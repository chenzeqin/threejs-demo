import{u as Ne,j as We,S as Ge,g as Ae,P as Je,W as Qe,s as Oe,O as He,b as Ue,k as Ke,B as Be,l as Ee,h as Pe,i as $e,D as Ce,I as ts,a as is,m as es}from"./chunks/useContainer.Bp5K8ok1.js";import{d as ss,y as as,z as ns,o as Fe,c as De,I as os,j as Me,a as qe,a2 as _s}from"./chunks/framework.DstARwHN.js";var m=m||{};m.collision||(m.collision={});m.collision.broadphase||(m.collision.broadphase={});m.collision.broadphase.BroadPhase=class{constructor(t){this._type=t,this._numProxies=0,this._proxyList=null,this._proxyListLast=null,this._proxyPairList=null,this._incremental=!1,this._testCount=0,this._proxyPairPool=null,this._idCount=0,this._convexSweep=new m.collision.broadphase._BroadPhase.ConvexSweepGeometry,this._aabb=new m.collision.broadphase._BroadPhase.AabbGeometry,this.identity=new m.common.Transform,this.zero=new m.common.Vec3,this.rayCastHit=new m.collision.geometry.RayCastHit}createProxy(t,i){return null}destroyProxy(t){}moveProxy(t,i,s){}isOverlapping(t,i){return t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ?t._aabbMaxZ>i._aabbMinZ:!1}collectPairs(){}getProxyPairList(){return this._proxyPairList}isIncremental(){return this._incremental}getTestCount(){return this._testCount}rayCast(t,i,s){}convexCast(t,i,s,o){}aabbTest(t,i){}};m.collision.geometry||(m.collision.geometry={});m.collision.geometry.Geometry=class{constructor(t){this._type=t,this._volume=0}_updateMass(){}_computeAabb(t,i){}_rayCastLocal(t,i,s,o,n,l,_){return!1}getType(){return this._type}getVolume(){return this._volume}rayCast(t,i,s,o){let n,l,_,r,e,a;n=t.x,l=t.y,_=t.z,r=i.x,e=i.y,a=i.z,n-=s._positionX,l-=s._positionY,_-=s._positionZ,r-=s._positionX,e-=s._positionY,a-=s._positionZ;let h,b,X;h=s._rotation00*n+s._rotation10*l+s._rotation20*_,b=s._rotation01*n+s._rotation11*l+s._rotation21*_,X=s._rotation02*n+s._rotation12*l+s._rotation22*_,n=h,l=b,_=X;let c,Y,p;if(c=s._rotation00*r+s._rotation10*e+s._rotation20*a,Y=s._rotation01*r+s._rotation11*e+s._rotation21*a,p=s._rotation02*r+s._rotation12*e+s._rotation22*a,r=c,e=Y,a=p,this._rayCastLocal(n,l,_,r,e,a,o)){let x,v,f,Z,k,g,I=o.position;x=I.x,v=I.y,f=I.z;let z=o.normal;Z=z.x,k=z.y,g=z.z;let d,u,B;d=s._rotation00*x+s._rotation01*v+s._rotation02*f,u=s._rotation10*x+s._rotation11*v+s._rotation12*f,B=s._rotation20*x+s._rotation21*v+s._rotation22*f,x=d,v=u,f=B;let j,L,V;j=s._rotation00*Z+s._rotation01*k+s._rotation02*g,L=s._rotation10*Z+s._rotation11*k+s._rotation12*g,V=s._rotation20*Z+s._rotation21*k+s._rotation22*g,Z=j,k=L,g=V,x+=s._positionX,v+=s._positionY,f+=s._positionZ;let M=o.position;M.x=x,M.y=v,M.z=f;let w=o.normal;return w.x=Z,w.y=k,w.z=g,!0}return!1}};m.collision.geometry.ConvexGeometry=class extends m.collision.geometry.Geometry{constructor(t){super(t),this._gjkMargin=m.common.Setting.defaultGJKMargin,this._useGjkRayCast=!1}getGjkMergin(){return this._gjkMargin}setGjkMergin(t){t<0&&(t=0),this._gjkMargin=t}computeLocalSupportingVertex(t,i){}rayCast(t,i,s,o){return this._useGjkRayCast?m.collision.narrowphase.detector.gjkepa.GjkEpa.instance.rayCast(this,s,t,i,o):super.rayCast(t,i,s,o)}};m.collision.broadphase._BroadPhase||(m.collision.broadphase._BroadPhase={});m.collision.broadphase._BroadPhase.ConvexSweepGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(){super(-1)}init(t,i,s){this.c=t;let o,n,l;o=s.x,n=s.y,l=s.z;let _,r,e,a,h,b;a=i._rotation00*o+i._rotation10*n+i._rotation20*l,h=i._rotation01*o+i._rotation11*n+i._rotation21*l,b=i._rotation02*o+i._rotation12*n+i._rotation22*l,_=a,r=h,e=b,this.localTranslation=new m.common.Vec3;let X=this.localTranslation;X.x=_,X.y=r,X.z=e,this._gjkMargin=t._gjkMargin}computeLocalSupportingVertex(t,i){this.c.computeLocalSupportingVertex(t,i);let s=this.localTranslation;if(t.x*s.x+t.y*s.y+t.z*s.z>0){let o=this.localTranslation;i.x+=o.x,i.y+=o.y,i.z+=o.z}}};m.collision.broadphase._BroadPhase.AabbGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(){super(-1),this.min=new m.common.Vec3,this.max=new m.common.Vec3}computeLocalSupportingVertex(t,i){i.x=t.x>0?this.max.x:this.min.x,i.y=t.y>0?this.max.y:this.min.y,i.z=t.z>0?this.max.z:this.min.z}};m.collision.broadphase.BroadPhaseProxyCallback=class{constructor(){}process(t){}};m.collision.broadphase.BroadPhaseType=class{};m.collision.broadphase.Proxy=class{constructor(t,i){this.userData=t,this._id=i,this._prev=null,this._next=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}getId(){return this._id}getFatAabb(){let t=new m.collision.geometry.Aabb;return t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ,t}getFatAabbTo(t){t._minX=this._aabbMinX,t._minY=this._aabbMinY,t._minZ=this._aabbMinZ,t._maxX=this._aabbMaxX,t._maxY=this._aabbMaxY,t._maxZ=this._aabbMaxZ}};m.collision.broadphase.ProxyPair=class{constructor(){this._p1=null,this._p2=null}getProxy1(){return this._p1}getProxy2(){return this._p2}getNext(){return this._next}};m.collision.broadphase.bruteforce||(m.collision.broadphase.bruteforce={});m.collision.broadphase.bruteforce.BruteForceBroadPhase=class extends m.collision.broadphase.BroadPhase{constructor(){super(1),this._incremental=!1}createProxy(t,i){let s=new m.collision.broadphase.Proxy(t,this._idCount++);return this._numProxies++,this._proxyList==null?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ,s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null,t.userData=null}moveProxy(t,i,s){t._aabbMinX=i._minX,t._aabbMinY=i._minY,t._aabbMinZ=i._minZ,t._aabbMaxX=i._maxX,t._aabbMaxY=i._maxY,t._aabbMaxZ=i._maxZ}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}this._testCount=0;let i=this._proxyList;for(;i!=null;){let s=i._next,o=i._next;for(;o!=null;){let n=o._next;if(this._testCount++,i._aabbMinX<o._aabbMaxX&&i._aabbMaxX>o._aabbMinX&&i._aabbMinY<o._aabbMaxY&&i._aabbMaxY>o._aabbMinY&&i._aabbMinZ<o._aabbMaxZ&&i._aabbMaxZ>o._aabbMinZ){let l=this._proxyPairPool;l!=null?(this._proxyPairPool=l._next,l._next=null):l=new m.collision.broadphase.ProxyPair;let _=l;this._proxyPairList==null?this._proxyPairList=_:(_._next=this._proxyPairList,this._proxyPairList=_),_._p1=i,_._p2=o}o=n}i=s}}rayCast(t,i,s){let o,n,l,_,r,e;o=t.x,n=t.y,l=t.z,_=i.x,r=i.y,e=i.z;let a=this._proxyList;for(;a!=null;){let h=a._next,b=o,X=n,c=l,Y=_,p=r,x=e,v=a._aabbMinX,f=a._aabbMinY,Z=a._aabbMinZ,k=a._aabbMaxX,g=a._aabbMaxY,I=a._aabbMaxZ,z;if(v>(b>Y?b:Y)||k<(b<Y?b:Y)||f>(X>p?X:p)||g<(X<p?X:p)||Z>(c>x?c:x)||I<(c<x?c:x))z=!1;else{let d=Y-b,u=p-X,B=x-c,j=d<0?-d:d,L=u<0?-u:u,V=B<0?-B:B,M=(k-v)*.5,w=(g-f)*.5,P=(I-Z)*.5,E=b-(k+v)*.5,C=X-(g+f)*.5,S=c-(I+Z)*.5,A,R,H=C*B-S*u;if((H<0?-H:H)-(w*V+P*L)>0)R=!0;else{let y=S*d-E*B;R=(y<0?-y:y)-(P*j+M*V)>0}if(R)A=!0;else{let y=E*u-C*d;A=(y<0?-y:y)-(M*L+w*j)>0}z=!A}z&&s.process(a),a=h}}convexCast(t,i,s,o){let n=this._proxyList;for(;n!=null;){let l=n._next,_=this._aabb.min;_.x=n._aabbMinX,_.y=n._aabbMinY,_.z=n._aabbMinZ;let r=this._aabb.max;r.x=n._aabbMaxX,r.y=n._aabbMaxY,r.z=n._aabbMaxZ,this._convexSweep.init(t,i,s);let e=m.collision.narrowphase.detector.gjkepa.GjkEpa.instance;e.computeClosestPointsImpl(this._convexSweep,this._aabb,i,this.identity,null,!1)==0&&e.distance<=0&&o.process(n),n=l}}aabbTest(t,i){let s=this._proxyList;for(;s!=null;){let o=s._next;t._minX<s._aabbMaxX&&t._maxX>s._aabbMinX&&t._minY<s._aabbMaxY&&t._maxY>s._aabbMinY&&t._minZ<s._aabbMaxZ&&t._maxZ>s._aabbMinZ&&i.process(s),s=o}}};m.collision.broadphase.bvh||(m.collision.broadphase.bvh={});m.collision.broadphase.bvh.BvhBroadPhase=class extends m.collision.broadphase.BroadPhase{constructor(){super(2),this._incremental=!0,this._tree=new m.collision.broadphase.bvh.BvhTree,this.movedProxies=new Array(1024),this.numMovedProxies=0}collide(t,i){this._testCount++;let s=t._height==0,o=i._height==0;if(t==i){if(s)return;this.collide(t._children[0],i),this.collide(t._children[1],i);return}if(t._aabbMinX<i._aabbMaxX&&t._aabbMaxX>i._aabbMinX&&t._aabbMinY<i._aabbMaxY&&t._aabbMaxY>i._aabbMinY&&t._aabbMinZ<i._aabbMaxZ&&t._aabbMaxZ>i._aabbMinZ){if(s&&o){let n=this._proxyPairPool;n!=null?(this._proxyPairPool=n._next,n._next=null):n=new m.collision.broadphase.ProxyPair;let l=n;this._proxyPairList==null?this._proxyPairList=l:(l._next=this._proxyPairList,this._proxyPairList=l),l._p1=t._proxy,l._p2=i._proxy;return}o||t._height>i._height?(this.collide(t._children[0],i),this.collide(t._children[1],i)):(this.collide(i._children[0],t),this.collide(i._children[1],t))}}rayCastRecursive(t,i,s,o,n,l,_,r){let e=i,a=s,h=o,b=n,X=l,c=_,Y=t._aabbMinX,p=t._aabbMinY,x=t._aabbMinZ,v=t._aabbMaxX,f=t._aabbMaxY,Z=t._aabbMaxZ,k;if(Y>(e>b?e:b)||v<(e<b?e:b)||p>(a>X?a:X)||f<(a<X?a:X)||x>(h>c?h:c)||Z<(h<c?h:c))k=!1;else{let g=b-e,I=X-a,z=c-h,d=g<0?-g:g,u=I<0?-I:I,B=z<0?-z:z,j=(v-Y)*.5,L=(f-p)*.5,V=(Z-x)*.5,M=e-(v+Y)*.5,w=a-(f+p)*.5,P=h-(Z+x)*.5,E,C,S=w*z-P*I;if((S<0?-S:S)-(L*B+V*u)>0)C=!0;else{let A=P*g-M*z;C=(A<0?-A:A)-(V*d+j*B)>0}if(C)E=!0;else{let A=M*I-w*g;E=(A<0?-A:A)-(j*u+L*d)>0}k=!E}if(k){if(t._height==0){r.process(t._proxy);return}this.rayCastRecursive(t._children[0],i,s,o,n,l,_,r),this.rayCastRecursive(t._children[1],i,s,o,n,l,_,r)}}convexCastRecursive(t,i,s,o,n){let l=this._aabb.min;l.x=t._aabbMinX,l.y=t._aabbMinY,l.z=t._aabbMinZ;let _=this._aabb.max;_.x=t._aabbMaxX,_.y=t._aabbMaxY,_.z=t._aabbMaxZ,this._convexSweep.init(i,s,o);let r=m.collision.narrowphase.detector.gjkepa.GjkEpa.instance;if(r.computeClosestPointsImpl(this._convexSweep,this._aabb,s,this.identity,null,!1)==0&&r.distance<=0){if(t._height==0){n.process(t._proxy);return}this.convexCastRecursive(t._children[0],i,s,o,n),this.convexCastRecursive(t._children[1],i,s,o,n)}}aabbTestRecursive(t,i,s){if(t._aabbMinX<i._maxX&&t._aabbMaxX>i._minX&&t._aabbMinY<i._maxY&&t._aabbMaxY>i._minY&&t._aabbMinZ<i._maxZ&&t._aabbMaxZ>i._minZ){if(t._height==0){s.process(t._proxy);return}this.aabbTestRecursive(t._children[0],i,s),this.aabbTestRecursive(t._children[1],i,s)}}createProxy(t,i){let s=new m.collision.broadphase.bvh.BvhProxy(t,this._idCount++);this._numProxies++,this._proxyList==null?(this._proxyList=s,this._proxyListLast=s):(this._proxyListLast._next=s,s._prev=this._proxyListLast,this._proxyListLast=s),s._aabbMinX=i._minX,s._aabbMinY=i._minY,s._aabbMinZ=i._minZ,s._aabbMaxX=i._maxX,s._aabbMaxY=i._maxY,s._aabbMaxZ=i._maxZ;let o=m.common.Setting.bvhProxyPadding;s._aabbMinX-=o,s._aabbMinY-=o,s._aabbMinZ-=o,s._aabbMaxX+=o,s._aabbMaxY+=o,s._aabbMaxZ+=o;let n=this._tree,l=n._nodePool;l!=null?(n._nodePool=l._next,l._next=null):l=new m.collision.broadphase.bvh.BvhNode;let _=l;if(_._proxy=s,s._leaf=_,_._aabbMinX=s._aabbMinX,_._aabbMinY=s._aabbMinY,_._aabbMinZ=s._aabbMinZ,_._aabbMaxX=s._aabbMaxX,_._aabbMaxY=s._aabbMaxY,_._aabbMaxZ=s._aabbMaxZ,n._numLeaves++,n.leafList==null?(n.leafList=_,n.leafListLast=_):(n.leafListLast._nextLeaf=_,_._prevLeaf=n.leafListLast,n.leafListLast=_),n._root==null)n._root=_;else{let r=n._root;for(;r._height>0;){let c=n._strategy._decideInsertion(r,_);if(c==-1)break;r=r._children[c]}let e=r._parent,a=n._nodePool;a!=null?(n._nodePool=a._next,a._next=null):a=new m.collision.broadphase.bvh.BvhNode;let h=a;if(e==null)n._root=h;else{let c=r._childIndex;e._children[c]=h,h._parent=e,h._childIndex=c}let b=r._childIndex;h._children[b]=r,r._parent=h,r._childIndex=b;let X=r._childIndex^1;for(h._children[X]=_,_._parent=h,_._childIndex=X;h!=null;){if(n._strategy._balancingEnabled&&h._height>=2){let v=h._parent,f=h._children[0],Z=h._children[1],k=f._height-Z._height,g=h._childIndex;if(k>1){let I=f._children[0],z=f._children[1];if(I._height>z._height){f._children[1]=h,h._parent=f,h._childIndex=1,h._children[0]=z,z._parent=h,z._childIndex=0;let d=f._children[0],u=f._children[1];f._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,f._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,f._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,f._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,f._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,f._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=f._children[0]._height,j=f._children[1]._height;f._height=(B>j?B:j)+1;let L=h._children[0],V=h._children[1];h._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,h._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,h._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,h._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,h._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,h._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=h._children[0]._height,w=h._children[1]._height;h._height=(M>w?M:w)+1}else{f._children[0]=h,h._parent=f,h._childIndex=0,h._children[0]=I,I._parent=h,I._childIndex=0;let d=f._children[0],u=f._children[1];f._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,f._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,f._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,f._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,f._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,f._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=f._children[0]._height,j=f._children[1]._height;f._height=(B>j?B:j)+1;let L=h._children[0],V=h._children[1];h._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,h._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,h._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,h._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,h._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,h._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=h._children[0]._height,w=h._children[1]._height;h._height=(M>w?M:w)+1}v!=null?(v._children[g]=f,f._parent=v,f._childIndex=g):(n._root=f,f._parent=null),h=f}else if(k<-1){let I=Z._children[0],z=Z._children[1];if(I._height>z._height){Z._children[1]=h,h._parent=Z,h._childIndex=1,h._children[1]=z,z._parent=h,z._childIndex=1;let d=Z._children[0],u=Z._children[1];Z._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,Z._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,Z._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,Z._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,Z._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,Z._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=Z._children[0]._height,j=Z._children[1]._height;Z._height=(B>j?B:j)+1;let L=h._children[0],V=h._children[1];h._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,h._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,h._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,h._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,h._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,h._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=h._children[0]._height,w=h._children[1]._height;h._height=(M>w?M:w)+1}else{Z._children[0]=h,h._parent=Z,h._childIndex=0,h._children[1]=I,I._parent=h,I._childIndex=1;let d=Z._children[0],u=Z._children[1];Z._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,Z._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,Z._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,Z._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,Z._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,Z._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=Z._children[0]._height,j=Z._children[1]._height;Z._height=(B>j?B:j)+1;let L=h._children[0],V=h._children[1];h._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,h._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,h._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,h._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,h._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,h._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=h._children[0]._height,w=h._children[1]._height;h._height=(M>w?M:w)+1}v!=null?(v._children[g]=Z,Z._parent=v,Z._childIndex=g):(n._root=Z,Z._parent=null),h=Z}}let c=h._children[0]._height,Y=h._children[1]._height;h._height=(c>Y?c:Y)+1;let p=h._children[0],x=h._children[1];h._aabbMinX=p._aabbMinX<x._aabbMinX?p._aabbMinX:x._aabbMinX,h._aabbMinY=p._aabbMinY<x._aabbMinY?p._aabbMinY:x._aabbMinY,h._aabbMinZ=p._aabbMinZ<x._aabbMinZ?p._aabbMinZ:x._aabbMinZ,h._aabbMaxX=p._aabbMaxX>x._aabbMaxX?p._aabbMaxX:x._aabbMaxX,h._aabbMaxY=p._aabbMaxY>x._aabbMaxY?p._aabbMaxY:x._aabbMaxY,h._aabbMaxZ=p._aabbMaxZ>x._aabbMaxZ?p._aabbMaxZ:x._aabbMaxZ,h=h._parent}}if(!s._moved){if(s._moved=!0,this.movedProxies.length==this.numMovedProxies){let r=new Array(this.numMovedProxies<<1),e=0,a=this.numMovedProxies;for(;e<a;){let h=e++;r[h]=this.movedProxies[h],this.movedProxies[h]=null}this.movedProxies=r}this.movedProxies[this.numMovedProxies++]=s}return s}destroyProxy(t){this._numProxies--;let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._proxyList&&(this._proxyList=this._proxyList._next),t==this._proxyListLast&&(this._proxyListLast=this._proxyListLast._prev),t._next=null,t._prev=null;let o=t,n=this._tree,l=o._leaf;n._numLeaves--;let _=l._prevLeaf,r=l._nextLeaf;if(_!=null&&(_._nextLeaf=r),r!=null&&(r._prevLeaf=_),l==n.leafList&&(n.leafList=n.leafList._nextLeaf),l==n.leafListLast&&(n.leafListLast=n.leafListLast._prevLeaf),l._nextLeaf=null,l._prevLeaf=null,n._root==l)n._root=null;else{let e=l._parent,a=e._children[l._childIndex^1],h=e._parent;if(h==null)a._parent=null,a._childIndex=0,n._root=a,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=n._nodePool,n._nodePool=e;else{a._parent=h;let b=e._childIndex;h._children[b]=a,a._parent=h,a._childIndex=b,e._next=null,e._childIndex=0,e._children[0]=null,e._children[1]=null,e._childIndex=0,e._parent=null,e._height=0,e._proxy=null,e._next=n._nodePool,n._nodePool=e;let X=h;for(;X!=null;){if(n._strategy._balancingEnabled&&X._height>=2){let v=X._parent,f=X._children[0],Z=X._children[1],k=f._height-Z._height,g=X._childIndex;if(k>1){let I=f._children[0],z=f._children[1];if(I._height>z._height){f._children[1]=X,X._parent=f,X._childIndex=1,X._children[0]=z,z._parent=X,z._childIndex=0;let d=f._children[0],u=f._children[1];f._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,f._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,f._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,f._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,f._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,f._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=f._children[0]._height,j=f._children[1]._height;f._height=(B>j?B:j)+1;let L=X._children[0],V=X._children[1];X._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,X._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,X._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,X._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,X._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,X._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=X._children[0]._height,w=X._children[1]._height;X._height=(M>w?M:w)+1}else{f._children[0]=X,X._parent=f,X._childIndex=0,X._children[0]=I,I._parent=X,I._childIndex=0;let d=f._children[0],u=f._children[1];f._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,f._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,f._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,f._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,f._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,f._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=f._children[0]._height,j=f._children[1]._height;f._height=(B>j?B:j)+1;let L=X._children[0],V=X._children[1];X._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,X._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,X._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,X._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,X._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,X._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=X._children[0]._height,w=X._children[1]._height;X._height=(M>w?M:w)+1}v!=null?(v._children[g]=f,f._parent=v,f._childIndex=g):(n._root=f,f._parent=null),X=f}else if(k<-1){let I=Z._children[0],z=Z._children[1];if(I._height>z._height){Z._children[1]=X,X._parent=Z,X._childIndex=1,X._children[1]=z,z._parent=X,z._childIndex=1;let d=Z._children[0],u=Z._children[1];Z._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,Z._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,Z._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,Z._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,Z._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,Z._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=Z._children[0]._height,j=Z._children[1]._height;Z._height=(B>j?B:j)+1;let L=X._children[0],V=X._children[1];X._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,X._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,X._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,X._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,X._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,X._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=X._children[0]._height,w=X._children[1]._height;X._height=(M>w?M:w)+1}else{Z._children[0]=X,X._parent=Z,X._childIndex=0,X._children[1]=I,I._parent=X,I._childIndex=1;let d=Z._children[0],u=Z._children[1];Z._aabbMinX=d._aabbMinX<u._aabbMinX?d._aabbMinX:u._aabbMinX,Z._aabbMinY=d._aabbMinY<u._aabbMinY?d._aabbMinY:u._aabbMinY,Z._aabbMinZ=d._aabbMinZ<u._aabbMinZ?d._aabbMinZ:u._aabbMinZ,Z._aabbMaxX=d._aabbMaxX>u._aabbMaxX?d._aabbMaxX:u._aabbMaxX,Z._aabbMaxY=d._aabbMaxY>u._aabbMaxY?d._aabbMaxY:u._aabbMaxY,Z._aabbMaxZ=d._aabbMaxZ>u._aabbMaxZ?d._aabbMaxZ:u._aabbMaxZ;let B=Z._children[0]._height,j=Z._children[1]._height;Z._height=(B>j?B:j)+1;let L=X._children[0],V=X._children[1];X._aabbMinX=L._aabbMinX<V._aabbMinX?L._aabbMinX:V._aabbMinX,X._aabbMinY=L._aabbMinY<V._aabbMinY?L._aabbMinY:V._aabbMinY,X._aabbMinZ=L._aabbMinZ<V._aabbMinZ?L._aabbMinZ:V._aabbMinZ,X._aabbMaxX=L._aabbMaxX>V._aabbMaxX?L._aabbMaxX:V._aabbMaxX,X._aabbMaxY=L._aabbMaxY>V._aabbMaxY?L._aabbMaxY:V._aabbMaxY,X._aabbMaxZ=L._aabbMaxZ>V._aabbMaxZ?L._aabbMaxZ:V._aabbMaxZ;let M=X._children[0]._height,w=X._children[1]._height;X._height=(M>w?M:w)+1}v!=null?(v._children[g]=Z,Z._parent=v,Z._childIndex=g):(n._root=Z,Z._parent=null),X=Z}}let c=X._children[0]._height,Y=X._children[1]._height;X._height=(c>Y?c:Y)+1;let p=X._children[0],x=X._children[1];X._aabbMinX=p._aabbMinX<x._aabbMinX?p._aabbMinX:x._aabbMinX,X._aabbMinY=p._aabbMinY<x._aabbMinY?p._aabbMinY:x._aabbMinY,X._aabbMinZ=p._aabbMinZ<x._aabbMinZ?p._aabbMinZ:x._aabbMinZ,X._aabbMaxX=p._aabbMaxX>x._aabbMaxX?p._aabbMaxX:x._aabbMaxX,X._aabbMaxY=p._aabbMaxY>x._aabbMaxY?p._aabbMaxY:x._aabbMaxY,X._aabbMaxZ=p._aabbMaxZ>x._aabbMaxZ?p._aabbMaxZ:x._aabbMaxZ,X=X._parent}}}o._leaf=null,l._next=null,l._childIndex=0,l._children[0]=null,l._children[1]=null,l._childIndex=0,l._parent=null,l._height=0,l._proxy=null,l._next=n._nodePool,n._nodePool=l,o.userData=null,o._next=null,o._prev=null,o._moved&&(o._moved=!1)}moveProxy(t,i,s){let o=t;if(o._aabbMinX<=i._minX&&o._aabbMaxX>=i._maxX&&o._aabbMinY<=i._minY&&o._aabbMaxY>=i._maxY&&o._aabbMinZ<=i._minZ&&o._aabbMaxZ>=i._maxZ)return;o._aabbMinX=i._minX,o._aabbMinY=i._minY,o._aabbMinZ=i._minZ,o._aabbMaxX=i._maxX,o._aabbMaxY=i._maxY,o._aabbMaxZ=i._maxZ;let n=m.common.Setting.bvhProxyPadding;if(o._aabbMinX-=n,o._aabbMinY-=n,o._aabbMinZ-=n,o._aabbMaxX+=n,o._aabbMaxY+=n,o._aabbMaxZ+=n,s!=null){let l,_,r,e,a,h,b,X,c,Y,p,x;e=0,a=0,h=0,l=s.x,_=s.y,r=s.z,b=e<l?e:l,X=a<_?a:_,c=h<r?h:r,Y=e>l?e:l,p=a>_?a:_,x=h>r?h:r,o._aabbMinX+=b,o._aabbMinY+=X,o._aabbMinZ+=c,o._aabbMaxX+=Y,o._aabbMaxY+=p,o._aabbMaxZ+=x}if(!o._moved){if(o._moved=!0,this.movedProxies.length==this.numMovedProxies){let l=new Array(this.numMovedProxies<<1),_=0,r=this.numMovedProxies;for(;_<r;){let e=_++;l[e]=this.movedProxies[e],this.movedProxies[e]=null}this.movedProxies=l}this.movedProxies[this.numMovedProxies++]=o}}collectPairs(){let t=this._proxyPairList;if(t!=null){for(;t._p1=null,t._p2=null,t=t._next,t!=null;);this._proxyPairList._next=this._proxyPairPool,this._proxyPairPool=this._proxyPairList,this._proxyPairList=null}if(this._testCount=0,this._numProxies<2)return;let i=this.numMovedProxies/this._numProxies<m.common.Setting.bvhIncrementalCollisionThreshold,s=0,o=this.numMovedProxies;for(;s<o;){let n=s++,l=this.movedProxies[n];if(l._moved){let _=this._tree,r=l._leaf;_._numLeaves--;let e=r._prevLeaf,a=r._nextLeaf;if(e!=null&&(e._nextLeaf=a),a!=null&&(a._prevLeaf=e),r==_.leafList&&(_.leafList=_.leafList._nextLeaf),r==_.leafListLast&&(_.leafListLast=_.leafListLast._prevLeaf),r._nextLeaf=null,r._prevLeaf=null,_._root==r)_._root=null;else{let c=r._parent,Y=c._children[r._childIndex^1],p=c._parent;if(p==null)Y._parent=null,Y._childIndex=0,_._root=Y,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=_._nodePool,_._nodePool=c;else{Y._parent=p;let x=c._childIndex;p._children[x]=Y,Y._parent=p,Y._childIndex=x,c._next=null,c._childIndex=0,c._children[0]=null,c._children[1]=null,c._childIndex=0,c._parent=null,c._height=0,c._proxy=null,c._next=_._nodePool,_._nodePool=c;let v=p;for(;v!=null;){if(_._strategy._balancingEnabled&&v._height>=2){let I=v._parent,z=v._children[0],d=v._children[1],u=z._height-d._height,B=v._childIndex;if(u>1){let j=z._children[0],L=z._children[1];if(j._height>L._height){z._children[1]=v,v._parent=z,v._childIndex=1,v._children[0]=L,L._parent=v,L._childIndex=0;let V=z._children[0],M=z._children[1];z._aabbMinX=V._aabbMinX<M._aabbMinX?V._aabbMinX:M._aabbMinX,z._aabbMinY=V._aabbMinY<M._aabbMinY?V._aabbMinY:M._aabbMinY,z._aabbMinZ=V._aabbMinZ<M._aabbMinZ?V._aabbMinZ:M._aabbMinZ,z._aabbMaxX=V._aabbMaxX>M._aabbMaxX?V._aabbMaxX:M._aabbMaxX,z._aabbMaxY=V._aabbMaxY>M._aabbMaxY?V._aabbMaxY:M._aabbMaxY,z._aabbMaxZ=V._aabbMaxZ>M._aabbMaxZ?V._aabbMaxZ:M._aabbMaxZ;let w=z._children[0]._height,P=z._children[1]._height;z._height=(w>P?w:P)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let S=v._children[0]._height,A=v._children[1]._height;v._height=(S>A?S:A)+1}else{z._children[0]=v,v._parent=z,v._childIndex=0,v._children[0]=j,j._parent=v,j._childIndex=0;let V=z._children[0],M=z._children[1];z._aabbMinX=V._aabbMinX<M._aabbMinX?V._aabbMinX:M._aabbMinX,z._aabbMinY=V._aabbMinY<M._aabbMinY?V._aabbMinY:M._aabbMinY,z._aabbMinZ=V._aabbMinZ<M._aabbMinZ?V._aabbMinZ:M._aabbMinZ,z._aabbMaxX=V._aabbMaxX>M._aabbMaxX?V._aabbMaxX:M._aabbMaxX,z._aabbMaxY=V._aabbMaxY>M._aabbMaxY?V._aabbMaxY:M._aabbMaxY,z._aabbMaxZ=V._aabbMaxZ>M._aabbMaxZ?V._aabbMaxZ:M._aabbMaxZ;let w=z._children[0]._height,P=z._children[1]._height;z._height=(w>P?w:P)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let S=v._children[0]._height,A=v._children[1]._height;v._height=(S>A?S:A)+1}I!=null?(I._children[B]=z,z._parent=I,z._childIndex=B):(_._root=z,z._parent=null),v=z}else if(u<-1){let j=d._children[0],L=d._children[1];if(j._height>L._height){d._children[1]=v,v._parent=d,v._childIndex=1,v._children[1]=L,L._parent=v,L._childIndex=1;let V=d._children[0],M=d._children[1];d._aabbMinX=V._aabbMinX<M._aabbMinX?V._aabbMinX:M._aabbMinX,d._aabbMinY=V._aabbMinY<M._aabbMinY?V._aabbMinY:M._aabbMinY,d._aabbMinZ=V._aabbMinZ<M._aabbMinZ?V._aabbMinZ:M._aabbMinZ,d._aabbMaxX=V._aabbMaxX>M._aabbMaxX?V._aabbMaxX:M._aabbMaxX,d._aabbMaxY=V._aabbMaxY>M._aabbMaxY?V._aabbMaxY:M._aabbMaxY,d._aabbMaxZ=V._aabbMaxZ>M._aabbMaxZ?V._aabbMaxZ:M._aabbMaxZ;let w=d._children[0]._height,P=d._children[1]._height;d._height=(w>P?w:P)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let S=v._children[0]._height,A=v._children[1]._height;v._height=(S>A?S:A)+1}else{d._children[0]=v,v._parent=d,v._childIndex=0,v._children[1]=j,j._parent=v,j._childIndex=1;let V=d._children[0],M=d._children[1];d._aabbMinX=V._aabbMinX<M._aabbMinX?V._aabbMinX:M._aabbMinX,d._aabbMinY=V._aabbMinY<M._aabbMinY?V._aabbMinY:M._aabbMinY,d._aabbMinZ=V._aabbMinZ<M._aabbMinZ?V._aabbMinZ:M._aabbMinZ,d._aabbMaxX=V._aabbMaxX>M._aabbMaxX?V._aabbMaxX:M._aabbMaxX,d._aabbMaxY=V._aabbMaxY>M._aabbMaxY?V._aabbMaxY:M._aabbMaxY,d._aabbMaxZ=V._aabbMaxZ>M._aabbMaxZ?V._aabbMaxZ:M._aabbMaxZ;let w=d._children[0]._height,P=d._children[1]._height;d._height=(w>P?w:P)+1;let E=v._children[0],C=v._children[1];v._aabbMinX=E._aabbMinX<C._aabbMinX?E._aabbMinX:C._aabbMinX,v._aabbMinY=E._aabbMinY<C._aabbMinY?E._aabbMinY:C._aabbMinY,v._aabbMinZ=E._aabbMinZ<C._aabbMinZ?E._aabbMinZ:C._aabbMinZ,v._aabbMaxX=E._aabbMaxX>C._aabbMaxX?E._aabbMaxX:C._aabbMaxX,v._aabbMaxY=E._aabbMaxY>C._aabbMaxY?E._aabbMaxY:C._aabbMaxY,v._aabbMaxZ=E._aabbMaxZ>C._aabbMaxZ?E._aabbMaxZ:C._aabbMaxZ;let S=v._children[0]._height,A=v._children[1]._height;v._height=(S>A?S:A)+1}I!=null?(I._children[B]=d,d._parent=I,d._childIndex=B):(_._root=d,d._parent=null),v=d}}let f=v._children[0]._height,Z=v._children[1]._height;v._height=(f>Z?f:Z)+1;let k=v._children[0],g=v._children[1];v._aabbMinX=k._aabbMinX<g._aabbMinX?k._aabbMinX:g._aabbMinX,v._aabbMinY=k._aabbMinY<g._aabbMinY?k._aabbMinY:g._aabbMinY,v._aabbMinZ=k._aabbMinZ<g._aabbMinZ?k._aabbMinZ:g._aabbMinZ,v._aabbMaxX=k._aabbMaxX>g._aabbMaxX?k._aabbMaxX:g._aabbMaxX,v._aabbMaxY=k._aabbMaxY>g._aabbMaxY?k._aabbMaxY:g._aabbMaxY,v._aabbMaxZ=k._aabbMaxZ>g._aabbMaxZ?k._aabbMaxZ:g._aabbMaxZ,v=v._parent}}}l._leaf=null,r._next=null,r._childIndex=0,r._children[0]=null,r._children[1]=null,r._childIndex=0,r._parent=null,r._height=0,r._proxy=null,r._next=_._nodePool,_._nodePool=r;let h=this._tree,b=h._nodePool;b!=null?(h._nodePool=b._next,b._next=null):b=new m.collision.broadphase.bvh.BvhNode;let X=b;if(X._proxy=l,l._leaf=X,X._aabbMinX=l._aabbMinX,X._aabbMinY=l._aabbMinY,X._aabbMinZ=l._aabbMinZ,X._aabbMaxX=l._aabbMaxX,X._aabbMaxY=l._aabbMaxY,X._aabbMaxZ=l._aabbMaxZ,h._numLeaves++,h.leafList==null?(h.leafList=X,h.leafListLast=X):(h.leafListLast._nextLeaf=X,X._prevLeaf=h.leafListLast,h.leafListLast=X),h._root==null)h._root=X;else{let c=h._root;for(;c._height>0;){let Z=h._strategy._decideInsertion(c,X);if(Z==-1)break;c=c._children[Z]}let Y=c._parent,p=h._nodePool;p!=null?(h._nodePool=p._next,p._next=null):p=new m.collision.broadphase.bvh.BvhNode;let x=p;if(Y==null)h._root=x;else{let Z=c._childIndex;Y._children[Z]=x,x._parent=Y,x._childIndex=Z}let v=c._childIndex;x._children[v]=c,c._parent=x,c._childIndex=v;let f=c._childIndex^1;for(x._children[f]=X,X._parent=x,X._childIndex=f;x!=null;){if(h._strategy._balancingEnabled&&x._height>=2){let z=x._parent,d=x._children[0],u=x._children[1],B=d._height-u._height,j=x._childIndex;if(B>1){let L=d._children[0],V=d._children[1];if(L._height>V._height){d._children[1]=x,x._parent=d,x._childIndex=1,x._children[0]=V,V._parent=x,V._childIndex=0;let M=d._children[0],w=d._children[1];d._aabbMinX=M._aabbMinX<w._aabbMinX?M._aabbMinX:w._aabbMinX,d._aabbMinY=M._aabbMinY<w._aabbMinY?M._aabbMinY:w._aabbMinY,d._aabbMinZ=M._aabbMinZ<w._aabbMinZ?M._aabbMinZ:w._aabbMinZ,d._aabbMaxX=M._aabbMaxX>w._aabbMaxX?M._aabbMaxX:w._aabbMaxX,d._aabbMaxY=M._aabbMaxY>w._aabbMaxY?M._aabbMaxY:w._aabbMaxY,d._aabbMaxZ=M._aabbMaxZ>w._aabbMaxZ?M._aabbMaxZ:w._aabbMaxZ;let P=d._children[0]._height,E=d._children[1]._height;d._height=(P>E?P:E)+1;let C=x._children[0],S=x._children[1];x._aabbMinX=C._aabbMinX<S._aabbMinX?C._aabbMinX:S._aabbMinX,x._aabbMinY=C._aabbMinY<S._aabbMinY?C._aabbMinY:S._aabbMinY,x._aabbMinZ=C._aabbMinZ<S._aabbMinZ?C._aabbMinZ:S._aabbMinZ,x._aabbMaxX=C._aabbMaxX>S._aabbMaxX?C._aabbMaxX:S._aabbMaxX,x._aabbMaxY=C._aabbMaxY>S._aabbMaxY?C._aabbMaxY:S._aabbMaxY,x._aabbMaxZ=C._aabbMaxZ>S._aabbMaxZ?C._aabbMaxZ:S._aabbMaxZ;let A=x._children[0]._height,R=x._children[1]._height;x._height=(A>R?A:R)+1}else{d._children[0]=x,x._parent=d,x._childIndex=0,x._children[0]=L,L._parent=x,L._childIndex=0;let M=d._children[0],w=d._children[1];d._aabbMinX=M._aabbMinX<w._aabbMinX?M._aabbMinX:w._aabbMinX,d._aabbMinY=M._aabbMinY<w._aabbMinY?M._aabbMinY:w._aabbMinY,d._aabbMinZ=M._aabbMinZ<w._aabbMinZ?M._aabbMinZ:w._aabbMinZ,d._aabbMaxX=M._aabbMaxX>w._aabbMaxX?M._aabbMaxX:w._aabbMaxX,d._aabbMaxY=M._aabbMaxY>w._aabbMaxY?M._aabbMaxY:w._aabbMaxY,d._aabbMaxZ=M._aabbMaxZ>w._aabbMaxZ?M._aabbMaxZ:w._aabbMaxZ;let P=d._children[0]._height,E=d._children[1]._height;d._height=(P>E?P:E)+1;let C=x._children[0],S=x._children[1];x._aabbMinX=C._aabbMinX<S._aabbMinX?C._aabbMinX:S._aabbMinX,x._aabbMinY=C._aabbMinY<S._aabbMinY?C._aabbMinY:S._aabbMinY,x._aabbMinZ=C._aabbMinZ<S._aabbMinZ?C._aabbMinZ:S._aabbMinZ,x._aabbMaxX=C._aabbMaxX>S._aabbMaxX?C._aabbMaxX:S._aabbMaxX,x._aabbMaxY=C._aabbMaxY>S._aabbMaxY?C._aabbMaxY:S._aabbMaxY,x._aabbMaxZ=C._aabbMaxZ>S._aabbMaxZ?C._aabbMaxZ:S._aabbMaxZ;let A=x._children[0]._height,R=x._children[1]._height;x._height=(A>R?A:R)+1}z!=null?(z._children[j]=d,d._parent=z,d._childIndex=j):(h._root=d,d._parent=null),x=d}else if(B<-1){let L=u._children[0],V=u._children[1];if(L._height>V._height){u._children[1]=x,x._parent=u,x._childIndex=1,x._children[1]=V,V._parent=x,V._childIndex=1;let M=u._children[0],w=u._children[1];u._aabbMinX=M._aabbMinX<w._aabbMinX?M._aabbMinX:w._aabbMinX,u._aabbMinY=M._aabbMinY<w._aabbMinY?M._aabbMinY:w._aabbMinY,u._aabbMinZ=M._aabbMinZ<w._aabbMinZ?M._aabbMinZ:w._aabbMinZ,u._aabbMaxX=M._aabbMaxX>w._aabbMaxX?M._aabbMaxX:w._aabbMaxX,u._aabbMaxY=M._aabbMaxY>w._aabbMaxY?M._aabbMaxY:w._aabbMaxY,u._aabbMaxZ=M._aabbMaxZ>w._aabbMaxZ?M._aabbMaxZ:w._aabbMaxZ;let P=u._children[0]._height,E=u._children[1]._height;u._height=(P>E?P:E)+1;let C=x._children[0],S=x._children[1];x._aabbMinX=C._aabbMinX<S._aabbMinX?C._aabbMinX:S._aabbMinX,x._aabbMinY=C._aabbMinY<S._aabbMinY?C._aabbMinY:S._aabbMinY,x._aabbMinZ=C._aabbMinZ<S._aabbMinZ?C._aabbMinZ:S._aabbMinZ,x._aabbMaxX=C._aabbMaxX>S._aabbMaxX?C._aabbMaxX:S._aabbMaxX,x._aabbMaxY=C._aabbMaxY>S._aabbMaxY?C._aabbMaxY:S._aabbMaxY,x._aabbMaxZ=C._aabbMaxZ>S._aabbMaxZ?C._aabbMaxZ:S._aabbMaxZ;let A=x._children[0]._height,R=x._children[1]._height;x._height=(A>R?A:R)+1}else{u._children[0]=x,x._parent=u,x._childIndex=0,x._children[1]=L,L._parent=x,L._childIndex=1;let M=u._children[0],w=u._children[1];u._aabbMinX=M._aabbMinX<w._aabbMinX?M._aabbMinX:w._aabbMinX,u._aabbMinY=M._aabbMinY<w._aabbMinY?M._aabbMinY:w._aabbMinY,u._aabbMinZ=M._aabbMinZ<w._aabbMinZ?M._aabbMinZ:w._aabbMinZ,u._aabbMaxX=M._aabbMaxX>w._aabbMaxX?M._aabbMaxX:w._aabbMaxX,u._aabbMaxY=M._aabbMaxY>w._aabbMaxY?M._aabbMaxY:w._aabbMaxY,u._aabbMaxZ=M._aabbMaxZ>w._aabbMaxZ?M._aabbMaxZ:w._aabbMaxZ;let P=u._children[0]._height,E=u._children[1]._height;u._height=(P>E?P:E)+1;let C=x._children[0],S=x._children[1];x._aabbMinX=C._aabbMinX<S._aabbMinX?C._aabbMinX:S._aabbMinX,x._aabbMinY=C._aabbMinY<S._aabbMinY?C._aabbMinY:S._aabbMinY,x._aabbMinZ=C._aabbMinZ<S._aabbMinZ?C._aabbMinZ:S._aabbMinZ,x._aabbMaxX=C._aabbMaxX>S._aabbMaxX?C._aabbMaxX:S._aabbMaxX,x._aabbMaxY=C._aabbMaxY>S._aabbMaxY?C._aabbMaxY:S._aabbMaxY,x._aabbMaxZ=C._aabbMaxZ>S._aabbMaxZ?C._aabbMaxZ:S._aabbMaxZ;let A=x._children[0]._height,R=x._children[1]._height;x._height=(A>R?A:R)+1}z!=null?(z._children[j]=u,u._parent=z,u._childIndex=j):(h._root=u,u._parent=null),x=u}}let Z=x._children[0]._height,k=x._children[1]._height;x._height=(Z>k?Z:k)+1;let g=x._children[0],I=x._children[1];x._aabbMinX=g._aabbMinX<I._aabbMinX?g._aabbMinX:I._aabbMinX,x._aabbMinY=g._aabbMinY<I._aabbMinY?g._aabbMinY:I._aabbMinY,x._aabbMinZ=g._aabbMinZ<I._aabbMinZ?g._aabbMinZ:I._aabbMinZ,x._aabbMaxX=g._aabbMaxX>I._aabbMaxX?g._aabbMaxX:I._aabbMaxX,x._aabbMaxY=g._aabbMaxY>I._aabbMaxY?g._aabbMaxY:I._aabbMaxY,x._aabbMaxZ=g._aabbMaxZ>I._aabbMaxZ?g._aabbMaxZ:I._aabbMaxZ,x=x._parent}}i&&this.collide(this._tree._root,l._leaf),l._moved=!1}this.movedProxies[n]=null}i||this.collide(this._tree._root,this._tree._root),this.numMovedProxies=0}rayCast(t,i,s){if(this._tree._root==null)return;let o,n,l,_,r,e;o=t.x,n=t.y,l=t.z,_=i.x,r=i.y,e=i.z,this.rayCastRecursive(this._tree._root,o,n,l,_,r,e,s)}convexCast(t,i,s,o){this._tree._root!=null&&this.convexCastRecursive(this._tree._root,t,i,s,o)}aabbTest(t,i){this._tree._root!=null&&this.aabbTestRecursive(this._tree._root,t,i)}getTreeBalance(){return this._tree._getBalance()}};m.collision.broadphase.bvh.BvhInsertionStrategy=class{};m.collision.broadphase.bvh.BvhNode=class{constructor(){this._next=null,this._prevLeaf=null,this._nextLeaf=null,this._children=new Array(2),this._childIndex=0,this._parent=null,this._height=0,this._proxy=null,this._aabbMinX=0,this._aabbMinY=0,this._aabbMinZ=0,this._aabbMaxX=0,this._aabbMaxY=0,this._aabbMaxZ=0}};m.collision.broadphase.bvh.BvhProxy=class extends m.collision.broadphase.Proxy{constructor(t,i){super(t,i),this._leaf=null,this._moved=!1}};m.collision.broadphase.bvh.BvhStrategy=class{constructor(){this._insertionStrategy=0,this._balancingEnabled=!1}_decideInsertion(t,i){switch(this._insertionStrategy){case 0:let s,o,n;s=i._aabbMinX+i._aabbMaxX,o=i._aabbMinY+i._aabbMaxY,n=i._aabbMinZ+i._aabbMaxZ;let l=t._children[0],_=t._children[1],r,e,a,h,b,X;return r=l._aabbMinX+l._aabbMaxX,e=l._aabbMinY+l._aabbMaxY,a=l._aabbMinZ+l._aabbMaxZ,h=_._aabbMinX+_._aabbMaxX,b=_._aabbMinY+_._aabbMaxY,X=_._aabbMinZ+_._aabbMaxZ,r-=s,e-=o,a-=n,h-=s,b-=o,X-=n,r*r+e*e+a*a<h*h+b*b+X*X?0:1;case 1:let c=t._children[0],Y=t._children[1],p=t._aabbMaxY-t._aabbMinY,x=t._aabbMaxZ-t._aabbMinZ,v,f,Z,k,g,I;v=t._aabbMinX<i._aabbMinX?t._aabbMinX:i._aabbMinX,f=t._aabbMinY<i._aabbMinY?t._aabbMinY:i._aabbMinY,Z=t._aabbMinZ<i._aabbMinZ?t._aabbMinZ:i._aabbMinZ,k=t._aabbMaxX>i._aabbMaxX?t._aabbMaxX:i._aabbMaxX,g=t._aabbMaxY>i._aabbMaxY?t._aabbMaxY:i._aabbMaxY,I=t._aabbMaxZ>i._aabbMaxZ?t._aabbMaxZ:i._aabbMaxZ;let z=g-f,d=I-Z,u=((k-v)*(z+d)+z*d)*2,B=u*2,j=(u-((t._aabbMaxX-t._aabbMinX)*(p+x)+p*x)*2)*2,L;if(v=c._aabbMinX<i._aabbMinX?c._aabbMinX:i._aabbMinX,f=c._aabbMinY<i._aabbMinY?c._aabbMinY:i._aabbMinY,Z=c._aabbMinZ<i._aabbMinZ?c._aabbMinZ:i._aabbMinZ,k=c._aabbMaxX>i._aabbMaxX?c._aabbMaxX:i._aabbMaxX,g=c._aabbMaxY>i._aabbMaxY?c._aabbMaxY:i._aabbMaxY,I=c._aabbMaxZ>i._aabbMaxZ?c._aabbMaxZ:i._aabbMaxZ,c._height==0){let M=g-f,w=I-Z;L=j+((k-v)*(M+w)+M*w)*2}else{let M=g-f,w=I-Z,P=c._aabbMaxY-c._aabbMinY,E=c._aabbMaxZ-c._aabbMinZ;L=j+(((k-v)*(M+w)+M*w)*2-((c._aabbMaxX-c._aabbMinX)*(P+E)+P*E)*2)}let V;if(v=Y._aabbMinX<i._aabbMinX?Y._aabbMinX:i._aabbMinX,f=Y._aabbMinY<i._aabbMinY?Y._aabbMinY:i._aabbMinY,Z=Y._aabbMinZ<i._aabbMinZ?Y._aabbMinZ:i._aabbMinZ,k=Y._aabbMaxX>i._aabbMaxX?Y._aabbMaxX:i._aabbMaxX,g=Y._aabbMaxY>i._aabbMaxY?Y._aabbMaxY:i._aabbMaxY,I=Y._aabbMaxZ>i._aabbMaxZ?Y._aabbMaxZ:i._aabbMaxZ,Y._height==0){let M=g-f,w=I-Z;V=j+((k-v)*(M+w)+M*w)*2}else{let M=g-f,w=I-Z,P=Y._aabbMaxY-Y._aabbMinY,E=Y._aabbMaxZ-Y._aabbMinZ;V=j+(((k-v)*(M+w)+M*w)*2-((Y._aabbMaxX-Y._aabbMinX)*(P+E)+P*E)*2)}return B<L?B<V?-1:1:L<V?0:1;default:return console.log("src/oimo/collision/broadphase/bvh/BvhStrategy.hx:37:","invalid BVH insertion strategy: "+this._insertionStrategy),-1}}_splitLeaves(t,i,s){let o=1/(s-i),n,l,_;n=0,l=0,_=0;let r=i;for(;r<s;){let v=t[r++];v._tmpX=v._aabbMaxX+v._aabbMinX,v._tmpY=v._aabbMaxY+v._aabbMinY,v._tmpZ=v._aabbMaxZ+v._aabbMinZ,n+=v._tmpX,l+=v._tmpY,_+=v._tmpZ}n*=o,l*=o,_*=o;let e,a,h;e=0,a=0,h=0;let b=i;for(;b<s;){let v=t[b++],f,Z,k;f=v._tmpX-n,Z=v._tmpY-l,k=v._tmpZ-_,f*=f,Z*=Z,k*=k,e+=f,a+=Z,h+=k}let X=e,c=a,Y=h,p=i,x=s-1;if(X>c)if(X>Y){let v=n;for(;;){for(;!(t[p]._tmpX<=v);)++p;for(;!(t[x]._tmpX>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}else{let v=_;for(;;){for(;!(t[p]._tmpZ<=v);)++p;for(;!(t[x]._tmpZ>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}else if(c>Y){let v=l;for(;;){for(;!(t[p]._tmpY<=v);)++p;for(;!(t[x]._tmpY>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}else{let v=_;for(;;){for(;!(t[p]._tmpZ<=v);)++p;for(;!(t[x]._tmpZ>=v);)--x;if(p>=x)break;let f=t[p];t[p]=t[x],t[x]=f,++p,--x}}return p}};m.collision.broadphase.bvh.BvhTree=class{constructor(){this._root=null,this._numLeaves=0,this._strategy=new m.collision.broadphase.bvh.BvhStrategy,this._nodePool=null,this.leafList=null,this.leafListLast=null,this.tmp=new Array(1024)}_print(t,i){if(i==null&&(i=""),t!=null)if(t._height==0)console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:39:",i+t._proxy._id);else{this._print(t._children[0],i+"  ");let s,o,n,l;o=t._aabbMaxX-t._aabbMinX,n=t._aabbMaxY-t._aabbMinY,l=t._aabbMaxZ-t._aabbMinZ;let _=n,r=l;if(o*(_+r)+_*r>0){let e,a,h;e=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let b=a,X=h;s=((e*(b+X)+b*X)*1e3+.5|0)/1e3}else{let e,a,h;e=t._aabbMaxX-t._aabbMinX,a=t._aabbMaxY-t._aabbMinY,h=t._aabbMaxZ-t._aabbMinZ;let b=a,X=h;s=((e*(b+X)+b*X)*1e3-.5|0)/1e3}console.log("src/oimo/collision/broadphase/bvh/BvhTree.hx:42:",i+"#"+t._height+", "+s),this._print(t._children[1],i+"  ")}}_getBalance(){return this.getBalanceRecursive(this._root)}deleteRecursive(t){if(t._height==0){let i=t._prevLeaf,s=t._nextLeaf;i!=null&&(i._nextLeaf=s),s!=null&&(s._prevLeaf=i),t==this.leafList&&(this.leafList=this.leafList._nextLeaf),t==this.leafListLast&&(this.leafListLast=this.leafListLast._prevLeaf),t._nextLeaf=null,t._prevLeaf=null,t._proxy._leaf=null,t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t;return}this.deleteRecursive(t._children[0]),this.deleteRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}decomposeRecursive(t){if(t._height==0){t._childIndex=0,t._parent=null;return}this.decomposeRecursive(t._children[0]),this.decomposeRecursive(t._children[1]),t._next=null,t._childIndex=0,t._children[0]=null,t._children[1]=null,t._childIndex=0,t._parent=null,t._height=0,t._proxy=null,t._next=this._nodePool,this._nodePool=t}buildTopDownRecursive(t,i,s){if(s-i==1){let X=t[i],c=X._proxy;return X._aabbMinX=c._aabbMinX,X._aabbMinY=c._aabbMinY,X._aabbMinZ=c._aabbMinZ,X._aabbMaxX=c._aabbMaxX,X._aabbMaxY=c._aabbMaxY,X._aabbMaxZ=c._aabbMaxZ,X}let o=this._strategy._splitLeaves(t,i,s),n=this.buildTopDownRecursive(t,i,o),l=this.buildTopDownRecursive(t,o,s),_=this._nodePool;_!=null?(this._nodePool=_._next,_._next=null):_=new m.collision.broadphase.bvh.BvhNode;let r=_;r._children[0]=n,n._parent=r,n._childIndex=0,r._children[1]=l,l._parent=r,l._childIndex=1;let e=r._children[0],a=r._children[1];r._aabbMinX=e._aabbMinX<a._aabbMinX?e._aabbMinX:a._aabbMinX,r._aabbMinY=e._aabbMinY<a._aabbMinY?e._aabbMinY:a._aabbMinY,r._aabbMinZ=e._aabbMinZ<a._aabbMinZ?e._aabbMinZ:a._aabbMinZ,r._aabbMaxX=e._aabbMaxX>a._aabbMaxX?e._aabbMaxX:a._aabbMaxX,r._aabbMaxY=e._aabbMaxY>a._aabbMaxY?e._aabbMaxY:a._aabbMaxY,r._aabbMaxZ=e._aabbMaxZ>a._aabbMaxZ?e._aabbMaxZ:a._aabbMaxZ;let h=r._children[0]._height,b=r._children[1]._height;return r._height=(h>b?h:b)+1,r}getBalanceRecursive(t){if(t==null||t._height==0)return 0;let i=t._children[0]._height-t._children[1]._height;return i<0&&(i=-i),i+this.getBalanceRecursive(t._children[0])+this.getBalanceRecursive(t._children[1])}};m.collision.geometry.Aabb=class{constructor(){this._minX=0,this._minY=0,this._minZ=0,this._maxX=0,this._maxY=0,this._maxZ=0}init(t,i){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this._maxX=i.x,this._maxY=i.y,this._maxZ=i.z,this}getMin(){let t=new m.common.Vec3;return t.x=this._minX,t.y=this._minY,t.z=this._minZ,t}getMinTo(t){t.x=this._minX,t.y=this._minY,t.z=this._minZ}setMin(t){return this._minX=t.x,this._minY=t.y,this._minZ=t.z,this}getMax(){let t=new m.common.Vec3;return t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ,t}getMaxTo(t){t.x=this._maxX,t.y=this._maxY,t.z=this._maxZ}setMax(t){return this._maxX=t.x,this._maxY=t.y,this._maxZ=t.z,this}getCenter(){let t=new m.common.Vec3,i,s,o;return i=this._minX+this._maxX,s=this._minY+this._maxY,o=this._minZ+this._maxZ,i*=.5,s*=.5,o*=.5,t.x=i,t.y=s,t.z=o,t}getCenterTo(t){let i,s,o;i=this._minX+this._maxX,s=this._minY+this._maxY,o=this._minZ+this._maxZ,i*=.5,s*=.5,o*=.5,t.x=i,t.y=s,t.z=o}getExtents(){let t=new m.common.Vec3,i,s,o;return i=this._maxX-this._minX,s=this._maxY-this._minY,o=this._maxZ-this._minZ,i*=.5,s*=.5,o*=.5,t.x=i,t.y=s,t.z=o,t}getExtentsTo(t){let i,s,o;i=this._maxX-this._minX,s=this._maxY-this._minY,o=this._maxZ-this._minZ,i*=.5,s*=.5,o*=.5,t.x=i,t.y=s,t.z=o}combine(t){return this._minX=this._minX<t._minX?this._minX:t._minX,this._minY=this._minY<t._minY?this._minY:t._minY,this._minZ=this._minZ<t._minZ?this._minZ:t._minZ,this._maxX=this._maxX>t._maxX?this._maxX:t._maxX,this._maxY=this._maxY>t._maxY?this._maxY:t._maxY,this._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,this}combined(t){let i=new m.collision.geometry.Aabb;return i._minX=this._minX<t._minX?this._minX:t._minX,i._minY=this._minY<t._minY?this._minY:t._minY,i._minZ=this._minZ<t._minZ?this._minZ:t._minZ,i._maxX=this._maxX>t._maxX?this._maxX:t._maxX,i._maxY=this._maxY>t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ>t._maxZ?this._maxZ:t._maxZ,i}overlap(t){return this._minX<t._maxX&&this._maxX>t._minX&&this._minY<t._maxY&&this._maxY>t._minY&&this._minZ<t._maxZ?this._maxZ>t._minZ:!1}getIntersection(t){let i=new m.collision.geometry.Aabb;return i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ,i}getIntersectionTo(t,i){i._minX=this._minX>t._minX?this._minX:t._minX,i._minY=this._minY>t._minY?this._minY:t._minY,i._minZ=this._minZ>t._minZ?this._minZ:t._minZ,i._maxX=this._maxX<t._maxX?this._maxX:t._maxX,i._maxY=this._maxY<t._maxY?this._maxY:t._maxY,i._maxZ=this._maxZ<t._maxZ?this._maxZ:t._maxZ}copyFrom(t){return this._minX=t._minX,this._minY=t._minY,this._minZ=t._minZ,this._maxX=t._maxX,this._maxY=t._maxY,this._maxZ=t._maxZ,this}clone(){let t=new m.collision.geometry.Aabb;return t._minX=this._minX,t._minY=this._minY,t._minZ=this._minZ,t._maxX=this._maxX,t._maxY=this._maxY,t._maxZ=this._maxZ,t}};m.collision.geometry.BoxGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t){super(1),this._halfExtentsX=t.x,this._halfExtentsY=t.y,this._halfExtentsZ=t.z,this._halfAxisXX=t.x,this._halfAxisXY=0,this._halfAxisXZ=0,this._halfAxisYX=0,this._halfAxisYY=t.y,this._halfAxisYZ=0,this._halfAxisZX=0,this._halfAxisZY=0,this._halfAxisZZ=t.z,this._updateMass();let i=t.x<t.y?t.z<t.x?t.z:t.x:t.z<t.y?t.z:t.y;this._gjkMargin>i*.2&&(this._gjkMargin=i*.2)}getHalfExtents(){let t=new m.common.Vec3;return t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ,t}getHalfExtentsTo(t){t.x=this._halfExtentsX,t.y=this._halfExtentsY,t.z=this._halfExtentsZ}_updateMass(){this._volume=8*(this._halfExtentsX*this._halfExtentsY*this._halfExtentsZ);let t,i,s;t=this._halfExtentsX*this._halfExtentsX,i=this._halfExtentsY*this._halfExtentsY,s=this._halfExtentsZ*this._halfExtentsZ,this._inertiaCoeff00=.3333333333333333*(i+s),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(s+t),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(t+i)}_computeAabb(t,i){let s,o,n,l,_,r,e,a,h,b,X,c;b=i._rotation00*this._halfAxisXX+i._rotation01*this._halfAxisXY+i._rotation02*this._halfAxisXZ,X=i._rotation10*this._halfAxisXX+i._rotation11*this._halfAxisXY+i._rotation12*this._halfAxisXZ,c=i._rotation20*this._halfAxisXX+i._rotation21*this._halfAxisXY+i._rotation22*this._halfAxisXZ,s=b,o=X,n=c;let Y,p,x;Y=i._rotation00*this._halfAxisYX+i._rotation01*this._halfAxisYY+i._rotation02*this._halfAxisYZ,p=i._rotation10*this._halfAxisYX+i._rotation11*this._halfAxisYY+i._rotation12*this._halfAxisYZ,x=i._rotation20*this._halfAxisYX+i._rotation21*this._halfAxisYY+i._rotation22*this._halfAxisYZ,l=Y,_=p,r=x;let v,f,Z;v=i._rotation00*this._halfAxisZX+i._rotation01*this._halfAxisZY+i._rotation02*this._halfAxisZZ,f=i._rotation10*this._halfAxisZX+i._rotation11*this._halfAxisZY+i._rotation12*this._halfAxisZZ,Z=i._rotation20*this._halfAxisZX+i._rotation21*this._halfAxisZY+i._rotation22*this._halfAxisZZ,e=v,a=f,h=Z,s<0&&(s=-s),o<0&&(o=-o),n<0&&(n=-n),l<0&&(l=-l),_<0&&(_=-_),r<0&&(r=-r),e<0&&(e=-e),a<0&&(a=-a),h<0&&(h=-h);let k,g,I;k=s+l,g=o+_,I=n+r,k+=e,g+=a,I+=h,t._minX=i._positionX-k,t._minY=i._positionY-g,t._minZ=i._positionZ-I,t._maxX=i._positionX+k,t._maxY=i._positionY+g,t._maxZ=i._positionZ+I}computeLocalSupportingVertex(t,i){let s,o,n,l,_,r;s=this._gjkMargin,o=this._gjkMargin,n=this._gjkMargin,s<this._halfExtentsX||(s=this._halfExtentsX),o<this._halfExtentsY||(o=this._halfExtentsY),n<this._halfExtentsZ||(n=this._halfExtentsZ),l=this._halfExtentsX-s,_=this._halfExtentsY-o,r=this._halfExtentsZ-n,i.x=t.x>0?l:-l,i.y=t.y>0?_:-_,i.z=t.z>0?r:-r}_rayCastLocal(t,i,s,o,n,l,_){let r=this._halfExtentsX,e=this._halfExtentsY,a=this._halfExtentsZ,h=o-t,b=n-i,X=l-s,c=0,Y=0,p=0,x=1,v=1,f=1;if(h>-1e-6&&h<1e-6){if(t<=-r||t>=r)return!1}else{let I=1/h,z=(-r-t)*I,d=(r-t)*I;if(z>d){let u=z;z=d,d=u}z>0&&(c=z),d<1&&(x=d)}if(b>-1e-6&&b<1e-6){if(i<=-e||i>=e)return!1}else{let I=1/b,z=(-e-i)*I,d=(e-i)*I;if(z>d){let u=z;z=d,d=u}z>0&&(Y=z),d<1&&(v=d)}if(X>-1e-6&&X<1e-6){if(s<=-a||s>=a)return!1}else{let I=1/X,z=(-a-s)*I,d=(a-s)*I;if(z>d){let u=z;z=d,d=u}z>0&&(p=z),d<1&&(f=d)}if(c>=1||Y>=1||p>=1||x<=0||v<=0||f<=0)return!1;let Z=c,k=x,g=0;if(Y>Z&&(Z=Y,g=1),p>Z&&(Z=p,g=2),v<k&&(k=v),f<k&&(k=f),Z>k||Z==0)return!1;switch(g){case 0:_.normal.init(h>0?-1:1,0,0);break;case 1:_.normal.init(0,b>0?-1:1,0);break;case 2:_.normal.init(0,0,X>0?-1:1);break}return _.position.init(t+Z*h,i+Z*b,s+Z*X),_.fraction=Z,!0}};m.collision.geometry.CapsuleGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t,i){super(4),this._radius=t,this._halfHeight=i,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight,s=6.28318530717958*t*this._halfHeight,o=3.14159265358979*t*this._radius*4/3;this._volume=s+o;let n=this._volume==0?0:1/this._volume,l=n*(s*(t*.25+i/3)+o*(t*.4+this._halfHeight*this._radius*.75+i));this._inertiaCoeff00=l,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=n*(s*t*.5+o*t*.4),this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=l}_computeAabb(t,i){let s,o,n;s=this._radius,o=this._radius,n=this._radius;let l,_,r;l=i._rotation01,_=i._rotation11,r=i._rotation21,l<0&&(l=-l),_<0&&(_=-_),r<0&&(r=-r),l*=this._halfHeight,_*=this._halfHeight,r*=this._halfHeight,s+=l,o+=_,n+=r,t._minX=i._positionX-s,t._minY=i._positionY-o,t._minZ=i._positionZ-n,t._maxX=i._positionX+s,t._maxY=i._positionY+o,t._maxZ=i._positionZ+n}computeLocalSupportingVertex(t,i){t.y>0?i.init(0,this._halfHeight,0):i.init(0,-this._halfHeight,0)}_rayCastLocal(t,i,s,o,n,l,_){let r=this._halfHeight,e=o-t,a=l-s,h=0,b,X=e*e+a*a,c=t*e+s*a,Y=t*t+s*s-this._radius*this._radius,p=c*c-X*Y;if(p<0)return!1;if(X>0){let R=Math.sqrt(p);if(h=(-c-R)/X,b=(-c+R)/X,h>=1||b<=0)return!1}else{if(Y>=0)return!1;h=0}let x=i+(n-i)*h,v;if(x>-r&&x<r){if(h>0){v=h;let R=_.normal.init(t+e*v,0,s+a*v),H=Math.sqrt(R.x*R.x+R.y*R.y+R.z*R.z);return H>0&&(H=1/H),R.x*=H,R.y*=H,R.z*=H,_.position.init(t+v*e,x,s+v*a),_.fraction=v,!0}return!1}let f,Z,k,g,I,z;f=0,Z=x<0?-r:r,k=0,g=t-f,I=i-Z,z=s-k;let d,u,B;if(d=o-t,u=n-i,B=l-s,X=d*d+u*u+B*B,c=g*d+I*u+z*B,Y=g*g+I*I+z*z-this._radius*this._radius,p=c*c-X*Y,p<0)return!1;let j=(-c-Math.sqrt(p))/X;if(j<0||j>1)return!1;let L,V,M,w,P,E;L=g+d*j,V=I+u*j,M=z+B*j;let C=L*L+V*V+M*M;C>0&&(C=1/Math.sqrt(C)),w=L*C,P=V*C,E=M*C,L+=f,V+=Z,M+=k;let S=_.position;S.x=L,S.y=V,S.z=M;let A=_.normal;return A.x=w,A.y=P,A.z=E,_.fraction=j,!0}};m.collision.geometry.ConeGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t,i){super(3),this._radius=t,this._halfHeight=i,this.sinTheta=t/Math.sqrt(t*t+4*i*i),this.cosTheta=2*i/Math.sqrt(t*t+4*i*i),this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2/3,this._inertiaCoeff00=.05*(3*t+2*i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.05*(3*t+2*i)}_computeAabb(t,i){let s,o,n,l,_,r,e,a,h,b,X,c;s=i._rotation01,o=i._rotation11,n=i._rotation21,l=s*s,_=o*o,r=n*n,b=Math.sqrt(1-l),X=Math.sqrt(1-_),c=Math.sqrt(1-r),b*=this._radius,X*=this._radius,c*=this._radius,e=s*this._halfHeight,a=o*this._halfHeight,h=n*this._halfHeight;let Y,p,x,v,f,Z;Y=-e,p=-a,x=-h,Y-=b,p-=X,x-=c,v=-e,f=-a,Z=-h,v+=b,f+=X,Z+=c;let k,g,I,z,d,u;k=Y>v?Y:v,g=p>f?p:f,I=x>Z?x:Z,k>e||(k=e),g>a||(g=a),I>h||(I=h),z=Y<v?Y:v,d=p<f?p:f,u=x<Z?x:Z,z<e||(z=e),d<a||(d=a),u<h||(u=h),t._minX=i._positionX+z,t._minY=i._positionY+d,t._minZ=i._positionZ+u,t._maxX=i._positionX+k,t._maxY=i._positionY+g,t._maxZ=i._positionZ+I}computeLocalSupportingVertex(t,i){let s=t.x,o=t.y,n=t.z;if(o>0&&o*o>this.sinTheta*this.sinTheta*(s*s+o*o+n*n)){i.init(0,this._halfHeight-this._gjkMargin/this.sinTheta,0),i.y<0&&(i.y=0);return}let l=t.x,_=t.z,r=l*l+_*_,e=2*this._halfHeight,a=(e-this._gjkMargin)/e*this._radius-this._gjkMargin/this.cosTheta;a<0&&(a=0);let h=r>0?a/Math.sqrt(r):0,b=this._halfHeight-this._gjkMargin;b<0&&(b=0),i.x=l*h,i.y=-b,i.z=_*h}_rayCastLocal(t,i,s,o,n,l,_){let r,e=this._halfHeight,a=o-t,h=n-i,b=l-s,X=0,c=1;if(h>-1e-6&&h<1e-6){if(i<=-e||i>=e)return!1}else{let I=1/h,z=(-e-i)*I,d=(e-i)*I;if(z>d){let u=z;z=d,d=u}z>0&&(X=z),d<1&&(c=d)}if(X>=1||c<=0)return!1;let Y=0,p=0;r=i-e;let x=this.cosTheta*this.cosTheta,v=x*(a*a+h*h+b*b)-h*h,f=x*(t*a+r*h+s*b)-r*h,Z=x*(t*t+r*r+s*s)-r*r,k=f*f-v*Z;if(v!=0){if(k<0)return!1;let I=Math.sqrt(k);if(v<0){if(h>0){if(Y=0,p=(-f+I)/v,p<=0)return!1}else if(Y=(-f-I)/v,p=1,Y>=1)return!1}else if(Y=(-f-I)/v,p=(-f+I)/v,Y>=1||p<=0)return!1}else{let I=-Z/(2*f);if(f>0){if(Y=0,p=I,I<=0)return!1}else if(Y=I,p=1,I>=1)return!1}r+=e;let g;if(p<=X||c<=Y)return!1;if(Y<X){if(g=X,g==0)return!1;_.normal.init(0,h>0?-1:1,0)}else{if(g=Y,g==0)return!1;let I=_.normal.init(t+a*g,0,s+b*g),z=Math.sqrt(I.x*I.x+I.y*I.y+I.z*I.z);z>0&&(z=1/z),I.x*=z,I.y*=z,I.z*=z;let d=this.cosTheta;I.x*=d,I.y*=d,I.z*=d,_.normal.y+=this.sinTheta}return _.position.init(t+g*a,r+g*h,s+g*b),_.fraction=g,!0}};m.collision.geometry.ConvexHullGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t){super(5),this._numVertices=t.length,this._vertices=new Array(this._numVertices),this._tmpVertices=new Array(this._numVertices);let i=0,s=this._numVertices;for(;i<s;){let o=i++;this._vertices[o]=t[o],this._tmpVertices[o]=new m.common.Vec3}this._useGjkRayCast=!0,this._updateMass()}getVertices(){return this._vertices}_updateMass(){this._volume=1,this._inertiaCoeff00=1,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=1,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=1;let t=this._vertices[0].x,i=this._vertices[0].y,s=this._vertices[0].z,o=this._vertices[0].x,n=this._vertices[0].y,l=this._vertices[0].z,_=1,r=this._numVertices;for(;_<r;){let X=_++,c=this._vertices[X].x,Y=this._vertices[X].y,p=this._vertices[X].z;c<t?t=c:c>o&&(o=c),Y<i?i=Y:Y>n&&(n=Y),p<s?s=p:p>l&&(l=p)}let e=o-t,a=n-i,h=l-s;this._volume=e*a*h;let b=((t+o)*(t+o)+(i+n)*(i+n)+(s+l)*(s+l))*.25;e=e*e*.25,a=a*a*.25,h=h*h*.25,this._inertiaCoeff00=.3333333333333333*(a+h)+b,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.3333333333333333*(h+e)+b,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.3333333333333333*(e+a)+b}_computeAabb(t,i){let s,o,n,l,_,r,e,a,h;e=this._gjkMargin,a=this._gjkMargin,h=this._gjkMargin;let b,X,c,Y=this._vertices[0];b=Y.x,X=Y.y,c=Y.z;let p,x,v,f,Z,k;f=i._rotation00*b+i._rotation01*X+i._rotation02*c,Z=i._rotation10*b+i._rotation11*X+i._rotation12*c,k=i._rotation20*b+i._rotation21*X+i._rotation22*c,p=f,x=Z,v=k,p+=i._positionX,x+=i._positionY,v+=i._positionZ,s=p,o=x,n=v,l=p,_=x,r=v;let g=1,I=this._numVertices;for(;g<I;){let z=this._vertices[g++];b=z.x,X=z.y,c=z.z;let d,u,B;d=i._rotation00*b+i._rotation01*X+i._rotation02*c,u=i._rotation10*b+i._rotation11*X+i._rotation12*c,B=i._rotation20*b+i._rotation21*X+i._rotation22*c,p=d,x=u,v=B,p+=i._positionX,x+=i._positionY,v+=i._positionZ,s<p||(s=p),o<x||(o=x),n<v||(n=v),l>p||(l=p),_>x||(_=x),r>v||(r=v)}t._minX=s-e,t._minY=o-a,t._minZ=n-h,t._maxX=l+e,t._maxY=_+a,t._maxZ=r+h}computeLocalSupportingVertex(t,i){let s=this._vertices[0],o=s.x*t.x+s.y*t.y+s.z*t.z,n=0,l=1,_=this._numVertices;for(;l<_;){let e=l++,a=this._vertices[e],h=a.x*t.x+a.y*t.y+a.z*t.z;h>o&&(o=h,n=e)}let r=this._vertices[n];i.x=r.x,i.y=r.y,i.z=r.z}};m.collision.geometry.CylinderGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t,i){super(2),this._radius=t,this._halfHeight=i,this._updateMass()}getRadius(){return this._radius}getHalfHeight(){return this._halfHeight}_updateMass(){let t=this._radius*this._radius,i=this._halfHeight*this._halfHeight*4;this._volume=3.14159265358979*t*this._halfHeight*2,this._inertiaCoeff00=.08333333333333333*(3*t+i),this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.5*t,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.08333333333333333*(3*t+i)}_computeAabb(t,i){let s,o,n,l,_,r,e,a,h,b,X,c;s=i._rotation01,o=i._rotation11,n=i._rotation21,s<0&&(s=-s),o<0&&(o=-o),n<0&&(n=-n),l=s*s,_=o*o,r=n*n,b=Math.sqrt(1-l),X=Math.sqrt(1-_),c=Math.sqrt(1-r),b*=this._radius,X*=this._radius,c*=this._radius,e=s*this._halfHeight,a=o*this._halfHeight,h=n*this._halfHeight;let Y,p,x;Y=b+e,p=X+a,x=c+h,t._minX=i._positionX-Y,t._minY=i._positionY-p,t._minZ=i._positionZ-x,t._maxX=i._positionX+Y,t._maxY=i._positionY+p,t._maxZ=i._positionZ+x}computeLocalSupportingVertex(t,i){let s=t.x,o=t.z,n=s*s+o*o,l=this._radius-this._gjkMargin;l<0&&(l=0);let _=n>0?l/Math.sqrt(n):0,r=this._halfHeight-this._gjkMargin;r<0&&(r=0),i.x=s*_,i.y=t.y>0?r:-r,i.z=o*_}_rayCastLocal(t,i,s,o,n,l,_){let r=this._halfHeight,e=o-t,a=n-i,h=l-s,b=0,X=1;if(a>-1e-6&&a<1e-6){if(i<=-r||i>=r)return!1}else{let k=1/a,g=(-r-i)*k,I=(r-i)*k;if(g>I){let z=g;g=I,I=z}g>0&&(b=g),I<1&&(X=I)}if(b>=1||X<=0)return!1;let c=0,Y,p=e*e+h*h,x=t*e+s*h,v=t*t+s*s-this._radius*this._radius,f=x*x-p*v;if(f<0)return!1;if(p>0){let k=Math.sqrt(f);if(c=(-x-k)/p,Y=(-x+k)/p,c>=1||Y<=0)return!1}else{if(v>=0)return!1;c=0,Y=1}let Z;if(Y<=b||X<=c)return!1;if(c<b){if(Z=b,Z==0)return!1;_.normal.init(0,a>0?-1:1,0)}else{if(Z=c,Z==0)return!1;let k=_.normal.init(t+e*Z,0,s+h*Z),g=Math.sqrt(k.x*k.x+k.y*k.y+k.z*k.z);g>0&&(g=1/g),k.x*=g,k.y*=g,k.z*=g}return _.position.init(t+Z*e,i+Z*a,s+Z*h),_.fraction=Z,!0}};m.collision.geometry.GeometryType=class{};m.collision.geometry.RayCastHit=class{constructor(){this.position=new m.common.Vec3,this.normal=new m.common.Vec3,this.fraction=0}};m.collision.geometry.SphereGeometry=class extends m.collision.geometry.ConvexGeometry{constructor(t){super(0),this._radius=t,this._gjkMargin=this._radius,this._updateMass()}getRadius(){return this._radius}_updateMass(){this._volume=4.188790204786386*this._radius*this._radius*this._radius,this._inertiaCoeff00=.4*this._radius*this._radius,this._inertiaCoeff01=0,this._inertiaCoeff02=0,this._inertiaCoeff10=0,this._inertiaCoeff11=.4*this._radius*this._radius,this._inertiaCoeff12=0,this._inertiaCoeff20=0,this._inertiaCoeff21=0,this._inertiaCoeff22=.4*this._radius*this._radius}_computeAabb(t,i){let s,o,n;s=this._radius,o=this._radius,n=this._radius,t._minX=i._positionX-s,t._minY=i._positionY-o,t._minZ=i._positionZ-n,t._maxX=i._positionX+s,t._maxY=i._positionY+o,t._maxZ=i._positionZ+n}computeLocalSupportingVertex(t,i){i.zero()}_rayCastLocal(t,i,s,o,n,l,_){let r,e,a;r=o-t,e=n-i,a=l-s;let h=r*r+e*e+a*a,b=t*r+i*e+s*a,X=b*b-h*(t*t+i*i+s*s-this._radius*this._radius);if(X<0)return!1;let c=(-b-Math.sqrt(X))/h;if(c<0||c>1)return!1;let Y,p,x,v,f,Z;Y=t+r*c,p=i+e*c,x=s+a*c;let k=Y*Y+p*p+x*x;k>0&&(k=1/Math.sqrt(k)),v=Y*k,f=p*k,Z=x*k;let g=_.position;g.x=Y,g.y=p,g.z=x;let I=_.normal;return I.x=v,I.y=f,I.z=Z,_.fraction=c,!0}};m.collision.narrowphase||(m.collision.narrowphase={});m.collision.narrowphase.CollisionMatrix=class{constructor(){this.detectors=new Array(8),this.detectors[0]=new Array(8),this.detectors[1]=new Array(8),this.detectors[2]=new Array(8),this.detectors[3]=new Array(8),this.detectors[4]=new Array(8),this.detectors[5]=new Array(8);let t=new m.collision.narrowphase.detector.GjkEpaDetector;this.detectors[0][0]=new m.collision.narrowphase.detector.SphereSphereDetector,this.detectors[0][1]=new m.collision.narrowphase.detector.SphereBoxDetector(!1),this.detectors[0][2]=t,this.detectors[0][3]=t,this.detectors[0][4]=new m.collision.narrowphase.detector.SphereCapsuleDetector(!1),this.detectors[0][5]=t,this.detectors[1][0]=new m.collision.narrowphase.detector.SphereBoxDetector(!0),this.detectors[1][1]=new m.collision.narrowphase.detector.BoxBoxDetector,this.detectors[1][2]=t,this.detectors[1][3]=t,this.detectors[1][4]=t,this.detectors[1][5]=t,this.detectors[2][0]=t,this.detectors[2][1]=t,this.detectors[2][2]=t,this.detectors[2][3]=t,this.detectors[2][4]=t,this.detectors[2][5]=t,this.detectors[3][0]=t,this.detectors[3][1]=t,this.detectors[3][2]=t,this.detectors[3][3]=t,this.detectors[3][4]=t,this.detectors[3][5]=t,this.detectors[4][0]=new m.collision.narrowphase.detector.SphereCapsuleDetector(!0),this.detectors[4][1]=t,this.detectors[4][2]=t,this.detectors[4][3]=t,this.detectors[4][4]=new m.collision.narrowphase.detector.CapsuleCapsuleDetector,this.detectors[4][5]=t,this.detectors[5][0]=t,this.detectors[5][1]=t,this.detectors[5][2]=t,this.detectors[5][3]=t,this.detectors[5][4]=t,this.detectors[5][5]=t}getDetector(t,i){return this.detectors[t][i]}};m.collision.narrowphase.DetectorResult=class{constructor(){this.numPoints=0,this.normal=new m.common.Vec3,this.points=new Array(m.common.Setting.maxManifoldPoints),this.incremental=!1;let t=0,i=m.common.Setting.maxManifoldPoints;for(;t<i;)this.points[t++]=new m.collision.narrowphase.DetectorResultPoint}getMaxDepth(){let t=0,i=0,s=this.numPoints;for(;i<s;){let o=i++;this.points[o].depth>t&&(t=this.points[o].depth)}return t}clear(){this.numPoints=0;let t=0,i=this.points;for(;t<i.length;){let s=i[t];++t,s.position1.zero(),s.position2.zero(),s.depth=0,s.id=0}this.normal.zero()}};m.collision.narrowphase.DetectorResultPoint=class{constructor(){this.position1=new m.common.Vec3,this.position2=new m.common.Vec3,this.depth=0,this.id=0}};m.collision.narrowphase.detector||(m.collision.narrowphase.detector={});m.collision.narrowphase.detector.Detector=class{constructor(t){this.swapped=t}setNormal(t,i,s,o){let n=t.normal;if(n.x=i,n.y=s,n.z=o,this.swapped){let l=t.normal;l.x=-l.x,l.y=-l.y,l.z=-l.z}}addPoint(t,i,s,o,n,l,_,r,e){let a=t.points[t.numPoints++];if(a.depth=r,a.id=e,this.swapped){let h=a.position1;h.x=n,h.y=l,h.z=_;let b=a.position2;b.x=i,b.y=s,b.z=o}else{let h=a.position1;h.x=i,h.y=s,h.z=o;let b=a.position2;b.x=n,b.y=l,b.z=_}}detectImpl(t,i,s,o,n,l){}detect(t,i,s,o,n,l){t.numPoints=0;let _=0,r=t.points;for(;_<r.length;){let e=r[_];++_,e.position1.zero(),e.position2.zero(),e.depth=0,e.id=0}t.normal.zero(),this.swapped?this.detectImpl(t,s,i,n,o,l):this.detectImpl(t,i,s,o,n,l)}};m.collision.narrowphase.detector.BoxBoxDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1),this.clipper=new m.collision.narrowphase.detector._BoxBoxDetector.FaceClipper}detectImpl(t,i,s,o,n,l){let _=i,r=s;t.incremental=!1;let e,a,h,b,X,c,Y,p,x;e=o._positionX,a=o._positionY,h=o._positionZ,b=n._positionX,X=n._positionY,c=n._positionZ,Y=b-e,p=X-a,x=c-h;let v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w,P,E,C;v=o._rotation00,f=o._rotation10,Z=o._rotation20,k=o._rotation01,g=o._rotation11,I=o._rotation21,z=o._rotation02,d=o._rotation12,u=o._rotation22,B=n._rotation00,j=n._rotation10,L=n._rotation20,V=n._rotation01,M=n._rotation11,w=n._rotation21,P=n._rotation02,E=n._rotation12,C=n._rotation22;let S=_._halfExtentsX,A=_._halfExtentsY,R=_._halfExtentsZ,H=r._halfExtentsX,y=r._halfExtentsY,D=r._halfExtentsZ,F,Q,W,q,U,G,J,N,K,O,$,et,st,lt,rt,at,ot,ht;F=v*S,Q=f*S,W=Z*S,q=k*A,U=g*A,G=I*A,J=z*R,N=d*R,K=u*R,O=B*H,$=j*H,et=L*H,st=V*y,lt=M*y,rt=w*y,at=P*D,ot=E*D,ht=C*D;let _t=1/0,bt=-1,Xt=0,ft,Zt,xt;ft=0,Zt=0,xt=0;let zt=S,Yt=v*O+f*$+Z*et,pt=v*st+f*lt+Z*rt,ct=v*at+f*ot+Z*ht;Yt<0&&(Yt=-Yt),pt<0&&(pt=-pt),ct<0&&(ct=-ct);let nt=Yt+pt+ct,tt=v*Y+f*p+Z*x,Lt=zt+nt,Bt=tt<0,Mt=Bt?-tt:tt;if(Mt<Lt){let Tt=Lt-Mt;Tt<1/0&&(_t=Tt,bt=0,ft=v,Zt=f,xt=Z,Xt=Bt?-1:1)}else return;zt=A;let jt=k*O+g*$+I*et,ci=k*st+g*lt+I*rt,Xi=k*at+g*ot+I*ht;jt<0&&(jt=-jt),ci<0&&(ci=-ci),Xi<0&&(Xi=-Xi),nt=jt+ci+Xi,tt=k*Y+g*p+I*x;let Yi=zt+nt,Li=tt<0,wi=Li?-tt:tt;if(wi<Yi){let Tt=Yi-wi;Tt<_t&&(_t=Tt,bt=1,ft=k,Zt=g,xt=I,Xt=Li?-1:1)}else return;zt=R;let ei=z*O+d*$+u*et,qt=z*st+d*lt+u*rt,At=z*at+d*ot+u*ht;ei<0&&(ei=-ei),qt<0&&(qt=-qt),At<0&&(At=-At),nt=ei+qt+At,tt=z*Y+d*p+u*x;let ni=zt+nt,ui=tt<0,Oi=ui?-tt:tt;if(Oi<ni){let Tt=ni-Oi;Tt<_t&&(_t=Tt,bt=2,ft=z,Zt=d,xt=u,Xt=ui?-1:1)}else return;_t>m.common.Setting.linearSlop?_t-=m.common.Setting.linearSlop:_t=0;let Bi=B*F+j*Q+L*W,kt=B*q+j*U+L*G,wt=B*J+j*N+L*K;Bi<0&&(Bi=-Bi),kt<0&&(kt=-kt),wt<0&&(wt=-wt),zt=Bi+kt+wt,nt=H,tt=B*Y+j*p+L*x;let $t=zt+nt,fi=tt<0,gi=fi?-tt:tt;if(gi<$t){let Tt=$t-gi;Tt<_t&&(_t=Tt,bt=3,ft=B,Zt=j,xt=L,Xt=fi?-1:1)}else return;let it=V*F+M*Q+w*W,Ht=V*q+M*U+w*G,ii=V*J+M*N+w*K;it<0&&(it=-it),Ht<0&&(Ht=-Ht),ii<0&&(ii=-ii),zt=it+Ht+ii,nt=y,tt=V*Y+M*p+w*x;let T=zt+nt,Gt=tt<0,Et=Gt?-tt:tt;if(Et<T){let Tt=T-Et;Tt<_t&&(_t=Tt,bt=4,ft=V,Zt=M,xt=w,Xt=Gt?-1:1)}else return;let si=P*F+E*Q+C*W,oi=P*q+E*U+C*G,Pt=P*J+E*N+C*K;si<0&&(si=-si),oi<0&&(oi=-oi),Pt<0&&(Pt=-Pt),zt=si+oi+Pt,nt=D,tt=P*Y+E*p+C*x;let ai=zt+nt,Ri=tt<0,Zi=Ri?-tt:tt;if(Zi<ai){let Tt=ai-Zi;Tt<_t&&(_t=Tt,bt=5,ft=P,Zt=E,xt=C,Xt=Ri?-1:1)}else return;_t>m.common.Setting.linearSlop?_t-=m.common.Setting.linearSlop:_t=0;let yt,dt,vt;if(yt=f*L-Z*j,dt=Z*B-v*L,vt=v*j-f*B,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*q+dt*U+vt*G,Rt=yt*J+dt*N+vt*K;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*st+dt*lt+vt*rt,gt=yt*at+dt*ot+vt*ht;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=6,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=f*w-Z*M,dt=Z*V-v*w,vt=v*M-f*V,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*q+dt*U+vt*G,Rt=yt*J+dt*N+vt*K;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*O+dt*$+vt*et,gt=yt*at+dt*ot+vt*ht;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=7,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=f*C-Z*E,dt=Z*P-v*C,vt=v*E-f*P,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*q+dt*U+vt*G,Rt=yt*J+dt*N+vt*K;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*O+dt*$+vt*et,gt=yt*st+dt*lt+vt*rt;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=8,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=g*L-I*j,dt=I*B-k*L,vt=k*j-g*B,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*F+dt*Q+vt*W,Rt=yt*J+dt*N+vt*K;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*st+dt*lt+vt*rt,gt=yt*at+dt*ot+vt*ht;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=9,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=g*w-I*M,dt=I*V-k*w,vt=k*M-g*V,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*F+dt*Q+vt*W,Rt=yt*J+dt*N+vt*K;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*O+dt*$+vt*et,gt=yt*at+dt*ot+vt*ht;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=10,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=g*C-I*E,dt=I*P-k*C,vt=k*E-g*P,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*F+dt*Q+vt*W,Rt=yt*J+dt*N+vt*K;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*O+dt*$+vt*et,gt=yt*st+dt*lt+vt*rt;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=11,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=d*L-u*j,dt=u*B-z*L,vt=z*j-d*B,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*F+dt*Q+vt*W,Rt=yt*q+dt*U+vt*G;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*st+dt*lt+vt*rt,gt=yt*at+dt*ot+vt*ht;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=12,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=d*w-u*M,dt=u*V-z*w,vt=z*M-d*V,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*F+dt*Q+vt*W,Rt=yt*q+dt*U+vt*G;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*O+dt*$+vt*et,gt=yt*at+dt*ot+vt*ht;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=13,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(yt=d*C-u*E,dt=u*P-z*C,vt=z*E-d*P,!(yt==0&&dt==0&&vt==0)){let Tt=yt*yt+dt*dt+vt*vt;Tt>0&&(Tt=1/Math.sqrt(Tt)),yt*=Tt,dt*=Tt,vt*=Tt;let hi=yt*F+dt*Q+vt*W,Rt=yt*q+dt*U+vt*G;hi<0&&(hi=-hi),Rt<0&&(Rt=-Rt),zt=hi+Rt;let mt=yt*O+dt*$+vt*et,gt=yt*st+dt*lt+vt*rt;mt<0&&(mt=-mt),gt<0&&(gt=-gt),nt=mt+gt,tt=yt*Y+dt*p+vt*x;let Ft=zt+nt,Dt=tt<0,Nt=Dt?-tt:tt;if(Nt<Ft){let Kt=Ft-Nt;Kt<_t&&(_t=Kt,bt=14,ft=yt,Zt=dt,xt=vt,Xt=Dt?-1:1)}else return}if(bt>=6){ft*=Xt,Zt*=Xt,xt*=Xt;let Tt=(bt-6)/3|0,hi=bt-6-Tt*3,Rt,mt,gt,Ft,Dt,Nt,Kt,li,yi,pi,Ot,It;switch(Tt){case 0:Kt=v,li=f,yi=Z;let Ze=J*ft+N*Zt+K*xt>0;q*ft+U*Zt+G*xt>0?Ze?(Rt=q+J,mt=U+N,gt=G+K):(Rt=q-J,mt=U-N,gt=G-K):Ze?(Rt=J-q,mt=N-U,gt=K-G):(Rt=q+J,mt=U+N,gt=G+K,Rt=-Rt,mt=-mt,gt=-gt);break;case 1:Kt=k,li=g,yi=I;let ue=J*ft+N*Zt+K*xt>0;F*ft+Q*Zt+W*xt>0?ue?(Rt=F+J,mt=Q+N,gt=W+K):(Rt=F-J,mt=Q-N,gt=W-K):ue?(Rt=J-F,mt=N-Q,gt=K-W):(Rt=F+J,mt=Q+N,gt=W+K,Rt=-Rt,mt=-mt,gt=-gt);break;default:Kt=z,li=d,yi=u;let ze=q*ft+U*Zt+G*xt>0;F*ft+Q*Zt+W*xt>0?ze?(Rt=F+q,mt=Q+U,gt=W+G):(Rt=F-q,mt=Q-U,gt=W-G):ze?(Rt=q-F,mt=U-Q,gt=G-W):(Rt=F+q,mt=Q+U,gt=W+G,Rt=-Rt,mt=-mt,gt=-gt)}switch(Rt=e+Rt,mt=a+mt,gt=h+gt,hi){case 0:pi=B,Ot=j,It=L;let Ze=at*ft+ot*Zt+ht*xt>0;st*ft+lt*Zt+rt*xt>0?Ze?(Ft=st+at,Dt=lt+ot,Nt=rt+ht):(Ft=st-at,Dt=lt-ot,Nt=rt-ht):Ze?(Ft=at-st,Dt=ot-lt,Nt=ht-rt):(Ft=st+at,Dt=lt+ot,Nt=rt+ht,Ft=-Ft,Dt=-Dt,Nt=-Nt);break;case 1:pi=V,Ot=M,It=w;let ue=at*ft+ot*Zt+ht*xt>0;O*ft+$*Zt+et*xt>0?ue?(Ft=O+at,Dt=$+ot,Nt=et+ht):(Ft=O-at,Dt=$-ot,Nt=et-ht):ue?(Ft=at-O,Dt=ot-$,Nt=ht-et):(Ft=O+at,Dt=$+ot,Nt=et+ht,Ft=-Ft,Dt=-Dt,Nt=-Nt);break;default:pi=P,Ot=E,It=C;let ze=st*ft+lt*Zt+rt*xt>0;O*ft+$*Zt+et*xt>0?ze?(Ft=O+st,Dt=$+lt,Nt=et+rt):(Ft=O-st,Dt=$-lt,Nt=et-rt):ze?(Ft=st-O,Dt=lt-$,Nt=rt-et):(Ft=O+st,Dt=$+lt,Nt=et+rt,Ft=-Ft,Dt=-Dt,Nt=-Nt)}Ft=b-Ft,Dt=X-Dt,Nt=c-Nt;let Jt,xi,ji;Jt=Rt-Ft,xi=mt-Dt,ji=gt-Nt;let ee=Kt*pi+li*Ot+yi*It,_e=Kt*Jt+li*xi+yi*ji,Qi=pi*Jt+Ot*xi+It*ji,te=1/(1-ee*ee),Gi=(ee*Qi-_e)*te,Si=(Qi-ee*_e)*te,le,fe,Xe,ge,de,we;le=Rt+Kt*Gi,fe=mt+li*Gi,Xe=gt+yi*Gi,ge=Ft+pi*Si,de=Dt+Ot*Si,we=Nt+It*Si;let ke,Ve,Le;ke=-ft,Ve=-Zt,Le=-xt,this.setNormal(t,ke,Ve,Le),this.addPoint(t,le,fe,Xe,ge,de,we,_t,4);return}let di,Ii,bi,se;bt>=3?(Xt=-Xt,Y=-Y,p=-p,x=-x,S=H,A=y,R=D,e=b,a=X,h=c,di=v,Ii=f,bi=Z,v=B,f=j,Z=L,B=di,j=Ii,L=bi,di=k,Ii=g,bi=I,k=V,g=M,I=w,V=di,M=Ii,w=bi,di=z,Ii=d,bi=u,z=P,d=E,u=C,P=di,E=Ii,C=bi,di=F,Ii=Q,bi=W,F=O,Q=$,W=et,O=di,$=Ii,et=bi,di=q,Ii=U,bi=G,q=st,U=lt,G=rt,st=di,lt=Ii,rt=bi,di=J,Ii=N,bi=K,J=at,N=ot,K=ht,at=di,ot=Ii,ht=bi,bt-=3,se=!0):se=!1;let me,Di,he,ve,_i,ce,be,xe,ye,Ni,Ji,Ui,oe,ne;switch(bt){case 0:me=F,Di=Q,he=W,ve=v,_i=f,ce=Z,be=k,xe=g,ye=I,Ni=z,Ji=d,Ui=u,oe=A,ne=R;break;case 1:me=q,Di=U,he=G,ve=k,_i=g,ce=I,be=z,xe=d,ye=u,Ni=v,Ji=f,Ui=Z,oe=R,ne=S;break;default:me=J,Di=N,he=K,ve=z,_i=d,ce=u,be=v,xe=f,ye=Z,Ni=k,Ji=g,Ui=I,oe=S,ne=A}if(Xt<0){me=-me,Di=-Di,he=-he,ve=-ve,_i=-_i,ce=-ce,di=be,Ii=xe,bi=ye,be=Ni,xe=Ji,ye=Ui,Ni=di,Ji=Ii,Ui=bi;let Tt=oe;oe=ne,ne=Tt}me+=e,Di+=a,he+=h;let Ki=1,ie=0,Hi=ve*B+_i*j+ce*L;Hi<Ki&&(Ki=Hi,ie=0),-Hi<Ki&&(Ki=-Hi,ie=1),Hi=ve*V+_i*M+ce*w,Hi<Ki&&(Ki=Hi,ie=2),-Hi<Ki&&(Ki=-Hi,ie=3),Hi=ve*P+_i*E+ce*C,Hi<Ki&&(Ki=Hi,ie=4),-Hi<Ki&&(ie=5);let Wi,Pi,Ut,ri,Ct,Mi,zi,Ei,ki,Ti,Wt,ut;switch(ie){case 0:Wi=O+st,Pi=$+lt,Ut=et+rt,Wi+=at,Pi+=ot,Ut+=ht,ri=O-st,Ct=$-lt,Mi=et-rt,ri+=at,Ct+=ot,Mi+=ht,zi=O-st,Ei=$-lt,ki=et-rt,zi-=at,Ei-=ot,ki-=ht,Ti=O+st,Wt=$+lt,ut=et+rt,Ti-=at,Wt-=ot,ut-=ht;break;case 1:Wi=st-O,Pi=lt-$,Ut=rt-et,Wi+=at,Pi+=ot,Ut+=ht,ri=st-O,Ct=lt-$,Mi=rt-et,ri-=at,Ct-=ot,Mi-=ht,zi=O+st,Ei=$+lt,ki=et+rt,zi=-zi,Ei=-Ei,ki=-ki,zi-=at,Ei-=ot,ki-=ht,Ti=O+st,Wt=$+lt,ut=et+rt,Ti=-Ti,Wt=-Wt,ut=-ut,Ti+=at,Wt+=ot,ut+=ht;break;case 2:Wi=O+st,Pi=$+lt,Ut=et+rt,Wi+=at,Pi+=ot,Ut+=ht,ri=O+st,Ct=$+lt,Mi=et+rt,ri-=at,Ct-=ot,Mi-=ht,zi=st-O,Ei=lt-$,ki=rt-et,zi-=at,Ei-=ot,ki-=ht,Ti=st-O,Wt=lt-$,ut=rt-et,Ti+=at,Wt+=ot,ut+=ht;break;case 3:Wi=O-st,Pi=$-lt,Ut=et-rt,Wi+=at,Pi+=ot,Ut+=ht,ri=O+st,Ct=$+lt,Mi=et+rt,ri=-ri,Ct=-Ct,Mi=-Mi,ri+=at,Ct+=ot,Mi+=ht,zi=O+st,Ei=$+lt,ki=et+rt,zi=-zi,Ei=-Ei,ki=-ki,zi-=at,Ei-=ot,ki-=ht,Ti=O-st,Wt=$-lt,ut=et-rt,Ti-=at,Wt-=ot,ut-=ht;break;case 4:Wi=O+st,Pi=$+lt,Ut=et+rt,Wi+=at,Pi+=ot,Ut+=ht,ri=st-O,Ct=lt-$,Mi=rt-et,ri+=at,Ct+=ot,Mi+=ht,zi=O+st,Ei=$+lt,ki=et+rt,zi=-zi,Ei=-Ei,ki=-ki,zi+=at,Ei+=ot,ki+=ht,Ti=O-st,Wt=$-lt,ut=et-rt,Ti+=at,Wt+=ot,ut+=ht;break;default:Wi=O+st,Pi=$+lt,Ut=et+rt,Wi-=at,Pi-=ot,Ut-=ht,ri=O-st,Ct=$-lt,Mi=et-rt,ri-=at,Ct-=ot,Mi-=ht,zi=O+st,Ei=$+lt,ki=et+rt,zi=-zi,Ei=-Ei,ki=-ki,zi-=at,Ei-=ot,ki-=ht,Ti=st-O,Wt=lt-$,ut=rt-et,Ti-=at,Wt-=ot,ut-=ht}Wi+=Y,Pi+=p,Ut+=x,ri+=Y,Ct+=p,Mi+=x,zi+=Y,Ei+=p,ki+=x,Ti+=Y,Wt+=p,ut+=x;let Vt=this.clipper;Vt.w=oe,Vt.h=ne,Vt.numVertices=0,Vt.numTmpVertices=0;let Ai=this.clipper,Vi=Ai.vertices[Ai.numVertices++];Vi.x=Wi*be+Pi*xe+Ut*ye,Vi.y=Wi*Ni+Pi*Ji+Ut*Ui,Vi.wx=Wi,Vi.wy=Pi,Vi.wz=Ut;let Fi=this.clipper,$i=Fi.vertices[Fi.numVertices++];$i.x=ri*be+Ct*xe+Mi*ye,$i.y=ri*Ni+Ct*Ji+Mi*Ui,$i.wx=ri,$i.wy=Ct,$i.wz=Mi;let ae=this.clipper,re=ae.vertices[ae.numVertices++];re.x=zi*be+Ei*xe+ki*ye,re.y=zi*Ni+Ei*Ji+ki*Ui,re.wx=zi,re.wy=Ei,re.wz=ki;let pe=this.clipper,ti=pe.vertices[pe.numVertices++];ti.x=Ti*be+Wt*xe+ut*ye,ti.y=Ti*Ni+Wt*Ji+ut*Ui,ti.wx=Ti,ti.wy=Wt,ti.wz=ut,this.clipper.clip(),this.clipper.reduce();let qi,vi,Ci;se?(qi=ve,vi=_i,Ci=ce):(qi=-ve,vi=-_i,Ci=-ce),this.setNormal(t,qi,vi,Ci);let mi=0,St=this.clipper.numVertices;for(;mi<St;){let Tt=mi++,hi=this.clipper.vertices[Tt],Rt,mt,gt;Rt=hi.wx,mt=hi.wy,gt=hi.wz,Rt+=e,mt+=a,gt+=h;let Ft,Dt,Nt;Ft=me-Rt,Dt=Di-mt,Nt=he-gt;let Kt=Ft*ve+Dt*_i+Nt*ce,li,yi,pi;li=Rt+ve*Kt,yi=mt+_i*Kt,pi=gt+ce*Kt,Kt>-m.common.Setting.contactPersistenceThreshold&&(se?this.addPoint(t,Rt,mt,gt,li,yi,pi,Kt,Tt):this.addPoint(t,li,yi,pi,Rt,mt,gt,Kt,Tt))}}};m.collision.narrowphase.detector._BoxBoxDetector||(m.collision.narrowphase.detector._BoxBoxDetector={});m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex=class{constructor(){this.x=0,this.y=0,this.wx=0,this.wy=0,this.wz=0}};m.collision.narrowphase.detector._BoxBoxDetector.FaceClipper=class{constructor(){this.w=0,this.h=0,this.numVertices=0,this.numTmpVertices=0,this.vertices=new Array(8),this.tmpVertices=new Array(8),this.vertices[0]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[0]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[1]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[1]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[2]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[2]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[3]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[3]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[4]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[4]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[5]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[5]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[6]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[6]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.vertices[7]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex,this.tmpVertices[7]=new m.collision.narrowphase.detector._BoxBoxDetector.IncidentVertex}clip(){let t=0,i=this.numVertices;for(;t<i;){let X=t++,c=this.vertices[X],Y=this.vertices[(X+1)%this.numVertices],p=this.w+c.x,x=this.w+Y.x;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),Z=this.tmpVertices[this.numTmpVertices++];Z.x=c.x+(Y.x-c.x)*f,Z.y=c.y+(Y.y-c.y)*f,Z.wx=c.wx+(Y.wx-c.wx)*f,Z.wy=c.wy+(Y.wy-c.wy)*f,Z.wz=c.wz+(Y.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(Y.x-c.x)*v,f.y=c.y+(Y.y-c.y)*v,f.wx=c.wx+(Y.wx-c.wx)*v,f.wy=c.wy+(Y.wy-c.wy)*v,f.wz=c.wz+(Y.wz-c.wz)*v}}let s=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=s,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let o=0,n=this.numVertices;for(;o<n;){let X=o++,c=this.vertices[X],Y=this.vertices[(X+1)%this.numVertices],p=this.w-c.x,x=this.w-Y.x;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),Z=this.tmpVertices[this.numTmpVertices++];Z.x=c.x+(Y.x-c.x)*f,Z.y=c.y+(Y.y-c.y)*f,Z.wx=c.wx+(Y.wx-c.wx)*f,Z.wy=c.wy+(Y.wy-c.wy)*f,Z.wz=c.wz+(Y.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(Y.x-c.x)*v,f.y=c.y+(Y.y-c.y)*v,f.wx=c.wx+(Y.wx-c.wx)*v,f.wy=c.wy+(Y.wy-c.wy)*v,f.wz=c.wz+(Y.wz-c.wz)*v}}let l=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=l,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let _=0,r=this.numVertices;for(;_<r;){let X=_++,c=this.vertices[X],Y=this.vertices[(X+1)%this.numVertices],p=this.h+c.y,x=this.h+Y.y;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),Z=this.tmpVertices[this.numTmpVertices++];Z.x=c.x+(Y.x-c.x)*f,Z.y=c.y+(Y.y-c.y)*f,Z.wx=c.wx+(Y.wx-c.wx)*f,Z.wy=c.wy+(Y.wy-c.wy)*f,Z.wz=c.wz+(Y.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(Y.x-c.x)*v,f.y=c.y+(Y.y-c.y)*v,f.wx=c.wx+(Y.wx-c.wx)*v,f.wy=c.wy+(Y.wy-c.wy)*v,f.wz=c.wz+(Y.wz-c.wz)*v}}let e=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=e,this.numVertices=this.numTmpVertices,this.numTmpVertices=0;let a=0,h=this.numVertices;for(;a<h;){let X=a++,c=this.vertices[X],Y=this.vertices[(X+1)%this.numVertices],p=this.h-c.y,x=this.h-Y.y;if(p>0&&x>0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz}else if(p>0&&x<=0){let v=this.tmpVertices[this.numTmpVertices++];v.x=c.x,v.y=c.y,v.wx=c.wx,v.wy=c.wy,v.wz=c.wz;let f=p/(p-x),Z=this.tmpVertices[this.numTmpVertices++];Z.x=c.x+(Y.x-c.x)*f,Z.y=c.y+(Y.y-c.y)*f,Z.wx=c.wx+(Y.wx-c.wx)*f,Z.wy=c.wy+(Y.wy-c.wy)*f,Z.wz=c.wz+(Y.wz-c.wz)*f}else if(p<=0&&x>0){let v=p/(p-x),f=this.tmpVertices[this.numTmpVertices++];f.x=c.x+(Y.x-c.x)*v,f.y=c.y+(Y.y-c.y)*v,f.wx=c.wx+(Y.wx-c.wx)*v,f.wy=c.wy+(Y.wy-c.wy)*v,f.wz=c.wz+(Y.wz-c.wz)*v}}let b=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=b,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}reduce(){if(this.numVertices<4)return;let t=-1/0,i=1/0,s=-1/0,o=1/0,n=null,l=null,_=null,r=null,e=1,a=1,h=-1,b=1,X=0,c=this.numVertices;for(;X<c;){let Z=this.vertices[X++],k=Z.x*e+Z.y*a,g=Z.x*h+Z.y*b;k>t&&(t=k,n=Z),k<i&&(i=k,l=Z),g>s&&(s=g,_=Z),g<o&&(o=g,r=Z)}let Y=this.tmpVertices[this.numTmpVertices++];Y.x=n.x,Y.y=n.y,Y.wx=n.wx,Y.wy=n.wy,Y.wz=n.wz;let p=this.tmpVertices[this.numTmpVertices++];p.x=_.x,p.y=_.y,p.wx=_.wx,p.wy=_.wy,p.wz=_.wz;let x=this.tmpVertices[this.numTmpVertices++];x.x=l.x,x.y=l.y,x.wx=l.wx,x.wy=l.wy,x.wz=l.wz;let v=this.tmpVertices[this.numTmpVertices++];v.x=r.x,v.y=r.y,v.wx=r.wx,v.wy=r.wy,v.wz=r.wz;let f=this.vertices;this.vertices=this.tmpVertices,this.tmpVertices=f,this.numVertices=this.numTmpVertices,this.numTmpVertices=0}};m.collision.narrowphase.detector.BoxBoxDetectorMacro=class{};m.collision.narrowphase.detector.CachedDetectorData=class{constructor(){}_clear(){this._gjkCache!=null&&this._gjkCache.clear()}};m.collision.narrowphase.detector.CapsuleCapsuleDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,o,n,l){let _=i,r=s;t.incremental=!1;let e,a,h,b,X,c;e=o._rotation01,a=o._rotation11,h=o._rotation21,b=n._rotation01,X=n._rotation11,c=n._rotation21;let Y=_._halfHeight,p=r._halfHeight,x=_._radius,v=r._radius,f,Z,k,g,I,z,d,u,B,j,L,V;f=o._positionX+e*-Y,Z=o._positionY+a*-Y,k=o._positionZ+h*-Y,g=o._positionX+e*Y,I=o._positionY+a*Y,z=o._positionZ+h*Y,d=n._positionX+b*-p,u=n._positionY+X*-p,B=n._positionZ+c*-p,j=n._positionX+b*p,L=n._positionY+X*p,V=n._positionZ+c*p;let M,w,P;M=f-d,w=Z-u,P=k-B;let E,C,S,A,R,H;E=g-f,C=I-Z,S=z-k,A=j-d,R=L-u,H=V-B;let y=-(M*E+w*C+P*S),D=M*A+w*R+P*H,F=Y*Y*4,Q=E*A+C*R+S*H,W=p*p*4,q,U;if(F==0&&W==0)q=0,U=0;else if(F==0)q=0,D<0?U=0:D>W?U=1:U=D/W;else if(W==0)U=0,y<0?q=0:y>F?q=1:q=y/F;else{let Yt=F*W-Q*Q;Yt==0?q=0:(q=Q*D+W*y,q<0?q=0:q>Yt?q=1:q/=Yt),U=q*Q+D,U<0?(U=0,y<0?q=0:y>F?q=1:q=y/F):U>W?(U=1,q=Q+y,q<0?q=0:q>F?q=1:q/=F):U/=W}let G,J,N,K,O,$;G=f+E*q,J=Z+C*q,N=k+S*q,K=d+A*U,O=u+R*U,$=B+H*U;let et,st,lt;et=G-K,st=J-O,lt=N-$;let rt=et*et+st*st+lt*lt;if(rt>=(x+v)*(x+v))return;let at=Math.sqrt(rt),ot,ht,_t;at>0?(ot=et*(1/at),ht=st*(1/at),_t=lt*(1/at)):(ot=1,ht=0,_t=0),this.setNormal(t,ot,ht,_t);let bt,Xt,ft,Zt,xt,zt;bt=G+ot*-x,Xt=J+ht*-x,ft=N+_t*-x,Zt=K+ot*v,xt=O+ht*v,zt=$+_t*v,this.addPoint(t,bt,Xt,ft,Zt,xt,zt,x+v-at,0)}};m.collision.narrowphase.detector.GjkEpaDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,o,n,l){let _=m.collision.narrowphase.detector.gjkepa.GjkEpa.instance,r=i,e=s,a=_.computeClosestPointsImpl(r,e,o,n,m.common.Setting.enableGJKCaching?l:null,!0);if(t.incremental=!0,a!=m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED){console.log("src/oimo/collision/narrowphase/detector/GjkEpaDetector.hx:28:","GJK/EPA failed: status="+a);return}if(_.distance>r._gjkMargin+e._gjkMargin)return;let h,b,X,c,Y,p,x=_.closestPoint1;h=x.x,b=x.y,X=x.z;let v=_.closestPoint2;c=v.x,Y=v.y,p=v.z;let f,Z,k;if(f=h-c,Z=b-Y,k=X-p,f*f+Z*Z+k*k==0)return;_.distance<0&&(f=-f,Z=-Z,k=-k);let g=f*f+Z*Z+k*k;g>0&&(g=1/Math.sqrt(g)),f*=g,Z*=g,k*=g,this.setNormal(t,f,Z,k),h+=f*-r._gjkMargin,b+=Z*-r._gjkMargin,X+=k*-r._gjkMargin,c+=f*e._gjkMargin,Y+=Z*e._gjkMargin,p+=k*e._gjkMargin,this.addPoint(t,h,b,X,c,Y,p,r._gjkMargin+e._gjkMargin-_.distance,0)}};m.collision.narrowphase.detector.SphereBoxDetector=class extends m.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,o,n,l){let _=s;t.incremental=!1;let r,e,a,h,b,X;r=_._halfExtentsX,e=_._halfExtentsY,a=_._halfExtentsZ,h=-r,b=-e,X=-a;let c=i._radius,Y,p,x;Y=o._positionX-n._positionX,p=o._positionY-n._positionY,x=o._positionZ-n._positionZ;let v,f,Z,k,g,I;if(k=n._rotation00*Y+n._rotation10*p+n._rotation20*x,g=n._rotation01*Y+n._rotation11*p+n._rotation21*x,I=n._rotation02*Y+n._rotation12*p+n._rotation22*x,v=k,f=g,Z=I,h<v&&r>v&&b<f&&e>f&&X<Z&&a>Z){let et,st,lt;et=v<0?-v:v,st=f<0?-f:f,lt=Z<0?-Z:Z,et=r-et,st=e-st,lt=a-lt;let rt,at,ot,ht=et,_t=st,bt=lt,Xt,ft,Zt,xt;ht<_t?ht<bt?(v>0?(rt=1,at=0,ot=0):(rt=-1,at=0,ot=0),ft=0,Zt=1,xt=1,Xt=ht):(Z>0?(rt=0,at=0,ot=1):(rt=0,at=0,ot=-1),ft=1,Zt=1,xt=0,Xt=bt):_t<bt?(f>0?(rt=0,at=1,ot=0):(rt=0,at=-1,ot=0),ft=1,Zt=0,xt=1,Xt=_t):(Z>0?(rt=0,at=0,ot=1):(rt=0,at=0,ot=-1),ft=1,Zt=1,xt=0,Xt=bt);let zt,Yt,pt;zt=ft*v,Yt=Zt*f,pt=xt*Z;let ct,nt,tt;ct=rt*r,nt=at*e,tt=ot*a,ct+=zt,nt+=Yt,tt+=pt;let Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi;Yi=n._rotation00*ct+n._rotation01*nt+n._rotation02*tt,Li=n._rotation10*ct+n._rotation11*nt+n._rotation12*tt,wi=n._rotation20*ct+n._rotation21*nt+n._rotation22*tt,Lt=Yi,Bt=Li,Mt=wi;let ei,qt,At;ei=n._rotation00*rt+n._rotation01*at+n._rotation02*ot,qt=n._rotation10*rt+n._rotation11*at+n._rotation12*ot,At=n._rotation20*rt+n._rotation21*at+n._rotation22*ot,jt=ei,ci=qt,Xi=At,this.setNormal(t,jt,ci,Xi);let ni,ui,Oi,Bi,kt,wt;ni=o._positionX+jt*-c,ui=o._positionY+ci*-c,Oi=o._positionZ+Xi*-c,Bi=n._positionX+Lt,kt=n._positionY+Bt,wt=n._positionZ+Mt,this.addPoint(t,ni,ui,Oi,Bi,kt,wt,Xt,0);return}let z,d,u;r-=1e-9,e-=1e-9,a-=1e-9,h+=1e-9,b+=1e-9,X+=1e-9,z=v<r?v:r,d=f<e?f:e,u=Z<a?Z:a,z>h||(z=h),d>b||(d=b),u>X||(u=X);let B,j,L;B=v-z,j=f-d,L=Z-u;let V=B*B+j*j+L*L;if(V>=c*c)return;V=Math.sqrt(V);let M,w,P,E,C,S,A,R,H;A=n._rotation00*z+n._rotation01*d+n._rotation02*u,R=n._rotation10*z+n._rotation11*d+n._rotation12*u,H=n._rotation20*z+n._rotation21*d+n._rotation22*u,M=A,w=R,P=H;let y,D,F;y=n._rotation00*B+n._rotation01*j+n._rotation02*L,D=n._rotation10*B+n._rotation11*j+n._rotation12*L,F=n._rotation20*B+n._rotation21*j+n._rotation22*L,E=y,C=D,S=F;let Q,W,q,U=E*E+C*C+S*S;U>0&&(U=1/Math.sqrt(U)),Q=E*U,W=C*U,q=S*U,this.setNormal(t,Q,W,q);let G,J,N,K,O,$;G=o._positionX+Q*-c,J=o._positionY+W*-c,N=o._positionZ+q*-c,K=n._positionX+M,O=n._positionY+w,$=n._positionZ+P,this.addPoint(t,G,J,N,K,O,$,c-V,0)}};m.collision.narrowphase.detector.SphereCapsuleDetector=class extends m.collision.narrowphase.detector.Detector{constructor(t){super(t)}detectImpl(t,i,s,o,n,l){let _=s;t.incremental=!1;let r=_._halfHeight,e=i._radius,a=_._radius,h,b,X;h=n._rotation01,b=n._rotation11,X=n._rotation21;let c,Y,p;c=o._positionX,Y=o._positionY,p=o._positionZ;let x,v,f,Z,k,g;x=n._positionX+h*-r,v=n._positionY+b*-r,f=n._positionZ+X*-r,Z=n._positionX+h*r,k=n._positionY+b*r,g=n._positionZ+X*r;let I,z,d;I=c-x,z=Y-v,d=p-f;let u,B,j;u=Z-x,B=k-v,j=g-f;let L=r*r*4,V=I*u+z*B+d*j;V<0?V=0:V>L?V=1:V/=L;let M,w,P;M=x+u*V,w=v+B*V,P=f+j*V;let E,C,S;E=c-M,C=Y-w,S=p-P;let A=E*E+C*C+S*S;if(A>=(e+a)*(e+a))return;let R=Math.sqrt(A),H,y,D;R>0?(H=E*(1/R),y=C*(1/R),D=S*(1/R)):(H=1,y=0,D=0),this.setNormal(t,H,y,D);let F,Q,W,q,U,G;F=c+H*-e,Q=Y+y*-e,W=p+D*-e,q=M+H*a,U=w+y*a,G=P+D*a,this.addPoint(t,F,Q,W,q,U,G,e+a-R,0)}};m.collision.narrowphase.detector.SphereSphereDetector=class extends m.collision.narrowphase.detector.Detector{constructor(){super(!1)}detectImpl(t,i,s,o,n,l){t.incremental=!1;let _,r,e;_=o._positionX-n._positionX,r=o._positionY-n._positionY,e=o._positionZ-n._positionZ;let a=i._radius,h=s._radius,b=_*_+r*r+e*e;if(b>=(a+h)*(a+h))return;let X=Math.sqrt(b),c,Y,p;X>0?(c=_*(1/X),Y=r*(1/X),p=e*(1/X)):(c=1,Y=0,p=0),this.setNormal(t,c,Y,p);let x,v,f,Z,k,g;x=o._positionX+c*-a,v=o._positionY+Y*-a,f=o._positionZ+p*-a,Z=n._positionX+c*h,k=n._positionY+Y*h,g=n._positionZ+p*h,this.addPoint(t,x,v,f,Z,k,g,a+h-X,0)}};m.collision.narrowphase.detector.gjkepa||(m.collision.narrowphase.detector.gjkepa={});m.collision.narrowphase.detector.gjkepa.EpaPolyhedron=class{constructor(){this._vertices=new Array(m.common.Setting.maxEPAVertices),this._center=new m.common.Vec3,this._numVertices=0,this._triangleList=null,this._triangleListLast=null,this._numTriangles=0,this._trianglePool=null,this._vertexPool=null}dumpHoleEdge(t){}validate(){let t=this._triangleList;for(;t!=null;){if(t._vertices[0]._tmpEdgeLoopOuterTriangle=null,t._vertices[0]._tmpEdgeLoopNext=null,t._adjacentPairIndex[0]==-1)return this._status=2,!1;if(t._adjacentTriangles[0]==null)return this._status=3,!1;if(t._vertices[1]._tmpEdgeLoopOuterTriangle=null,t._vertices[1]._tmpEdgeLoopNext=null,t._adjacentPairIndex[1]==-1)return this._status=2,!1;if(t._adjacentTriangles[1]==null)return this._status=3,!1;if(t._vertices[2]._tmpEdgeLoopOuterTriangle=null,t._vertices[2]._tmpEdgeLoopNext=null,t._adjacentPairIndex[2]==-1)return this._status=2,!1;if(t._adjacentTriangles[2]==null)return this._status=3,!1;t=t._next}return!0}findEdgeLoop(t,i,s){if(i._tmpDfsId==t)return;i._tmpDfsId=t;let o=i.tmp;o.x=s.x,o.y=s.y,o.z=s.z;let n=i._vertices[0].v;o.x-=n.x,o.y-=n.y,o.z-=n.z;let l=i.tmp,_=i._normal;if(i._tmpDfsVisible=l.x*_.x+l.y*_.y+l.z*_.z>0,!i._tmpDfsVisible){this._status=6;return}let r=0;for(;r<3;){let c=r++,Y=i._adjacentTriangles[c];if(Y==null)continue;let p=Y.tmp;p.x=s.x,p.y=s.y,p.z=s.z;let x=Y._vertices[0].v;p.x-=x.x,p.y-=x.y,p.z-=x.z;let v=Y.tmp,f=Y._normal;if(Y._tmpDfsVisible=v.x*f.x+v.y*f.y+v.z*f.z>0,Y._tmpDfsVisible)this.findEdgeLoop(t,Y,s);else{let Z=i._vertices[c];Z._tmpEdgeLoopNext=i._vertices[i._nextIndex[c]],Z._tmpEdgeLoopOuterTriangle=Y}}let e=i._adjacentTriangles[0];if(e!=null){let c=i._adjacentPairIndex[0];e._adjacentTriangles[c]=null,e._adjacentPairIndex[c]=-1,i._adjacentTriangles[0]=null,i._adjacentPairIndex[0]=-1}let a=i._adjacentTriangles[1];if(a!=null){let c=i._adjacentPairIndex[1];a._adjacentTriangles[c]=null,a._adjacentPairIndex[c]=-1,i._adjacentTriangles[1]=null,i._adjacentPairIndex[1]=-1}let h=i._adjacentTriangles[2];if(h!=null){let c=i._adjacentPairIndex[2];h._adjacentTriangles[c]=null,h._adjacentPairIndex[c]=-1,i._adjacentTriangles[2]=null,i._adjacentPairIndex[2]=-1}this._numTriangles--;let b=i._prev,X=i._next;b!=null&&(b._next=X),X!=null&&(X._prev=b),i==this._triangleList&&(this._triangleList=this._triangleList._next),i==this._triangleListLast&&(this._triangleListLast=this._triangleListLast._prev),i._next=null,i._prev=null,i.removeReferences(),i._next=this._trianglePool,this._trianglePool=i}_init(t,i,s,o){this._status=0,this._numVertices=4,this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s,this._vertices[3]=o;let n=this._center,l=t.v;n.x=l.x,n.y=l.y,n.z=l.z;let _=i.v;n.x+=_.x,n.y+=_.y,n.z+=_.z;let r=s.v;n.x+=r.x,n.y+=r.y,n.z+=r.z;let e=o.v;n.x+=e.x,n.y+=e.y,n.z+=e.z,n.x*=.25,n.y*=.25,n.z*=.25;let a=this._trianglePool;a!=null?(this._trianglePool=a._next,a._next=null):a=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let h=a,b=this._trianglePool;b!=null?(this._trianglePool=b._next,b._next=null):b=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let X=b,c=this._trianglePool;c!=null?(this._trianglePool=c._next,c._next=null):c=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let Y=c,p=this._trianglePool;p!=null?(this._trianglePool=p._next,p._next=null):p=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let x=p;return h.init(t,i,s,this._center,!0)||(this._status=1),X.init(t,i,o,this._center,!0)||(this._status=1),Y.init(t,s,o,this._center,!0)||(this._status=1),x.init(i,s,o,this._center,!0)||(this._status=1),h.setAdjacentTriangle(X)||(this._status=1),h.setAdjacentTriangle(Y)||(this._status=1),h.setAdjacentTriangle(x)||(this._status=1),X.setAdjacentTriangle(Y)||(this._status=1),X.setAdjacentTriangle(x)||(this._status=1),Y.setAdjacentTriangle(x)||(this._status=1),this._numTriangles++,this._triangleList==null?(this._triangleList=h,this._triangleListLast=h):(this._triangleListLast._next=h,h._prev=this._triangleListLast,this._triangleListLast=h),this._numTriangles++,this._triangleList==null?(this._triangleList=X,this._triangleListLast=X):(this._triangleListLast._next=X,X._prev=this._triangleListLast,this._triangleListLast=X),this._numTriangles++,this._triangleList==null?(this._triangleList=Y,this._triangleListLast=Y):(this._triangleListLast._next=Y,Y._prev=this._triangleListLast,this._triangleListLast=Y),this._numTriangles++,this._triangleList==null?(this._triangleList=x,this._triangleListLast=x):(this._triangleListLast._next=x,x._prev=this._triangleListLast,this._triangleListLast=x),this._status==0}_addVertex(t,i){this._vertices[this._numVertices++]=t;let s=i._vertices[0];if(this.findEdgeLoop(this._numVertices,i,t.v),this._status!=0)return!1;let o=s,n=null,l=null;for(;;){if(o._tmpEdgeLoopNext==null)return this._dumpAsObjModel(),this._status=4,!1;if(o._tmpEdgeLoopOuterTriangle==null)return this._status=5,!1;let _=this._trianglePool;_!=null?(this._trianglePool=_._next,_._next=null):_=new m.collision.narrowphase.detector.gjkepa.EpaTriangle;let r=_;if(l==null&&(l=r),r.init(o,o._tmpEdgeLoopNext,t,this._center,!1)||(this._status=1),this._status!=0)return!1;if(this._numTriangles++,this._triangleList==null?(this._triangleList=r,this._triangleListLast=r):(this._triangleListLast._next=r,r._prev=this._triangleListLast,this._triangleListLast=r),r.setAdjacentTriangle(o._tmpEdgeLoopOuterTriangle)||(this._status=1),n!=null&&(r.setAdjacentTriangle(n)||(this._status=1)),n=r,o=o._tmpEdgeLoopNext,o==s)break}return n.setAdjacentTriangle(l)||(this._status=1),this._status==0?this.validate():!1}_dumpAsObjModel(){}};m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState=class{};m.collision.narrowphase.detector.gjkepa.EpaTriangle=class{constructor(){this.id=++m.collision.narrowphase.detector.gjkepa.EpaTriangle.count,this._next=null,this._prev=null,this._normal=new m.common.Vec3,this._distanceSq=0,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._vertices=new Array(3),this._adjacentTriangles=new Array(3),this._adjacentPairIndex=new Array(3),this.tmp=new m.common.Vec3,this._nextIndex=new Array(3),this._nextIndex[0]=1,this._nextIndex[1]=2,this._nextIndex[2]=0}init(t,i,s,o,n){n==null&&(n=!1);let l,_,r,e,a,h,b,X,c,Y,p,x,v=t.v;l=v.x,_=v.y,r=v.z;let f=i.v;e=f.x,a=f.y,h=f.z;let Z=s.v;b=Z.x,X=Z.y,c=Z.z,Y=o.x,p=o.y,x=o.z;let k,g,I,z,d,u,B,j,L;k=e-l,g=a-_,I=h-r,z=b-l,d=X-_,u=c-r,B=l-Y,j=_-p,L=r-x;let V,M,w;V=g*u-I*d,M=I*z-k*u,w=k*d-g*z;let P=!1;if(B*V+j*M+L*w<0)if(n){let Mt=i;i=s,s=Mt,V*=-1,M*=-1,w*=-1}else P=!0;this._vertices[0]=t,this._vertices[1]=i,this._vertices[2]=s;let E=this._normal;E.x=V,E.y=M,E.z=w;let C=t.v,S=i.v,A=s.v,R=this.tmp,H,y,D,F,Q,W,q,U,G,J,N,K,O,$,et,st,lt,rt;H=C.x,y=C.y,D=C.z,F=S.x,Q=S.y,W=S.z,q=A.x,U=A.y,G=A.z,J=F-H,N=Q-y,K=W-D,O=q-F,$=U-Q,et=G-W,st=H-q,lt=y-U,rt=D-G;let at,ot,ht;at=N*et-K*$,ot=K*O-J*et,ht=J*$-N*O;let _t,bt,Xt,ft,Zt,xt,zt,Yt,pt;_t=N*ht-K*ot,bt=K*at-J*ht,Xt=J*ot-N*at,ft=$*ht-et*ot,Zt=et*at-O*ht,xt=O*ot-$*at,zt=lt*ht-rt*ot,Yt=rt*at-st*ht,pt=st*ot-lt*at;let ct=-1,nt,tt,Lt;if(nt=0,tt=0,Lt=0,H*_t+y*bt+D*Xt<0){let Mt,jt,ci,Xi,Yi,Li;Mt=C.x,jt=C.y,ci=C.z,Xi=S.x,Yi=S.y,Li=S.z;let wi,ei,qt;wi=Xi-Mt,ei=Yi-jt,qt=Li-ci;let At=wi*Mt+ei*jt+qt*ci;if(At=-At/(wi*wi+ei*ei+qt*qt),At<0)R.x=Mt,R.y=jt,R.z=ci;else if(At>1)R.x=Xi,R.y=Yi,R.z=Li;else{let ni,ui,Oi;ni=Mt+wi*At,ui=jt+ei*At,Oi=ci+qt*At,R.x=ni,R.y=ui,R.z=Oi}ct=R.x*R.x+R.y*R.y+R.z*R.z,nt=R.x,tt=R.y,Lt=R.z}if(F*ft+Q*Zt+W*xt<0){let Mt,jt,ci,Xi,Yi,Li;Mt=S.x,jt=S.y,ci=S.z,Xi=A.x,Yi=A.y,Li=A.z;let wi,ei,qt;wi=Xi-Mt,ei=Yi-jt,qt=Li-ci;let At=wi*Mt+ei*jt+qt*ci;if(At=-At/(wi*wi+ei*ei+qt*qt),At<0)R.x=Mt,R.y=jt,R.z=ci;else if(At>1)R.x=Xi,R.y=Yi,R.z=Li;else{let ui,Oi,Bi;ui=Mt+wi*At,Oi=jt+ei*At,Bi=ci+qt*At,R.x=ui,R.y=Oi,R.z=Bi}let ni=R.x*R.x+R.y*R.y+R.z*R.z;(ct<0||ni<ct)&&(ct=ni,nt=R.x,tt=R.y,Lt=R.z)}if(q*zt+U*Yt+G*pt<0){let Mt,jt,ci,Xi,Yi,Li;Mt=C.x,jt=C.y,ci=C.z,Xi=A.x,Yi=A.y,Li=A.z;let wi,ei,qt;wi=Xi-Mt,ei=Yi-jt,qt=Li-ci;let At=wi*Mt+ei*jt+qt*ci;if(At=-At/(wi*wi+ei*ei+qt*qt),At<0)R.x=Mt,R.y=jt,R.z=ci;else if(At>1)R.x=Xi,R.y=Yi,R.z=Li;else{let ui,Oi,Bi;ui=Mt+wi*At,Oi=jt+ei*At,Bi=ci+qt*At,R.x=ui,R.y=Oi,R.z=Bi}let ni=R.x*R.x+R.y*R.y+R.z*R.z;(ct<0||ni<ct)&&(ct=ni,nt=R.x,tt=R.y,Lt=R.z)}if(ct>0)R.x=nt,R.y=tt,R.z=Lt;else{let Mt=at*at+ot*ot+ht*ht;Mt>0&&(Mt=1/Math.sqrt(Mt)),at*=Mt,ot*=Mt,ht*=Mt;let jt=at*at+ot*ot+ht*ht;jt=(H*at+y*ot+D*ht)/jt,nt=at*jt,tt=ot*jt,Lt=ht*jt,R.x=nt,R.y=tt,R.z=Lt}let Bt=this.tmp;return this._distanceSq=Bt.x*Bt.x+Bt.y*Bt.y+Bt.z*Bt.z,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=-1,this._adjacentPairIndex[1]=-1,this._adjacentPairIndex[2]=-1,!P}setAdjacentTriangle(t){let i=0;return this._vertices[0]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[0]]==t._vertices[0]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=0,i=1),this._vertices[0]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[0]]==t._vertices[1]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=0,++i),this._vertices[0]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[0]]==t._vertices[2]&&(this._adjacentTriangles[0]=t,this._adjacentPairIndex[0]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=0,++i),this._vertices[1]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[1]]==t._vertices[0]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[1]]==t._vertices[1]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=1,++i),this._vertices[1]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[1]]==t._vertices[2]&&(this._adjacentTriangles[1]=t,this._adjacentPairIndex[1]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=1,++i),this._vertices[2]==t._vertices[this._nextIndex[0]]&&this._vertices[this._nextIndex[2]]==t._vertices[0]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=0,t._adjacentTriangles[0]=this,t._adjacentPairIndex[0]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[1]]&&this._vertices[this._nextIndex[2]]==t._vertices[1]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=1,t._adjacentTriangles[1]=this,t._adjacentPairIndex[1]=2,++i),this._vertices[2]==t._vertices[this._nextIndex[2]]&&this._vertices[this._nextIndex[2]]==t._vertices[2]&&(this._adjacentTriangles[2]=t,this._adjacentPairIndex[2]=2,t._adjacentTriangles[2]=this,t._adjacentPairIndex[2]=2,++i),i==1}removeAdjacentTriangles(){let t=this._adjacentTriangles[0];if(t!=null){let o=this._adjacentPairIndex[0];t._adjacentTriangles[o]=null,t._adjacentPairIndex[o]=-1,this._adjacentTriangles[0]=null,this._adjacentPairIndex[0]=-1}let i=this._adjacentTriangles[1];if(i!=null){let o=this._adjacentPairIndex[1];i._adjacentTriangles[o]=null,i._adjacentPairIndex[o]=-1,this._adjacentTriangles[1]=null,this._adjacentPairIndex[1]=-1}let s=this._adjacentTriangles[2];if(s!=null){let o=this._adjacentPairIndex[2];s._adjacentTriangles[o]=null,s._adjacentPairIndex[o]=-1,this._adjacentTriangles[2]=null,this._adjacentPairIndex[2]=-1}}removeReferences(){this._next=null,this._prev=null,this._tmpDfsId=0,this._tmpDfsVisible=!1,this._distanceSq=0,this._vertices[0]=null,this._vertices[1]=null,this._vertices[2]=null,this._adjacentTriangles[0]=null,this._adjacentTriangles[1]=null,this._adjacentTriangles[2]=null,this._adjacentPairIndex[0]=0,this._adjacentPairIndex[1]=0,this._adjacentPairIndex[2]=0}dump(){}};m.collision.narrowphase.detector.gjkepa.EpaVertex=class{constructor(){this.randId=Math.random()*1e5|0,this.v=new m.common.Vec3,this.w1=new m.common.Vec3,this.w2=new m.common.Vec3}init(t,i,s){let o=this.v;o.x=t.x,o.y=t.y,o.z=t.z;let n=this.w1;n.x=i.x,n.y=i.y,n.z=i.z;let l=this.w2;return l.x=s.x,l.y=s.y,l.z=s.z,this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null,this}removeReferences(){this._next=null,this._tmpEdgeLoopNext=null,this._tmpEdgeLoopOuterTriangle=null}};m.collision.narrowphase.detector.gjkepa.GjkCache=class{constructor(){this.prevClosestDir=new m.common.Vec3}clear(){this.prevClosestDir.zero()}};m.common||(m.common={});m.common.Vec3=class{constructor(t,i,s){s==null&&(s=0),i==null&&(i=0),t==null&&(t=0),this.x=t,this.y=i,this.z=s,m.common.Vec3.numCreations++}init(t,i,s){return this.x=t,this.y=i,this.z=s,this}zero(){return this.x=0,this.y=0,this.z=0,this}add(t){return new m.common.Vec3(this.x+t.x,this.y+t.y,this.z+t.z)}add3(t,i,s){return new m.common.Vec3(this.x+t,this.y+i,this.z+s)}addScaled(t,i){return new m.common.Vec3(this.x+t.x*i,this.y+t.y*i,this.z+t.z*i)}sub(t){return new m.common.Vec3(this.x-t.x,this.y-t.y,this.z-t.z)}sub3(t,i,s){return new m.common.Vec3(this.x-t,this.y-i,this.z-s)}scale(t){return new m.common.Vec3(this.x*t,this.y*t,this.z*t)}scale3(t,i,s){return new m.common.Vec3(this.x*t,this.y*i,this.z*s)}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return new m.common.Vec3(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}add3Eq(t,i,s){return this.x+=t,this.y+=i,this.z+=s,this}addScaledEq(t,i){return this.x+=t.x*i,this.y+=t.y*i,this.z+=t.z*i,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}sub3Eq(t,i,s){return this.x-=t,this.y-=i,this.z-=s,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this}scale3Eq(t,i,s){return this.x*=t,this.y*=i,this.z*=s,this}crossEq(t){let i=this.z*t.x-this.x*t.z,s=this.x*t.y-this.y*t.x;return this.x=this.y*t.z-this.z*t.y,this.y=i,this.z=s,this}mulMat3(t){return new m.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02,this.x*t.e10+this.y*t.e11+this.z*t.e12,this.x*t.e20+this.y*t.e21+this.z*t.e22)}mulMat4(t){return new m.common.Vec3(this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23)}mulTransform(t){let i,s,o;i=this.x,s=this.y,o=this.z;let n,l,_;n=t._rotation00*i+t._rotation01*s+t._rotation02*o,l=t._rotation10*i+t._rotation11*s+t._rotation12*o,_=t._rotation20*i+t._rotation21*s+t._rotation22*o,i=n,s=l,o=_,i+=t._positionX,s+=t._positionY,o+=t._positionZ;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=o,r}mulMat3Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12,s=this.x*t.e20+this.y*t.e21+this.z*t.e22;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02,this.y=i,this.z=s,this}mulMat4Eq(t){let i=this.x*t.e10+this.y*t.e11+this.z*t.e12+t.e13,s=this.x*t.e20+this.y*t.e21+this.z*t.e22+t.e23;return this.x=this.x*t.e00+this.y*t.e01+this.z*t.e02+t.e03,this.y=i,this.z=s,this}mulTransformEq(t){let i,s,o;i=this.x,s=this.y,o=this.z;let n,l,_;return n=t._rotation00*i+t._rotation01*s+t._rotation02*o,l=t._rotation10*i+t._rotation11*s+t._rotation12*o,_=t._rotation20*i+t._rotation21*s+t._rotation22*o,i=n,s=l,o=_,i+=t._positionX,s+=t._positionY,o+=t._positionZ,this.x=i,this.y=s,this.z=o,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),new m.common.Vec3(this.x*t,this.y*t,this.z*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this}negate(){return new m.common.Vec3(-this.x,-this.y,-this.z)}negateEq(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}clone(){return new m.common.Vec3(this.x,this.y,this.z)}toString(){return"Vec3["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+", "+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+", "+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+"]"}};m.common.Transform=class{constructor(){this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1}identity(){return this._positionX=0,this._positionY=0,this._positionZ=0,this._rotation00=1,this._rotation01=0,this._rotation02=0,this._rotation10=0,this._rotation11=1,this._rotation12=0,this._rotation20=0,this._rotation21=0,this._rotation22=1,this}getPosition(){let t=new m.common.Vec3;return t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ,t}getPositionTo(t){t.x=this._positionX,t.y=this._positionY,t.z=this._positionZ}setPosition(t){return this._positionX=t.x,this._positionY=t.y,this._positionZ=t.z,this}translate(t){let i,s,o;i=t.x,s=t.y,o=t.z,this._positionX+=i,this._positionY+=s,this._positionZ+=o}getRotation(){let t=new m.common.Mat3;return t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22,t}getRotationTo(t){t.e00=this._rotation00,t.e01=this._rotation01,t.e02=this._rotation02,t.e10=this._rotation10,t.e11=this._rotation11,t.e12=this._rotation12,t.e20=this._rotation20,t.e21=this._rotation21,t.e22=this._rotation22}setRotation(t){return this._rotation00=t.e00,this._rotation01=t.e01,this._rotation02=t.e02,this._rotation10=t.e10,this._rotation11=t.e11,this._rotation12=t.e12,this._rotation20=t.e20,this._rotation21=t.e21,this._rotation22=t.e22,this}setRotationXyz(t){let i,s,o;i=t.x,s=t.y,o=t.z;let n=Math.sin(i),l=Math.sin(s),_=Math.sin(o),r=Math.cos(i),e=Math.cos(s),a=Math.cos(o);this._rotation00=e*a,this._rotation01=-e*_,this._rotation02=l,this._rotation10=r*_+a*n*l,this._rotation11=r*a-n*l*_,this._rotation12=-e*n,this._rotation20=n*_-r*a*l,this._rotation21=a*n+r*l*_,this._rotation22=r*e}rotate(t){let i,s,o,n,l,_,r,e,a;i=t.e00,s=t.e01,o=t.e02,n=t.e10,l=t.e11,_=t.e12,r=t.e20,e=t.e21,a=t.e22;let h,b,X,c,Y,p,x,v,f;h=i*this._rotation00+s*this._rotation10+o*this._rotation20,b=i*this._rotation01+s*this._rotation11+o*this._rotation21,X=i*this._rotation02+s*this._rotation12+o*this._rotation22,c=n*this._rotation00+l*this._rotation10+_*this._rotation20,Y=n*this._rotation01+l*this._rotation11+_*this._rotation21,p=n*this._rotation02+l*this._rotation12+_*this._rotation22,x=r*this._rotation00+e*this._rotation10+a*this._rotation20,v=r*this._rotation01+e*this._rotation11+a*this._rotation21,f=r*this._rotation02+e*this._rotation12+a*this._rotation22,this._rotation00=h,this._rotation01=b,this._rotation02=X,this._rotation10=c,this._rotation11=Y,this._rotation12=p,this._rotation20=x,this._rotation21=v,this._rotation22=f}rotateXyz(t){let i,s,o,n,l,_,r,e,a,h,b,X;i=t.x,s=t.y,o=t.z;let c=Math.sin(i),Y=Math.sin(s),p=Math.sin(o),x=Math.cos(i),v=Math.cos(s),f=Math.cos(o);n=v*f,l=-v*p,_=Y,r=x*p+f*c*Y,e=x*f-c*Y*p,a=-v*c,h=c*p-x*f*Y,b=f*c+x*Y*p,X=x*v;let Z,k,g,I,z,d,u,B,j;Z=n*this._rotation00+l*this._rotation10+_*this._rotation20,k=n*this._rotation01+l*this._rotation11+_*this._rotation21,g=n*this._rotation02+l*this._rotation12+_*this._rotation22,I=r*this._rotation00+e*this._rotation10+a*this._rotation20,z=r*this._rotation01+e*this._rotation11+a*this._rotation21,d=r*this._rotation02+e*this._rotation12+a*this._rotation22,u=h*this._rotation00+b*this._rotation10+X*this._rotation20,B=h*this._rotation01+b*this._rotation11+X*this._rotation21,j=h*this._rotation02+b*this._rotation12+X*this._rotation22,this._rotation00=Z,this._rotation01=k,this._rotation02=g,this._rotation10=I,this._rotation11=z,this._rotation12=d,this._rotation20=u,this._rotation21=B,this._rotation22=j}getOrientation(){let t=new m.common.Quat,i,s,o,n,l=this._rotation00,_=this._rotation11,r=this._rotation22,e=l+_+r,a;return e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._rotation21-this._rotation12)*a,s=(this._rotation02-this._rotation20)*a,o=(this._rotation10-this._rotation01)*a):l>_?l>r?(a=Math.sqrt(l-_-r+1),i=.5*a,a=.5/a,s=(this._rotation01+this._rotation10)*a,o=(this._rotation02+this._rotation20)*a,n=(this._rotation21-this._rotation12)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a):_>r?(a=Math.sqrt(_-r-l+1),s=.5*a,a=.5/a,i=(this._rotation01+this._rotation10)*a,o=(this._rotation12+this._rotation21)*a,n=(this._rotation02-this._rotation20)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a),t.x=i,t.y=s,t.z=o,t.w=n,t}getOrientationTo(t){let i,s,o,n,l=this._rotation00,_=this._rotation11,r=this._rotation22,e=l+_+r,a;e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._rotation21-this._rotation12)*a,s=(this._rotation02-this._rotation20)*a,o=(this._rotation10-this._rotation01)*a):l>_?l>r?(a=Math.sqrt(l-_-r+1),i=.5*a,a=.5/a,s=(this._rotation01+this._rotation10)*a,o=(this._rotation02+this._rotation20)*a,n=(this._rotation21-this._rotation12)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a):_>r?(a=Math.sqrt(_-r-l+1),s=.5*a,a=.5/a,i=(this._rotation01+this._rotation10)*a,o=(this._rotation12+this._rotation21)*a,n=(this._rotation02-this._rotation20)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._rotation02+this._rotation20)*a,s=(this._rotation12+this._rotation21)*a,n=(this._rotation10-this._rotation01)*a),t.x=i,t.y=s,t.z=o,t.w=n}setOrientation(t){let i,s,o,n;i=t.x,s=t.y,o=t.z,n=t.w;let l=i,_=s,r=o,e=n,a=2*l,h=2*_,b=2*r,X=l*a,c=_*h,Y=r*b,p=l*h,x=_*b,v=l*b,f=e*a,Z=e*h,k=e*b;return this._rotation00=1-c-Y,this._rotation01=p-k,this._rotation02=v+Z,this._rotation10=p+k,this._rotation11=1-X-Y,this._rotation12=x-f,this._rotation20=v-Z,this._rotation21=x+f,this._rotation22=1-X-c,this}clone(){let t=new m.common.Transform;return t._positionX=this._positionX,t._positionY=this._positionY,t._positionZ=this._positionZ,t._rotation00=this._rotation00,t._rotation01=this._rotation01,t._rotation02=this._rotation02,t._rotation10=this._rotation10,t._rotation11=this._rotation11,t._rotation12=this._rotation12,t._rotation20=this._rotation20,t._rotation21=this._rotation21,t._rotation22=this._rotation22,t}copyFrom(t){return this._positionX=t._positionX,this._positionY=t._positionY,this._positionZ=t._positionZ,this._rotation00=t._rotation00,this._rotation01=t._rotation01,this._rotation02=t._rotation02,this._rotation10=t._rotation10,this._rotation11=t._rotation11,this._rotation12=t._rotation12,this._rotation20=t._rotation20,this._rotation21=t._rotation21,this._rotation22=t._rotation22,this}};m.common.Setting=class{};m.collision.narrowphase.detector.gjkepa.GjkEpa=class{constructor(){this.s=new Array(4),this.w1=new Array(4),this.w2=new Array(4),this.baseDirs=new Array(3),this.baseDirs[0]=new m.common.Vec3(1,0,0),this.baseDirs[1]=new m.common.Vec3(0,1,0),this.baseDirs[2]=new m.common.Vec3(0,0,1),this.tl1=new m.common.Vec3,this.tl2=new m.common.Vec3,this.rayX=new m.common.Vec3,this.rayR=new m.common.Vec3,this.tempTransform=new m.common.Transform,this.s[0]=new m.common.Vec3,this.w1[0]=new m.common.Vec3,this.w2[0]=new m.common.Vec3,this.s[1]=new m.common.Vec3,this.w1[1]=new m.common.Vec3,this.w2[1]=new m.common.Vec3,this.s[2]=new m.common.Vec3,this.w1[2]=new m.common.Vec3,this.w2[2]=new m.common.Vec3,this.s[3]=new m.common.Vec3,this.w1[3]=new m.common.Vec3,this.w2[3]=new m.common.Vec3,this.dir=new m.common.Vec3,this.closest=new m.common.Vec3,this.closestPoint1=new m.common.Vec3,this.closestPoint2=new m.common.Vec3,this.polyhedron=new m.collision.narrowphase.detector.gjkepa.EpaPolyhedron}computeClosestPointsImpl(t,i,s,o,n,l){this.c1=t,this.c2=i,this.tf1=s,this.tf2=o;let _=this.s,r=this.w1,e=this.w2,a=this.closest,h=this.dir;if(n!=null?(n._gjkCache==null&&(n._gjkCache=new m.collision.narrowphase.detector.gjkepa.GjkCache),this.loadCache(n._gjkCache)):h.zero(),h.x*h.x+h.y*h.y+h.z*h.z==0){let p,x,v;p=o._positionX-s._positionX,x=o._positionY-s._positionY,v=o._positionZ-s._positionZ,h.x=p,h.y=x,h.z=v,h.x*h.x+h.y*h.y+h.z*h.z<1e-6&&h.init(1,0,0)}this.simplexSize=0,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let b=this.s[this.simplexSize],X=this.w1[this.simplexSize];b.x=X.x,b.y=X.y,b.z=X.z;let c=this.w2[this.simplexSize];b.x-=c.x,b.y-=c.y,b.z-=c.z,this.simplexSize=1;let Y=0;for(;Y<40;){let p=0;switch(this.simplexSize){case 1:let k=_[0];a.x=k.x,a.y=k.y,a.z=k.z,p=1;break;case 2:let g,I,z,d,u,B,j=_[0];g=j.x,I=j.y,z=j.z;let L=_[1];d=L.x,u=L.y,B=L.z;let V,M,w;V=d-g,M=u-I,w=B-z;let P=V*g+M*I+w*z;if(P=-P/(V*V+M*M+w*w),P<0)a.x=g,a.y=I,a.z=z,p=1;else if(P>1)a.x=d,a.y=u,a.z=B,p=2;else{let Ni,Ji,Ui;Ni=g+V*P,Ji=I+M*P,Ui=z+w*P,a.x=Ni,a.y=Ji,a.z=Ui,p=3}break;case 3:let E=_[0],C=_[1],S=_[2],A,R,H,y,D,F,Q,W,q,U,G,J,N,K,O,$,et,st;A=E.x,R=E.y,H=E.z,y=C.x,D=C.y,F=C.z,Q=S.x,W=S.y,q=S.z,U=y-A,G=D-R,J=F-H,N=Q-y,K=W-D,O=q-F,$=A-Q,et=R-W,st=H-q;let lt,rt,at;lt=G*O-J*K,rt=J*N-U*O,at=U*K-G*N;let ot,ht,_t,bt,Xt,ft,Zt,xt,zt;ot=G*at-J*rt,ht=J*lt-U*at,_t=U*rt-G*lt,bt=K*at-O*rt,Xt=O*lt-N*at,ft=N*rt-K*lt,Zt=et*at-st*rt,xt=st*lt-$*at,zt=$*rt-et*lt;let Yt=-1,pt,ct,nt,tt=0;if(pt=0,ct=0,nt=0,A*ot+R*ht+H*_t<0){let Ni,Ji,Ui,oe,ne,Ki;Ni=E.x,Ji=E.y,Ui=E.z,oe=C.x,ne=C.y,Ki=C.z;let ie,Hi,Wi;ie=oe-Ni,Hi=ne-Ji,Wi=Ki-Ui;let Pi=ie*Ni+Hi*Ji+Wi*Ui;Pi=-Pi/(ie*ie+Hi*Hi+Wi*Wi);let Ut;if(Pi<0)a.x=Ni,a.y=Ji,a.z=Ui,Ut=1;else if(Pi>1)a.x=oe,a.y=ne,a.z=Ki,Ut=2;else{let ri,Ct,Mi;ri=Ni+ie*Pi,Ct=Ji+Hi*Pi,Mi=Ui+Wi*Pi,a.x=ri,a.y=Ct,a.z=Mi,Ut=3}tt=Ut,Yt=a.x*a.x+a.y*a.y+a.z*a.z,pt=a.x,ct=a.y,nt=a.z}if(y*bt+D*Xt+F*ft<0){let Ni,Ji,Ui,oe,ne,Ki;Ni=C.x,Ji=C.y,Ui=C.z,oe=S.x,ne=S.y,Ki=S.z;let ie,Hi,Wi;ie=oe-Ni,Hi=ne-Ji,Wi=Ki-Ui;let Pi=ie*Ni+Hi*Ji+Wi*Ui;Pi=-Pi/(ie*ie+Hi*Hi+Wi*Wi);let Ut;if(Pi<0)a.x=Ni,a.y=Ji,a.z=Ui,Ut=1;else if(Pi>1)a.x=oe,a.y=ne,a.z=Ki,Ut=2;else{let Ct,Mi,zi;Ct=Ni+ie*Pi,Mi=Ji+Hi*Pi,zi=Ui+Wi*Pi,a.x=Ct,a.y=Mi,a.z=zi,Ut=3}let ri=a.x*a.x+a.y*a.y+a.z*a.z;(Yt<0||ri<Yt)&&(tt=Ut<<1,Yt=ri,pt=a.x,ct=a.y,nt=a.z)}if(Q*Zt+W*xt+q*zt<0){let Ni,Ji,Ui,oe,ne,Ki;Ni=E.x,Ji=E.y,Ui=E.z,oe=S.x,ne=S.y,Ki=S.z;let ie,Hi,Wi;ie=oe-Ni,Hi=ne-Ji,Wi=Ki-Ui;let Pi=ie*Ni+Hi*Ji+Wi*Ui;Pi=-Pi/(ie*ie+Hi*Hi+Wi*Wi);let Ut;if(Pi<0)a.x=Ni,a.y=Ji,a.z=Ui,Ut=1;else if(Pi>1)a.x=oe,a.y=ne,a.z=Ki,Ut=2;else{let Ct,Mi,zi;Ct=Ni+ie*Pi,Mi=Ji+Hi*Pi,zi=Ui+Wi*Pi,a.x=Ct,a.y=Mi,a.z=zi,Ut=3}let ri=a.x*a.x+a.y*a.y+a.z*a.z;(Yt<0||ri<Yt)&&(tt=Ut&1|(Ut&2)<<1,Yt=ri,pt=a.x,ct=a.y,nt=a.z)}if(Yt>0)a.x=pt,a.y=ct,a.z=nt,p=tt;else{let Ni=lt*lt+rt*rt+at*at;Ni>0&&(Ni=1/Math.sqrt(Ni)),lt*=Ni,rt*=Ni,at*=Ni;let Ji=lt*lt+rt*rt+at*at;Ji=(A*lt+R*rt+H*at)/Ji,pt=lt*Ji,ct=rt*Ji,nt=at*Ji,a.x=pt,a.y=ct,a.z=nt,p=7}break;case 4:let Lt=_[0],Bt=_[1],Mt=_[2],jt=_[3],ci,Xi,Yi,Li,wi,ei,qt,At,ni,ui,Oi,Bi,kt,wt,$t,fi,gi,it,Ht,ii,T,Gt,Et,si,oi,Pt,ai;ci=Lt.x,Xi=Lt.y,Yi=Lt.z,Li=Bt.x,wi=Bt.y,ei=Bt.z,qt=Mt.x,At=Mt.y,ni=Mt.z,ui=jt.x,Oi=jt.y,Bi=jt.z,kt=Li-ci,wt=wi-Xi,$t=ei-Yi,fi=qt-ci,gi=At-Xi,it=ni-Yi,Ht=ui-ci,ii=Oi-Xi,T=Bi-Yi,Gt=qt-Li,Et=At-wi,si=ni-ei,oi=ui-Li,Pt=Oi-wi,ai=Bi-ei;let Ri,Zi,yt,dt,vt,di,Ii,bi,se,me,Di,he;Ri=wt*it-$t*gi,Zi=$t*fi-kt*it,yt=kt*gi-wt*fi,dt=gi*T-it*ii,vt=it*Ht-fi*T,di=fi*ii-gi*Ht,Ii=ii*$t-T*wt,bi=T*kt-Ht*$t,se=Ht*wt-ii*kt,me=Pt*si-ai*Et,Di=ai*Gt-oi*si,he=oi*Et-Pt*Gt;let ve=kt*me+wt*Di+$t*he>0?1:-1,_i=-1,ce,be,xe,ye=0;if(ce=0,be=0,xe=0,(ci*Ri+Xi*Zi+Yi*yt)*ve<0){let Ni,Ji,Ui,oe,ne,Ki,ie,Hi,Wi,Pi,Ut,ri,Ct,Mi,zi,Ei,ki,Ti;Ni=Lt.x,Ji=Lt.y,Ui=Lt.z,oe=Bt.x,ne=Bt.y,Ki=Bt.z,ie=Mt.x,Hi=Mt.y,Wi=Mt.z,Pi=oe-Ni,Ut=ne-Ji,ri=Ki-Ui,Ct=ie-oe,Mi=Hi-ne,zi=Wi-Ki,Ei=Ni-ie,ki=Ji-Hi,Ti=Ui-Wi;let Wt,ut,Vt;Wt=Ut*zi-ri*Mi,ut=ri*Ct-Pi*zi,Vt=Pi*Mi-Ut*Ct;let Ai,Vi,Fi,$i,ae,re,pe,ti,qi;Ai=Ut*Vt-ri*ut,Vi=ri*Wt-Pi*Vt,Fi=Pi*ut-Ut*Wt,$i=Mi*Vt-zi*ut,ae=zi*Wt-Ct*Vt,re=Ct*ut-Mi*Wt,pe=ki*Vt-Ti*ut,ti=Ti*Wt-Ei*Vt,qi=Ei*ut-ki*Wt;let vi=-1,Ci,mi,St,Tt=0;if(Ci=0,mi=0,St=0,Ni*Ai+Ji*Vi+Ui*Fi<0){let Rt,mt,gt,Ft,Dt,Nt;Rt=Lt.x,mt=Lt.y,gt=Lt.z,Ft=Bt.x,Dt=Bt.y,Nt=Bt.z;let Kt,li,yi;Kt=Ft-Rt,li=Dt-mt,yi=Nt-gt;let pi=Kt*Rt+li*mt+yi*gt;pi=-pi/(Kt*Kt+li*li+yi*yi);let Ot;if(pi<0)a.x=Rt,a.y=mt,a.z=gt,Ot=1;else if(pi>1)a.x=Ft,a.y=Dt,a.z=Nt,Ot=2;else{let It,Jt,xi;It=Rt+Kt*pi,Jt=mt+li*pi,xi=gt+yi*pi,a.x=It,a.y=Jt,a.z=xi,Ot=3}Tt=Ot,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ci=a.x,mi=a.y,St=a.z}if(oe*$i+ne*ae+Ki*re<0){let Rt,mt,gt,Ft,Dt,Nt;Rt=Bt.x,mt=Bt.y,gt=Bt.z,Ft=Mt.x,Dt=Mt.y,Nt=Mt.z;let Kt,li,yi;Kt=Ft-Rt,li=Dt-mt,yi=Nt-gt;let pi=Kt*Rt+li*mt+yi*gt;pi=-pi/(Kt*Kt+li*li+yi*yi);let Ot;if(pi<0)a.x=Rt,a.y=mt,a.z=gt,Ot=1;else if(pi>1)a.x=Ft,a.y=Dt,a.z=Nt,Ot=2;else{let Jt,xi,ji;Jt=Rt+Kt*pi,xi=mt+li*pi,ji=gt+yi*pi,a.x=Jt,a.y=xi,a.z=ji,Ot=3}let It=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||It<vi)&&(Tt=Ot<<1,vi=It,Ci=a.x,mi=a.y,St=a.z)}if(ie*pe+Hi*ti+Wi*qi<0){let Rt,mt,gt,Ft,Dt,Nt;Rt=Lt.x,mt=Lt.y,gt=Lt.z,Ft=Mt.x,Dt=Mt.y,Nt=Mt.z;let Kt,li,yi;Kt=Ft-Rt,li=Dt-mt,yi=Nt-gt;let pi=Kt*Rt+li*mt+yi*gt;pi=-pi/(Kt*Kt+li*li+yi*yi);let Ot;if(pi<0)a.x=Rt,a.y=mt,a.z=gt,Ot=1;else if(pi>1)a.x=Ft,a.y=Dt,a.z=Nt,Ot=2;else{let Jt,xi,ji;Jt=Rt+Kt*pi,xi=mt+li*pi,ji=gt+yi*pi,a.x=Jt,a.y=xi,a.z=ji,Ot=3}let It=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||It<vi)&&(Tt=Ot&1|(Ot&2)<<1,vi=It,Ci=a.x,mi=a.y,St=a.z)}let hi;if(vi>0)a.x=Ci,a.y=mi,a.z=St,hi=Tt;else{let Rt=Wt*Wt+ut*ut+Vt*Vt;Rt>0&&(Rt=1/Math.sqrt(Rt)),Wt*=Rt,ut*=Rt,Vt*=Rt;let mt=Wt*Wt+ut*ut+Vt*Vt;mt=(Ni*Wt+Ji*ut+Ui*Vt)/mt,Ci=Wt*mt,mi=ut*mt,St=Vt*mt,a.x=Ci,a.y=mi,a.z=St,hi=7}ye=hi,_i=a.x*a.x+a.y*a.y+a.z*a.z,ce=a.x,be=a.y,xe=a.z}if((ci*dt+Xi*vt+Yi*di)*ve<0){let Ni,Ji,Ui,oe,ne,Ki,ie,Hi,Wi,Pi,Ut,ri,Ct,Mi,zi,Ei,ki,Ti;Ni=Lt.x,Ji=Lt.y,Ui=Lt.z,oe=Mt.x,ne=Mt.y,Ki=Mt.z,ie=jt.x,Hi=jt.y,Wi=jt.z,Pi=oe-Ni,Ut=ne-Ji,ri=Ki-Ui,Ct=ie-oe,Mi=Hi-ne,zi=Wi-Ki,Ei=Ni-ie,ki=Ji-Hi,Ti=Ui-Wi;let Wt,ut,Vt;Wt=Ut*zi-ri*Mi,ut=ri*Ct-Pi*zi,Vt=Pi*Mi-Ut*Ct;let Ai,Vi,Fi,$i,ae,re,pe,ti,qi;Ai=Ut*Vt-ri*ut,Vi=ri*Wt-Pi*Vt,Fi=Pi*ut-Ut*Wt,$i=Mi*Vt-zi*ut,ae=zi*Wt-Ct*Vt,re=Ct*ut-Mi*Wt,pe=ki*Vt-Ti*ut,ti=Ti*Wt-Ei*Vt,qi=Ei*ut-ki*Wt;let vi=-1,Ci,mi,St,Tt=0;if(Ci=0,mi=0,St=0,Ni*Ai+Ji*Vi+Ui*Fi<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Lt.x,gt=Lt.y,Ft=Lt.z,Dt=Mt.x,Nt=Mt.y,Kt=Mt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let Jt,xi,ji;Jt=mt+li*Ot,xi=gt+yi*Ot,ji=Ft+pi*Ot,a.x=Jt,a.y=xi,a.z=ji,It=3}Tt=It,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ci=a.x,mi=a.y,St=a.z}if(oe*$i+ne*ae+Ki*re<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Mt.x,gt=Mt.y,Ft=Mt.z,Dt=jt.x,Nt=jt.y,Kt=jt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let xi,ji,ee;xi=mt+li*Ot,ji=gt+yi*Ot,ee=Ft+pi*Ot,a.x=xi,a.y=ji,a.z=ee,It=3}let Jt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Jt<vi)&&(Tt=It<<1,vi=Jt,Ci=a.x,mi=a.y,St=a.z)}if(ie*pe+Hi*ti+Wi*qi<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Lt.x,gt=Lt.y,Ft=Lt.z,Dt=jt.x,Nt=jt.y,Kt=jt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let xi,ji,ee;xi=mt+li*Ot,ji=gt+yi*Ot,ee=Ft+pi*Ot,a.x=xi,a.y=ji,a.z=ee,It=3}let Jt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Jt<vi)&&(Tt=It&1|(It&2)<<1,vi=Jt,Ci=a.x,mi=a.y,St=a.z)}let hi;if(vi>0)a.x=Ci,a.y=mi,a.z=St,hi=Tt;else{let mt=Wt*Wt+ut*ut+Vt*Vt;mt>0&&(mt=1/Math.sqrt(mt)),Wt*=mt,ut*=mt,Vt*=mt;let gt=Wt*Wt+ut*ut+Vt*Vt;gt=(Ni*Wt+Ji*ut+Ui*Vt)/gt,Ci=Wt*gt,mi=ut*gt,St=Vt*gt,a.x=Ci,a.y=mi,a.z=St,hi=7}let Rt=a.x*a.x+a.y*a.y+a.z*a.z;(_i<0||Rt<_i)&&(ye=hi&1|(hi&6)<<1,_i=Rt,ce=a.x,be=a.y,xe=a.z)}if((ci*Ii+Xi*bi+Yi*se)*ve<0){let Ni,Ji,Ui,oe,ne,Ki,ie,Hi,Wi,Pi,Ut,ri,Ct,Mi,zi,Ei,ki,Ti;Ni=Lt.x,Ji=Lt.y,Ui=Lt.z,oe=Bt.x,ne=Bt.y,Ki=Bt.z,ie=jt.x,Hi=jt.y,Wi=jt.z,Pi=oe-Ni,Ut=ne-Ji,ri=Ki-Ui,Ct=ie-oe,Mi=Hi-ne,zi=Wi-Ki,Ei=Ni-ie,ki=Ji-Hi,Ti=Ui-Wi;let Wt,ut,Vt;Wt=Ut*zi-ri*Mi,ut=ri*Ct-Pi*zi,Vt=Pi*Mi-Ut*Ct;let Ai,Vi,Fi,$i,ae,re,pe,ti,qi;Ai=Ut*Vt-ri*ut,Vi=ri*Wt-Pi*Vt,Fi=Pi*ut-Ut*Wt,$i=Mi*Vt-zi*ut,ae=zi*Wt-Ct*Vt,re=Ct*ut-Mi*Wt,pe=ki*Vt-Ti*ut,ti=Ti*Wt-Ei*Vt,qi=Ei*ut-ki*Wt;let vi=-1,Ci,mi,St,Tt=0;if(Ci=0,mi=0,St=0,Ni*Ai+Ji*Vi+Ui*Fi<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Lt.x,gt=Lt.y,Ft=Lt.z,Dt=Bt.x,Nt=Bt.y,Kt=Bt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let Jt,xi,ji;Jt=mt+li*Ot,xi=gt+yi*Ot,ji=Ft+pi*Ot,a.x=Jt,a.y=xi,a.z=ji,It=3}Tt=It,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ci=a.x,mi=a.y,St=a.z}if(oe*$i+ne*ae+Ki*re<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Bt.x,gt=Bt.y,Ft=Bt.z,Dt=jt.x,Nt=jt.y,Kt=jt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let xi,ji,ee;xi=mt+li*Ot,ji=gt+yi*Ot,ee=Ft+pi*Ot,a.x=xi,a.y=ji,a.z=ee,It=3}let Jt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Jt<vi)&&(Tt=It<<1,vi=Jt,Ci=a.x,mi=a.y,St=a.z)}if(ie*pe+Hi*ti+Wi*qi<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Lt.x,gt=Lt.y,Ft=Lt.z,Dt=jt.x,Nt=jt.y,Kt=jt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let xi,ji,ee;xi=mt+li*Ot,ji=gt+yi*Ot,ee=Ft+pi*Ot,a.x=xi,a.y=ji,a.z=ee,It=3}let Jt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Jt<vi)&&(Tt=It&1|(It&2)<<1,vi=Jt,Ci=a.x,mi=a.y,St=a.z)}let hi;if(vi>0)a.x=Ci,a.y=mi,a.z=St,hi=Tt;else{let mt=Wt*Wt+ut*ut+Vt*Vt;mt>0&&(mt=1/Math.sqrt(mt)),Wt*=mt,ut*=mt,Vt*=mt;let gt=Wt*Wt+ut*ut+Vt*Vt;gt=(Ni*Wt+Ji*ut+Ui*Vt)/gt,Ci=Wt*gt,mi=ut*gt,St=Vt*gt,a.x=Ci,a.y=mi,a.z=St,hi=7}let Rt=a.x*a.x+a.y*a.y+a.z*a.z;(_i<0||Rt<_i)&&(ye=hi&3|(hi&4)<<1,_i=Rt,ce=a.x,be=a.y,xe=a.z)}if((Li*me+wi*Di+ei*he)*ve<0){let Ni,Ji,Ui,oe,ne,Ki,ie,Hi,Wi,Pi,Ut,ri,Ct,Mi,zi,Ei,ki,Ti;Ni=Bt.x,Ji=Bt.y,Ui=Bt.z,oe=Mt.x,ne=Mt.y,Ki=Mt.z,ie=jt.x,Hi=jt.y,Wi=jt.z,Pi=oe-Ni,Ut=ne-Ji,ri=Ki-Ui,Ct=ie-oe,Mi=Hi-ne,zi=Wi-Ki,Ei=Ni-ie,ki=Ji-Hi,Ti=Ui-Wi;let Wt,ut,Vt;Wt=Ut*zi-ri*Mi,ut=ri*Ct-Pi*zi,Vt=Pi*Mi-Ut*Ct;let Ai,Vi,Fi,$i,ae,re,pe,ti,qi;Ai=Ut*Vt-ri*ut,Vi=ri*Wt-Pi*Vt,Fi=Pi*ut-Ut*Wt,$i=Mi*Vt-zi*ut,ae=zi*Wt-Ct*Vt,re=Ct*ut-Mi*Wt,pe=ki*Vt-Ti*ut,ti=Ti*Wt-Ei*Vt,qi=Ei*ut-ki*Wt;let vi=-1,Ci,mi,St,Tt=0;if(Ci=0,mi=0,St=0,Ni*Ai+Ji*Vi+Ui*Fi<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Bt.x,gt=Bt.y,Ft=Bt.z,Dt=Mt.x,Nt=Mt.y,Kt=Mt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let Jt,xi,ji;Jt=mt+li*Ot,xi=gt+yi*Ot,ji=Ft+pi*Ot,a.x=Jt,a.y=xi,a.z=ji,It=3}Tt=It,vi=a.x*a.x+a.y*a.y+a.z*a.z,Ci=a.x,mi=a.y,St=a.z}if(oe*$i+ne*ae+Ki*re<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Mt.x,gt=Mt.y,Ft=Mt.z,Dt=jt.x,Nt=jt.y,Kt=jt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let xi,ji,ee;xi=mt+li*Ot,ji=gt+yi*Ot,ee=Ft+pi*Ot,a.x=xi,a.y=ji,a.z=ee,It=3}let Jt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Jt<vi)&&(Tt=It<<1,vi=Jt,Ci=a.x,mi=a.y,St=a.z)}if(ie*pe+Hi*ti+Wi*qi<0){let mt,gt,Ft,Dt,Nt,Kt;mt=Bt.x,gt=Bt.y,Ft=Bt.z,Dt=jt.x,Nt=jt.y,Kt=jt.z;let li,yi,pi;li=Dt-mt,yi=Nt-gt,pi=Kt-Ft;let Ot=li*mt+yi*gt+pi*Ft;Ot=-Ot/(li*li+yi*yi+pi*pi);let It;if(Ot<0)a.x=mt,a.y=gt,a.z=Ft,It=1;else if(Ot>1)a.x=Dt,a.y=Nt,a.z=Kt,It=2;else{let xi,ji,ee;xi=mt+li*Ot,ji=gt+yi*Ot,ee=Ft+pi*Ot,a.x=xi,a.y=ji,a.z=ee,It=3}let Jt=a.x*a.x+a.y*a.y+a.z*a.z;(vi<0||Jt<vi)&&(Tt=It&1|(It&2)<<1,vi=Jt,Ci=a.x,mi=a.y,St=a.z)}let hi;if(vi>0)a.x=Ci,a.y=mi,a.z=St,hi=Tt;else{let mt=Wt*Wt+ut*ut+Vt*Vt;mt>0&&(mt=1/Math.sqrt(mt)),Wt*=mt,ut*=mt,Vt*=mt;let gt=Wt*Wt+ut*ut+Vt*Vt;gt=(Ni*Wt+Ji*ut+Ui*Vt)/gt,Ci=Wt*gt,mi=ut*gt,St=Vt*gt,a.x=Ci,a.y=mi,a.z=St,hi=7}let Rt=a.x*a.x+a.y*a.y+a.z*a.z;(_i<0||Rt<_i)&&(ye=hi<<1,_i=Rt,ce=a.x,be=a.y,xe=a.z)}_i>0?(a.x=ce,a.y=be,a.z=xe,p=ye):(a.zero(),p=15);break}if(a.x*a.x+a.y*a.y+a.z*a.z<1e-8){if(!l)return this.distance=0,0;switch(this.simplexSize){case 1:this.pointToTetrahedron();break;case 2:this.lineToTetrahedron();break;case 3:this.triangleToTetrahedron();break}if(this.simplexSize==4){let k=this.computeDepth(t,i,s,o,_,r,e);return k!=0?(this.distance=0,k):(this.distance=-this.depth,0)}return this.distance=0,1}this.shrinkSimplex(p),h.x=a.x,h.y=a.y,h.z=a.z,h.x=-h.x,h.y=-h.y,h.z=-h.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let x=this.s[this.simplexSize],v=this.w1[this.simplexSize];x.x=v.x,x.y=v.y,x.z=v.z;let f=this.w2[this.simplexSize];if(x.x-=f.x,x.y-=f.y,x.z-=f.z,h.x*h.x+h.y*h.y+h.z*h.z<1e-8)throw new Error("!?");let Z=_[this.simplexSize];if(Z.x*h.x+Z.y*h.y+Z.z*h.z-(a.x*h.x+a.y*h.y+a.z*h.z)<1e-8)return this.interpolateClosestPoints(),this.distance=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z),n!=null&&n._gjkCache!=null&&this.saveCache(n._gjkCache),0;this.simplexSize++,++Y}return 2}convexCastImpl(t,i,s,o,n,l,_){this.c1=t,this.c2=i,this.tf1=s,this.tf2=o;let r=this.s,e=this.closest,a=this.dir,h,b,X;if(h=o._positionX-s._positionX,b=o._positionY-s._positionY,X=o._positionZ-s._positionZ,a.x=h,a.y=b,a.z=X,a.x*a.x+a.y*a.y+a.z*a.z<1e-6&&a.init(1,0,0),this.simplexSize=0,this.c1!=null)this.computeWitnessPoint1(!0);else{let k=this.w1[this.simplexSize];k.x=this.tf1._positionX,k.y=this.tf1._positionY,k.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let c=this.s[this.simplexSize],Y=this.w1[this.simplexSize];c.x=Y.x,c.y=Y.y,c.z=Y.z;let p=this.w2[this.simplexSize];c.x-=p.x,c.y-=p.y,c.z-=p.z,this.simplexSize=1;let x=0,v=0,f=this.rayX,Z=this.rayR;for(f.zero(),Z.x=l.x,Z.y=l.y,Z.z=l.z,Z.x-=n.x,Z.y-=n.y,Z.z-=n.z;x<40;){let k=0;switch(this.simplexSize){case 1:let M=r[0];e.x=M.x,e.y=M.y,e.z=M.z,k=1;break;case 2:let w,P,E,C,S,A,R=r[0];w=R.x,P=R.y,E=R.z;let H=r[1];C=H.x,S=H.y,A=H.z;let y,D,F;y=C-w,D=S-P,F=A-E;let Q=y*w+D*P+F*E;if(Q=-Q/(y*y+D*D+F*F),Q<0)e.x=w,e.y=P,e.z=E,k=1;else if(Q>1)e.x=C,e.y=S,e.z=A,k=2;else{let Ut,ri,Ct;Ut=w+y*Q,ri=P+D*Q,Ct=E+F*Q,e.x=Ut,e.y=ri,e.z=Ct,k=3}break;case 3:let W=r[0],q=r[1],U=r[2],G,J,N,K,O,$,et,st,lt,rt,at,ot,ht,_t,bt,Xt,ft,Zt;G=W.x,J=W.y,N=W.z,K=q.x,O=q.y,$=q.z,et=U.x,st=U.y,lt=U.z,rt=K-G,at=O-J,ot=$-N,ht=et-K,_t=st-O,bt=lt-$,Xt=G-et,ft=J-st,Zt=N-lt;let xt,zt,Yt;xt=at*bt-ot*_t,zt=ot*ht-rt*bt,Yt=rt*_t-at*ht;let pt,ct,nt,tt,Lt,Bt,Mt,jt,ci;pt=at*Yt-ot*zt,ct=ot*xt-rt*Yt,nt=rt*zt-at*xt,tt=_t*Yt-bt*zt,Lt=bt*xt-ht*Yt,Bt=ht*zt-_t*xt,Mt=ft*Yt-Zt*zt,jt=Zt*xt-Xt*Yt,ci=Xt*zt-ft*xt;let Xi=-1,Yi,Li,wi,ei=0;if(Yi=0,Li=0,wi=0,G*pt+J*ct+N*nt<0){let Ut,ri,Ct,Mi,zi,Ei;Ut=W.x,ri=W.y,Ct=W.z,Mi=q.x,zi=q.y,Ei=q.z;let ki,Ti,Wt;ki=Mi-Ut,Ti=zi-ri,Wt=Ei-Ct;let ut=ki*Ut+Ti*ri+Wt*Ct;ut=-ut/(ki*ki+Ti*Ti+Wt*Wt);let Vt;if(ut<0)e.x=Ut,e.y=ri,e.z=Ct,Vt=1;else if(ut>1)e.x=Mi,e.y=zi,e.z=Ei,Vt=2;else{let Ai,Vi,Fi;Ai=Ut+ki*ut,Vi=ri+Ti*ut,Fi=Ct+Wt*ut,e.x=Ai,e.y=Vi,e.z=Fi,Vt=3}ei=Vt,Xi=e.x*e.x+e.y*e.y+e.z*e.z,Yi=e.x,Li=e.y,wi=e.z}if(K*tt+O*Lt+$*Bt<0){let Ut,ri,Ct,Mi,zi,Ei;Ut=q.x,ri=q.y,Ct=q.z,Mi=U.x,zi=U.y,Ei=U.z;let ki,Ti,Wt;ki=Mi-Ut,Ti=zi-ri,Wt=Ei-Ct;let ut=ki*Ut+Ti*ri+Wt*Ct;ut=-ut/(ki*ki+Ti*Ti+Wt*Wt);let Vt;if(ut<0)e.x=Ut,e.y=ri,e.z=Ct,Vt=1;else if(ut>1)e.x=Mi,e.y=zi,e.z=Ei,Vt=2;else{let Vi,Fi,$i;Vi=Ut+ki*ut,Fi=ri+Ti*ut,$i=Ct+Wt*ut,e.x=Vi,e.y=Fi,e.z=$i,Vt=3}let Ai=e.x*e.x+e.y*e.y+e.z*e.z;(Xi<0||Ai<Xi)&&(ei=Vt<<1,Xi=Ai,Yi=e.x,Li=e.y,wi=e.z)}if(et*Mt+st*jt+lt*ci<0){let Ut,ri,Ct,Mi,zi,Ei;Ut=W.x,ri=W.y,Ct=W.z,Mi=U.x,zi=U.y,Ei=U.z;let ki,Ti,Wt;ki=Mi-Ut,Ti=zi-ri,Wt=Ei-Ct;let ut=ki*Ut+Ti*ri+Wt*Ct;ut=-ut/(ki*ki+Ti*Ti+Wt*Wt);let Vt;if(ut<0)e.x=Ut,e.y=ri,e.z=Ct,Vt=1;else if(ut>1)e.x=Mi,e.y=zi,e.z=Ei,Vt=2;else{let Vi,Fi,$i;Vi=Ut+ki*ut,Fi=ri+Ti*ut,$i=Ct+Wt*ut,e.x=Vi,e.y=Fi,e.z=$i,Vt=3}let Ai=e.x*e.x+e.y*e.y+e.z*e.z;(Xi<0||Ai<Xi)&&(ei=Vt&1|(Vt&2)<<1,Xi=Ai,Yi=e.x,Li=e.y,wi=e.z)}if(Xi>0)e.x=Yi,e.y=Li,e.z=wi,k=ei;else{let Ut=xt*xt+zt*zt+Yt*Yt;Ut>0&&(Ut=1/Math.sqrt(Ut)),xt*=Ut,zt*=Ut,Yt*=Ut;let ri=xt*xt+zt*zt+Yt*Yt;ri=(G*xt+J*zt+N*Yt)/ri,Yi=xt*ri,Li=zt*ri,wi=Yt*ri,e.x=Yi,e.y=Li,e.z=wi,k=7}break;case 4:let qt=r[0],At=r[1],ni=r[2],ui=r[3],Oi,Bi,kt,wt,$t,fi,gi,it,Ht,ii,T,Gt,Et,si,oi,Pt,ai,Ri,Zi,yt,dt,vt,di,Ii,bi,se,me;Oi=qt.x,Bi=qt.y,kt=qt.z,wt=At.x,$t=At.y,fi=At.z,gi=ni.x,it=ni.y,Ht=ni.z,ii=ui.x,T=ui.y,Gt=ui.z,Et=wt-Oi,si=$t-Bi,oi=fi-kt,Pt=gi-Oi,ai=it-Bi,Ri=Ht-kt,Zi=ii-Oi,yt=T-Bi,dt=Gt-kt,vt=gi-wt,di=it-$t,Ii=Ht-fi,bi=ii-wt,se=T-$t,me=Gt-fi;let Di,he,ve,_i,ce,be,xe,ye,Ni,Ji,Ui,oe;Di=si*Ri-oi*ai,he=oi*Pt-Et*Ri,ve=Et*ai-si*Pt,_i=ai*dt-Ri*yt,ce=Ri*Zi-Pt*dt,be=Pt*yt-ai*Zi,xe=yt*oi-dt*si,ye=dt*Et-Zi*oi,Ni=Zi*si-yt*Et,Ji=se*Ii-me*di,Ui=me*vt-bi*Ii,oe=bi*di-se*vt;let ne=Et*Ji+si*Ui+oi*oe>0?1:-1,Ki=-1,ie,Hi,Wi,Pi=0;if(ie=0,Hi=0,Wi=0,(Oi*Di+Bi*he+kt*ve)*ne<0){let Ut,ri,Ct,Mi,zi,Ei,ki,Ti,Wt,ut,Vt,Ai,Vi,Fi,$i,ae,re,pe;Ut=qt.x,ri=qt.y,Ct=qt.z,Mi=At.x,zi=At.y,Ei=At.z,ki=ni.x,Ti=ni.y,Wt=ni.z,ut=Mi-Ut,Vt=zi-ri,Ai=Ei-Ct,Vi=ki-Mi,Fi=Ti-zi,$i=Wt-Ei,ae=Ut-ki,re=ri-Ti,pe=Ct-Wt;let ti,qi,vi;ti=Vt*$i-Ai*Fi,qi=Ai*Vi-ut*$i,vi=ut*Fi-Vt*Vi;let Ci,mi,St,Tt,hi,Rt,mt,gt,Ft;Ci=Vt*vi-Ai*qi,mi=Ai*ti-ut*vi,St=ut*qi-Vt*ti,Tt=Fi*vi-$i*qi,hi=$i*ti-Vi*vi,Rt=Vi*qi-Fi*ti,mt=re*vi-pe*qi,gt=pe*ti-ae*vi,Ft=ae*qi-re*ti;let Dt=-1,Nt,Kt,li,yi=0;if(Nt=0,Kt=0,li=0,Ut*Ci+ri*mi+Ct*St<0){let Ot,It,Jt,xi,ji,ee;Ot=qt.x,It=qt.y,Jt=qt.z,xi=At.x,ji=At.y,ee=At.z;let _e,Qi,te;_e=xi-Ot,Qi=ji-It,te=ee-Jt;let Gi=_e*Ot+Qi*It+te*Jt;Gi=-Gi/(_e*_e+Qi*Qi+te*te);let Si;if(Gi<0)e.x=Ot,e.y=It,e.z=Jt,Si=1;else if(Gi>1)e.x=xi,e.y=ji,e.z=ee,Si=2;else{let le,fe,Xe;le=Ot+_e*Gi,fe=It+Qi*Gi,Xe=Jt+te*Gi,e.x=le,e.y=fe,e.z=Xe,Si=3}yi=Si,Dt=e.x*e.x+e.y*e.y+e.z*e.z,Nt=e.x,Kt=e.y,li=e.z}if(Mi*Tt+zi*hi+Ei*Rt<0){let Ot,It,Jt,xi,ji,ee;Ot=At.x,It=At.y,Jt=At.z,xi=ni.x,ji=ni.y,ee=ni.z;let _e,Qi,te;_e=xi-Ot,Qi=ji-It,te=ee-Jt;let Gi=_e*Ot+Qi*It+te*Jt;Gi=-Gi/(_e*_e+Qi*Qi+te*te);let Si;if(Gi<0)e.x=Ot,e.y=It,e.z=Jt,Si=1;else if(Gi>1)e.x=xi,e.y=ji,e.z=ee,Si=2;else{let fe,Xe,ge;fe=Ot+_e*Gi,Xe=It+Qi*Gi,ge=Jt+te*Gi,e.x=fe,e.y=Xe,e.z=ge,Si=3}let le=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||le<Dt)&&(yi=Si<<1,Dt=le,Nt=e.x,Kt=e.y,li=e.z)}if(ki*mt+Ti*gt+Wt*Ft<0){let Ot,It,Jt,xi,ji,ee;Ot=qt.x,It=qt.y,Jt=qt.z,xi=ni.x,ji=ni.y,ee=ni.z;let _e,Qi,te;_e=xi-Ot,Qi=ji-It,te=ee-Jt;let Gi=_e*Ot+Qi*It+te*Jt;Gi=-Gi/(_e*_e+Qi*Qi+te*te);let Si;if(Gi<0)e.x=Ot,e.y=It,e.z=Jt,Si=1;else if(Gi>1)e.x=xi,e.y=ji,e.z=ee,Si=2;else{let fe,Xe,ge;fe=Ot+_e*Gi,Xe=It+Qi*Gi,ge=Jt+te*Gi,e.x=fe,e.y=Xe,e.z=ge,Si=3}let le=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||le<Dt)&&(yi=Si&1|(Si&2)<<1,Dt=le,Nt=e.x,Kt=e.y,li=e.z)}let pi;if(Dt>0)e.x=Nt,e.y=Kt,e.z=li,pi=yi;else{let Ot=ti*ti+qi*qi+vi*vi;Ot>0&&(Ot=1/Math.sqrt(Ot)),ti*=Ot,qi*=Ot,vi*=Ot;let It=ti*ti+qi*qi+vi*vi;It=(Ut*ti+ri*qi+Ct*vi)/It,Nt=ti*It,Kt=qi*It,li=vi*It,e.x=Nt,e.y=Kt,e.z=li,pi=7}Pi=pi,Ki=e.x*e.x+e.y*e.y+e.z*e.z,ie=e.x,Hi=e.y,Wi=e.z}if((Oi*_i+Bi*ce+kt*be)*ne<0){let Ut,ri,Ct,Mi,zi,Ei,ki,Ti,Wt,ut,Vt,Ai,Vi,Fi,$i,ae,re,pe;Ut=qt.x,ri=qt.y,Ct=qt.z,Mi=ni.x,zi=ni.y,Ei=ni.z,ki=ui.x,Ti=ui.y,Wt=ui.z,ut=Mi-Ut,Vt=zi-ri,Ai=Ei-Ct,Vi=ki-Mi,Fi=Ti-zi,$i=Wt-Ei,ae=Ut-ki,re=ri-Ti,pe=Ct-Wt;let ti,qi,vi;ti=Vt*$i-Ai*Fi,qi=Ai*Vi-ut*$i,vi=ut*Fi-Vt*Vi;let Ci,mi,St,Tt,hi,Rt,mt,gt,Ft;Ci=Vt*vi-Ai*qi,mi=Ai*ti-ut*vi,St=ut*qi-Vt*ti,Tt=Fi*vi-$i*qi,hi=$i*ti-Vi*vi,Rt=Vi*qi-Fi*ti,mt=re*vi-pe*qi,gt=pe*ti-ae*vi,Ft=ae*qi-re*ti;let Dt=-1,Nt,Kt,li,yi=0;if(Nt=0,Kt=0,li=0,Ut*Ci+ri*mi+Ct*St<0){let It,Jt,xi,ji,ee,_e;It=qt.x,Jt=qt.y,xi=qt.z,ji=ni.x,ee=ni.y,_e=ni.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let fe,Xe,ge;fe=It+Qi*Si,Xe=Jt+te*Si,ge=xi+Gi*Si,e.x=fe,e.y=Xe,e.z=ge,le=3}yi=le,Dt=e.x*e.x+e.y*e.y+e.z*e.z,Nt=e.x,Kt=e.y,li=e.z}if(Mi*Tt+zi*hi+Ei*Rt<0){let It,Jt,xi,ji,ee,_e;It=ni.x,Jt=ni.y,xi=ni.z,ji=ui.x,ee=ui.y,_e=ui.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let Xe,ge,de;Xe=It+Qi*Si,ge=Jt+te*Si,de=xi+Gi*Si,e.x=Xe,e.y=ge,e.z=de,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||fe<Dt)&&(yi=le<<1,Dt=fe,Nt=e.x,Kt=e.y,li=e.z)}if(ki*mt+Ti*gt+Wt*Ft<0){let It,Jt,xi,ji,ee,_e;It=qt.x,Jt=qt.y,xi=qt.z,ji=ui.x,ee=ui.y,_e=ui.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let Xe,ge,de;Xe=It+Qi*Si,ge=Jt+te*Si,de=xi+Gi*Si,e.x=Xe,e.y=ge,e.z=de,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||fe<Dt)&&(yi=le&1|(le&2)<<1,Dt=fe,Nt=e.x,Kt=e.y,li=e.z)}let pi;if(Dt>0)e.x=Nt,e.y=Kt,e.z=li,pi=yi;else{let It=ti*ti+qi*qi+vi*vi;It>0&&(It=1/Math.sqrt(It)),ti*=It,qi*=It,vi*=It;let Jt=ti*ti+qi*qi+vi*vi;Jt=(Ut*ti+ri*qi+Ct*vi)/Jt,Nt=ti*Jt,Kt=qi*Jt,li=vi*Jt,e.x=Nt,e.y=Kt,e.z=li,pi=7}let Ot=e.x*e.x+e.y*e.y+e.z*e.z;(Ki<0||Ot<Ki)&&(Pi=pi&1|(pi&6)<<1,Ki=Ot,ie=e.x,Hi=e.y,Wi=e.z)}if((Oi*xe+Bi*ye+kt*Ni)*ne<0){let Ut,ri,Ct,Mi,zi,Ei,ki,Ti,Wt,ut,Vt,Ai,Vi,Fi,$i,ae,re,pe;Ut=qt.x,ri=qt.y,Ct=qt.z,Mi=At.x,zi=At.y,Ei=At.z,ki=ui.x,Ti=ui.y,Wt=ui.z,ut=Mi-Ut,Vt=zi-ri,Ai=Ei-Ct,Vi=ki-Mi,Fi=Ti-zi,$i=Wt-Ei,ae=Ut-ki,re=ri-Ti,pe=Ct-Wt;let ti,qi,vi;ti=Vt*$i-Ai*Fi,qi=Ai*Vi-ut*$i,vi=ut*Fi-Vt*Vi;let Ci,mi,St,Tt,hi,Rt,mt,gt,Ft;Ci=Vt*vi-Ai*qi,mi=Ai*ti-ut*vi,St=ut*qi-Vt*ti,Tt=Fi*vi-$i*qi,hi=$i*ti-Vi*vi,Rt=Vi*qi-Fi*ti,mt=re*vi-pe*qi,gt=pe*ti-ae*vi,Ft=ae*qi-re*ti;let Dt=-1,Nt,Kt,li,yi=0;if(Nt=0,Kt=0,li=0,Ut*Ci+ri*mi+Ct*St<0){let It,Jt,xi,ji,ee,_e;It=qt.x,Jt=qt.y,xi=qt.z,ji=At.x,ee=At.y,_e=At.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let fe,Xe,ge;fe=It+Qi*Si,Xe=Jt+te*Si,ge=xi+Gi*Si,e.x=fe,e.y=Xe,e.z=ge,le=3}yi=le,Dt=e.x*e.x+e.y*e.y+e.z*e.z,Nt=e.x,Kt=e.y,li=e.z}if(Mi*Tt+zi*hi+Ei*Rt<0){let It,Jt,xi,ji,ee,_e;It=At.x,Jt=At.y,xi=At.z,ji=ui.x,ee=ui.y,_e=ui.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let Xe,ge,de;Xe=It+Qi*Si,ge=Jt+te*Si,de=xi+Gi*Si,e.x=Xe,e.y=ge,e.z=de,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||fe<Dt)&&(yi=le<<1,Dt=fe,Nt=e.x,Kt=e.y,li=e.z)}if(ki*mt+Ti*gt+Wt*Ft<0){let It,Jt,xi,ji,ee,_e;It=qt.x,Jt=qt.y,xi=qt.z,ji=ui.x,ee=ui.y,_e=ui.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let Xe,ge,de;Xe=It+Qi*Si,ge=Jt+te*Si,de=xi+Gi*Si,e.x=Xe,e.y=ge,e.z=de,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||fe<Dt)&&(yi=le&1|(le&2)<<1,Dt=fe,Nt=e.x,Kt=e.y,li=e.z)}let pi;if(Dt>0)e.x=Nt,e.y=Kt,e.z=li,pi=yi;else{let It=ti*ti+qi*qi+vi*vi;It>0&&(It=1/Math.sqrt(It)),ti*=It,qi*=It,vi*=It;let Jt=ti*ti+qi*qi+vi*vi;Jt=(Ut*ti+ri*qi+Ct*vi)/Jt,Nt=ti*Jt,Kt=qi*Jt,li=vi*Jt,e.x=Nt,e.y=Kt,e.z=li,pi=7}let Ot=e.x*e.x+e.y*e.y+e.z*e.z;(Ki<0||Ot<Ki)&&(Pi=pi&3|(pi&4)<<1,Ki=Ot,ie=e.x,Hi=e.y,Wi=e.z)}if((wt*Ji+$t*Ui+fi*oe)*ne<0){let Ut,ri,Ct,Mi,zi,Ei,ki,Ti,Wt,ut,Vt,Ai,Vi,Fi,$i,ae,re,pe;Ut=At.x,ri=At.y,Ct=At.z,Mi=ni.x,zi=ni.y,Ei=ni.z,ki=ui.x,Ti=ui.y,Wt=ui.z,ut=Mi-Ut,Vt=zi-ri,Ai=Ei-Ct,Vi=ki-Mi,Fi=Ti-zi,$i=Wt-Ei,ae=Ut-ki,re=ri-Ti,pe=Ct-Wt;let ti,qi,vi;ti=Vt*$i-Ai*Fi,qi=Ai*Vi-ut*$i,vi=ut*Fi-Vt*Vi;let Ci,mi,St,Tt,hi,Rt,mt,gt,Ft;Ci=Vt*vi-Ai*qi,mi=Ai*ti-ut*vi,St=ut*qi-Vt*ti,Tt=Fi*vi-$i*qi,hi=$i*ti-Vi*vi,Rt=Vi*qi-Fi*ti,mt=re*vi-pe*qi,gt=pe*ti-ae*vi,Ft=ae*qi-re*ti;let Dt=-1,Nt,Kt,li,yi=0;if(Nt=0,Kt=0,li=0,Ut*Ci+ri*mi+Ct*St<0){let It,Jt,xi,ji,ee,_e;It=At.x,Jt=At.y,xi=At.z,ji=ni.x,ee=ni.y,_e=ni.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let fe,Xe,ge;fe=It+Qi*Si,Xe=Jt+te*Si,ge=xi+Gi*Si,e.x=fe,e.y=Xe,e.z=ge,le=3}yi=le,Dt=e.x*e.x+e.y*e.y+e.z*e.z,Nt=e.x,Kt=e.y,li=e.z}if(Mi*Tt+zi*hi+Ei*Rt<0){let It,Jt,xi,ji,ee,_e;It=ni.x,Jt=ni.y,xi=ni.z,ji=ui.x,ee=ui.y,_e=ui.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let Xe,ge,de;Xe=It+Qi*Si,ge=Jt+te*Si,de=xi+Gi*Si,e.x=Xe,e.y=ge,e.z=de,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||fe<Dt)&&(yi=le<<1,Dt=fe,Nt=e.x,Kt=e.y,li=e.z)}if(ki*mt+Ti*gt+Wt*Ft<0){let It,Jt,xi,ji,ee,_e;It=At.x,Jt=At.y,xi=At.z,ji=ui.x,ee=ui.y,_e=ui.z;let Qi,te,Gi;Qi=ji-It,te=ee-Jt,Gi=_e-xi;let Si=Qi*It+te*Jt+Gi*xi;Si=-Si/(Qi*Qi+te*te+Gi*Gi);let le;if(Si<0)e.x=It,e.y=Jt,e.z=xi,le=1;else if(Si>1)e.x=ji,e.y=ee,e.z=_e,le=2;else{let Xe,ge,de;Xe=It+Qi*Si,ge=Jt+te*Si,de=xi+Gi*Si,e.x=Xe,e.y=ge,e.z=de,le=3}let fe=e.x*e.x+e.y*e.y+e.z*e.z;(Dt<0||fe<Dt)&&(yi=le&1|(le&2)<<1,Dt=fe,Nt=e.x,Kt=e.y,li=e.z)}let pi;if(Dt>0)e.x=Nt,e.y=Kt,e.z=li,pi=yi;else{let It=ti*ti+qi*qi+vi*vi;It>0&&(It=1/Math.sqrt(It)),ti*=It,qi*=It,vi*=It;let Jt=ti*ti+qi*qi+vi*vi;Jt=(Ut*ti+ri*qi+Ct*vi)/Jt,Nt=ti*Jt,Kt=qi*Jt,li=vi*Jt,e.x=Nt,e.y=Kt,e.z=li,pi=7}let Ot=e.x*e.x+e.y*e.y+e.z*e.z;(Ki<0||Ot<Ki)&&(Pi=pi<<1,Ki=Ot,ie=e.x,Hi=e.y,Wi=e.z)}Ki>0?(e.x=ie,e.y=Hi,e.z=Wi,k=Pi):(e.zero(),k=15);break}if(this.shrinkSimplex(k),e.x*e.x+e.y*e.y+e.z*e.z<1e-8){if(v==0||this.simplexSize==4)return _.fraction=v,!1;this.interpolateClosestPoints(),_.fraction=v;let M=_.normal;M.x=a.x,M.y=a.y,M.z=a.z;let w=Math.sqrt(M.x*M.x+M.y*M.y+M.z*M.z);w>0&&(w=1/w),M.x*=w,M.y*=w,M.z*=w;let P=_.position,E=this.closestPoint1;return P.x=E.x,P.y=E.y,P.z=E.z,P.x+=n.x*v,P.y+=n.y*v,P.z+=n.z*v,!0}if(a.x=e.x,a.y=e.y,a.z=e.z,a.x=-a.x,a.y=-a.y,a.z=-a.z,this.c1!=null)this.computeWitnessPoint1(!0);else{let M=this.w1[this.simplexSize];M.x=this.tf1._positionX,M.y=this.tf1._positionY,M.z=this.tf1._positionZ}this.computeWitnessPoint2(!0);let g=this.s[this.simplexSize],I=this.w1[this.simplexSize];g.x=I.x,g.y=I.y,g.z=I.z;let z=this.w2[this.simplexSize];g.x-=z.x,g.y-=z.y,g.z-=z.z;let d=r[this.simplexSize];if(d.x-=f.x,d.y-=f.y,d.z-=f.z,a.x*a.x+a.y*a.y+a.z*a.z<1e-8)throw new Error("!?");let u=r[this.simplexSize],B=u.x*a.x+u.y*a.y+u.z*a.z;if(B<0){if(Z.x*a.x+Z.y*a.y+Z.z*a.z>=0)return!1;let M=B/(Z.x*a.x+Z.y*a.y+Z.z*a.z);if(v+=M,v>=1)return!1;f.x+=Z.x*M,f.y+=Z.y*M,f.z+=Z.z*M;let w=0,P=this.simplexSize+1;for(;w<P;){let E=r[w++],C=-M;E.x+=Z.x*C,E.y+=Z.y*C,E.z+=Z.z*C}}let j=!1,L=0,V=this.simplexSize;for(;L<V;){let M=L++,w=r[M].x-r[this.simplexSize].x,P=r[M].y-r[this.simplexSize].y,E=r[M].z-r[this.simplexSize].z;if(w*w+P*P+E*E<1e-8){j=!0;break}}j||this.simplexSize++,++x}return!1}interpolateClosestPoints(){switch(this.simplexSize){case 1:let t=this.closestPoint1,i=this.w1[0];t.x=i.x,t.y=i.y,t.z=i.z;let s=this.closestPoint2,o=this.w2[0];s.x=o.x,s.y=o.y,s.z=o.z;break;case 2:let n,l,_,r=this.closest;n=r.x,l=r.y,_=r.z;let e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B=this.s[0];e=B.x,a=B.y,h=B.z;let j=this.w1[0];b=j.x,X=j.y,c=j.z;let L=this.w2[0];Y=L.x,p=L.y,x=L.z;let V=this.s[1];v=V.x,f=V.y,Z=V.z;let M=this.w1[1];k=M.x,g=M.y,I=M.z;let w=this.w2[1];z=w.x,d=w.y,u=w.z;let P,E,C;P=v-e,E=f-a,C=Z-h;let S=P*P+E*E+C*C;S!=0&&(S=1/S);let A,R,H;A=n-e,R=l-a,H=_-h;let y=(A*P+R*E+H*C)*S,D,F,Q,W,q,U,G,J,N;D=k-b,F=g-X,Q=I-c,W=b+D*y,q=X+F*y,U=c+Q*y,D=z-Y,F=d-p,Q=u-x,G=Y+D*y,J=p+F*y,N=x+Q*y;let K=this.closestPoint1;K.x=W,K.y=q,K.z=U;let O=this.closestPoint2;O.x=G,O.y=J,O.z=N;break;case 3:let $,et,st,lt=this.closest;$=lt.x,et=lt.y,st=lt.z;let rt,at,ot,ht,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt,ct,nt,tt,Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi,ei,qt,At=this.s[0];rt=At.x,at=At.y,ot=At.z;let ni=this.w1[0];ht=ni.x,_t=ni.y,bt=ni.z;let ui=this.w2[0];Xt=ui.x,ft=ui.y,Zt=ui.z;let Oi=this.s[1];xt=Oi.x,zt=Oi.y,Yt=Oi.z;let Bi=this.w1[1];pt=Bi.x,ct=Bi.y,nt=Bi.z;let kt=this.w2[1];tt=kt.x,Lt=kt.y,Bt=kt.z;let wt=this.s[2];Mt=wt.x,jt=wt.y,ci=wt.z;let $t=this.w1[2];Xi=$t.x,Yi=$t.y,Li=$t.z;let fi=this.w2[2];wi=fi.x,ei=fi.y,qt=fi.z;let gi,it,Ht,ii,T,Gt,Et,si,oi;gi=xt-rt,it=zt-at,Ht=Yt-ot,ii=Mt-rt,T=jt-at,Gt=ci-ot,Et=$-rt,si=et-at,oi=st-ot;let Pt=gi*gi+it*it+Ht*Ht,ai=gi*ii+it*T+Ht*Gt,Ri=ii*ii+T*T+Gt*Gt,Zi=gi*Et+it*si+Ht*oi,yt=ii*Et+T*si+Gt*oi,dt=Pt*Ri-ai*ai;dt!=0&&(dt=1/dt);let vt=(Zi*Ri-yt*ai)*dt,di=(-Zi*ai+yt*Pt)*dt,Ii,bi,se,me,Di,he,ve,_i,ce;Ii=pt-ht,bi=ct-_t,se=nt-bt,me=ht+Ii*vt,Di=_t+bi*vt,he=bt+se*vt,Ii=Xi-ht,bi=Yi-_t,se=Li-bt,me+=Ii*di,Di+=bi*di,he+=se*di,Ii=tt-Xt,bi=Lt-ft,se=Bt-Zt,ve=Xt+Ii*vt,_i=ft+bi*vt,ce=Zt+se*vt,Ii=wi-Xt,bi=ei-ft,se=qt-Zt,ve+=Ii*di,_i+=bi*di,ce+=se*di;let be=this.closestPoint1;be.x=me,be.y=Di,be.z=he;let xe=this.closestPoint2;xe.x=ve,xe.y=_i,xe.z=ce;break;default:throw new Error("!?")}}loadCache(t){let i=this.dir,s=t.prevClosestDir;i.x=s.x,i.y=s.y,i.z=s.z}saveCache(t){let i=t.prevClosestDir,s=this.closest;i.x=s.x,i.y=s.y,i.z=s.z,i.x=-i.x,i.y=-i.y,i.z=-i.z}shrinkSimplex(t){switch(this.simplexSize=t,this.simplexSize=(this.simplexSize&5)+(this.simplexSize>>1&5),this.simplexSize=(this.simplexSize&3)+(this.simplexSize>>2&3),t){case 2:let i=this.s[0],s=this.s[1];i.x=s.x,i.y=s.y,i.z=s.z;let o=this.w1[0],n=this.w1[1];o.x=n.x,o.y=n.y,o.z=n.z;let l=this.w2[0],_=this.w2[1];l.x=_.x,l.y=_.y,l.z=_.z;break;case 4:let r=this.s[0],e=this.s[2];r.x=e.x,r.y=e.y,r.z=e.z;let a=this.w1[0],h=this.w1[2];a.x=h.x,a.y=h.y,a.z=h.z;let b=this.w2[0],X=this.w2[2];b.x=X.x,b.y=X.y,b.z=X.z;break;case 5:let c=this.s[1],Y=this.s[2];c.x=Y.x,c.y=Y.y,c.z=Y.z;let p=this.w1[1],x=this.w1[2];p.x=x.x,p.y=x.y,p.z=x.z;let v=this.w2[1],f=this.w2[2];v.x=f.x,v.y=f.y,v.z=f.z;break;case 6:let Z=this.s[0],k=this.s[2];Z.x=k.x,Z.y=k.y,Z.z=k.z;let g=this.w1[0],I=this.w1[2];g.x=I.x,g.y=I.y,g.z=I.z;let z=this.w2[0],d=this.w2[2];z.x=d.x,z.y=d.y,z.z=d.z;break;case 8:let u=this.s[0],B=this.s[3];u.x=B.x,u.y=B.y,u.z=B.z;let j=this.w1[0],L=this.w1[3];j.x=L.x,j.y=L.y,j.z=L.z;let V=this.w2[0],M=this.w2[3];V.x=M.x,V.y=M.y,V.z=M.z;break;case 9:let w=this.s[1],P=this.s[3];w.x=P.x,w.y=P.y,w.z=P.z;let E=this.w1[1],C=this.w1[3];E.x=C.x,E.y=C.y,E.z=C.z;let S=this.w2[1],A=this.w2[3];S.x=A.x,S.y=A.y,S.z=A.z;break;case 10:let R=this.s[0],H=this.s[3];R.x=H.x,R.y=H.y,R.z=H.z;let y=this.w1[0],D=this.w1[3];y.x=D.x,y.y=D.y,y.z=D.z;let F=this.w2[0],Q=this.w2[3];F.x=Q.x,F.y=Q.y,F.z=Q.z;break;case 11:let W=this.s[2],q=this.s[3];W.x=q.x,W.y=q.y,W.z=q.z;let U=this.w1[2],G=this.w1[3];U.x=G.x,U.y=G.y,U.z=G.z;let J=this.w2[2],N=this.w2[3];J.x=N.x,J.y=N.y,J.z=N.z;break;case 12:let K=this.s[0],O=this.s[2];K.x=O.x,K.y=O.y,K.z=O.z;let $=this.w1[0],et=this.w1[2];$.x=et.x,$.y=et.y,$.z=et.z;let st=this.w2[0],lt=this.w2[2];st.x=lt.x,st.y=lt.y,st.z=lt.z;let rt=this.s[1],at=this.s[3];rt.x=at.x,rt.y=at.y,rt.z=at.z;let ot=this.w1[1],ht=this.w1[3];ot.x=ht.x,ot.y=ht.y,ot.z=ht.z;let _t=this.w2[1],bt=this.w2[3];_t.x=bt.x,_t.y=bt.y,_t.z=bt.z;break;case 13:let Xt=this.s[1],ft=this.s[3];Xt.x=ft.x,Xt.y=ft.y,Xt.z=ft.z;let Zt=this.w1[1],xt=this.w1[3];Zt.x=xt.x,Zt.y=xt.y,Zt.z=xt.z;let zt=this.w2[1],Yt=this.w2[3];zt.x=Yt.x,zt.y=Yt.y,zt.z=Yt.z;break;case 14:let pt=this.s[0],ct=this.s[3];pt.x=ct.x,pt.y=ct.y,pt.z=ct.z;let nt=this.w1[0],tt=this.w1[3];nt.x=tt.x,nt.y=tt.y,nt.z=tt.z;let Lt=this.w2[0],Bt=this.w2[3];Lt.x=Bt.x,Lt.y=Bt.y,Lt.z=Bt.z;break}}computeWitnessPoint1(t){let i,s,o,n,l,_,r=this.dir;n=r.x,l=r.y,_=r.z;let e,a,h,b,X,c;b=this.tf1._rotation00*n+this.tf1._rotation10*l+this.tf1._rotation20*_,X=this.tf1._rotation01*n+this.tf1._rotation11*l+this.tf1._rotation21*_,c=this.tf1._rotation02*n+this.tf1._rotation12*l+this.tf1._rotation22*_,e=b,a=X,h=c;let Y,p,x,v=this.dir;if(v.x=e,v.y=a,v.z=h,this.c1.computeLocalSupportingVertex(this.dir,this.w1[this.simplexSize]),t){let d=this.dir,u=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);u>0&&(u=1/u),d.x*=u,d.y*=u,d.z*=u;let B=this.w1[this.simplexSize],j=this.dir,L=this.c1._gjkMargin;B.x+=j.x*L,B.y+=j.y*L,B.z+=j.z*L}let f=this.w1[this.simplexSize];i=f.x,s=f.y,o=f.z;let Z,k,g;Z=this.tf1._rotation00*i+this.tf1._rotation01*s+this.tf1._rotation02*o,k=this.tf1._rotation10*i+this.tf1._rotation11*s+this.tf1._rotation12*o,g=this.tf1._rotation20*i+this.tf1._rotation21*s+this.tf1._rotation22*o,Y=Z,p=k,x=g,Y+=this.tf1._positionX,p+=this.tf1._positionY,x+=this.tf1._positionZ;let I=this.w1[this.simplexSize];I.x=Y,I.y=p,I.z=x;let z=this.dir;z.x=n,z.y=l,z.z=_}computeWitnessPoint2(t){let i,s,o,n,l,_,r=this.dir;n=r.x,l=r.y,_=r.z;let e,a,h,b,X,c;b=this.tf2._rotation00*n+this.tf2._rotation10*l+this.tf2._rotation20*_,X=this.tf2._rotation01*n+this.tf2._rotation11*l+this.tf2._rotation21*_,c=this.tf2._rotation02*n+this.tf2._rotation12*l+this.tf2._rotation22*_,e=b,a=X,h=c,e=-e,a=-a,h=-h;let Y,p,x,v=this.dir;if(v.x=e,v.y=a,v.z=h,this.c2.computeLocalSupportingVertex(this.dir,this.w2[this.simplexSize]),t){let d=this.dir,u=Math.sqrt(d.x*d.x+d.y*d.y+d.z*d.z);u>0&&(u=1/u),d.x*=u,d.y*=u,d.z*=u;let B=this.w2[this.simplexSize],j=this.dir,L=this.c2._gjkMargin;B.x+=j.x*L,B.y+=j.y*L,B.z+=j.z*L}let f=this.w2[this.simplexSize];i=f.x,s=f.y,o=f.z;let Z,k,g;Z=this.tf2._rotation00*i+this.tf2._rotation01*s+this.tf2._rotation02*o,k=this.tf2._rotation10*i+this.tf2._rotation11*s+this.tf2._rotation12*o,g=this.tf2._rotation20*i+this.tf2._rotation21*s+this.tf2._rotation22*o,Y=Z,p=k,x=g,Y+=this.tf2._positionX,p+=this.tf2._positionY,x+=this.tf2._positionZ;let I=this.w2[this.simplexSize];I.x=Y,I.y=p,I.z=x;let z=this.dir;z.x=n,z.y=l,z.z=_}pointToTetrahedron(){let t=0;for(;t<3;){let i=this.dir,s=this.baseDirs[t++];i.x=s.x,i.y=s.y,i.z=s.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let o=this.s[this.simplexSize],n=this.w1[this.simplexSize];o.x=n.x,o.y=n.y,o.z=n.z;let l=this.w2[this.simplexSize];if(o.x-=l.x,o.y-=l.y,o.z-=l.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let _=this.dir;_.x=-_.x,_.y=-_.y,_.z=-_.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let r=this.s[this.simplexSize],e=this.w1[this.simplexSize];r.x=e.x,r.y=e.y,r.z=e.z;let a=this.w2[this.simplexSize];if(r.x-=a.x,r.y-=a.y,r.z-=a.z,this.simplexSize++,this.lineToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}}lineToTetrahedron(){let t,i,s,o=this.dir;t=o.x,i=o.y,s=o.z;let n,l,_,r,e,a,h,b,X,c=this.s[0];n=c.x,l=c.y,_=c.z;let Y=this.s[1];r=Y.x,e=Y.y,a=Y.z,h=n-r,b=l-e,X=_-a;let p=0;for(;p<3;){let v,f,Z,k=this.baseDirs[p++];v=k.x,f=k.y,Z=k.z;let g,I,z;g=b*Z-X*f,I=X*v-h*Z,z=h*f-b*v;let d=this.dir;d.x=g,d.y=I,d.z=z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let u=this.s[this.simplexSize],B=this.w1[this.simplexSize];u.x=B.x,u.y=B.y,u.z=B.z;let j=this.w2[this.simplexSize];if(u.x-=j.x,u.y-=j.y,u.z-=j.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--;let L=this.dir;L.x=-L.x,L.y=-L.y,L.z=-L.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let V=this.s[this.simplexSize],M=this.w1[this.simplexSize];V.x=M.x,V.y=M.y,V.z=M.z;let w=this.w2[this.simplexSize];if(V.x-=w.x,V.y-=w.y,V.z-=w.z,this.simplexSize++,this.triangleToTetrahedron(),this.simplexSize==4)break;this.simplexSize--}let x=this.dir;x.x=t,x.y=i,x.z=s}triangleToTetrahedron(){let t,i,s,o=this.dir;for(t=o.x,i=o.y,s=o.z;;){let l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k=this.s[0];l=k.x,_=k.y,r=k.z;let g=this.s[1];e=g.x,a=g.y,h=g.z;let I=this.s[2];b=I.x,X=I.y,c=I.z,Y=e-l,p=a-_,x=h-r,v=b-l,f=X-_,Z=c-r;let z,d,u;z=p*Z-x*f,d=x*v-Y*Z,u=Y*f-p*v;let B=this.dir;B.x=z,B.y=d,B.z=u,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let j=this.s[this.simplexSize],L=this.w1[this.simplexSize];j.x=L.x,j.y=L.y,j.z=L.z;let V=this.w2[this.simplexSize];if(j.x-=V.x,j.y-=V.y,j.z-=V.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;let M=this.dir;M.x=-M.x,M.y=-M.y,M.z=-M.z,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let w=this.s[this.simplexSize],P=this.w1[this.simplexSize];w.x=P.x,w.y=P.y,w.z=P.z;let E=this.w2[this.simplexSize];if(w.x-=E.x,w.y-=E.y,w.z-=E.z,this.simplexSize++,this.isValidTetrahedron())break;this.simplexSize--;break}let n=this.dir;n.x=t,n.y=i,n.z=s}isValidTetrahedron(){let t=this.s[2].x-this.s[0].x,i=this.s[2].y-this.s[0].y,s=this.s[2].z-this.s[0].z,o=this.s[3].x-this.s[0].x,n=this.s[3].y-this.s[0].y,l=this.s[3].z-this.s[0].z,_=(this.s[1].x-this.s[0].x)*(i*l-s*n)-(this.s[1].y-this.s[0].y)*(t*l-s*o)+(this.s[1].z-this.s[0].z)*(t*n-i*o);return _>1e-12?!0:_<-1e-12}computeDepth(t,i,s,o,n,l,_){let r=this.polyhedron;for(;r._numTriangles>0;){let d=r._triangleList;r._numTriangles--;let u=d._prev,B=d._next;u!=null&&(u._next=B),B!=null&&(B._prev=u),d==r._triangleList&&(r._triangleList=r._triangleList._next),d==r._triangleListLast&&(r._triangleListLast=r._triangleListLast._prev),d._next=null,d._prev=null,d.removeReferences(),d._next=r._trianglePool,r._trianglePool=d}for(;r._numVertices>0;){let d=r._vertices[--r._numVertices];d.removeReferences(),d._next=r._vertexPool,r._vertexPool=d}let e=this.polyhedron,a=this.polyhedron,h=a._vertexPool;h!=null?(a._vertexPool=h._next,h._next=null):h=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let b=h.init(n[0],l[0],_[0]),X=this.polyhedron,c=X._vertexPool;c!=null?(X._vertexPool=c._next,c._next=null):c=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let Y=c.init(n[1],l[1],_[1]),p=this.polyhedron,x=p._vertexPool;x!=null?(p._vertexPool=x._next,x._next=null):x=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let v=x.init(n[2],l[2],_[2]),f=this.polyhedron,Z=f._vertexPool;if(Z!=null?(f._vertexPool=Z._next,Z._next=null):Z=new m.collision.narrowphase.detector.gjkepa.EpaVertex,!e._init(b,Y,v,Z.init(n[3],l[3],_[3])))return m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT;this.simplexSize=0;let k=this.s[0],g=this.w1[0],I=this.w2[0],z=0;for(;z<40;){let d=this.polyhedron._triangleList,u=1/0,B=null;for(;d!=null;)d._distanceSq<u&&(u=d._distanceSq,B=d),d=d._next;let j=B,L=this.dir,V=j._normal;L.x=V.x,L.y=V.y,L.z=V.z;let M=Math.sqrt(L.x*L.x+L.y*L.y+L.z*L.z);M>0&&(M=1/M),L.x*=M,L.y*=M,L.z*=M,this.computeWitnessPoint1(!1),this.computeWitnessPoint2(!1);let w=this.s[this.simplexSize],P=this.w1[this.simplexSize];w.x=P.x,w.y=P.y,w.z=P.z;let E=this.w2[this.simplexSize];w.x-=E.x,w.y-=E.y,w.z-=E.z;let C=j._vertices[0],S=j._vertices[1],A=j._vertices[2],R=C.v,H=this.dir,y=this.dir;if(k.x*y.x+k.y*y.y+k.z*y.z-(R.x*H.x+R.y*H.y+R.z*H.z)<1e-6||z==39){let W=this.closest,q=this.dir;W.x=q.x,W.y=q.y,W.z=q.z;let U=this.dir,G=C.v,J=this.dir,N=(U.x*G.x+U.y*G.y+U.z*G.z)/(J.x*J.x+J.y*J.y+J.z*J.z);W.x*=N,W.y*=N,W.z*=N;let K,O,$,et=this.closest;K=et.x,O=et.y,$=et.z;let st,lt,rt,at,ot,ht,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt,ct,nt,tt,Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi,ei=C.v;st=ei.x,lt=ei.y,rt=ei.z;let qt=C.w1;at=qt.x,ot=qt.y,ht=qt.z;let At=C.w2;_t=At.x,bt=At.y,Xt=At.z;let ni=S.v;ft=ni.x,Zt=ni.y,xt=ni.z;let ui=S.w1;zt=ui.x,Yt=ui.y,pt=ui.z;let Oi=S.w2;ct=Oi.x,nt=Oi.y,tt=Oi.z;let Bi=A.v;Lt=Bi.x,Bt=Bi.y,Mt=Bi.z;let kt=A.w1;jt=kt.x,ci=kt.y,Xi=kt.z;let wt=A.w2;Yi=wt.x,Li=wt.y,wi=wt.z;let $t,fi,gi,it,Ht,ii,T,Gt,Et;$t=ft-st,fi=Zt-lt,gi=xt-rt,it=Lt-st,Ht=Bt-lt,ii=Mt-rt,T=K-st,Gt=O-lt,Et=$-rt;let si=$t*$t+fi*fi+gi*gi,oi=$t*it+fi*Ht+gi*ii,Pt=it*it+Ht*Ht+ii*ii,ai=$t*T+fi*Gt+gi*Et,Ri=it*T+Ht*Gt+ii*Et,Zi=si*Pt-oi*oi;Zi!=0&&(Zi=1/Zi);let yt=(ai*Pt-Ri*oi)*Zi,dt=(-ai*oi+Ri*si)*Zi,vt,di,Ii,bi,se,me,Di,he,ve;vt=zt-at,di=Yt-ot,Ii=pt-ht,bi=at+vt*yt,se=ot+di*yt,me=ht+Ii*yt,vt=jt-at,di=ci-ot,Ii=Xi-ht,bi+=vt*dt,se+=di*dt,me+=Ii*dt,vt=ct-_t,di=nt-bt,Ii=tt-Xt,Di=_t+vt*yt,he=bt+di*yt,ve=Xt+Ii*yt,vt=Yi-_t,di=Li-bt,Ii=wi-Xt,Di+=vt*dt,he+=di*dt,ve+=Ii*dt;let _i=this.closestPoint1;_i.x=bi,_i.y=se,_i.z=me;let ce=this.closestPoint2;ce.x=Di,ce.y=he,ce.z=ve;let be=this.closest;return this.depth=Math.sqrt(be.x*be.x+be.y*be.y+be.z*be.z),m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED}let D=this.polyhedron,F=D._vertexPool;F!=null?(D._vertexPool=F._next,F._next=null):F=new m.collision.narrowphase.detector.gjkepa.EpaVertex;let Q=F.init(k,g,I);if(!this.polyhedron._addVertex(Q,j))return m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX;++z}return m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE}computeClosestPoints(t,i,s,o,n){return this.computeClosestPointsImpl(t,i,s,o,n,!0)}computeDistance(t,i,s,o,n){return this.computeClosestPointsImpl(t,i,s,o,n,!1)}convexCast(t,i,s,o,n,l,_){return this.convexCastImpl(t,i,s,o,n,l,_)}rayCast(t,i,s,o,n){let l=this.tempTransform;l._positionX=s.x,l._positionY=s.y,l._positionZ=s.z;let _=this.tl1,r=this.tl2;return _.x=o.x,_.y=o.y,_.z=o.z,_.x-=s.x,_.y-=s.y,_.z-=s.z,r.zero(),this.convexCastImpl(null,t,l,i,_,r,n)}static getInstance(){return m.collision.narrowphase.detector.gjkepa.GjkEpa.instance}};m.collision.narrowphase.detector.gjkepa.GjkEpaLog=class{};m.collision.narrowphase.detector.gjkepa.GjkEpaResultState=class{};m.collision.narrowphase.detector.gjkepa.SimplexUtil=class{static projectOrigin2(t,i,s){let o,n,l,_,r,e;o=t.x,n=t.y,l=t.z,_=i.x,r=i.y,e=i.z;let a,h,b;a=_-o,h=r-n,b=e-l;let X=a*o+h*n+b*l;if(X=-X/(a*a+h*h+b*b),X<0)return s.x=o,s.y=n,s.z=l,1;if(X>1)return s.x=_,s.y=r,s.z=e,2;let c,Y,p;return c=o+a*X,Y=n+h*X,p=l+b*X,s.x=c,s.y=Y,s.z=p,3}static projectOrigin3(t,i,s,o){let n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g;n=t.x,l=t.y,_=t.z,r=i.x,e=i.y,a=i.z,h=s.x,b=s.y,X=s.z,c=r-n,Y=e-l,p=a-_,x=h-r,v=b-e,f=X-a,Z=n-h,k=l-b,g=_-X;let I,z,d;I=Y*f-p*v,z=p*x-c*f,d=c*v-Y*x;let u,B,j,L,V,M,w,P,E;u=Y*d-p*z,B=p*I-c*d,j=c*z-Y*I,L=v*d-f*z,V=f*I-x*d,M=x*z-v*I,w=k*d-g*z,P=g*I-Z*d,E=Z*z-k*I;let C=-1,S,A,R,H=0;if(S=0,A=0,R=0,n*u+l*B+_*j<0){let F,Q,W,q,U,G;F=t.x,Q=t.y,W=t.z,q=i.x,U=i.y,G=i.z;let J,N,K;J=q-F,N=U-Q,K=G-W;let O=J*F+N*Q+K*W;O=-O/(J*J+N*N+K*K);let $;if(O<0)o.x=F,o.y=Q,o.z=W,$=1;else if(O>1)o.x=q,o.y=U,o.z=G,$=2;else{let et,st,lt;et=F+J*O,st=Q+N*O,lt=W+K*O,o.x=et,o.y=st,o.z=lt,$=3}H=$,C=o.x*o.x+o.y*o.y+o.z*o.z,S=o.x,A=o.y,R=o.z}if(r*L+e*V+a*M<0){let F,Q,W,q,U,G;F=i.x,Q=i.y,W=i.z,q=s.x,U=s.y,G=s.z;let J,N,K;J=q-F,N=U-Q,K=G-W;let O=J*F+N*Q+K*W;O=-O/(J*J+N*N+K*K);let $;if(O<0)o.x=F,o.y=Q,o.z=W,$=1;else if(O>1)o.x=q,o.y=U,o.z=G,$=2;else{let st,lt,rt;st=F+J*O,lt=Q+N*O,rt=W+K*O,o.x=st,o.y=lt,o.z=rt,$=3}let et=o.x*o.x+o.y*o.y+o.z*o.z;(C<0||et<C)&&(H=$<<1,C=et,S=o.x,A=o.y,R=o.z)}if(h*w+b*P+X*E<0){let F,Q,W,q,U,G;F=t.x,Q=t.y,W=t.z,q=s.x,U=s.y,G=s.z;let J,N,K;J=q-F,N=U-Q,K=G-W;let O=J*F+N*Q+K*W;O=-O/(J*J+N*N+K*K);let $;if(O<0)o.x=F,o.y=Q,o.z=W,$=1;else if(O>1)o.x=q,o.y=U,o.z=G,$=2;else{let st,lt,rt;st=F+J*O,lt=Q+N*O,rt=W+K*O,o.x=st,o.y=lt,o.z=rt,$=3}let et=o.x*o.x+o.y*o.y+o.z*o.z;(C<0||et<C)&&(H=$&1|($&2)<<1,C=et,S=o.x,A=o.y,R=o.z)}if(C>0)return o.x=S,o.y=A,o.z=R,H;let y=I*I+z*z+d*d;y>0&&(y=1/Math.sqrt(y)),I*=y,z*=y,d*=y;let D=I*I+z*z+d*d;return D=(n*I+l*z+_*d)/D,S=I*D,A=z*D,R=d*D,o.x=S,o.y=A,o.z=R,7}static projectOrigin4(t,i,s,o,n){let l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w;l=t.x,_=t.y,r=t.z,e=i.x,a=i.y,h=i.z,b=s.x,X=s.y,c=s.z,Y=o.x,p=o.y,x=o.z,v=e-l,f=a-_,Z=h-r,k=b-l,g=X-_,I=c-r,z=Y-l,d=p-_,u=x-r,B=b-e,j=X-a,L=c-h,V=Y-e,M=p-a,w=x-h;let P,E,C,S,A,R,H,y,D,F,Q,W;P=f*I-Z*g,E=Z*k-v*I,C=v*g-f*k,S=g*u-I*d,A=I*z-k*u,R=k*d-g*z,H=d*Z-u*f,y=u*v-z*Z,D=z*f-d*v,F=M*L-w*j,Q=w*B-V*L,W=V*j-M*B;let q=v*F+f*Q+Z*W>0?1:-1,U=-1,G,J,N,K=0;if(G=0,J=0,N=0,(l*P+_*E+r*C)*q<0){let O,$,et,st,lt,rt,at,ot,ht,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt;O=t.x,$=t.y,et=t.z,st=i.x,lt=i.y,rt=i.z,at=s.x,ot=s.y,ht=s.z,_t=st-O,bt=lt-$,Xt=rt-et,ft=at-st,Zt=ot-lt,xt=ht-rt,zt=O-at,Yt=$-ot,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*Zt,nt=Xt*ft-_t*xt,tt=_t*Zt-bt*ft;let Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi;Lt=bt*tt-Xt*nt,Bt=Xt*ct-_t*tt,Mt=_t*nt-bt*ct,jt=Zt*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-Zt*ct,Yi=Yt*tt-pt*nt,Li=pt*ct-zt*tt,wi=zt*nt-Yt*ct;let ei=-1,qt,At,ni,ui=0;if(qt=0,At=0,ni=0,O*Lt+$*Bt+et*Mt<0){let Bi,kt,wt,$t,fi,gi;Bi=t.x,kt=t.y,wt=t.z,$t=i.x,fi=i.y,gi=i.z;let it,Ht,ii;it=$t-Bi,Ht=fi-kt,ii=gi-wt;let T=it*Bi+Ht*kt+ii*wt;T=-T/(it*it+Ht*Ht+ii*ii);let Gt;if(T<0)n.x=Bi,n.y=kt,n.z=wt,Gt=1;else if(T>1)n.x=$t,n.y=fi,n.z=gi,Gt=2;else{let Et,si,oi;Et=Bi+it*T,si=kt+Ht*T,oi=wt+ii*T,n.x=Et,n.y=si,n.z=oi,Gt=3}ui=Gt,ei=n.x*n.x+n.y*n.y+n.z*n.z,qt=n.x,At=n.y,ni=n.z}if(st*jt+lt*ci+rt*Xi<0){let Bi,kt,wt,$t,fi,gi;Bi=i.x,kt=i.y,wt=i.z,$t=s.x,fi=s.y,gi=s.z;let it,Ht,ii;it=$t-Bi,Ht=fi-kt,ii=gi-wt;let T=it*Bi+Ht*kt+ii*wt;T=-T/(it*it+Ht*Ht+ii*ii);let Gt;if(T<0)n.x=Bi,n.y=kt,n.z=wt,Gt=1;else if(T>1)n.x=$t,n.y=fi,n.z=gi,Gt=2;else{let si,oi,Pt;si=Bi+it*T,oi=kt+Ht*T,Pt=wt+ii*T,n.x=si,n.y=oi,n.z=Pt,Gt=3}let Et=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||Et<ei)&&(ui=Gt<<1,ei=Et,qt=n.x,At=n.y,ni=n.z)}if(at*Yi+ot*Li+ht*wi<0){let Bi,kt,wt,$t,fi,gi;Bi=t.x,kt=t.y,wt=t.z,$t=s.x,fi=s.y,gi=s.z;let it,Ht,ii;it=$t-Bi,Ht=fi-kt,ii=gi-wt;let T=it*Bi+Ht*kt+ii*wt;T=-T/(it*it+Ht*Ht+ii*ii);let Gt;if(T<0)n.x=Bi,n.y=kt,n.z=wt,Gt=1;else if(T>1)n.x=$t,n.y=fi,n.z=gi,Gt=2;else{let si,oi,Pt;si=Bi+it*T,oi=kt+Ht*T,Pt=wt+ii*T,n.x=si,n.y=oi,n.z=Pt,Gt=3}let Et=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||Et<ei)&&(ui=Gt&1|(Gt&2)<<1,ei=Et,qt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=qt,n.y=At,n.z=ni,Oi=ui;else{let Bi=ct*ct+nt*nt+tt*tt;Bi>0&&(Bi=1/Math.sqrt(Bi)),ct*=Bi,nt*=Bi,tt*=Bi;let kt=ct*ct+nt*nt+tt*tt;kt=(O*ct+$*nt+et*tt)/kt,qt=ct*kt,At=nt*kt,ni=tt*kt,n.x=qt,n.y=At,n.z=ni,Oi=7}K=Oi,U=n.x*n.x+n.y*n.y+n.z*n.z,G=n.x,J=n.y,N=n.z}if((l*S+_*A+r*R)*q<0){let O,$,et,st,lt,rt,at,ot,ht,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt;O=t.x,$=t.y,et=t.z,st=s.x,lt=s.y,rt=s.z,at=o.x,ot=o.y,ht=o.z,_t=st-O,bt=lt-$,Xt=rt-et,ft=at-st,Zt=ot-lt,xt=ht-rt,zt=O-at,Yt=$-ot,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*Zt,nt=Xt*ft-_t*xt,tt=_t*Zt-bt*ft;let Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi;Lt=bt*tt-Xt*nt,Bt=Xt*ct-_t*tt,Mt=_t*nt-bt*ct,jt=Zt*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-Zt*ct,Yi=Yt*tt-pt*nt,Li=pt*ct-zt*tt,wi=zt*nt-Yt*ct;let ei=-1,qt,At,ni,ui=0;if(qt=0,At=0,ni=0,O*Lt+$*Bt+et*Mt<0){let kt,wt,$t,fi,gi,it;kt=t.x,wt=t.y,$t=t.z,fi=s.x,gi=s.y,it=s.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let si,oi,Pt;si=kt+Ht*Gt,oi=wt+ii*Gt,Pt=$t+T*Gt,n.x=si,n.y=oi,n.z=Pt,Et=3}ui=Et,ei=n.x*n.x+n.y*n.y+n.z*n.z,qt=n.x,At=n.y,ni=n.z}if(st*jt+lt*ci+rt*Xi<0){let kt,wt,$t,fi,gi,it;kt=s.x,wt=s.y,$t=s.z,fi=o.x,gi=o.y,it=o.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let oi,Pt,ai;oi=kt+Ht*Gt,Pt=wt+ii*Gt,ai=$t+T*Gt,n.x=oi,n.y=Pt,n.z=ai,Et=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(ui=Et<<1,ei=si,qt=n.x,At=n.y,ni=n.z)}if(at*Yi+ot*Li+ht*wi<0){let kt,wt,$t,fi,gi,it;kt=t.x,wt=t.y,$t=t.z,fi=o.x,gi=o.y,it=o.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let oi,Pt,ai;oi=kt+Ht*Gt,Pt=wt+ii*Gt,ai=$t+T*Gt,n.x=oi,n.y=Pt,n.z=ai,Et=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(ui=Et&1|(Et&2)<<1,ei=si,qt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=qt,n.y=At,n.z=ni,Oi=ui;else{let kt=ct*ct+nt*nt+tt*tt;kt>0&&(kt=1/Math.sqrt(kt)),ct*=kt,nt*=kt,tt*=kt;let wt=ct*ct+nt*nt+tt*tt;wt=(O*ct+$*nt+et*tt)/wt,qt=ct*wt,At=nt*wt,ni=tt*wt,n.x=qt,n.y=At,n.z=ni,Oi=7}let Bi=n.x*n.x+n.y*n.y+n.z*n.z;(U<0||Bi<U)&&(K=Oi&1|(Oi&6)<<1,U=Bi,G=n.x,J=n.y,N=n.z)}if((l*H+_*y+r*D)*q<0){let O,$,et,st,lt,rt,at,ot,ht,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt;O=t.x,$=t.y,et=t.z,st=i.x,lt=i.y,rt=i.z,at=o.x,ot=o.y,ht=o.z,_t=st-O,bt=lt-$,Xt=rt-et,ft=at-st,Zt=ot-lt,xt=ht-rt,zt=O-at,Yt=$-ot,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*Zt,nt=Xt*ft-_t*xt,tt=_t*Zt-bt*ft;let Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi;Lt=bt*tt-Xt*nt,Bt=Xt*ct-_t*tt,Mt=_t*nt-bt*ct,jt=Zt*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-Zt*ct,Yi=Yt*tt-pt*nt,Li=pt*ct-zt*tt,wi=zt*nt-Yt*ct;let ei=-1,qt,At,ni,ui=0;if(qt=0,At=0,ni=0,O*Lt+$*Bt+et*Mt<0){let kt,wt,$t,fi,gi,it;kt=t.x,wt=t.y,$t=t.z,fi=i.x,gi=i.y,it=i.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let si,oi,Pt;si=kt+Ht*Gt,oi=wt+ii*Gt,Pt=$t+T*Gt,n.x=si,n.y=oi,n.z=Pt,Et=3}ui=Et,ei=n.x*n.x+n.y*n.y+n.z*n.z,qt=n.x,At=n.y,ni=n.z}if(st*jt+lt*ci+rt*Xi<0){let kt,wt,$t,fi,gi,it;kt=i.x,wt=i.y,$t=i.z,fi=o.x,gi=o.y,it=o.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let oi,Pt,ai;oi=kt+Ht*Gt,Pt=wt+ii*Gt,ai=$t+T*Gt,n.x=oi,n.y=Pt,n.z=ai,Et=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(ui=Et<<1,ei=si,qt=n.x,At=n.y,ni=n.z)}if(at*Yi+ot*Li+ht*wi<0){let kt,wt,$t,fi,gi,it;kt=t.x,wt=t.y,$t=t.z,fi=o.x,gi=o.y,it=o.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let oi,Pt,ai;oi=kt+Ht*Gt,Pt=wt+ii*Gt,ai=$t+T*Gt,n.x=oi,n.y=Pt,n.z=ai,Et=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(ui=Et&1|(Et&2)<<1,ei=si,qt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=qt,n.y=At,n.z=ni,Oi=ui;else{let kt=ct*ct+nt*nt+tt*tt;kt>0&&(kt=1/Math.sqrt(kt)),ct*=kt,nt*=kt,tt*=kt;let wt=ct*ct+nt*nt+tt*tt;wt=(O*ct+$*nt+et*tt)/wt,qt=ct*wt,At=nt*wt,ni=tt*wt,n.x=qt,n.y=At,n.z=ni,Oi=7}let Bi=n.x*n.x+n.y*n.y+n.z*n.z;(U<0||Bi<U)&&(K=Oi&3|(Oi&4)<<1,U=Bi,G=n.x,J=n.y,N=n.z)}if((e*F+a*Q+h*W)*q<0){let O,$,et,st,lt,rt,at,ot,ht,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt;O=i.x,$=i.y,et=i.z,st=s.x,lt=s.y,rt=s.z,at=o.x,ot=o.y,ht=o.z,_t=st-O,bt=lt-$,Xt=rt-et,ft=at-st,Zt=ot-lt,xt=ht-rt,zt=O-at,Yt=$-ot,pt=et-ht;let ct,nt,tt;ct=bt*xt-Xt*Zt,nt=Xt*ft-_t*xt,tt=_t*Zt-bt*ft;let Lt,Bt,Mt,jt,ci,Xi,Yi,Li,wi;Lt=bt*tt-Xt*nt,Bt=Xt*ct-_t*tt,Mt=_t*nt-bt*ct,jt=Zt*tt-xt*nt,ci=xt*ct-ft*tt,Xi=ft*nt-Zt*ct,Yi=Yt*tt-pt*nt,Li=pt*ct-zt*tt,wi=zt*nt-Yt*ct;let ei=-1,qt,At,ni,ui=0;if(qt=0,At=0,ni=0,O*Lt+$*Bt+et*Mt<0){let kt,wt,$t,fi,gi,it;kt=i.x,wt=i.y,$t=i.z,fi=s.x,gi=s.y,it=s.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let si,oi,Pt;si=kt+Ht*Gt,oi=wt+ii*Gt,Pt=$t+T*Gt,n.x=si,n.y=oi,n.z=Pt,Et=3}ui=Et,ei=n.x*n.x+n.y*n.y+n.z*n.z,qt=n.x,At=n.y,ni=n.z}if(st*jt+lt*ci+rt*Xi<0){let kt,wt,$t,fi,gi,it;kt=s.x,wt=s.y,$t=s.z,fi=o.x,gi=o.y,it=o.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let oi,Pt,ai;oi=kt+Ht*Gt,Pt=wt+ii*Gt,ai=$t+T*Gt,n.x=oi,n.y=Pt,n.z=ai,Et=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(ui=Et<<1,ei=si,qt=n.x,At=n.y,ni=n.z)}if(at*Yi+ot*Li+ht*wi<0){let kt,wt,$t,fi,gi,it;kt=i.x,wt=i.y,$t=i.z,fi=o.x,gi=o.y,it=o.z;let Ht,ii,T;Ht=fi-kt,ii=gi-wt,T=it-$t;let Gt=Ht*kt+ii*wt+T*$t;Gt=-Gt/(Ht*Ht+ii*ii+T*T);let Et;if(Gt<0)n.x=kt,n.y=wt,n.z=$t,Et=1;else if(Gt>1)n.x=fi,n.y=gi,n.z=it,Et=2;else{let oi,Pt,ai;oi=kt+Ht*Gt,Pt=wt+ii*Gt,ai=$t+T*Gt,n.x=oi,n.y=Pt,n.z=ai,Et=3}let si=n.x*n.x+n.y*n.y+n.z*n.z;(ei<0||si<ei)&&(ui=Et&1|(Et&2)<<1,ei=si,qt=n.x,At=n.y,ni=n.z)}let Oi;if(ei>0)n.x=qt,n.y=At,n.z=ni,Oi=ui;else{let kt=ct*ct+nt*nt+tt*tt;kt>0&&(kt=1/Math.sqrt(kt)),ct*=kt,nt*=kt,tt*=kt;let wt=ct*ct+nt*nt+tt*tt;wt=(O*ct+$*nt+et*tt)/wt,qt=ct*wt,At=nt*wt,ni=tt*wt,n.x=qt,n.y=At,n.z=ni,Oi=7}let Bi=n.x*n.x+n.y*n.y+n.z*n.z;(U<0||Bi<U)&&(K=Oi<<1,U=Bi,G=n.x,J=n.y,N=n.z)}return U>0?(n.x=G,n.y=J,n.z=N,K):(n.zero(),15)}};m.common.Mat3=class{constructor(t,i,s,o,n,l,_,r,e){e==null&&(e=1),r==null&&(r=0),_==null&&(_=0),l==null&&(l=0),n==null&&(n=1),o==null&&(o=0),s==null&&(s=0),i==null&&(i=0),t==null&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e10=o,this.e11=n,this.e12=l,this.e20=_,this.e21=r,this.e22=e,m.common.Mat3.numCreations++}init(t,i,s,o,n,l,_,r,e){return this.e00=t,this.e01=i,this.e02=s,this.e10=o,this.e11=n,this.e12=l,this.e20=_,this.e21=r,this.e22=e,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e10=0,this.e11=1,this.e12=0,this.e20=0,this.e21=0,this.e22=1,this}add(t){return new m.common.Mat3(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22)}sub(t){return new m.common.Mat3(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22)}scale(t){return new m.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*t,this.e11*t,this.e12*t,this.e20*t,this.e21*t,this.e22*t)}mul(t){return new m.common.Mat3(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e20*=t,this.e21*=t,this.e22*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22,o=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20,n=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21,l=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22,_=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20,r=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21,e=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20,this.e01=i,this.e02=s,this.e10=o,this.e11=n,this.e12=l,this.e20=_,this.e21=r,this.e22=e,this}prependScale(t,i,s){return new m.common.Mat3(this.e00*t,this.e01*t,this.e02*t,this.e10*i,this.e11*i,this.e12*i,this.e20*s,this.e21*s,this.e22*s)}appendScale(t,i,s){return new m.common.Mat3(this.e00*t,this.e01*i,this.e02*s,this.e10*t,this.e11*i,this.e12*s,this.e20*t,this.e21*i,this.e22*s)}prependRotation(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l;return new m.common.Mat3(r*this.e00+e*this.e10+a*this.e20,r*this.e01+e*this.e11+a*this.e21,r*this.e02+e*this.e12+a*this.e22,h*this.e00+b*this.e10+X*this.e20,h*this.e01+b*this.e11+X*this.e21,h*this.e02+b*this.e12+X*this.e22,c*this.e00+Y*this.e10+p*this.e20,c*this.e01+Y*this.e11+p*this.e21,c*this.e02+Y*this.e12+p*this.e22)}appendRotation(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l;return new m.common.Mat3(this.e00*r+this.e01*h+this.e02*c,this.e00*e+this.e01*b+this.e02*Y,this.e00*a+this.e01*X+this.e02*p,this.e10*r+this.e11*h+this.e12*c,this.e10*e+this.e11*b+this.e12*Y,this.e10*a+this.e11*X+this.e12*p,this.e20*r+this.e21*h+this.e22*c,this.e20*e+this.e21*b+this.e22*Y,this.e20*a+this.e21*X+this.e22*p)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e20*=s,this.e21*=s,this.e22*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this}prependRotationEq(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l,x=h*this.e00+b*this.e10+X*this.e20,v=h*this.e01+b*this.e11+X*this.e21,f=h*this.e02+b*this.e12+X*this.e22,Z=c*this.e00+Y*this.e10+p*this.e20,k=c*this.e01+Y*this.e11+p*this.e21,g=c*this.e02+Y*this.e12+p*this.e22;return this.e00=r*this.e00+e*this.e10+a*this.e20,this.e01=r*this.e01+e*this.e11+a*this.e21,this.e02=r*this.e02+e*this.e12+a*this.e22,this.e10=x,this.e11=v,this.e12=f,this.e20=Z,this.e21=k,this.e22=g,this}appendRotationEq(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l,x=this.e00*e+this.e01*b+this.e02*Y,v=this.e00*a+this.e01*X+this.e02*p,f=this.e10*e+this.e11*b+this.e12*Y,Z=this.e10*a+this.e11*X+this.e12*p,k=this.e20*e+this.e21*b+this.e22*Y,g=this.e20*a+this.e21*X+this.e22*p;return this.e00=this.e00*r+this.e01*h+this.e02*c,this.e01=x,this.e02=v,this.e10=this.e10*r+this.e11*h+this.e12*c,this.e11=f,this.e12=Z,this.e20=this.e20*r+this.e21*h+this.e22*c,this.e21=k,this.e22=g,this}transpose(){return new m.common.Mat3(this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12;return this.e01=this.e10,this.e02=this.e20,this.e10=t,this.e12=this.e21,this.e20=i,this.e21=s,this}determinant(){return this.e00*(this.e11*this.e22-this.e12*this.e21)-this.e01*(this.e10*this.e22-this.e12*this.e20)+this.e02*(this.e10*this.e21-this.e11*this.e20)}trace(){return this.e00+this.e11+this.e22}inverse(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,o=this.e00*t-this.e01*i+this.e02*s;return o!=0&&(o=1/o),new m.common.Mat3(t*o,-(this.e01*this.e22-this.e02*this.e21)*o,(this.e01*this.e12-this.e02*this.e11)*o,-i*o,(this.e00*this.e22-this.e02*this.e20)*o,-(this.e00*this.e12-this.e02*this.e10)*o,s*o,-(this.e00*this.e21-this.e01*this.e20)*o,(this.e00*this.e11-this.e01*this.e10)*o)}inverseEq(){let t=this.e11*this.e22-this.e12*this.e21,i=this.e10*this.e22-this.e12*this.e20,s=this.e10*this.e21-this.e11*this.e20,o=this.e00*t-this.e01*i+this.e02*s;o!=0&&(o=1/o);let n=(this.e01*this.e12-this.e02*this.e11)*o,l=(this.e00*this.e22-this.e02*this.e20)*o,_=-(this.e00*this.e12-this.e02*this.e10)*o,r=-(this.e00*this.e21-this.e01*this.e20)*o,e=(this.e00*this.e11-this.e01*this.e10)*o;return this.e00=t*o,this.e01=-(this.e01*this.e22-this.e02*this.e21)*o,this.e02=n,this.e10=-i*o,this.e11=l,this.e12=_,this.e20=s*o,this.e21=r,this.e22=e,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e01,this.e11,this.e21,this.e02,this.e12,this.e22]:[this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this}clone(){return new m.common.Mat3(this.e00,this.e01,this.e02,this.e10,this.e11,this.e12,this.e20,this.e21,this.e22)}fromQuat(t){let i=t.x,s=t.y,o=t.z,n=t.w,l=2*i,_=2*s,r=2*o,e=i*l,a=s*_,h=o*r,b=i*_,X=s*r,c=i*r,Y=n*l,p=n*_,x=n*r;return this.e00=1-a-h,this.e01=b-x,this.e02=c+p,this.e10=b+x,this.e11=1-e-h,this.e12=X-Y,this.e20=c-p,this.e21=X+Y,this.e22=1-e-a,this}toQuat(){let t=new m.common.Quat,i=this.e00,s=this.e11,o=this.e22,n=i+s+o,l;return n>0?(l=Math.sqrt(n+1),t.w=.5*l,l=.5/l,t.x=(this.e21-this.e12)*l,t.y=(this.e02-this.e20)*l,t.z=(this.e10-this.e01)*l):i>s?i>o?(l=Math.sqrt(i-s-o+1),t.x=.5*l,l=.5/l,t.y=(this.e01+this.e10)*l,t.z=(this.e02+this.e20)*l,t.w=(this.e21-this.e12)*l):(l=Math.sqrt(o-i-s+1),t.z=.5*l,l=.5/l,t.x=(this.e02+this.e20)*l,t.y=(this.e12+this.e21)*l,t.w=(this.e10-this.e01)*l):s>o?(l=Math.sqrt(s-o-i+1),t.y=.5*l,l=.5/l,t.x=(this.e01+this.e10)*l,t.z=(this.e12+this.e21)*l,t.w=(this.e02-this.e20)*l):(l=Math.sqrt(o-i-s+1),t.z=.5*l,l=.5/l,t.x=(this.e02+this.e20)*l,t.y=(this.e12+this.e21)*l,t.w=(this.e10-this.e01)*l),t}fromEulerXyz(t){let i=Math.sin(t.x),s=Math.sin(t.y),o=Math.sin(t.z),n=Math.cos(t.x),l=Math.cos(t.y),_=Math.cos(t.z);return this.e00=l*_,this.e01=-l*o,this.e02=s,this.e10=n*o+_*i*s,this.e11=n*_-i*s*o,this.e12=-l*i,this.e20=i*o-n*_*s,this.e21=_*i+n*s*o,this.e22=n*l,this}toEulerXyz(){let t=this.e02;if(t<=-1){let i=Math.atan2(this.e21,this.e11);return new m.common.Vec3(i*.5,-1.570796326794895,-i*.5)}if(t>=1){let i=Math.atan2(this.e21,this.e11);return new m.common.Vec3(i*.5,1.570796326794895,i*.5)}return new m.common.Vec3(Math.atan2(-this.e12,this.e22),Math.asin(t),Math.atan2(-this.e01,this.e00))}getRow(t){return t==0?new m.common.Vec3(this.e00,this.e01,this.e02):t==1?new m.common.Vec3(this.e10,this.e11,this.e12):t==2?new m.common.Vec3(this.e20,this.e21,this.e22):null}getCol(t){return t==0?new m.common.Vec3(this.e00,this.e10,this.e20):t==1?new m.common.Vec3(this.e01,this.e11,this.e21):t==2?new m.common.Vec3(this.e02,this.e12,this.e22):null}getRowTo(t,i){t==0?i.init(this.e00,this.e01,this.e02):t==1?i.init(this.e10,this.e11,this.e12):t==2?i.init(this.e20,this.e21,this.e22):i.zero()}getColTo(t,i){t==0?i.init(this.e00,this.e10,this.e20):t==1?i.init(this.e01,this.e11,this.e21):t==2?i.init(this.e02,this.e12,this.e22):i.zero()}fromRows(t,i,s){return this.e00=t.x,this.e01=t.y,this.e02=t.z,this.e10=i.x,this.e11=i.y,this.e12=i.z,this.e20=s.x,this.e21=s.y,this.e22=s.z,this}fromCols(t,i,s){return this.e00=t.x,this.e01=i.x,this.e02=s.x,this.e10=t.y,this.e11=i.y,this.e12=s.y,this.e20=t.z,this.e21=i.z,this.e22=s.z,this}toString(){return"Mat3["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+`,
     `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+`,
     `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+"]"}};m.common.Mat4=class{constructor(t,i,s,o,n,l,_,r,e,a,h,b,X,c,Y,p){p==null&&(p=1),Y==null&&(Y=0),c==null&&(c=0),X==null&&(X=0),b==null&&(b=0),h==null&&(h=1),a==null&&(a=0),e==null&&(e=0),r==null&&(r=0),_==null&&(_=0),l==null&&(l=1),n==null&&(n=0),o==null&&(o=0),s==null&&(s=0),i==null&&(i=0),t==null&&(t=1),this.e00=t,this.e01=i,this.e02=s,this.e03=o,this.e10=n,this.e11=l,this.e12=_,this.e13=r,this.e20=e,this.e21=a,this.e22=h,this.e23=b,this.e30=X,this.e31=c,this.e32=Y,this.e33=p,m.common.Mat4.numCreations++}init(t,i,s,o,n,l,_,r,e,a,h,b,X,c,Y,p){return this.e00=t,this.e01=i,this.e02=s,this.e03=o,this.e10=n,this.e11=l,this.e12=_,this.e13=r,this.e20=e,this.e21=a,this.e22=h,this.e23=b,this.e30=X,this.e31=c,this.e32=Y,this.e33=p,this}identity(){return this.e00=1,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=1,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=1,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}add(t){return new m.common.Mat4(this.e00+t.e00,this.e01+t.e01,this.e02+t.e02,this.e03+t.e03,this.e10+t.e10,this.e11+t.e11,this.e12+t.e12,this.e13+t.e13,this.e20+t.e20,this.e21+t.e21,this.e22+t.e22,this.e23+t.e23,this.e30+t.e30,this.e31+t.e31,this.e32+t.e32,this.e33+t.e33)}sub(t){return new m.common.Mat4(this.e00-t.e00,this.e01-t.e01,this.e02-t.e02,this.e03-t.e03,this.e10-t.e10,this.e11-t.e11,this.e12-t.e12,this.e13-t.e13,this.e20-t.e20,this.e21-t.e21,this.e22-t.e22,this.e23-t.e23,this.e30-t.e30,this.e31-t.e31,this.e32-t.e32,this.e33-t.e33)}scale(t){return new m.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*t,this.e11*t,this.e12*t,this.e13*t,this.e20*t,this.e21*t,this.e22*t,this.e23*t,this.e30*t,this.e31*t,this.e32*t,this.e33*t)}mul(t){return new m.common.Mat4(this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33)}addEq(t){return this.e00+=t.e00,this.e01+=t.e01,this.e02+=t.e02,this.e03+=t.e03,this.e10+=t.e10,this.e11+=t.e11,this.e12+=t.e12,this.e13+=t.e13,this.e20+=t.e20,this.e21+=t.e21,this.e22+=t.e22,this.e23+=t.e23,this.e30+=t.e30,this.e31+=t.e31,this.e32+=t.e32,this.e33+=t.e33,this}subEq(t){return this.e00-=t.e00,this.e01-=t.e01,this.e02-=t.e02,this.e03-=t.e03,this.e10-=t.e10,this.e11-=t.e11,this.e12-=t.e12,this.e13-=t.e13,this.e20-=t.e20,this.e21-=t.e21,this.e22-=t.e22,this.e23-=t.e23,this.e30-=t.e30,this.e31-=t.e31,this.e32-=t.e32,this.e33-=t.e33,this}scaleEq(t){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=t,this.e11*=t,this.e12*=t,this.e13*=t,this.e20*=t,this.e21*=t,this.e22*=t,this.e23*=t,this.e30*=t,this.e31*=t,this.e32*=t,this.e33*=t,this}mulEq(t){let i=this.e00*t.e01+this.e01*t.e11+this.e02*t.e21+this.e03*t.e31,s=this.e00*t.e02+this.e01*t.e12+this.e02*t.e22+this.e03*t.e32,o=this.e00*t.e03+this.e01*t.e13+this.e02*t.e23+this.e03*t.e33,n=this.e10*t.e00+this.e11*t.e10+this.e12*t.e20+this.e13*t.e30,l=this.e10*t.e01+this.e11*t.e11+this.e12*t.e21+this.e13*t.e31,_=this.e10*t.e02+this.e11*t.e12+this.e12*t.e22+this.e13*t.e32,r=this.e10*t.e03+this.e11*t.e13+this.e12*t.e23+this.e13*t.e33,e=this.e20*t.e00+this.e21*t.e10+this.e22*t.e20+this.e23*t.e30,a=this.e20*t.e01+this.e21*t.e11+this.e22*t.e21+this.e23*t.e31,h=this.e20*t.e02+this.e21*t.e12+this.e22*t.e22+this.e23*t.e32,b=this.e20*t.e03+this.e21*t.e13+this.e22*t.e23+this.e23*t.e33,X=this.e30*t.e00+this.e31*t.e10+this.e32*t.e20+this.e33*t.e30,c=this.e30*t.e01+this.e31*t.e11+this.e32*t.e21+this.e33*t.e31,Y=this.e30*t.e02+this.e31*t.e12+this.e32*t.e22+this.e33*t.e32,p=this.e30*t.e03+this.e31*t.e13+this.e32*t.e23+this.e33*t.e33;return this.e00=this.e00*t.e00+this.e01*t.e10+this.e02*t.e20+this.e03*t.e30,this.e01=i,this.e02=s,this.e03=o,this.e10=n,this.e11=l,this.e12=_,this.e13=r,this.e20=e,this.e21=a,this.e22=h,this.e23=b,this.e30=X,this.e31=c,this.e32=Y,this.e33=p,this}prependScale(t,i,s){return new m.common.Mat4(this.e00*t,this.e01*t,this.e02*t,this.e03*t,this.e10*i,this.e11*i,this.e12*i,this.e13*i,this.e20*s,this.e21*s,this.e22*s,this.e23*s,this.e30,this.e31,this.e32,this.e33)}appendScale(t,i,s){return new m.common.Mat4(this.e00*t,this.e01*i,this.e02*s,this.e03,this.e10*t,this.e11*i,this.e12*s,this.e13,this.e20*t,this.e21*i,this.e22*s,this.e23,this.e30*t,this.e31*i,this.e32*s,this.e33)}prependRotation(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l;return new m.common.Mat4(r*this.e00+e*this.e10+a*this.e20,r*this.e01+e*this.e11+a*this.e21,r*this.e02+e*this.e12+a*this.e22,r*this.e03+e*this.e13+a*this.e23,h*this.e00+b*this.e10+X*this.e20,h*this.e01+b*this.e11+X*this.e21,h*this.e02+b*this.e12+X*this.e22,h*this.e03+b*this.e13+X*this.e23,c*this.e00+Y*this.e10+p*this.e20,c*this.e01+Y*this.e11+p*this.e21,c*this.e02+Y*this.e12+p*this.e22,c*this.e03+Y*this.e13+p*this.e23,this.e30,this.e31,this.e32,this.e33)}appendRotation(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l;return new m.common.Mat4(this.e00*r+this.e01*h+this.e02*c,this.e00*e+this.e01*b+this.e02*Y,this.e00*a+this.e01*X+this.e02*p,this.e03,this.e10*r+this.e11*h+this.e12*c,this.e10*e+this.e11*b+this.e12*Y,this.e10*a+this.e11*X+this.e12*p,this.e13,this.e20*r+this.e21*h+this.e22*c,this.e20*e+this.e21*b+this.e22*Y,this.e20*a+this.e21*X+this.e22*p,this.e23,this.e30*r+this.e31*h+this.e32*c,this.e30*e+this.e31*b+this.e32*Y,this.e30*a+this.e31*X+this.e32*p,this.e33)}prependTranslation(t,i,s){return new m.common.Mat4(this.e00+t*this.e30,this.e01+t*this.e31,this.e02+t*this.e32,this.e03+t*this.e33,this.e10+i*this.e30,this.e11+i*this.e31,this.e12+i*this.e32,this.e13+i*this.e33,this.e20+s*this.e30,this.e21+s*this.e31,this.e22+s*this.e32,this.e23+s*this.e33,this.e30,this.e31,this.e32,this.e33)}appendTranslation(t,i,s){return new m.common.Mat4(this.e00,this.e01,this.e02,this.e00*t+this.e01*i+this.e02*s+this.e03,this.e10,this.e11,this.e12,this.e10*t+this.e11*i+this.e12*s+this.e13,this.e20,this.e21,this.e22,this.e20*t+this.e21*i+this.e22*s+this.e23,this.e30,this.e31,this.e32,this.e30*t+this.e31*i+this.e32*s+this.e33)}prependScaleEq(t,i,s){return this.e00*=t,this.e01*=t,this.e02*=t,this.e03*=t,this.e10*=i,this.e11*=i,this.e12*=i,this.e13*=i,this.e20*=s,this.e21*=s,this.e22*=s,this.e23*=s,this}appendScaleEq(t,i,s){return this.e00*=t,this.e01*=i,this.e02*=s,this.e10*=t,this.e11*=i,this.e12*=s,this.e20*=t,this.e21*=i,this.e22*=s,this.e30*=t,this.e31*=i,this.e32*=s,this}prependRotationEq(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l,x=h*this.e00+b*this.e10+X*this.e20,v=h*this.e01+b*this.e11+X*this.e21,f=h*this.e02+b*this.e12+X*this.e22,Z=h*this.e03+b*this.e13+X*this.e23,k=c*this.e00+Y*this.e10+p*this.e20,g=c*this.e01+Y*this.e11+p*this.e21,I=c*this.e02+Y*this.e12+p*this.e22,z=c*this.e03+Y*this.e13+p*this.e23;return this.e00=r*this.e00+e*this.e10+a*this.e20,this.e01=r*this.e01+e*this.e11+a*this.e21,this.e02=r*this.e02+e*this.e12+a*this.e22,this.e03=r*this.e03+e*this.e13+a*this.e23,this.e10=x,this.e11=v,this.e12=f,this.e13=Z,this.e20=k,this.e21=g,this.e22=I,this.e23=z,this}appendRotationEq(t,i,s,o){let n=Math.sin(t),l=Math.cos(t),_=1-l,r=i*i*_+l,e=i*s*_-o*n,a=i*o*_+s*n,h=s*i*_+o*n,b=s*s*_+l,X=s*o*_-i*n,c=o*i*_-s*n,Y=o*s*_+i*n,p=o*o*_+l,x=this.e00*e+this.e01*b+this.e02*Y,v=this.e00*a+this.e01*X+this.e02*p,f=this.e10*e+this.e11*b+this.e12*Y,Z=this.e10*a+this.e11*X+this.e12*p,k=this.e20*e+this.e21*b+this.e22*Y,g=this.e20*a+this.e21*X+this.e22*p,I=this.e30*e+this.e31*b+this.e32*Y,z=this.e30*a+this.e31*X+this.e32*p;return this.e00=this.e00*r+this.e01*h+this.e02*c,this.e01=x,this.e02=v,this.e10=this.e10*r+this.e11*h+this.e12*c,this.e11=f,this.e12=Z,this.e20=this.e20*r+this.e21*h+this.e22*c,this.e21=k,this.e22=g,this.e30=this.e30*r+this.e31*h+this.e32*c,this.e31=I,this.e32=z,this}prependTranslationEq(t,i,s){return this.e00+=t*this.e30,this.e01+=t*this.e31,this.e02+=t*this.e32,this.e03+=t*this.e33,this.e10+=i*this.e30,this.e11+=i*this.e31,this.e12+=i*this.e32,this.e13+=i*this.e33,this.e20+=s*this.e30,this.e21+=s*this.e31,this.e22+=s*this.e32,this.e23+=s*this.e33,this}appendTranslationEq(t,i,s){let o=this.e00*t+this.e01*i+this.e02*s+this.e03,n=this.e10*t+this.e11*i+this.e12*s+this.e13,l=this.e20*t+this.e21*i+this.e22*s+this.e23,_=this.e30*t+this.e31*i+this.e32*s+this.e33;return this.e03=o,this.e13=n,this.e23=l,this.e33=_,this}transpose(){return new m.common.Mat4(this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33)}transposeEq(){let t=this.e01,i=this.e02,s=this.e12,o=this.e03,n=this.e13,l=this.e23;return this.e01=this.e10,this.e02=this.e20,this.e03=this.e30,this.e10=t,this.e12=this.e21,this.e13=this.e31,this.e20=i,this.e21=s,this.e23=this.e32,this.e30=o,this.e31=n,this.e32=l,this}determinant(){let t=this.e20*this.e31-this.e21*this.e30,i=this.e20*this.e32-this.e22*this.e30,s=this.e20*this.e33-this.e23*this.e30,o=this.e21*this.e32-this.e22*this.e31,n=this.e21*this.e33-this.e23*this.e31,l=this.e22*this.e33-this.e23*this.e32;return this.e00*(this.e11*l-this.e12*n+this.e13*o)-this.e01*(this.e10*l-this.e12*s+this.e13*i)+this.e02*(this.e10*n-this.e11*s+this.e13*t)-this.e03*(this.e10*o-this.e11*i+this.e12*t)}trace(){return this.e00+this.e11+this.e22+this.e33}inverse(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,l=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,a=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,b=this.e22*this.e33-this.e23*this.e32,X=this.e11*b-this.e12*h+this.e13*a,c=this.e10*b-this.e12*e+this.e13*r,Y=this.e10*h-this.e11*e+this.e13*_,p=this.e10*a-this.e11*r+this.e12*_,x=this.e00*X-this.e01*c+this.e02*Y-this.e03*p;return x!=0&&(x=1/x),new m.common.Mat4(X*x,-(this.e01*b-this.e02*h+this.e03*a)*x,(this.e31*l-this.e32*n+this.e33*o)*x,-(this.e21*l-this.e22*n+this.e23*o)*x,-c*x,(this.e00*b-this.e02*e+this.e03*r)*x,-(this.e30*l-this.e32*s+this.e33*i)*x,(this.e20*l-this.e22*s+this.e23*i)*x,Y*x,-(this.e00*h-this.e01*e+this.e03*_)*x,(this.e30*n-this.e31*s+this.e33*t)*x,-(this.e20*n-this.e21*s+this.e23*t)*x,-p*x,(this.e00*a-this.e01*r+this.e02*_)*x,-(this.e30*o-this.e31*i+this.e32*t)*x,(this.e20*o-this.e21*i+this.e22*t)*x)}inverseEq(){let t=this.e00*this.e11-this.e01*this.e10,i=this.e00*this.e12-this.e02*this.e10,s=this.e00*this.e13-this.e03*this.e10,o=this.e01*this.e12-this.e02*this.e11,n=this.e01*this.e13-this.e03*this.e11,l=this.e02*this.e13-this.e03*this.e12,_=this.e20*this.e31-this.e21*this.e30,r=this.e20*this.e32-this.e22*this.e30,e=this.e20*this.e33-this.e23*this.e30,a=this.e21*this.e32-this.e22*this.e31,h=this.e21*this.e33-this.e23*this.e31,b=this.e22*this.e33-this.e23*this.e32,X=this.e11*b-this.e12*h+this.e13*a,c=this.e10*b-this.e12*e+this.e13*r,Y=this.e10*h-this.e11*e+this.e13*_,p=this.e10*a-this.e11*r+this.e12*_,x=this.e00*X-this.e01*c+this.e02*Y-this.e03*p;x!=0&&(x=1/x);let v=(this.e00*b-this.e02*e+this.e03*r)*x,f=-(this.e00*h-this.e01*e+this.e03*_)*x,Z=-(this.e20*n-this.e21*s+this.e23*t)*x,k=(this.e00*a-this.e01*r+this.e02*_)*x,g=-(this.e30*o-this.e31*i+this.e32*t)*x,I=(this.e20*o-this.e21*i+this.e22*t)*x;return this.e00=X*x,this.e01=-(this.e01*b-this.e02*h+this.e03*a)*x,this.e02=(this.e31*l-this.e32*n+this.e33*o)*x,this.e03=-(this.e21*l-this.e22*n+this.e23*o)*x,this.e10=-c*x,this.e11=v,this.e12=-(this.e30*l-this.e32*s+this.e33*i)*x,this.e13=(this.e20*l-this.e22*s+this.e23*i)*x,this.e20=Y*x,this.e21=f,this.e22=(this.e30*n-this.e31*s+this.e33*t)*x,this.e23=Z,this.e30=-p*x,this.e31=k,this.e32=g,this.e33=I,this}lookAt(t,i,s,o,n,l,_,r,e){let a=t-o,h=i-n,b=s-l,X=1/Math.sqrt(a*a+h*h+b*b);a*=X,h*=X,b*=X;let c=r*b-e*h,Y=e*a-_*b,p=_*h-r*a;X=1/Math.sqrt(c*c+Y*Y+p*p),c*=X,Y*=X,p*=X;let x=h*p-b*Y,v=b*c-a*p,f=a*Y-h*c;return this.e00=c,this.e01=Y,this.e02=p,this.e03=-(c*t+Y*i+p*s),this.e10=x,this.e11=v,this.e12=f,this.e13=-(x*t+v*i+f*s),this.e20=a,this.e21=h,this.e22=b,this.e23=-(a*t+h*i+b*s),this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}perspective(t,i,s,o){let n=1/Math.tan(t*.5),l=o/(s-o);return this.e00=n/i,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=n,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=l,this.e23=s*l,this.e30=0,this.e31=0,this.e32=-1,this.e33=0,this}ortho(t,i,s,o){let n=1/(s-o);return this.e00=2/t,this.e01=0,this.e02=0,this.e03=0,this.e10=0,this.e11=2/i,this.e12=0,this.e13=0,this.e20=0,this.e21=0,this.e22=n,this.e23=s*n,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}toArray(t){return t==null&&(t=!1),t?[this.e00,this.e10,this.e20,this.e30,this.e01,this.e11,this.e21,this.e31,this.e02,this.e12,this.e22,this.e32,this.e03,this.e13,this.e23,this.e33]:[this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33]}copyFrom(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=t.e03,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=t.e13,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=t.e23,this.e30=t.e30,this.e31=t.e31,this.e32=t.e32,this.e33=t.e33,this}fromMat3(t){return this.e00=t.e00,this.e01=t.e01,this.e02=t.e02,this.e03=0,this.e10=t.e10,this.e11=t.e11,this.e12=t.e12,this.e13=0,this.e20=t.e20,this.e21=t.e21,this.e22=t.e22,this.e23=0,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}fromTransform(t){return this.e00=t._rotation00,this.e01=t._rotation01,this.e02=t._rotation02,this.e10=t._rotation10,this.e11=t._rotation11,this.e12=t._rotation12,this.e20=t._rotation20,this.e21=t._rotation21,this.e22=t._rotation22,this.e03=t._positionX,this.e13=t._positionY,this.e23=t._positionZ,this.e30=0,this.e31=0,this.e32=0,this.e33=1,this}clone(){return new m.common.Mat4(this.e00,this.e01,this.e02,this.e03,this.e10,this.e11,this.e12,this.e13,this.e20,this.e21,this.e22,this.e23,this.e30,this.e31,this.e32,this.e33)}toString(){return"Mat4["+(this.e00>0?(this.e00*1e7+.5|0)/1e7:(this.e00*1e7-.5|0)/1e7)+", "+(this.e01>0?(this.e01*1e7+.5|0)/1e7:(this.e01*1e7-.5|0)/1e7)+", "+(this.e02>0?(this.e02*1e7+.5|0)/1e7:(this.e02*1e7-.5|0)/1e7)+", "+(this.e03>0?(this.e03*1e7+.5|0)/1e7:(this.e03*1e7-.5|0)/1e7)+`,
    `+(this.e10>0?(this.e10*1e7+.5|0)/1e7:(this.e10*1e7-.5|0)/1e7)+", "+(this.e11>0?(this.e11*1e7+.5|0)/1e7:(this.e11*1e7-.5|0)/1e7)+", "+(this.e12>0?(this.e12*1e7+.5|0)/1e7:(this.e12*1e7-.5|0)/1e7)+", "+(this.e13>0?(this.e13*1e7+.5|0)/1e7:(this.e13*1e7-.5|0)/1e7)+`,
    `+(this.e20>0?(this.e20*1e7+.5|0)/1e7:(this.e20*1e7-.5|0)/1e7)+", "+(this.e21>0?(this.e21*1e7+.5|0)/1e7:(this.e21*1e7-.5|0)/1e7)+", "+(this.e22>0?(this.e22*1e7+.5|0)/1e7:(this.e22*1e7-.5|0)/1e7)+", "+(this.e23>0?(this.e23*1e7+.5|0)/1e7:(this.e23*1e7-.5|0)/1e7)+`,
    `+(this.e30>0?(this.e30*1e7+.5|0)/1e7:(this.e30*1e7-.5|0)/1e7)+", "+(this.e31>0?(this.e31*1e7+.5|0)/1e7:(this.e31*1e7-.5|0)/1e7)+", "+(this.e32>0?(this.e32*1e7+.5|0)/1e7:(this.e32*1e7-.5|0)/1e7)+", "+(this.e33>0?(this.e33*1e7+.5|0)/1e7:(this.e33*1e7-.5|0)/1e7)+"]"}};m.common.MathUtil=class{static abs(t){return t>0?t:-t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static tan(t){return Math.tan(t)}static asin(t){return Math.asin(t)}static acos(t){return Math.acos(t)}static atan(t){return Math.atan(t)}static safeAsin(t){return t<=-1?-1.570796326794895:t>=1?1.570796326794895:Math.asin(t)}static safeAcos(t){return t<=-1?3.14159265358979:t>=1?0:Math.acos(t)}static atan2(t,i){return Math.atan2(t,i)}static sqrt(t){return Math.sqrt(t)}static clamp(t,i,s){return t<i?i:t>s?s:t}static rand(){return Math.random()}static randIn(t,i){return t+Math.random()*(i-t)}static randVec3In(t,i){return new m.common.Vec3(t+Math.random()*(i-t),t+Math.random()*(i-t),t+Math.random()*(i-t))}static randVec3(){return new m.common.Vec3(-1+Math.random()*2,-1+Math.random()*2,-1+Math.random()*2)}};m.common.Pool=class{constructor(){this.stackVec3=new Array(256),this.sizeVec3=0,this.stackMat3=new Array(256),this.sizeMat3=0,this.stackMat4=new Array(256),this.sizeMat4=0,this.stackQuat=new Array(256),this.sizeQuat=0}vec3(){return this.sizeVec3==0?new m.common.Vec3:this.stackVec3[--this.sizeVec3]}mat3(){return this.sizeMat3==0?new m.common.Mat3:this.stackMat3[--this.sizeMat3]}mat4(){return this.sizeMat4==0?new m.common.Mat4:this.stackMat4[--this.sizeMat4]}quat(){return this.sizeQuat==0?new m.common.Quat:this.stackQuat[--this.sizeQuat]}dispose(t,i,s,o){if(t!=null){if(t.zero(),this.sizeVec3==this.stackVec3.length){let n=new Array(this.sizeVec3<<1),l=0,_=this.sizeVec3;for(;l<_;){let r=l++;n[r]=this.stackVec3[r],this.stackVec3[r]=null}this.stackVec3=n}this.stackVec3[this.sizeVec3++]=t}if(i!=null){if(i.e00=1,i.e01=0,i.e02=0,i.e10=0,i.e11=1,i.e12=0,i.e20=0,i.e21=0,i.e22=1,this.sizeMat3==this.stackMat3.length){let n=new Array(this.sizeMat3<<1),l=0,_=this.sizeMat3;for(;l<_;){let r=l++;n[r]=this.stackMat3[r],this.stackMat3[r]=null}this.stackMat3=n}this.stackMat3[this.sizeMat3++]=i}if(s!=null){if(s.e00=1,s.e01=0,s.e02=0,s.e03=0,s.e10=0,s.e11=1,s.e12=0,s.e13=0,s.e20=0,s.e21=0,s.e22=1,s.e23=0,s.e30=0,s.e31=0,s.e32=0,s.e33=1,this.sizeMat4==this.stackMat4.length){let n=new Array(this.sizeMat4<<1),l=0,_=this.sizeMat4;for(;l<_;){let r=l++;n[r]=this.stackMat4[r],this.stackMat4[r]=null}this.stackMat4=n}this.stackMat4[this.sizeMat4++]=s}if(o!=null){if(o.x=0,o.y=0,o.z=0,o.w=1,this.sizeQuat==this.stackQuat.length){let n=new Array(this.sizeQuat<<1),l=0,_=this.sizeQuat;for(;l<_;){let r=l++;n[r]=this.stackQuat[r],this.stackQuat[r]=null}this.stackQuat=n}this.stackQuat[this.sizeQuat++]=o}}disposeVec3(t){if(t.zero(),this.sizeVec3==this.stackVec3.length){let i=new Array(this.sizeVec3<<1),s=0,o=this.sizeVec3;for(;s<o;){let n=s++;i[n]=this.stackVec3[n],this.stackVec3[n]=null}this.stackVec3=i}this.stackVec3[this.sizeVec3++]=t}disposeMat3(t){if(t.e00=1,t.e01=0,t.e02=0,t.e10=0,t.e11=1,t.e12=0,t.e20=0,t.e21=0,t.e22=1,this.sizeMat3==this.stackMat3.length){let i=new Array(this.sizeMat3<<1),s=0,o=this.sizeMat3;for(;s<o;){let n=s++;i[n]=this.stackMat3[n],this.stackMat3[n]=null}this.stackMat3=i}this.stackMat3[this.sizeMat3++]=t}disposeMat4(t){if(t.e00=1,t.e01=0,t.e02=0,t.e03=0,t.e10=0,t.e11=1,t.e12=0,t.e13=0,t.e20=0,t.e21=0,t.e22=1,t.e23=0,t.e30=0,t.e31=0,t.e32=0,t.e33=1,this.sizeMat4==this.stackMat4.length){let i=new Array(this.sizeMat4<<1),s=0,o=this.sizeMat4;for(;s<o;){let n=s++;i[n]=this.stackMat4[n],this.stackMat4[n]=null}this.stackMat4=i}this.stackMat4[this.sizeMat4++]=t}disposeQuat(t){if(t.x=0,t.y=0,t.z=0,t.w=1,this.sizeQuat==this.stackQuat.length){let i=new Array(this.sizeQuat<<1),s=0,o=this.sizeQuat;for(;s<o;){let n=s++;i[n]=this.stackQuat[n],this.stackQuat[n]=null}this.stackQuat=i}this.stackQuat[this.sizeQuat++]=t}};m.common.Quat=class{constructor(t,i,s,o){o==null&&(o=1),s==null&&(s=0),i==null&&(i=0),t==null&&(t=0),this.x=t,this.y=i,this.z=s,this.w=o,m.common.Quat.numCreations++}identity(){return this.x=0,this.y=0,this.z=0,this.w=1,this}init(t,i,s,o){return this.x=t,this.y=i,this.z=s,this.w=o,this}add(t){return new m.common.Quat(this.x+t.x,this.y+t.y,this.z+t.z,this.w+t.w)}sub(t){return new m.common.Quat(this.x-t.x,this.y-t.y,this.z-t.z,this.w-t.w)}scale(t){return new m.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}addEq(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this}subEq(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this}scaleEq(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w}normalized(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),new m.common.Quat(this.x*t,this.y*t,this.z*t,this.w*t)}normalize(){let t=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return t>0&&(t=1/t),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this}setArc(t,i){let s=t.x,o=t.y,n=t.z,l=i.x,_=i.y,r=i.z,e=s*l+o*_+n*r;return this.w=Math.sqrt((1+e)*.5),this.w==0?(l=s*s,_=o*o,r=n*n,l<_?l<r?(e=1/Math.sqrt(_+r),this.x=0,this.y=n*e,this.z=-o*e):(e=1/Math.sqrt(l+_),this.z=0,this.x=o*e,this.y=-s*e):_<r?(e=1/Math.sqrt(r+l),this.y=0,this.z=s*e,this.x=-n*e):(e=1/Math.sqrt(l+_),this.z=0,this.x=o*e,this.y=-s*e),this):(e=.5/this.w,this.x=(o*r-n*_)*e,this.y=(n*l-s*r)*e,this.z=(s*_-o*l)*e,this)}slerp(t,i){let s,o,n,l,_=this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w;if(_<0?(_=-_,s=-t.x,o=-t.y,n=-t.z,l=-t.w):(s=t.x,o=t.y,n=t.z,l=t.w),_>.999999){let b=new m.common.Quat(this.x+(s-this.x)*i,this.y+(o-this.y)*i,this.z+(n-this.z)*i,this.w+(l-this.w)*i),X=Math.sqrt(b.x*b.x+b.y*b.y+b.z*b.z+b.w*b.w);return X>0&&(X=1/X),b.x*=X,b.y*=X,b.z*=X,b.w*=X,b}let r=i*Math.acos(_);s-=this.x*_,o-=this.y*_,n-=this.z*_,l-=this.w*_;let e=1/Math.sqrt(s*s+o*o+n*n+l*l);s*=e,o*=e,n*=e,l*=e;let a=Math.sin(r),h=Math.cos(r);return new m.common.Quat(this.x*h+s*a,this.y*h+o*a,this.z*h+n*a,this.w*h+l*a)}copyFrom(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this}clone(){return new m.common.Quat(this.x,this.y,this.z,this.w)}fromMat3(t){let i=t.e00,s=t.e11,o=t.e22,n=i+s+o,l;return n>0?(l=Math.sqrt(n+1),this.w=.5*l,l=.5/l,this.x=(t.e21-t.e12)*l,this.y=(t.e02-t.e20)*l,this.z=(t.e10-t.e01)*l):i>s?i>o?(l=Math.sqrt(i-s-o+1),this.x=.5*l,l=.5/l,this.y=(t.e01+t.e10)*l,this.z=(t.e02+t.e20)*l,this.w=(t.e21-t.e12)*l):(l=Math.sqrt(o-i-s+1),this.z=.5*l,l=.5/l,this.x=(t.e02+t.e20)*l,this.y=(t.e12+t.e21)*l,this.w=(t.e10-t.e01)*l):s>o?(l=Math.sqrt(s-o-i+1),this.y=.5*l,l=.5/l,this.x=(t.e01+t.e10)*l,this.z=(t.e12+t.e21)*l,this.w=(t.e02-t.e20)*l):(l=Math.sqrt(o-i-s+1),this.z=.5*l,l=.5/l,this.x=(t.e02+t.e20)*l,this.y=(t.e12+t.e21)*l,this.w=(t.e10-t.e01)*l),this}toMat3(){let t=new m.common.Mat3,i=this.x,s=this.y,o=this.z,n=this.w,l=2*i,_=2*s,r=2*o,e=i*l,a=s*_,h=o*r,b=i*_,X=s*r,c=i*r,Y=n*l,p=n*_,x=n*r;return t.e00=1-a-h,t.e01=b-x,t.e02=c+p,t.e10=b+x,t.e11=1-e-h,t.e12=X-Y,t.e20=c-p,t.e21=X+Y,t.e22=1-e-a,t}toString(){return"Quat["+(this.x>0?(this.x*1e7+.5|0)/1e7:(this.x*1e7-.5|0)/1e7)+` i,
    `+(this.y>0?(this.y*1e7+.5|0)/1e7:(this.y*1e7-.5|0)/1e7)+` j,
    `+(this.z>0?(this.z*1e7+.5|0)/1e7:(this.z*1e7-.5|0)/1e7)+` k,
    `+(this.w>0?(this.w*1e7+.5|0)/1e7:(this.w*1e7-.5|0)/1e7)+"]"}};m.dynamics||(m.dynamics={});m.dynamics.Contact=class{constructor(){this._next=null,this._prev=null,this._link1=new m.dynamics.ContactLink,this._link2=new m.dynamics.ContactLink,this._s1=null,this._s2=null,this._b1=null,this._b2=null,this._detector=null,this._cachedDetectorData=new m.collision.narrowphase.detector.CachedDetectorData,this._detectorResult=new m.collision.narrowphase.DetectorResult,this._latest=!1,this._shouldBeSkipped=!1,this._manifold=new m.dynamics.constraint.contact.Manifold,this._updater=new m.dynamics.constraint.contact.ManifoldUpdater(this._manifold),this._contactConstraint=new m.dynamics.constraint.contact.ContactConstraint(this._manifold),this._touching=!1}_updateManifold(){if(this._detector==null)return;let t=this._touching,i=this._detectorResult;if(this._detector.detect(i,this._s1._geom,this._s2._geom,this._s1._transform,this._s2._transform,this._cachedDetectorData),this._touching=i.numPoints>0,this._touching?(this._manifold._buildBasis(i.normal),i.getMaxDepth()>m.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold?this._contactConstraint._positionCorrectionAlgorithm=m.common.Setting.alternativeContactPositionCorrectionAlgorithm:this._contactConstraint._positionCorrectionAlgorithm=m.common.Setting.defaultContactPositionCorrectionAlgorithm,i.incremental?this._updater.incrementalUpdate(i,this._b1._transform,this._b2._transform):this._updater.totalUpdate(i,this._b1._transform,this._b2._transform)):this._manifold._clear(),this._touching&&!t){let s=this._s1._contactCallback,o=this._s2._contactCallback;s==o&&(o=null),s!=null&&s.beginContact(this),o!=null&&o.beginContact(this)}if(!this._touching&&t){let s=this._s1._contactCallback,o=this._s2._contactCallback;s==o&&(o=null),s!=null&&s.endContact(this),o!=null&&o.endContact(this)}if(this._touching){let s=this._s1._contactCallback,o=this._s2._contactCallback;s==o&&(o=null),s!=null&&s.preSolve(this),o!=null&&o.preSolve(this)}}_postSolve(){let t=this._s1._contactCallback,i=this._s2._contactCallback;t==i&&(i=null),t!=null&&t.postSolve(this),i!=null&&i.postSolve(this)}getShape1(){return this._s1}getShape2(){return this._s2}isTouching(){return this._touching}getManifold(){return this._manifold}getContactConstraint(){return this._contactConstraint}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.ContactLink=class{constructor(){this._prev=null,this._next=null,this._contact=null,this._other=null}getContact(){return this._contact}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.ContactManager=class{constructor(t){this._broadPhase=t,this._collisionMatrix=new m.collision.narrowphase.CollisionMatrix,this._numContacts=0}createContacts(){let t=this._broadPhase._proxyPairList;for(;t!=null;){let i=t._next;for(;;){let s,o;if(t._p1._id<t._p2._id?(s=t._p1.userData,o=t._p2.userData):(s=t._p2.userData,o=t._p1.userData),!this.shouldCollide(s,o))break;let n=s._rigidBody,l=o._rigidBody,_;n._numContactLinks<l._numContactLinks?_=n._contactLinkList:_=l._contactLinkList;let r=s._id,e=o._id,a=!1;for(;_!=null;){let h=_._contact;if(h._s1._id==r&&h._s2._id==e){h._latest=!0,a=!0;break}_=_._next}if(!a){let h=this._contactPool;h!=null?(this._contactPool=h._next,h._next=null):h=new m.dynamics.Contact;let b=h;this._contactList==null?(this._contactList=b,this._contactListLast=b):(this._contactListLast._next=b,b._prev=this._contactListLast,this._contactListLast=b),b._latest=!0;let X=this._collisionMatrix.detectors[s._geom._type][o._geom._type];b._s1=s,b._s2=o,b._b1=s._rigidBody,b._b2=o._rigidBody,b._touching=!1,b._b1._contactLinkList==null?(b._b1._contactLinkList=b._link1,b._b1._contactLinkListLast=b._link1):(b._b1._contactLinkListLast._next=b._link1,b._link1._prev=b._b1._contactLinkListLast,b._b1._contactLinkListLast=b._link1),b._b2._contactLinkList==null?(b._b2._contactLinkList=b._link2,b._b2._contactLinkListLast=b._link2):(b._b2._contactLinkListLast._next=b._link2,b._link2._prev=b._b2._contactLinkListLast,b._b2._contactLinkListLast=b._link2),b._b1._numContactLinks++,b._b2._numContactLinks++,b._link1._other=b._b2,b._link2._other=b._b1,b._link1._contact=b,b._link2._contact=b,b._detector=X;let c=b._contactConstraint;c._s1=s,c._s2=o,c._b1=c._s1._rigidBody,c._b2=c._s2._rigidBody,c._tf1=c._b1._transform,c._tf2=c._b2._transform,this._numContacts++}break}t=i}}destroyOutdatedContacts(){let t=this._broadPhase._incremental,i=this._contactList;for(;i!=null;){let s=i._next;for(;;){if(i._latest){i._latest=!1,i._shouldBeSkipped=!1;break}if(!t){let b=i._prev,X=i._next;if(b!=null&&(b._next=X),X!=null&&(X._prev=b),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let f=i._s1._contactCallback,Z=i._s2._contactCallback;f==Z&&(Z=null),f!=null&&f.endContact(i),Z!=null&&Z.endContact(i)}let c=i._link1._prev,Y=i._link1._next;c!=null&&(c._next=Y),Y!=null&&(Y._prev=c),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let p=i._link2._prev,x=i._link2._next;p!=null&&(p._next=x),x!=null&&(x._prev=p),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let v=i._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}let o=i._s1,n=i._s2,l=o._rigidBody,_=n._rigidBody;if(!(!l._sleeping&&l._type!=1)&&!(!_._sleeping&&_._type!=1)){i._shouldBeSkipped=!0;break}let r=o._aabb,e=n._aabb,a=o._proxy,h=n._proxy;if(!(a._aabbMinX<h._aabbMaxX&&a._aabbMaxX>h._aabbMinX&&a._aabbMinY<h._aabbMaxY&&a._aabbMaxY>h._aabbMinY&&a._aabbMinZ<h._aabbMaxZ&&a._aabbMaxZ>h._aabbMinZ)||!this.shouldCollide(o,n)){let b=i._prev,X=i._next;if(b!=null&&(b._next=X),X!=null&&(X._prev=b),i==this._contactList&&(this._contactList=this._contactList._next),i==this._contactListLast&&(this._contactListLast=this._contactListLast._prev),i._next=null,i._prev=null,i._touching){let f=i._s1._contactCallback,Z=i._s2._contactCallback;f==Z&&(Z=null),f!=null&&f.endContact(i),Z!=null&&Z.endContact(i)}let c=i._link1._prev,Y=i._link1._next;c!=null&&(c._next=Y),Y!=null&&(Y._prev=c),i._link1==i._b1._contactLinkList&&(i._b1._contactLinkList=i._b1._contactLinkList._next),i._link1==i._b1._contactLinkListLast&&(i._b1._contactLinkListLast=i._b1._contactLinkListLast._prev),i._link1._next=null,i._link1._prev=null;let p=i._link2._prev,x=i._link2._next;p!=null&&(p._next=x),x!=null&&(x._prev=p),i._link2==i._b2._contactLinkList&&(i._b2._contactLinkList=i._b2._contactLinkList._next),i._link2==i._b2._contactLinkListLast&&(i._b2._contactLinkListLast=i._b2._contactLinkListLast._prev),i._link2._next=null,i._link2._prev=null,i._b1._numContactLinks--,i._b2._numContactLinks--,i._link1._other=null,i._link2._other=null,i._link1._contact=null,i._link2._contact=null,i._s1=null,i._s2=null,i._b1=null,i._b2=null,i._touching=!1,i._cachedDetectorData._clear(),i._manifold._clear(),i._detector=null;let v=i._contactConstraint;v._s1=null,v._s2=null,v._b1=null,v._b2=null,v._tf1=null,v._tf2=null,i._next=this._contactPool,this._contactPool=i,this._numContacts--;break}i._shouldBeSkipped=!(r._minX<e._maxX&&r._maxX>e._minX&&r._minY<e._maxY&&r._maxY>e._minY&&r._minZ<e._maxZ&&r._maxZ>e._minZ);break}i=s}}shouldCollide(t,i){let s=t._rigidBody,o=i._rigidBody;if(s==o||s._type!=0&&o._type!=0||!(t._collisionGroup&i._collisionMask)||!(i._collisionGroup&t._collisionMask))return!1;let n,l;for(s._numJointLinks<o._numJointLinks?(n=s._jointLinkList,l=o):(n=o._jointLinkList,l=s);n!=null;){if(n._other==l&&!n._joint._allowCollision)return!1;n=n._next}return!0}_updateContacts(){this._broadPhase.collectPairs(),this.createContacts(),this.destroyOutdatedContacts()}_postSolve(){let t=this._contactList;for(;t!=null;){let i=t._next;t._touching&&t._postSolve(),t=i}}getNumContacts(){return this._numContacts}getContactList(){return this._contactList}};m.dynamics.Island=class{constructor(){this.rigidBodies=new Array(m.common.Setting.islandInitialRigidBodyArraySize),this.solvers=new Array(m.common.Setting.islandInitialConstraintArraySize),this.solversSi=new Array(m.common.Setting.islandInitialConstraintArraySize),this.solversNgs=new Array(m.common.Setting.islandInitialConstraintArraySize),this.numRigidBodies=0,this.numSolvers=0,this.numSolversSi=0,this.numSolversNgs=0}_clear(){for(;this.numRigidBodies>0;)this.rigidBodies[--this.numRigidBodies]=null;for(;this.numSolvers>0;)this.solvers[--this.numSolvers]=null;for(;this.numSolversSi>0;)this.solversSi[--this.numSolversSi]=null;for(;this.numSolversNgs>0;)this.solversNgs[--this.numSolversNgs]=null}_addRigidBody(t){if(this.numRigidBodies==this.rigidBodies.length){let i=new Array(this.numRigidBodies<<1),s=0,o=this.numRigidBodies;for(;s<o;){let n=s++;i[n]=this.rigidBodies[n],this.rigidBodies[n]=null}this.rigidBodies=i}t._addedToIsland=!0,this.rigidBodies[this.numRigidBodies++]=t}_addConstraintSolver(t,i){if(this.numSolvers==this.solvers.length){let s=new Array(this.numSolvers<<1),o=0,n=this.numSolvers;for(;o<n;){let l=o++;s[l]=this.solvers[l],this.solvers[l]=null}this.solvers=s}if(t._addedToIsland=!0,this.solvers[this.numSolvers++]=t,i==m.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE){if(this.numSolversSi==this.solversSi.length){let s=new Array(this.numSolversSi<<1),o=0,n=this.numSolversSi;for(;o<n;){let l=o++;s[l]=this.solversSi[l],this.solversSi[l]=null}this.solversSi=s}this.solversSi[this.numSolversSi++]=t}if(i==m.dynamics.constraint.PositionCorrectionAlgorithm.NGS){if(this.numSolversNgs==this.solversNgs.length){let s=new Array(this.numSolversNgs<<1),o=0,n=this.numSolversNgs;for(;o<n;){let l=o++;s[l]=this.solversNgs[l],this.solversNgs[l]=null}this.solversNgs=s}this.solversNgs[this.numSolversNgs++]=t}}_stepSingleRigidBody(t,i){let s=t.dt,o=i._ptransform,n=i._transform;if(o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22,i._linearContactImpulseX=0,i._linearContactImpulseY=0,i._linearContactImpulseZ=0,i._angularContactImpulseX=0,i._angularContactImpulseY=0,i._angularContactImpulseZ=0,i._autoSleep&&i._velX*i._velX+i._velY*i._velY+i._velZ*i._velZ<m.common.Setting.sleepingVelocityThreshold*m.common.Setting.sleepingVelocityThreshold&&i._angVelX*i._angVelX+i._angVelY*i._angVelY+i._angVelZ*i._angVelZ<m.common.Setting.sleepingAngularVelocityThreshold*m.common.Setting.sleepingAngularVelocityThreshold?(i._sleepTime+=s,i._sleepTime>m.common.Setting.sleepingTimeThreshold&&(i._sleeping=!0,i._sleepTime=0)):i._sleepTime=0,!i._sleeping){if(i._type==0){let _=s*i._linearDamping,r=_*_,e=1/(1+_+r*(.5+_*.16666666666666666+r*.041666666666666664)),a=s*i._angularDamping,h=a*a,b=1/(1+a+h*(.5+a*.16666666666666666+h*.041666666666666664)),X,c,Y,p,x,v;X=this.gravityX*i._gravityScale,c=this.gravityY*i._gravityScale,Y=this.gravityZ*i._gravityScale,X+=i._forceX*i._invMass,c+=i._forceY*i._invMass,Y+=i._forceZ*i._invMass;let f,Z,k;f=i._invInertia00*i._torqueX+i._invInertia01*i._torqueY+i._invInertia02*i._torqueZ,Z=i._invInertia10*i._torqueX+i._invInertia11*i._torqueY+i._invInertia12*i._torqueZ,k=i._invInertia20*i._torqueX+i._invInertia21*i._torqueY+i._invInertia22*i._torqueZ,p=f,x=Z,v=k,i._velX+=X*s,i._velY+=c*s,i._velZ+=Y*s,i._velX*=e,i._velY*=e,i._velZ*=e,i._angVelX+=p*s,i._angVelY+=x*s,i._angVelZ+=v*s,i._angVelX*=b,i._angVelY*=b,i._angVelZ*=b}i._integrate(s);let l=i._shapeList;for(;l!=null;){let _=l._next,r=i._ptransform,e=i._transform,a=l._ptransform,h=l._localTransform,b,X,c,Y,p,x,v,f,Z;b=r._rotation00*h._rotation00+r._rotation01*h._rotation10+r._rotation02*h._rotation20,X=r._rotation00*h._rotation01+r._rotation01*h._rotation11+r._rotation02*h._rotation21,c=r._rotation00*h._rotation02+r._rotation01*h._rotation12+r._rotation02*h._rotation22,Y=r._rotation10*h._rotation00+r._rotation11*h._rotation10+r._rotation12*h._rotation20,p=r._rotation10*h._rotation01+r._rotation11*h._rotation11+r._rotation12*h._rotation21,x=r._rotation10*h._rotation02+r._rotation11*h._rotation12+r._rotation12*h._rotation22,v=r._rotation20*h._rotation00+r._rotation21*h._rotation10+r._rotation22*h._rotation20,f=r._rotation20*h._rotation01+r._rotation21*h._rotation11+r._rotation22*h._rotation21,Z=r._rotation20*h._rotation02+r._rotation21*h._rotation12+r._rotation22*h._rotation22,a._rotation00=b,a._rotation01=X,a._rotation02=c,a._rotation10=Y,a._rotation11=p,a._rotation12=x,a._rotation20=v,a._rotation21=f,a._rotation22=Z;let k,g,I;k=r._rotation00*h._positionX+r._rotation01*h._positionY+r._rotation02*h._positionZ,g=r._rotation10*h._positionX+r._rotation11*h._positionY+r._rotation12*h._positionZ,I=r._rotation20*h._positionX+r._rotation21*h._positionY+r._rotation22*h._positionZ,a._positionX=k,a._positionY=g,a._positionZ=I,a._positionX+=r._positionX,a._positionY+=r._positionY,a._positionZ+=r._positionZ;let z=l._transform,d=l._localTransform,u,B,j,L,V,M,w,P,E;u=e._rotation00*d._rotation00+e._rotation01*d._rotation10+e._rotation02*d._rotation20,B=e._rotation00*d._rotation01+e._rotation01*d._rotation11+e._rotation02*d._rotation21,j=e._rotation00*d._rotation02+e._rotation01*d._rotation12+e._rotation02*d._rotation22,L=e._rotation10*d._rotation00+e._rotation11*d._rotation10+e._rotation12*d._rotation20,V=e._rotation10*d._rotation01+e._rotation11*d._rotation11+e._rotation12*d._rotation21,M=e._rotation10*d._rotation02+e._rotation11*d._rotation12+e._rotation12*d._rotation22,w=e._rotation20*d._rotation00+e._rotation21*d._rotation10+e._rotation22*d._rotation20,P=e._rotation20*d._rotation01+e._rotation21*d._rotation11+e._rotation22*d._rotation21,E=e._rotation20*d._rotation02+e._rotation21*d._rotation12+e._rotation22*d._rotation22,z._rotation00=u,z._rotation01=B,z._rotation02=j,z._rotation10=L,z._rotation11=V,z._rotation12=M,z._rotation20=w,z._rotation21=P,z._rotation22=E;let C,S,A;C=e._rotation00*d._positionX+e._rotation01*d._positionY+e._rotation02*d._positionZ,S=e._rotation10*d._positionX+e._rotation11*d._positionY+e._rotation12*d._positionZ,A=e._rotation20*d._positionX+e._rotation21*d._positionY+e._rotation22*d._positionZ,z._positionX=C,z._positionY=S,z._positionZ=A,z._positionX+=e._positionX,z._positionY+=e._positionY,z._positionZ+=e._positionZ;let R,H,y,D,F,Q;if(l._geom._computeAabb(l._aabb,l._ptransform),R=l._aabb._minX,H=l._aabb._minY,y=l._aabb._minZ,D=l._aabb._maxX,F=l._aabb._maxY,Q=l._aabb._maxZ,l._geom._computeAabb(l._aabb,l._transform),l._aabb._minX=R<l._aabb._minX?R:l._aabb._minX,l._aabb._minY=H<l._aabb._minY?H:l._aabb._minY,l._aabb._minZ=y<l._aabb._minZ?y:l._aabb._minZ,l._aabb._maxX=D>l._aabb._maxX?D:l._aabb._maxX,l._aabb._maxY=F>l._aabb._maxY?F:l._aabb._maxY,l._aabb._maxZ=Q>l._aabb._maxZ?Q:l._aabb._maxZ,l._proxy!=null){let W,q,U;W=l._transform._positionX-l._ptransform._positionX,q=l._transform._positionY-l._ptransform._positionY,U=l._transform._positionZ-l._ptransform._positionZ;let G=l.displacement;G.x=W,G.y=q,G.z=U,l._rigidBody._world._broadPhase.moveProxy(l._proxy,l._aabb,l.displacement)}l=_}}}_step(t,i,s){let o=t.dt,n=!0,l=0,_=this.numRigidBodies;for(;l<_;){let L=this.rigidBodies[l++],V=L._ptransform,M=L._transform;if(V._positionX=M._positionX,V._positionY=M._positionY,V._positionZ=M._positionZ,V._rotation00=M._rotation00,V._rotation01=M._rotation01,V._rotation02=M._rotation02,V._rotation10=M._rotation10,V._rotation11=M._rotation11,V._rotation12=M._rotation12,V._rotation20=M._rotation20,V._rotation21=M._rotation21,V._rotation22=M._rotation22,L._linearContactImpulseX=0,L._linearContactImpulseY=0,L._linearContactImpulseZ=0,L._angularContactImpulseX=0,L._angularContactImpulseY=0,L._angularContactImpulseZ=0,L._sleeping=!1,L._autoSleep&&L._velX*L._velX+L._velY*L._velY+L._velZ*L._velZ<m.common.Setting.sleepingVelocityThreshold*m.common.Setting.sleepingVelocityThreshold&&L._angVelX*L._angVelX+L._angVelY*L._angVelY+L._angVelZ*L._angVelZ<m.common.Setting.sleepingAngularVelocityThreshold*m.common.Setting.sleepingAngularVelocityThreshold?L._sleepTime+=o:L._sleepTime=0,L._sleepTime<m.common.Setting.sleepingTimeThreshold&&(n=!1),L._type==0){let w=o*L._linearDamping,P=w*w,E=1/(1+w+P*(.5+w*.16666666666666666+P*.041666666666666664)),C=o*L._angularDamping,S=C*C,A=1/(1+C+S*(.5+C*.16666666666666666+S*.041666666666666664)),R,H,y,D,F,Q;R=this.gravityX*L._gravityScale,H=this.gravityY*L._gravityScale,y=this.gravityZ*L._gravityScale,R+=L._forceX*L._invMass,H+=L._forceY*L._invMass,y+=L._forceZ*L._invMass;let W,q,U;W=L._invInertia00*L._torqueX+L._invInertia01*L._torqueY+L._invInertia02*L._torqueZ,q=L._invInertia10*L._torqueX+L._invInertia11*L._torqueY+L._invInertia12*L._torqueZ,U=L._invInertia20*L._torqueX+L._invInertia21*L._torqueY+L._invInertia22*L._torqueZ,D=W,F=q,Q=U,L._velX+=R*o,L._velY+=H*o,L._velZ+=y*o,L._velX*=E,L._velY*=E,L._velZ*=E,L._angVelX+=D*o,L._angVelY+=F*o,L._angVelZ+=Q*o,L._angVelX*=A,L._angVelY*=A,L._angVelZ*=A}}if(n){let L=0,V=this.numRigidBodies;for(;L<V;){let M=this.rigidBodies[L++];M._sleeping=!0,M._sleepTime=0}return}let r=0,e=this.numSolvers;for(;r<e;)this.solvers[r++].preSolveVelocity(t);let a=0,h=this.numSolvers;for(;a<h;)this.solvers[a++].warmStart(t);let b=0;for(;b<i;){++b;let L=0,V=this.numSolvers;for(;L<V;)this.solvers[L++].solveVelocity()}let X=0,c=this.numSolvers;for(;X<c;)this.solvers[X++].postSolveVelocity(t);let Y=0,p=this.numRigidBodies;for(;Y<p;)this.rigidBodies[Y++]._integrate(o);let x=0,v=this.numSolversSi;for(;x<v;)this.solversSi[x++].preSolvePosition(t);let f=0;for(;f<s;){++f;let L=0,V=this.numSolversSi;for(;L<V;)this.solversSi[L++].solvePositionSplitImpulse()}let Z=0,k=this.numRigidBodies;for(;Z<k;)this.rigidBodies[Z++]._integratePseudoVelocity();let g=0,I=this.numSolversNgs;for(;g<I;)this.solversNgs[g++].preSolvePosition(t);let z=0;for(;z<s;){++z;let L=0,V=this.numSolversNgs;for(;L<V;)this.solversNgs[L++].solvePositionNgs(t)}let d=0,u=this.numSolvers;for(;d<u;)this.solvers[d++].postSolve();let B=0,j=this.numRigidBodies;for(;B<j;){let L=this.rigidBodies[B++],V=L._shapeList;for(;V!=null;){let M=V._next,w=L._ptransform,P=L._transform,E=V._ptransform,C=V._localTransform,S,A,R,H,y,D,F,Q,W;S=w._rotation00*C._rotation00+w._rotation01*C._rotation10+w._rotation02*C._rotation20,A=w._rotation00*C._rotation01+w._rotation01*C._rotation11+w._rotation02*C._rotation21,R=w._rotation00*C._rotation02+w._rotation01*C._rotation12+w._rotation02*C._rotation22,H=w._rotation10*C._rotation00+w._rotation11*C._rotation10+w._rotation12*C._rotation20,y=w._rotation10*C._rotation01+w._rotation11*C._rotation11+w._rotation12*C._rotation21,D=w._rotation10*C._rotation02+w._rotation11*C._rotation12+w._rotation12*C._rotation22,F=w._rotation20*C._rotation00+w._rotation21*C._rotation10+w._rotation22*C._rotation20,Q=w._rotation20*C._rotation01+w._rotation21*C._rotation11+w._rotation22*C._rotation21,W=w._rotation20*C._rotation02+w._rotation21*C._rotation12+w._rotation22*C._rotation22,E._rotation00=S,E._rotation01=A,E._rotation02=R,E._rotation10=H,E._rotation11=y,E._rotation12=D,E._rotation20=F,E._rotation21=Q,E._rotation22=W;let q,U,G;q=w._rotation00*C._positionX+w._rotation01*C._positionY+w._rotation02*C._positionZ,U=w._rotation10*C._positionX+w._rotation11*C._positionY+w._rotation12*C._positionZ,G=w._rotation20*C._positionX+w._rotation21*C._positionY+w._rotation22*C._positionZ,E._positionX=q,E._positionY=U,E._positionZ=G,E._positionX+=w._positionX,E._positionY+=w._positionY,E._positionZ+=w._positionZ;let J=V._transform,N=V._localTransform,K,O,$,et,st,lt,rt,at,ot;K=P._rotation00*N._rotation00+P._rotation01*N._rotation10+P._rotation02*N._rotation20,O=P._rotation00*N._rotation01+P._rotation01*N._rotation11+P._rotation02*N._rotation21,$=P._rotation00*N._rotation02+P._rotation01*N._rotation12+P._rotation02*N._rotation22,et=P._rotation10*N._rotation00+P._rotation11*N._rotation10+P._rotation12*N._rotation20,st=P._rotation10*N._rotation01+P._rotation11*N._rotation11+P._rotation12*N._rotation21,lt=P._rotation10*N._rotation02+P._rotation11*N._rotation12+P._rotation12*N._rotation22,rt=P._rotation20*N._rotation00+P._rotation21*N._rotation10+P._rotation22*N._rotation20,at=P._rotation20*N._rotation01+P._rotation21*N._rotation11+P._rotation22*N._rotation21,ot=P._rotation20*N._rotation02+P._rotation21*N._rotation12+P._rotation22*N._rotation22,J._rotation00=K,J._rotation01=O,J._rotation02=$,J._rotation10=et,J._rotation11=st,J._rotation12=lt,J._rotation20=rt,J._rotation21=at,J._rotation22=ot;let ht,_t,bt;ht=P._rotation00*N._positionX+P._rotation01*N._positionY+P._rotation02*N._positionZ,_t=P._rotation10*N._positionX+P._rotation11*N._positionY+P._rotation12*N._positionZ,bt=P._rotation20*N._positionX+P._rotation21*N._positionY+P._rotation22*N._positionZ,J._positionX=ht,J._positionY=_t,J._positionZ=bt,J._positionX+=P._positionX,J._positionY+=P._positionY,J._positionZ+=P._positionZ;let Xt,ft,Zt,xt,zt,Yt;if(V._geom._computeAabb(V._aabb,V._ptransform),Xt=V._aabb._minX,ft=V._aabb._minY,Zt=V._aabb._minZ,xt=V._aabb._maxX,zt=V._aabb._maxY,Yt=V._aabb._maxZ,V._geom._computeAabb(V._aabb,V._transform),V._aabb._minX=Xt<V._aabb._minX?Xt:V._aabb._minX,V._aabb._minY=ft<V._aabb._minY?ft:V._aabb._minY,V._aabb._minZ=Zt<V._aabb._minZ?Zt:V._aabb._minZ,V._aabb._maxX=xt>V._aabb._maxX?xt:V._aabb._maxX,V._aabb._maxY=zt>V._aabb._maxY?zt:V._aabb._maxY,V._aabb._maxZ=Yt>V._aabb._maxZ?Yt:V._aabb._maxZ,V._proxy!=null){let pt,ct,nt;pt=V._transform._positionX-V._ptransform._positionX,ct=V._transform._positionY-V._ptransform._positionY,nt=V._transform._positionZ-V._ptransform._positionZ;let tt=V.displacement;tt.x=pt,tt.y=ct,tt.z=nt,V._rigidBody._world._broadPhase.moveProxy(V._proxy,V._aabb,V.displacement)}V=M}}}};m.dynamics.TimeStep=class{constructor(){this.dt=0,this.invDt=0,this.dtRatio=1}};m.dynamics.World=class{constructor(t,i){switch(t==null&&(t=2),t){case 1:this._broadPhase=new m.collision.broadphase.bruteforce.BruteForceBroadPhase;break;case 2:this._broadPhase=new m.collision.broadphase.bvh.BvhBroadPhase;break}this._contactManager=new m.dynamics.ContactManager(this._broadPhase),i==null&&(i=new m.common.Vec3(0,-9.80665,0)),this._gravity=new m.common.Vec3(i.x,i.y,i.z),this._rigidBodyList=null,this._rigidBodyListLast=null,this._jointList=null,this._jointListLast=null,this._numRigidBodies=0,this._numShapes=0,this._numJoints=0,this._numIslands=0,this._numVelocityIterations=10,this._numPositionIterations=5,this._rayCastWrapper=new m.dynamics._World.RayCastWrapper,this._convexCastWrapper=new m.dynamics._World.ConvexCastWrapper,this._aabbTestWrapper=new m.dynamics._World.AabbTestWrapper,this._island=new m.dynamics.Island,this._solversInIslands=new Array(m.common.Setting.islandInitialConstraintArraySize),this._rigidBodyStack=new Array(m.common.Setting.islandInitialRigidBodyArraySize),this._timeStep=new m.dynamics.TimeStep,this._pool=new m.common.Pool,this._shapeIdCount=0}_updateContacts(){let t=Date.now()/1e3;this._contactManager._updateContacts(),m.dynamics.common.Performance.broadPhaseCollisionTime=(Date.now()/1e3-t)*1e3;let i=Date.now()/1e3,s=this._contactManager._contactList;for(;s!=null;){let o=s._next;s._shouldBeSkipped||s._updateManifold(),s=o}m.dynamics.common.Performance.narrowPhaseCollisionTime=(Date.now()/1e3-i)*1e3}_solveIslands(){let t=Date.now()/1e3;if(m.common.Setting.disableSleeping){let n=this._rigidBodyList;for(;n!=null;)n._sleeping=!1,n._sleepTime=0,n=n._next}if(this._rigidBodyStack.length<this._numRigidBodies){let n=this._rigidBodyStack.length<<1;for(;n<this._numRigidBodies;)n<<=1;this._rigidBodyStack=new Array(n)}this._numIslands=0;let i=this._island,s=this._gravity;i.gravityX=s.x,i.gravityY=s.y,i.gravityZ=s.z;let o=this._rigidBodyList;for(this._numSolversInIslands=0;o!=null;){let n=o._next;for(;!(o._addedToIsland||o._sleeping||o._type==1);){if(o._numContactLinks==0&&o._numJointLinks==0){this._island._stepSingleRigidBody(this._timeStep,o),this._numIslands++;break}this.buildIsland(o),this._island._step(this._timeStep,this._numVelocityIterations,this._numPositionIterations),this._island._clear(),this._numIslands++;break}o=n}for(this._contactManager._postSolve(),o=this._rigidBodyList;o!=null;)o._addedToIsland=!1,o=o._next;for(o=this._rigidBodyList;o!=null;)o._forceX=0,o._forceY=0,o._forceZ=0,o._torqueX=0,o._torqueY=0,o._torqueZ=0,o=o._next;for(;this._numSolversInIslands>0;)this._solversInIslands[--this._numSolversInIslands]._addedToIsland=!1,this._solversInIslands[this._numSolversInIslands]=null;m.dynamics.common.Performance.dynamicsTime=(Date.now()/1e3-t)*1e3}buildIsland(t){let i=1;for(this._island._addRigidBody(t),this._rigidBodyStack[0]=t;i>0;){let s=this._rigidBodyStack[--i];if(this._rigidBodyStack[i]=null,s._type==1)continue;let o=s._contactLinkList;for(;o!=null;){let l=o._next,_=o._contact._contactConstraint,r=o._contact._contactConstraint._solver;if(_.isTouching()&&!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let a=new Array(this._numSolversInIslands<<1),h=0,b=this._numSolversInIslands;for(;h<b;){let X=h++;a[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=a}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,_._positionCorrectionAlgorithm);let e=o._other;e._addedToIsland||(this._island._addRigidBody(e),this._rigidBodyStack[i++]=e)}o=l}let n=s._jointLinkList;for(;n!=null;){let l=n._next,_=n._joint,r=_._solver;if(!r._addedToIsland){if(this._solversInIslands.length==this._numSolversInIslands){let a=new Array(this._numSolversInIslands<<1),h=0,b=this._numSolversInIslands;for(;h<b;){let X=h++;a[X]=this._solversInIslands[X],this._solversInIslands[X]=null}this._solversInIslands=a}this._solversInIslands[this._numSolversInIslands++]=r,this._island._addConstraintSolver(r,_._positionCorrectionAlgorithm);let e=n._other;e._addedToIsland||(this._island._addRigidBody(e),this._rigidBodyStack[i++]=e)}n=l}}}_drawBvh(t,i){t.drawBvh&&this._drawBvhNode(t,i._root,0,t.style.bvhNodeColor)}_drawBvhNode(t,i,s,o){if(i!=null){if(s>=t.drawBvhMinLevel&&s<=t.drawBvhMaxLevel){let n=this._pool,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],_=this._pool,r=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],e=l;e.x=i._aabbMinX,e.y=i._aabbMinY,e.z=i._aabbMinZ;let a=r;a.x=i._aabbMaxX,a.y=i._aabbMaxY,a.z=i._aabbMaxZ,t.aabb(l,r,o);let h=this._pool;if(l!=null){if(l.zero(),h.sizeVec3==h.stackVec3.length){let X=new Array(h.sizeVec3<<1),c=0,Y=h.sizeVec3;for(;c<Y;){let p=c++;X[p]=h.stackVec3[p],h.stackVec3[p]=null}h.stackVec3=X}h.stackVec3[h.sizeVec3++]=l}let b=this._pool;if(r!=null){if(r.zero(),b.sizeVec3==b.stackVec3.length){let X=new Array(b.sizeVec3<<1),c=0,Y=b.sizeVec3;for(;c<Y;){let p=c++;X[p]=b.stackVec3[p],b.stackVec3[p]=null}b.stackVec3=X}b.stackVec3[b.sizeVec3++]=r}}this._drawBvhNode(t,i._children[0],s+1,o),this._drawBvhNode(t,i._children[1],s+1,o)}}_drawRigidBodies(t){let i=t.style,s=this._rigidBodyList;for(;s!=null;){let o=s._next;if(t.drawBases){let r=t.style;t.basis(s._transform,r.basisLength,r.basisColorX,r.basisColorY,r.basisColorZ)}let n=null,l=s._type==0;l||(n=s._type==2?i.kinematicShapeColor:i.staticShapeColor);let _=s._shapeList;for(;_!=null;){let r=_._next;if(l&&(_._id&1?n=s._sleeping?i.sleepingShapeColor2:s._sleepTime>m.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor2:i.shapeColor2:n=s._sleeping?i.sleepingShapeColor1:s._sleepTime>m.common.Setting.sleepingTimeThreshold?i.sleepyShapeColor1:i.shapeColor1),t.drawShapes){let e=_._geom,a=_._transform;switch(e._type){case 0:t.sphere(a,e._radius,n);break;case 1:let h=e,b=this._pool,X=b.sizeVec3==0?new m.common.Vec3:b.stackVec3[--b.sizeVec3],c=X;c.x=h._halfExtentsX,c.y=h._halfExtentsY,c.z=h._halfExtentsZ,t.box(a,X,n);let Y=this._pool;if(X!=null){if(X.zero(),Y.sizeVec3==Y.stackVec3.length){let J=new Array(Y.sizeVec3<<1),N=0,K=Y.sizeVec3;for(;N<K;){let O=N++;J[O]=Y.stackVec3[O],Y.stackVec3[O]=null}Y.stackVec3=J}Y.stackVec3[Y.sizeVec3++]=X}break;case 2:let p=e;t.cylinder(a,p._radius,p._halfHeight,n);break;case 3:let x=e;t.cone(a,x._radius,x._halfHeight,n);break;case 4:let v=e;t.capsule(a,v._radius,v._halfHeight,n);break;case 5:let f=e,Z=f._numVertices,k=this._pool,g=k.sizeVec3==0?new m.common.Vec3:k.stackVec3[--k.sizeVec3],I=this._pool,z=I.sizeVec3==0?new m.common.Vec3:I.stackVec3[--I.sizeVec3],d=this._pool,u=d.sizeVec3==0?new m.common.Vec3:d.stackVec3[--d.sizeVec3],B=this._pool,j=B.sizeVec3==0?new m.common.Vec3:B.stackVec3[--B.sizeVec3],L=this._pool,V=L.sizeVec3==0?new m.common.Vec3:L.stackVec3[--L.sizeVec3],M=this._pool,w=M.sizeVec3==0?new m.common.Vec3:M.stackVec3[--M.sizeVec3],P=this._pool,E=P.sizeMat3==0?new m.common.Mat3:P.stackMat3[--P.sizeMat3],C=this._pool,S=C.sizeVec3==0?new m.common.Vec3:C.stackVec3[--C.sizeVec3],A=E;A.e00=a._rotation00,A.e01=a._rotation01,A.e02=a._rotation02,A.e10=a._rotation10,A.e11=a._rotation11,A.e12=a._rotation12,A.e20=a._rotation20,A.e21=a._rotation21,A.e22=a._rotation22;let R=S;R.x=a._positionX,R.y=a._positionY,R.z=a._positionZ;let H=0;for(;H<Z;){let J=H++,N=f._tmpVertices[J],K=f._vertices[J];N.x=K.x,N.y=K.y,N.z=K.z;let O=N.x*E.e10+N.y*E.e11+N.z*E.e12,$=N.x*E.e20+N.y*E.e21+N.z*E.e22;N.x=N.x*E.e00+N.y*E.e01+N.z*E.e02,N.y=O,N.z=$,N.x+=S.x,N.y+=S.y,N.z+=S.z}if(Z>30){let J=0;for(;J<Z;){let N=J++,K=f._tmpVertices[N];g.x=K.x,g.y=K.y,g.z=K.z;let O=f._tmpVertices[(N+1)%Z];z.x=O.x,z.y=O.y,z.z=O.z,t.line(g,z,n)}}else if(this._debugDraw.wireframe||Z>10){let J=0;for(;J<Z;){let N=J++,K=f._tmpVertices[N];g.x=K.x,g.y=K.y,g.z=K.z;let O=0;for(;O<N;){let $=f._tmpVertices[O++];z.x=$.x,z.y=$.y,z.z=$.z,t.line(g,z,n)}}}else{let J=0;for(;J<Z;){let N=J++,K=f._tmpVertices[N];g.x=K.x,g.y=K.y,g.z=K.z;let O=0;for(;O<N;){let $=O++,et=f._tmpVertices[$];z.x=et.x,z.y=et.y,z.z=et.z;let st=0;for(;st<$;){let lt=f._tmpVertices[st++];u.x=lt.x,u.y=lt.y,u.z=lt.z,j.x=z.x,j.y=z.y,j.z=z.z;let rt=j;rt.x-=g.x,rt.y-=g.y,rt.z-=g.z,V.x=u.x,V.y=u.y,V.z=u.z;let at=V;at.x-=g.x,at.y-=g.y,at.z-=g.z,w.x=j.x,w.y=j.y,w.z=j.z;let ot=w,ht=ot.z*V.x-ot.x*V.z,_t=ot.x*V.y-ot.y*V.x;ot.x=ot.y*V.z-ot.z*V.y,ot.y=ht,ot.z=_t;let bt=Math.sqrt(ot.x*ot.x+ot.y*ot.y+ot.z*ot.z);bt>0&&(bt=1/bt),ot.x*=bt,ot.y*=bt,ot.z*=bt,t.triangle(g,z,u,w,w,w,n),w.x=-w.x,w.y=-w.y,w.z=-w.z,t.triangle(g,u,z,w,w,w,n)}}}}let y=this._pool;if(g!=null){if(g.zero(),y.sizeVec3==y.stackVec3.length){let J=new Array(y.sizeVec3<<1),N=0,K=y.sizeVec3;for(;N<K;){let O=N++;J[O]=y.stackVec3[O],y.stackVec3[O]=null}y.stackVec3=J}y.stackVec3[y.sizeVec3++]=g}let D=this._pool;if(z!=null){if(z.zero(),D.sizeVec3==D.stackVec3.length){let J=new Array(D.sizeVec3<<1),N=0,K=D.sizeVec3;for(;N<K;){let O=N++;J[O]=D.stackVec3[O],D.stackVec3[O]=null}D.stackVec3=J}D.stackVec3[D.sizeVec3++]=z}let F=this._pool;if(u!=null){if(u.zero(),F.sizeVec3==F.stackVec3.length){let J=new Array(F.sizeVec3<<1),N=0,K=F.sizeVec3;for(;N<K;){let O=N++;J[O]=F.stackVec3[O],F.stackVec3[O]=null}F.stackVec3=J}F.stackVec3[F.sizeVec3++]=u}let Q=this._pool;if(j!=null){if(j.zero(),Q.sizeVec3==Q.stackVec3.length){let J=new Array(Q.sizeVec3<<1),N=0,K=Q.sizeVec3;for(;N<K;){let O=N++;J[O]=Q.stackVec3[O],Q.stackVec3[O]=null}Q.stackVec3=J}Q.stackVec3[Q.sizeVec3++]=j}let W=this._pool;if(V!=null){if(V.zero(),W.sizeVec3==W.stackVec3.length){let J=new Array(W.sizeVec3<<1),N=0,K=W.sizeVec3;for(;N<K;){let O=N++;J[O]=W.stackVec3[O],W.stackVec3[O]=null}W.stackVec3=J}W.stackVec3[W.sizeVec3++]=V}let q=this._pool;if(w!=null){if(w.zero(),q.sizeVec3==q.stackVec3.length){let J=new Array(q.sizeVec3<<1),N=0,K=q.sizeVec3;for(;N<K;){let O=N++;J[O]=q.stackVec3[O],q.stackVec3[O]=null}q.stackVec3=J}q.stackVec3[q.sizeVec3++]=w}let U=this._pool;if(E!=null){if(E.e00=1,E.e01=0,E.e02=0,E.e10=0,E.e11=1,E.e12=0,E.e20=0,E.e21=0,E.e22=1,U.sizeMat3==U.stackMat3.length){let J=new Array(U.sizeMat3<<1),N=0,K=U.sizeMat3;for(;N<K;){let O=N++;J[O]=U.stackMat3[O],U.stackMat3[O]=null}U.stackMat3=J}U.stackMat3[U.sizeMat3++]=E}let G=this._pool;if(S!=null){if(S.zero(),G.sizeVec3==G.stackVec3.length){let J=new Array(G.sizeVec3<<1),N=0,K=G.sizeVec3;for(;N<K;){let O=N++;J[O]=G.stackVec3[O],G.stackVec3[O]=null}G.stackVec3=J}G.stackVec3[G.sizeVec3++]=S}break}}if(t.drawAabbs){let e=_._aabb,a=i.aabbColor,h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3],Y=b;Y.x=e._minX,Y.y=e._minY,Y.z=e._minZ;let p=c;p.x=e._maxX,p.y=e._maxY,p.z=e._maxZ,t.aabb(b,c,a);let x=this._pool;if(b!=null){if(b.zero(),x.sizeVec3==x.stackVec3.length){let f=new Array(x.sizeVec3<<1),Z=0,k=x.sizeVec3;for(;Z<k;){let g=Z++;f[g]=x.stackVec3[g],x.stackVec3[g]=null}x.stackVec3=f}x.stackVec3[x.sizeVec3++]=b}let v=this._pool;if(c!=null){if(c.zero(),v.sizeVec3==v.stackVec3.length){let f=new Array(v.sizeVec3<<1),Z=0,k=v.sizeVec3;for(;Z<k;){let g=Z++;f[g]=v.stackVec3[g],v.stackVec3[g]=null}v.stackVec3=f}v.stackVec3[v.sizeVec3++]=c}}_=r}s=o}}_drawConstraints(t){let i=t.style;if(t.drawPairs||t.drawContacts){let s=this._contactManager._contactList;for(;s!=null;){let o=s._next;if(t.drawPairs){let n=i.pairColor,l=this._pool,_=l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3],r=this._pool,e=r.sizeVec3==0?new m.common.Vec3:r.stackVec3[--r.sizeVec3],a=_;a.x=s._s1._transform._positionX,a.y=s._s1._transform._positionY,a.z=s._s1._transform._positionZ;let h=e;h.x=s._s2._transform._positionX,h.y=s._s2._transform._positionY,h.z=s._s2._transform._positionZ,t.line(_,e,n);let b=this._pool;if(_!=null){if(_.zero(),b.sizeVec3==b.stackVec3.length){let c=new Array(b.sizeVec3<<1),Y=0,p=b.sizeVec3;for(;Y<p;){let x=Y++;c[x]=b.stackVec3[x],b.stackVec3[x]=null}b.stackVec3=c}b.stackVec3[b.sizeVec3++]=_}let X=this._pool;if(e!=null){if(e.zero(),X.sizeVec3==X.stackVec3.length){let c=new Array(X.sizeVec3<<1),Y=0,p=X.sizeVec3;for(;Y<p;){let x=Y++;c[x]=X.stackVec3[x],X.stackVec3[x]=null}X.stackVec3=c}X.stackVec3[X.sizeVec3++]=e}}if(t.drawContacts){let n=s._contactConstraint,l=s._contactConstraint._manifold._points,_=0,r=s._contactConstraint._manifold._numPoints;for(;_<r;){let e=l[_++],a=t.style,h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3],Y=this._pool,p=Y.sizeVec3==0?new m.common.Vec3:Y.stackVec3[--Y.sizeVec3],x=this._pool,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3],f=this._pool,Z=f.sizeVec3==0?new m.common.Vec3:f.stackVec3[--f.sizeVec3],k=b;k.x=e._pos1X,k.y=e._pos1Y,k.z=e._pos1Z;let g=c;g.x=e._pos2X,g.y=e._pos2Y,g.z=e._pos2Z;let I=p;I.x=n._manifold._normalX,I.y=n._manifold._normalY,I.z=n._manifold._normalZ;let z=v;z.x=n._manifold._tangentX,z.y=n._manifold._tangentY,z.z=n._manifold._tangentZ;let d=Z;if(d.x=n._manifold._binormalX,d.y=n._manifold._binormalY,d.z=n._manifold._binormalZ,e._disabled)t.point(b,a.disabledContactColor),t.point(c,a.disabledContactColor),t.line(b,c,a.disabledContactColor);else if(e._warmStarted){let P;switch(e._id&3){case 0:P=a.contactColor;break;case 1:P=a.contactColor2;break;case 2:P=a.contactColor3;break;default:P=a.contactColor4}t.point(b,P),t.point(c,P),t.line(b,c,a.contactColor)}else t.point(b,a.newContactColor),t.point(c,a.newContactColor),t.line(b,c,a.newContactColor);c.x=b.x,c.y=b.y,c.z=b.z;let u=c,B=a.contactNormalLength;if(u.x+=p.x*B,u.y+=p.y*B,u.z+=p.z*B,t.line(b,c,a.contactNormalColor),t.drawContactBases){c.x=b.x,c.y=b.y,c.z=b.z;let P=c,E=a.contactTangentLength;P.x+=v.x*E,P.y+=v.y*E,P.z+=v.z*E,t.line(b,c,a.contactTangentColor),c.x=b.x,c.y=b.y,c.z=b.z;let C=c,S=a.contactBinormalLength;C.x+=Z.x*S,C.y+=Z.y*S,C.z+=Z.z*S,t.line(b,c,a.contactBinormalColor)}let j=this._pool;if(b!=null){if(b.zero(),j.sizeVec3==j.stackVec3.length){let P=new Array(j.sizeVec3<<1),E=0,C=j.sizeVec3;for(;E<C;){let S=E++;P[S]=j.stackVec3[S],j.stackVec3[S]=null}j.stackVec3=P}j.stackVec3[j.sizeVec3++]=b}let L=this._pool;if(c!=null){if(c.zero(),L.sizeVec3==L.stackVec3.length){let P=new Array(L.sizeVec3<<1),E=0,C=L.sizeVec3;for(;E<C;){let S=E++;P[S]=L.stackVec3[S],L.stackVec3[S]=null}L.stackVec3=P}L.stackVec3[L.sizeVec3++]=c}let V=this._pool;if(p!=null){if(p.zero(),V.sizeVec3==V.stackVec3.length){let P=new Array(V.sizeVec3<<1),E=0,C=V.sizeVec3;for(;E<C;){let S=E++;P[S]=V.stackVec3[S],V.stackVec3[S]=null}V.stackVec3=P}V.stackVec3[V.sizeVec3++]=p}let M=this._pool;if(v!=null){if(v.zero(),M.sizeVec3==M.stackVec3.length){let P=new Array(M.sizeVec3<<1),E=0,C=M.sizeVec3;for(;E<C;){let S=E++;P[S]=M.stackVec3[S],M.stackVec3[S]=null}M.stackVec3=P}M.stackVec3[M.sizeVec3++]=v}let w=this._pool;if(Z!=null){if(Z.zero(),w.sizeVec3==w.stackVec3.length){let P=new Array(w.sizeVec3<<1),E=0,C=w.sizeVec3;for(;E<C;){let S=E++;P[S]=w.stackVec3[S],w.stackVec3[S]=null}w.stackVec3=P}w.stackVec3[w.sizeVec3++]=Z}}}s=o}}if(t.drawJoints){let s=this._jointList;for(;s!=null;){let o=s._next,n=this._pool,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],_=this._pool,r=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],e=l;e.x=s._b1._transform._positionX,e.y=s._b1._transform._positionY,e.z=s._b1._transform._positionZ;let a=r;a.x=s._b2._transform._positionX,a.y=s._b2._transform._positionY,a.z=s._b2._transform._positionZ;let h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3],Y=this._pool,p=Y.sizeVec3==0?new m.common.Vec3:Y.stackVec3[--Y.sizeVec3],x=this._pool,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3],f=this._pool,Z=f.sizeVec3==0?new m.common.Vec3:f.stackVec3[--f.sizeVec3],k=this._pool,g=k.sizeVec3==0?new m.common.Vec3:k.stackVec3[--k.sizeVec3],I=this._pool,z=I.sizeVec3==0?new m.common.Vec3:I.stackVec3[--I.sizeVec3],d=this._pool,u=d.sizeVec3==0?new m.common.Vec3:d.stackVec3[--d.sizeVec3],B=b;B.x=s._anchor1X,B.y=s._anchor1Y,B.z=s._anchor1Z;let j=c;j.x=s._anchor2X,j.y=s._anchor2Y,j.z=s._anchor2Z;let L=p;L.x=s._basisX1X,L.y=s._basisX1Y,L.z=s._basisX1Z;let V=v;V.x=s._basisY1X,V.y=s._basisY1Y,V.z=s._basisY1Z;let M=Z;M.x=s._basisZ1X,M.y=s._basisZ1Y,M.z=s._basisZ1Z;let w=g;w.x=s._basisX2X,w.y=s._basisX2Y,w.z=s._basisX2Z;let P=z;P.x=s._basisY2X,P.y=s._basisY2Y,P.z=s._basisY2Z;let E=u;if(E.x=s._basisZ2X,E.y=s._basisZ2Y,E.z=s._basisZ2Z,t.line(l,b,t.style.jointLineColor),t.line(r,c,t.style.jointLineColor),t.drawJointLimits)switch(s._type){case 0:break;case 1:let q=s._lm;this._drawRotationalLimit(t,b,v,Z,z,t.style.jointRotationalConstraintRadius,q.lowerLimit,q.upperLimit,t.style.jointLineColor);break;case 2:let U=s,G=t.style.jointLineColor,J=U._rotLm,N=U._translLm;this._drawRotationalLimit(t,c,v,Z,z,t.style.jointRotationalConstraintRadius,J.lowerLimit,J.upperLimit,G),this._drawTranslationalLimit(t,b,p,N.lowerLimit,N.upperLimit,G);break;case 3:let K=s._lm;this._drawTranslationalLimit(t,b,p,K.lowerLimit,K.upperLimit,t.style.jointLineColor);break;case 4:let O=s,$=t.style.jointRotationalConstraintRadius,et=t.style.jointLineColor,st=O._lm1,lt=O._lm2;this._drawRotationalLimit(t,b,v,Z,v,$,O._angleX-st.upperLimit,O._angleX-st.lowerLimit,et),this._drawRotationalLimit(t,c,g,z,g,$,lt.lowerLimit-O._angleZ,lt.upperLimit-O._angleZ,et);break;case 5:let rt=s,at=t.style.jointRotationalConstraintRadius,ot=t.style.jointLineColor,ht=rt._twistLm;this._drawRotationalLimit(t,c,z,u,z,at,ht.lowerLimit-rt._twistAngle,ht.upperLimit-rt._twistAngle,ot),this._drawEllipseOnSphere(t,b,p,v,Z,rt._maxSwingAngle1,rt._maxSwingAngle2,at,ot);let _t=this._pool,bt=_t.sizeVec3==0?new m.common.Vec3:_t.stackVec3[--_t.sizeVec3];bt.x=c.x,bt.y=c.y,bt.z=c.z;let Xt=bt;Xt.x+=g.x*at,Xt.y+=g.y*at,Xt.z+=g.z*at,t.line(c,Xt,ot);let ft=this._pool;if(Xt!=null){if(Xt.zero(),ft.sizeVec3==ft.stackVec3.length){let ei=new Array(ft.sizeVec3<<1),qt=0,At=ft.sizeVec3;for(;qt<At;){let ni=qt++;ei[ni]=ft.stackVec3[ni],ft.stackVec3[ni]=null}ft.stackVec3=ei}ft.stackVec3[ft.sizeVec3++]=Xt}break;case 6:let Zt=s,xt=t.style.jointRotationalConstraintRadius,zt=t.style.jointLineColor,Yt=Zt._rotLms[0],pt=Zt._rotLms[1],ct=Zt._rotLms[2];this._drawTranslationalLimit3D(t,b,p,v,Z,Zt._translLms[0],Zt._translLms[1],Zt._translLms[2],zt);let nt=this._pool,tt=nt.sizeVec3==0?new m.common.Vec3:nt.stackVec3[--nt.sizeVec3],Lt=tt;Lt.x=Zt._axisYX,Lt.y=Zt._axisYY,Lt.z=Zt._axisYZ;let Bt=this._pool,Mt=Bt.sizeVec3==0?new m.common.Vec3:Bt.stackVec3[--Bt.sizeVec3];Mt.x=p.x,Mt.y=p.y,Mt.z=p.z;let jt=Mt,ci=this._pool,Xi=ci.sizeVec3==0?new m.common.Vec3:ci.stackVec3[--ci.sizeVec3];Xi.x=p.x,Xi.y=p.y,Xi.z=p.z;let Yi=Xi,Li=Yi.z*tt.x-Yi.x*tt.z,wi=Yi.x*tt.y-Yi.y*tt.x;Yi.x=Yi.y*tt.z-Yi.z*tt.y,Yi.y=Li,Yi.z=wi,this._drawRotationalLimit(t,c,v,Z,v,xt,Zt._angleX-Yt.upperLimit,Zt._angleX-Yt.lowerLimit,zt),this._drawRotationalLimit(t,c,jt,Yi,jt,xt,pt.lowerLimit-Zt._angleY,pt.upperLimit-Zt._angleY,zt),this._drawRotationalLimit(t,c,g,z,g,xt,ct.lowerLimit-Zt._angleZ,ct.upperLimit-Zt._angleZ,zt);break}t.line(b,c,t.style.jointErrorColor);let C=this._pool;if(l!=null){if(l.zero(),C.sizeVec3==C.stackVec3.length){let q=new Array(C.sizeVec3<<1),U=0,G=C.sizeVec3;for(;U<G;){let J=U++;q[J]=C.stackVec3[J],C.stackVec3[J]=null}C.stackVec3=q}C.stackVec3[C.sizeVec3++]=l}let S=this._pool;if(r!=null){if(r.zero(),S.sizeVec3==S.stackVec3.length){let q=new Array(S.sizeVec3<<1),U=0,G=S.sizeVec3;for(;U<G;){let J=U++;q[J]=S.stackVec3[J],S.stackVec3[J]=null}S.stackVec3=q}S.stackVec3[S.sizeVec3++]=r}let A=this._pool;if(b!=null){if(b.zero(),A.sizeVec3==A.stackVec3.length){let q=new Array(A.sizeVec3<<1),U=0,G=A.sizeVec3;for(;U<G;){let J=U++;q[J]=A.stackVec3[J],A.stackVec3[J]=null}A.stackVec3=q}A.stackVec3[A.sizeVec3++]=b}let R=this._pool;if(c!=null){if(c.zero(),R.sizeVec3==R.stackVec3.length){let q=new Array(R.sizeVec3<<1),U=0,G=R.sizeVec3;for(;U<G;){let J=U++;q[J]=R.stackVec3[J],R.stackVec3[J]=null}R.stackVec3=q}R.stackVec3[R.sizeVec3++]=c}let H=this._pool;if(p!=null){if(p.zero(),H.sizeVec3==H.stackVec3.length){let q=new Array(H.sizeVec3<<1),U=0,G=H.sizeVec3;for(;U<G;){let J=U++;q[J]=H.stackVec3[J],H.stackVec3[J]=null}H.stackVec3=q}H.stackVec3[H.sizeVec3++]=p}let y=this._pool;if(v!=null){if(v.zero(),y.sizeVec3==y.stackVec3.length){let q=new Array(y.sizeVec3<<1),U=0,G=y.sizeVec3;for(;U<G;){let J=U++;q[J]=y.stackVec3[J],y.stackVec3[J]=null}y.stackVec3=q}y.stackVec3[y.sizeVec3++]=v}let D=this._pool;if(Z!=null){if(Z.zero(),D.sizeVec3==D.stackVec3.length){let q=new Array(D.sizeVec3<<1),U=0,G=D.sizeVec3;for(;U<G;){let J=U++;q[J]=D.stackVec3[J],D.stackVec3[J]=null}D.stackVec3=q}D.stackVec3[D.sizeVec3++]=Z}let F=this._pool;if(g!=null){if(g.zero(),F.sizeVec3==F.stackVec3.length){let q=new Array(F.sizeVec3<<1),U=0,G=F.sizeVec3;for(;U<G;){let J=U++;q[J]=F.stackVec3[J],F.stackVec3[J]=null}F.stackVec3=q}F.stackVec3[F.sizeVec3++]=g}let Q=this._pool;if(z!=null){if(z.zero(),Q.sizeVec3==Q.stackVec3.length){let q=new Array(Q.sizeVec3<<1),U=0,G=Q.sizeVec3;for(;U<G;){let J=U++;q[J]=Q.stackVec3[J],Q.stackVec3[J]=null}Q.stackVec3=q}Q.stackVec3[Q.sizeVec3++]=z}let W=this._pool;if(u!=null){if(u.zero(),W.sizeVec3==W.stackVec3.length){let q=new Array(W.sizeVec3<<1),U=0,G=W.sizeVec3;for(;U<G;){let J=U++;q[J]=W.stackVec3[J],W.stackVec3[J]=null}W.stackVec3=q}W.stackVec3[W.sizeVec3++]=u}s=o}}}_drawRotationalLimit(t,i,s,o,n,l,_,r,e){if(_!=r){let a=this._pool,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let b=h;b.x+=n.x*l,b.y+=n.y*l,b.z+=n.z*l,t.line(i,b,e);let X=this._pool;if(b!=null){if(b.zero(),X.sizeVec3==X.stackVec3.length){let c=new Array(X.sizeVec3<<1),Y=0,p=X.sizeVec3;for(;Y<p;){let x=Y++;c[x]=X.stackVec3[x],X.stackVec3[x]=null}X.stackVec3=c}X.stackVec3[X.sizeVec3++]=b}_>r?t.ellipse(i,s,o,l,l,e):t.arc(i,s,o,l,l,_,r,!0,e)}}_drawTranslationalLimit(t,i,s,o,n,l){if(o<n){let _=this._pool,r=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3];r.x=i.x,r.y=i.y,r.z=i.z;let e=r;e.x+=s.x*o,e.y+=s.y*o,e.z+=s.z*o;let a=this._pool,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let b=h;b.x+=s.x*n,b.y+=s.y*n,b.z+=s.z*n,t.line(e,b,l);let X=this._pool;if(e!=null){if(e.zero(),X.sizeVec3==X.stackVec3.length){let Y=new Array(X.sizeVec3<<1),p=0,x=X.sizeVec3;for(;p<x;){let v=p++;Y[v]=X.stackVec3[v],X.stackVec3[v]=null}X.stackVec3=Y}X.stackVec3[X.sizeVec3++]=e}let c=this._pool;if(b!=null){if(b.zero(),c.sizeVec3==c.stackVec3.length){let Y=new Array(c.sizeVec3<<1),p=0,x=c.sizeVec3;for(;p<x;){let v=p++;Y[v]=c.stackVec3[v],c.stackVec3[v]=null}c.stackVec3=Y}c.stackVec3[c.sizeVec3++]=b}}}_drawTranslationalLimit3D(t,i,s,o,n,l,_,r,e){let a=l.lowerLimit,h=l.upperLimit,b=_.lowerLimit,X=_.upperLimit,c=r.lowerLimit,Y=r.upperLimit,p=this._pool;p.sizeVec3==0?new m.common.Vec3:--p.sizeVec3;let x=this._pool;x.sizeVec3==0?new m.common.Vec3:--x.sizeVec3;let v=this._pool,f=v.sizeVec3==0?new m.common.Vec3:v.stackVec3[--v.sizeVec3];f.x=i.x,f.y=i.y,f.z=i.z;let Z=f;Z.x+=s.x*a,Z.y+=s.y*a,Z.z+=s.z*a,Z.x+=o.x*b,Z.y+=o.y*b,Z.z+=o.z*b,Z.x+=n.x*c,Z.y+=n.y*c,Z.z+=n.z*c;let k=this._pool,g=k.sizeVec3==0?new m.common.Vec3:k.stackVec3[--k.sizeVec3];g.x=i.x,g.y=i.y,g.z=i.z;let I=g;I.x+=s.x*a,I.y+=s.y*a,I.z+=s.z*a,I.x+=o.x*b,I.y+=o.y*b,I.z+=o.z*b,I.x+=n.x*Y,I.y+=n.y*Y,I.z+=n.z*Y;let z=this._pool,d=z.sizeVec3==0?new m.common.Vec3:z.stackVec3[--z.sizeVec3];d.x=i.x,d.y=i.y,d.z=i.z;let u=d;u.x+=s.x*a,u.y+=s.y*a,u.z+=s.z*a,u.x+=o.x*X,u.y+=o.y*X,u.z+=o.z*X,u.x+=n.x*c,u.y+=n.y*c,u.z+=n.z*c;let B=this._pool,j=B.sizeVec3==0?new m.common.Vec3:B.stackVec3[--B.sizeVec3];j.x=i.x,j.y=i.y,j.z=i.z;let L=j;L.x+=s.x*a,L.y+=s.y*a,L.z+=s.z*a,L.x+=o.x*X,L.y+=o.y*X,L.z+=o.z*X,L.x+=n.x*Y,L.y+=n.y*Y,L.z+=n.z*Y;let V=this._pool,M=V.sizeVec3==0?new m.common.Vec3:V.stackVec3[--V.sizeVec3];M.x=i.x,M.y=i.y,M.z=i.z;let w=M;w.x+=s.x*h,w.y+=s.y*h,w.z+=s.z*h,w.x+=o.x*b,w.y+=o.y*b,w.z+=o.z*b,w.x+=n.x*c,w.y+=n.y*c,w.z+=n.z*c;let P=this._pool,E=P.sizeVec3==0?new m.common.Vec3:P.stackVec3[--P.sizeVec3];E.x=i.x,E.y=i.y,E.z=i.z;let C=E;C.x+=s.x*h,C.y+=s.y*h,C.z+=s.z*h,C.x+=o.x*b,C.y+=o.y*b,C.z+=o.z*b,C.x+=n.x*Y,C.y+=n.y*Y,C.z+=n.z*Y;let S=this._pool,A=S.sizeVec3==0?new m.common.Vec3:S.stackVec3[--S.sizeVec3];A.x=i.x,A.y=i.y,A.z=i.z;let R=A;R.x+=s.x*h,R.y+=s.y*h,R.z+=s.z*h,R.x+=o.x*X,R.y+=o.y*X,R.z+=o.z*X,R.x+=n.x*c,R.y+=n.y*c,R.z+=n.z*c;let H=this._pool,y=H.sizeVec3==0?new m.common.Vec3:H.stackVec3[--H.sizeVec3];y.x=i.x,y.y=i.y,y.z=i.z;let D=y;D.x+=s.x*h,D.y+=s.y*h,D.z+=s.z*h,D.x+=o.x*X,D.y+=o.y*X,D.z+=o.z*X,D.x+=n.x*Y,D.y+=n.y*Y,D.z+=n.z*Y,t.line(Z,w,e),t.line(u,R,e),t.line(I,C,e),t.line(L,D,e),t.line(Z,u,e),t.line(w,R,e),t.line(I,L,e),t.line(C,D,e),t.line(Z,I,e),t.line(w,C,e),t.line(u,L,e),t.line(R,D,e);let F=this._pool;if(Z!=null){if(Z.zero(),F.sizeVec3==F.stackVec3.length){let K=new Array(F.sizeVec3<<1),O=0,$=F.sizeVec3;for(;O<$;){let et=O++;K[et]=F.stackVec3[et],F.stackVec3[et]=null}F.stackVec3=K}F.stackVec3[F.sizeVec3++]=Z}let Q=this._pool;if(I!=null){if(I.zero(),Q.sizeVec3==Q.stackVec3.length){let K=new Array(Q.sizeVec3<<1),O=0,$=Q.sizeVec3;for(;O<$;){let et=O++;K[et]=Q.stackVec3[et],Q.stackVec3[et]=null}Q.stackVec3=K}Q.stackVec3[Q.sizeVec3++]=I}let W=this._pool;if(u!=null){if(u.zero(),W.sizeVec3==W.stackVec3.length){let K=new Array(W.sizeVec3<<1),O=0,$=W.sizeVec3;for(;O<$;){let et=O++;K[et]=W.stackVec3[et],W.stackVec3[et]=null}W.stackVec3=K}W.stackVec3[W.sizeVec3++]=u}let q=this._pool;if(L!=null){if(L.zero(),q.sizeVec3==q.stackVec3.length){let K=new Array(q.sizeVec3<<1),O=0,$=q.sizeVec3;for(;O<$;){let et=O++;K[et]=q.stackVec3[et],q.stackVec3[et]=null}q.stackVec3=K}q.stackVec3[q.sizeVec3++]=L}let U=this._pool;if(w!=null){if(w.zero(),U.sizeVec3==U.stackVec3.length){let K=new Array(U.sizeVec3<<1),O=0,$=U.sizeVec3;for(;O<$;){let et=O++;K[et]=U.stackVec3[et],U.stackVec3[et]=null}U.stackVec3=K}U.stackVec3[U.sizeVec3++]=w}let G=this._pool;if(C!=null){if(C.zero(),G.sizeVec3==G.stackVec3.length){let K=new Array(G.sizeVec3<<1),O=0,$=G.sizeVec3;for(;O<$;){let et=O++;K[et]=G.stackVec3[et],G.stackVec3[et]=null}G.stackVec3=K}G.stackVec3[G.sizeVec3++]=C}let J=this._pool;if(R!=null){if(R.zero(),J.sizeVec3==J.stackVec3.length){let K=new Array(J.sizeVec3<<1),O=0,$=J.sizeVec3;for(;O<$;){let et=O++;K[et]=J.stackVec3[et],J.stackVec3[et]=null}J.stackVec3=K}J.stackVec3[J.sizeVec3++]=R}let N=this._pool;if(D!=null){if(D.zero(),N.sizeVec3==N.stackVec3.length){let K=new Array(N.sizeVec3<<1),O=0,$=N.sizeVec3;for(;O<$;){let et=O++;K[et]=N.stackVec3[et],N.stackVec3[et]=null}N.stackVec3=K}N.stackVec3[N.sizeVec3++]=D}}_drawEllipseOnSphere(t,i,s,o,n,l,_,r,e){let a=0,h=this._pool,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this._pool,c=X.sizeQuat==0?new m.common.Quat:X.stackQuat[--X.sizeQuat],Y=this._pool,p=Y.sizeMat3==0?new m.common.Mat3:Y.stackMat3[--Y.sizeMat3],x=this._pool,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3],f=0;for(;f<17;){let z=f++,d=Math.cos(a)*l,u=Math.sin(a)*_,B=Math.sqrt(d*d+u*u),j=Math.sin(B*.5),L=Math.cos(B*.5),V=b.zero();V.x+=o.x*d,V.y+=o.y*d,V.z+=o.z*d,V.x+=n.x*u,V.y+=n.y*u,V.z+=n.z*u;let M=1/B*j;b.x*=M,b.y*=M,b.z*=M,c.x=b.x,c.y=b.y,c.z=b.z,c.w=L;let w=c.x,P=c.y,E=c.z,C=c.w,S=2*w,A=2*P,R=2*E,H=w*S,y=P*A,D=E*R,F=w*A,Q=P*R,W=w*R,q=C*S,U=C*A,G=C*R;p.e00=1-y-D,p.e01=F-G,p.e02=W+U,p.e10=F+G,p.e11=1-H-D,p.e12=Q-q,p.e20=W-U,p.e21=Q+q,p.e22=1-H-y;let J=this._pool,N=J.sizeVec3==0?new m.common.Vec3:J.stackVec3[--J.sizeVec3];N.x+=s.x*r,N.y+=s.y*r,N.z+=s.z*r;let K=N,O=K.x*p.e10+K.y*p.e11+K.z*p.e12,$=K.x*p.e20+K.y*p.e21+K.z*p.e22;K.x=K.x*p.e00+K.y*p.e01+K.z*p.e02,K.y=O,K.z=$,K.x+=i.x,K.y+=i.y,K.z+=i.z,z>=1&&t.line(v,K,e);let et=this._pool;if(v!=null){if(v.zero(),et.sizeVec3==et.stackVec3.length){let st=new Array(et.sizeVec3<<1),lt=0,rt=et.sizeVec3;for(;lt<rt;){let at=lt++;st[at]=et.stackVec3[at],et.stackVec3[at]=null}et.stackVec3=st}et.stackVec3[et.sizeVec3++]=v}v=K,a+=.39269908169872375}let Z=this._pool;if(b!=null){if(b.zero(),Z.sizeVec3==Z.stackVec3.length){let z=new Array(Z.sizeVec3<<1),d=0,u=Z.sizeVec3;for(;d<u;){let B=d++;z[B]=Z.stackVec3[B],Z.stackVec3[B]=null}Z.stackVec3=z}Z.stackVec3[Z.sizeVec3++]=b}let k=this._pool;if(c!=null){if(c.x=0,c.y=0,c.z=0,c.w=1,k.sizeQuat==k.stackQuat.length){let z=new Array(k.sizeQuat<<1),d=0,u=k.sizeQuat;for(;d<u;){let B=d++;z[B]=k.stackQuat[B],k.stackQuat[B]=null}k.stackQuat=z}k.stackQuat[k.sizeQuat++]=c}let g=this._pool;if(p!=null){if(p.e00=1,p.e01=0,p.e02=0,p.e10=0,p.e11=1,p.e12=0,p.e20=0,p.e21=0,p.e22=1,g.sizeMat3==g.stackMat3.length){let z=new Array(g.sizeMat3<<1),d=0,u=g.sizeMat3;for(;d<u;){let B=d++;z[B]=g.stackMat3[B],g.stackMat3[B]=null}g.stackMat3=z}g.stackMat3[g.sizeMat3++]=p}let I=this._pool;if(v!=null){if(v.zero(),I.sizeVec3==I.stackVec3.length){let z=new Array(I.sizeVec3<<1),d=0,u=I.sizeVec3;for(;d<u;){let B=d++;z[B]=I.stackVec3[B],I.stackVec3[B]=null}I.stackVec3=z}I.stackVec3[I.sizeVec3++]=v}}step(t){this._timeStep.dt>0&&(this._timeStep.dtRatio=t/this._timeStep.dt),this._timeStep.dt=t,this._timeStep.invDt=1/t;let i=Date.now()/1e3;this._updateContacts(),this._solveIslands(),m.dynamics.common.Performance.totalTime=(Date.now()/1e3-i)*1e3}addRigidBody(t){if(t._world!=null)throw new Error("A rigid body cannot belong to multiple worlds.");this._rigidBodyList==null?(this._rigidBodyList=t,this._rigidBodyListLast=t):(this._rigidBodyListLast._next=t,t._prev=this._rigidBodyListLast,this._rigidBodyListLast=t),t._world=this;let i=t._shapeList;for(;i!=null;){let s=i._next;i._proxy=this._broadPhase.createProxy(i,i._aabb),i._id=this._shapeIdCount++,this._numShapes++,i=s}this._numRigidBodies++}removeRigidBody(t){if(t._world!=this)throw new Error("The rigid body doesn't belong to the world.");let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._rigidBodyList&&(this._rigidBodyList=this._rigidBodyList._next),t==this._rigidBodyListLast&&(this._rigidBodyListLast=this._rigidBodyListLast._prev),t._next=null,t._prev=null,t._world=null;let o=t._shapeList;for(;o!=null;){let n=o._next;this._broadPhase.destroyProxy(o._proxy),o._proxy=null,o._id=-1;let l=o._rigidBody._contactLinkList;for(;l!=null;){let _=l._next,r=l._contact;if(r._s1==o||r._s2==o){let e=l._other;e._sleeping=!1,e._sleepTime=0;let a=this._contactManager,h=r._prev,b=r._next;if(h!=null&&(h._next=b),b!=null&&(b._prev=h),r==a._contactList&&(a._contactList=a._contactList._next),r==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),r._next=null,r._prev=null,r._touching){let v=r._s1._contactCallback,f=r._s2._contactCallback;v==f&&(f=null),v!=null&&v.endContact(r),f!=null&&f.endContact(r)}let X=r._link1._prev,c=r._link1._next;X!=null&&(X._next=c),c!=null&&(c._prev=X),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;let Y=r._link2._prev,p=r._link2._next;Y!=null&&(Y._next=p),p!=null&&(p._prev=Y),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;let x=r._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,r._next=a._contactPool,a._contactPool=r,a._numContacts--}l=_}this._numShapes--,o=n}this._numRigidBodies--}addJoint(t){if(t._world!=null)throw new Error("A joint cannot belong to multiple worlds.");this._jointList==null?(this._jointList=t,this._jointListLast=t):(this._jointListLast._next=t,t._prev=this._jointListLast,this._jointListLast=t),t._world=this,t._link1._other=t._b2,t._link2._other=t._b1,t._b1._jointLinkList==null?(t._b1._jointLinkList=t._link1,t._b1._jointLinkListLast=t._link1):(t._b1._jointLinkListLast._next=t._link1,t._link1._prev=t._b1._jointLinkListLast,t._b1._jointLinkListLast=t._link1),t._b2._jointLinkList==null?(t._b2._jointLinkList=t._link2,t._b2._jointLinkListLast=t._link2):(t._b2._jointLinkListLast._next=t._link2,t._link2._prev=t._b2._jointLinkListLast,t._b2._jointLinkListLast=t._link2),t._b1._numJointLinks++,t._b2._numJointLinks++;let i=t._b1;i._sleeping=!1,i._sleepTime=0;let s=t._b2;s._sleeping=!1,s._sleepTime=0,t._syncAnchors(),this._numJoints++}removeJoint(t){if(t._world!=this)throw new Error("The joint doesn't belong to the world.");let i=t._prev,s=t._next;i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._jointList&&(this._jointList=this._jointList._next),t==this._jointListLast&&(this._jointListLast=this._jointListLast._prev),t._next=null,t._prev=null,t._world=null;let o=t._link1._prev,n=t._link1._next;o!=null&&(o._next=n),n!=null&&(n._prev=o),t._link1==t._b1._jointLinkList&&(t._b1._jointLinkList=t._b1._jointLinkList._next),t._link1==t._b1._jointLinkListLast&&(t._b1._jointLinkListLast=t._b1._jointLinkListLast._prev),t._link1._next=null,t._link1._prev=null;let l=t._link2._prev,_=t._link2._next;l!=null&&(l._next=_),_!=null&&(_._prev=l),t._link2==t._b2._jointLinkList&&(t._b2._jointLinkList=t._b2._jointLinkList._next),t._link2==t._b2._jointLinkListLast&&(t._b2._jointLinkListLast=t._b2._jointLinkListLast._prev),t._link2._next=null,t._link2._prev=null,t._link1._other=null,t._link2._other=null,t._b1._numJointLinks--,t._b2._numJointLinks--;let r=t._b1;r._sleeping=!1,r._sleepTime=0;let e=t._b2;e._sleeping=!1,e._sleepTime=0,this._numJoints--}setDebugDraw(t){this._debugDraw=t}getDebugDraw(){return this._debugDraw}debugDraw(){this._debugDraw!=null&&(this._broadPhase._type==2&&this._drawBvh(this._debugDraw,this._broadPhase._tree),this._drawRigidBodies(this._debugDraw),this._drawConstraints(this._debugDraw))}rayCast(t,i,s){let o=this._rayCastWrapper.begin;o.x=t.x,o.y=t.y,o.z=t.z;let n=this._rayCastWrapper.end;n.x=i.x,n.y=i.y,n.z=i.z,this._rayCastWrapper.callback=s,this._broadPhase.rayCast(t,i,this._rayCastWrapper)}convexCast(t,i,s,o){this._convexCastWrapper.convex=t;let n=this._convexCastWrapper.begin;n._positionX=i._positionX,n._positionY=i._positionY,n._positionZ=i._positionZ,n._rotation00=i._rotation00,n._rotation01=i._rotation01,n._rotation02=i._rotation02,n._rotation10=i._rotation10,n._rotation11=i._rotation11,n._rotation12=i._rotation12,n._rotation20=i._rotation20,n._rotation21=i._rotation21,n._rotation22=i._rotation22;let l=this._convexCastWrapper.translation;l.x=s.x,l.y=s.y,l.z=s.z,this._convexCastWrapper.callback=o,this._broadPhase.convexCast(t,i,s,this._convexCastWrapper)}aabbTest(t,i){this._aabbTestWrapper._aabb.copyFrom(t),this._aabbTestWrapper._callback=i,this._broadPhase.aabbTest(t,this._aabbTestWrapper)}getRigidBodyList(){return this._rigidBodyList}getJointList(){return this._jointList}getBroadPhase(){return this._broadPhase}getContactManager(){return this._contactManager}getNumRigidBodies(){return this._numRigidBodies}getNumJoints(){return this._numJoints}getNumShapes(){return this._numShapes}getNumIslands(){return this._numIslands}getNumVelocityIterations(){return this._numVelocityIterations}setNumVelocityIterations(t){this._numVelocityIterations=t}getNumPositionIterations(){return this._numPositionIterations}setNumPositionIterations(t){this._numPositionIterations=t}getGravity(){return this._gravity}setGravity(t){let i=this._gravity;i.x=t.x,i.y=t.y,i.z=t.z}};m.dynamics._World||(m.dynamics._World={});m.dynamics._World.RayCastWrapper=class extends m.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new m.collision.geometry.RayCastHit,this.begin=new m.common.Vec3,this.end=new m.common.Vec3,this.callback=null}process(t){let i=t.userData;i._geom.rayCast(this.begin,this.end,i._transform,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}};m.dynamics._World.ConvexCastWrapper=class extends m.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this.rayCastHit=new m.collision.geometry.RayCastHit,this.begin=new m.common.Transform,this.translation=new m.common.Vec3,this.zero=new m.common.Vec3,this.callback=null,this.convex=null}process(t){let i=t.userData,s=i._geom._type;s<0||s>5||m.collision.narrowphase.detector.gjkepa.GjkEpa.instance.convexCast(this.convex,i._geom,this.begin,i._transform,this.translation,this.zero,this.rayCastHit)&&this.callback.process(i,this.rayCastHit)}};m.dynamics._World.AabbTestWrapper=class extends m.collision.broadphase.BroadPhaseProxyCallback{constructor(){super(),this._aabb=new m.collision.geometry.Aabb,this._callback=null}process(t){let i=t.userData,s=i._aabb;s._minX<this._aabb._maxX&&s._maxX>this._aabb._minX&&s._minY<this._aabb._maxY&&s._maxY>this._aabb._minY&&s._minZ<this._aabb._maxZ&&s._maxZ>this._aabb._minZ&&this._callback.process(i)}};m.dynamics.callback||(m.dynamics.callback={});m.dynamics.callback.AabbTestCallback=class{constructor(){}process(t){}};m.dynamics.callback.ContactCallback=class{constructor(){}beginContact(t){}preSolve(t){}postSolve(t){}endContact(t){}};m.dynamics.callback.RayCastCallback=class{constructor(){}process(t,i){}};m.dynamics.callback.RayCastClosest=class extends m.dynamics.callback.RayCastCallback{constructor(){super(),this.position=new m.common.Vec3,this.normal=new m.common.Vec3,this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}clear(){this.shape=null,this.fraction=1,this.position.zero(),this.normal.zero(),this.hit=!1}process(t,i){if(i.fraction<this.fraction){this.shape=t,this.hit=!0,this.fraction=i.fraction;let s=this.position,o=i.position;s.x=o.x,s.y=o.y,s.z=o.z;let n=this.normal,l=i.normal;n.x=l.x,n.y=l.y,n.z=l.z}}};m.dynamics.common||(m.dynamics.common={});m.dynamics.common.DebugDraw=class{constructor(){this.p=new m.common.Pool,this.wireframe=!1,this.drawShapes=!0,this.drawBvh=!1,this.drawBvhMinLevel=0,this.drawBvhMaxLevel=65536,this.drawAabbs=!1,this.drawBases=!1,this.drawPairs=!1,this.drawContacts=!1,this.drawJoints=!0,this.drawJointLimits=!1,this.sphereCoords=new Array(5),this.tmpSphereVerts=new Array(5),this.tmpSphereNorms=new Array(5);let t=0;for(;t<5;){let s=t++,o=s==0||s==4?1:8;this.sphereCoords[s]=new Array(o),this.tmpSphereVerts[s]=new Array(o),this.tmpSphereNorms[s]=new Array(o);let n=0;for(;n<8;){let l=n++,_=s*.7853981633974475,r=l*.7853981633974475;this.sphereCoords[s][l]=new m.common.Vec3(Math.sin(_)*Math.cos(r),Math.cos(_),-Math.sin(_)*Math.sin(r)),this.tmpSphereVerts[s][l]=new m.common.Vec3,this.tmpSphereNorms[s][l]=new m.common.Vec3}}this.circleCoords=new Array(8),this.circleCoordsShift=new Array(8),this.tmpCircleVerts1=new Array(8),this.tmpCircleVerts2=new Array(8),this.tmpCircleNorms=new Array(8);let i=0;for(;i<8;){let s=i++;this.circleCoords[s]=new m.common.Vec3(Math.cos(s*.7853981633974475),0,-Math.sin(s*.7853981633974475)),this.circleCoordsShift[s]=new m.common.Vec3(Math.cos((s+.5)*.7853981633974475),0,-Math.sin((s+.5)*.7853981633974475)),this.tmpCircleVerts1[s]=new m.common.Vec3,this.tmpCircleVerts2[s]=new m.common.Vec3,this.tmpCircleNorms[s]=new m.common.Vec3}this.style=new m.dynamics.common.DebugDrawStyle}aabb(t,i,s){let o=this.p,n=(o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3]).init(t.x,t.y,t.z),l=this.p,_=(l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3]).init(t.x,t.y,i.z),r=this.p,e=(r.sizeVec3==0?new m.common.Vec3:r.stackVec3[--r.sizeVec3]).init(t.x,i.y,t.z),a=this.p,h=(a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3]).init(t.x,i.y,i.z),b=this.p,X=(b.sizeVec3==0?new m.common.Vec3:b.stackVec3[--b.sizeVec3]).init(i.x,t.y,t.z),c=this.p,Y=(c.sizeVec3==0?new m.common.Vec3:c.stackVec3[--c.sizeVec3]).init(i.x,t.y,i.z),p=this.p,x=(p.sizeVec3==0?new m.common.Vec3:p.stackVec3[--p.sizeVec3]).init(i.x,i.y,t.z),v=this.p,f=(v.sizeVec3==0?new m.common.Vec3:v.stackVec3[--v.sizeVec3]).init(i.x,i.y,i.z);this.line(n,_,s),this.line(e,h,s),this.line(X,Y,s),this.line(x,f,s),this.line(n,e,s),this.line(_,h,s),this.line(X,x,s),this.line(Y,f,s),this.line(n,X,s),this.line(_,Y,s),this.line(e,x,s),this.line(h,f,s);let Z=this.p;if(n!=null){if(n.zero(),Z.sizeVec3==Z.stackVec3.length){let j=new Array(Z.sizeVec3<<1),L=0,V=Z.sizeVec3;for(;L<V;){let M=L++;j[M]=Z.stackVec3[M],Z.stackVec3[M]=null}Z.stackVec3=j}Z.stackVec3[Z.sizeVec3++]=n}let k=this.p;if(_!=null){if(_.zero(),k.sizeVec3==k.stackVec3.length){let j=new Array(k.sizeVec3<<1),L=0,V=k.sizeVec3;for(;L<V;){let M=L++;j[M]=k.stackVec3[M],k.stackVec3[M]=null}k.stackVec3=j}k.stackVec3[k.sizeVec3++]=_}let g=this.p;if(e!=null){if(e.zero(),g.sizeVec3==g.stackVec3.length){let j=new Array(g.sizeVec3<<1),L=0,V=g.sizeVec3;for(;L<V;){let M=L++;j[M]=g.stackVec3[M],g.stackVec3[M]=null}g.stackVec3=j}g.stackVec3[g.sizeVec3++]=e}let I=this.p;if(h!=null){if(h.zero(),I.sizeVec3==I.stackVec3.length){let j=new Array(I.sizeVec3<<1),L=0,V=I.sizeVec3;for(;L<V;){let M=L++;j[M]=I.stackVec3[M],I.stackVec3[M]=null}I.stackVec3=j}I.stackVec3[I.sizeVec3++]=h}let z=this.p;if(X!=null){if(X.zero(),z.sizeVec3==z.stackVec3.length){let j=new Array(z.sizeVec3<<1),L=0,V=z.sizeVec3;for(;L<V;){let M=L++;j[M]=z.stackVec3[M],z.stackVec3[M]=null}z.stackVec3=j}z.stackVec3[z.sizeVec3++]=X}let d=this.p;if(Y!=null){if(Y.zero(),d.sizeVec3==d.stackVec3.length){let j=new Array(d.sizeVec3<<1),L=0,V=d.sizeVec3;for(;L<V;){let M=L++;j[M]=d.stackVec3[M],d.stackVec3[M]=null}d.stackVec3=j}d.stackVec3[d.sizeVec3++]=Y}let u=this.p;if(x!=null){if(x.zero(),u.sizeVec3==u.stackVec3.length){let j=new Array(u.sizeVec3<<1),L=0,V=u.sizeVec3;for(;L<V;){let M=L++;j[M]=u.stackVec3[M],u.stackVec3[M]=null}u.stackVec3=j}u.stackVec3[u.sizeVec3++]=x}let B=this.p;if(f!=null){if(f.zero(),B.sizeVec3==B.stackVec3.length){let j=new Array(B.sizeVec3<<1),L=0,V=B.sizeVec3;for(;L<V;){let M=L++;j[M]=B.stackVec3[M],B.stackVec3[M]=null}B.stackVec3=j}B.stackVec3[B.sizeVec3++]=f}}basis(t,i,s,o,n){let l=this.p,_=l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3],r=this.p,e=r.sizeMat3==0?new m.common.Mat3:r.stackMat3[--r.sizeMat3],a=this.p,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3],b=this.p,X=b.sizeVec3==0?new m.common.Vec3:b.stackVec3[--b.sizeVec3],c=this.p,Y=c.sizeVec3==0?new m.common.Vec3:c.stackVec3[--c.sizeVec3],p=_;p.x=t._positionX,p.y=t._positionY,p.z=t._positionZ;let x=e;x.e00=t._rotation00,x.e01=t._rotation01,x.e02=t._rotation02,x.e10=t._rotation10,x.e11=t._rotation11,x.e12=t._rotation12,x.e20=t._rotation20,x.e21=t._rotation21,x.e22=t._rotation22,h.init(e.e00,e.e10,e.e20),X.init(e.e01,e.e11,e.e21),Y.init(e.e02,e.e12,e.e22),h.x*=i,h.y*=i,h.z*=i;let v=h;v.x+=_.x,v.y+=_.y,v.z+=_.z,X.x*=i,X.y*=i,X.z*=i;let f=X;f.x+=_.x,f.y+=_.y,f.z+=_.z,Y.x*=i,Y.y*=i,Y.z*=i;let Z=Y;Z.x+=_.x,Z.y+=_.y,Z.z+=_.z,this.line(_,h,s),this.line(_,X,o),this.line(_,Y,n);let k=this.p;if(_!=null){if(_.zero(),k.sizeVec3==k.stackVec3.length){let u=new Array(k.sizeVec3<<1),B=0,j=k.sizeVec3;for(;B<j;){let L=B++;u[L]=k.stackVec3[L],k.stackVec3[L]=null}k.stackVec3=u}k.stackVec3[k.sizeVec3++]=_}let g=this.p;if(e!=null){if(e.e00=1,e.e01=0,e.e02=0,e.e10=0,e.e11=1,e.e12=0,e.e20=0,e.e21=0,e.e22=1,g.sizeMat3==g.stackMat3.length){let u=new Array(g.sizeMat3<<1),B=0,j=g.sizeMat3;for(;B<j;){let L=B++;u[L]=g.stackMat3[L],g.stackMat3[L]=null}g.stackMat3=u}g.stackMat3[g.sizeMat3++]=e}let I=this.p;if(h!=null){if(h.zero(),I.sizeVec3==I.stackVec3.length){let u=new Array(I.sizeVec3<<1),B=0,j=I.sizeVec3;for(;B<j;){let L=B++;u[L]=I.stackVec3[L],I.stackVec3[L]=null}I.stackVec3=u}I.stackVec3[I.sizeVec3++]=h}let z=this.p;if(X!=null){if(X.zero(),z.sizeVec3==z.stackVec3.length){let u=new Array(z.sizeVec3<<1),B=0,j=z.sizeVec3;for(;B<j;){let L=B++;u[L]=z.stackVec3[L],z.stackVec3[L]=null}z.stackVec3=u}z.stackVec3[z.sizeVec3++]=X}let d=this.p;if(Y!=null){if(Y.zero(),d.sizeVec3==d.stackVec3.length){let u=new Array(d.sizeVec3<<1),B=0,j=d.sizeVec3;for(;B<j;){let L=B++;u[L]=d.stackVec3[L],d.stackVec3[L]=null}d.stackVec3=u}d.stackVec3[d.sizeVec3++]=Y}}ellipse(t,i,s,o,n,l){this.arc(t,i,s,o,n,0,6.28318530717958,!1,l)}arc(t,i,s,o,n,l,_,r,e){let a=this.p,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3];h.x=i.x,h.y=i.y,h.z=i.z;let b=h;b.x*=o,b.y*=o,b.z*=o;let X=this.p,c=X.sizeVec3==0?new m.common.Vec3:X.stackVec3[--X.sizeVec3];c.x=s.x,c.y=s.y,c.z=s.z;let Y=c;Y.x*=n,Y.y*=n,Y.z*=n;let p=_-l;p<0&&(p=-p);let x=p/.5235987755982984+.5|0;x==0&&(x=1);let v=l,f=(_-l)/x,Z=this.p,k=Z.sizeVec3==0?new m.common.Vec3:Z.stackVec3[--Z.sizeVec3];k.x=t.x,k.y=t.y,k.z=t.z;let g=k,I=Math.cos(l);g.x+=b.x*I,g.y+=b.y*I,g.z+=b.z*I;let z=Math.sin(l);g.x+=Y.x*z,g.y+=Y.y*z,g.z+=Y.z*z;let d=g;r&&this.line(t,g,e);let u=0,B=x;for(;u<B;){++u,v+=f;let M=this.p,w=M.sizeVec3==0?new m.common.Vec3:M.stackVec3[--M.sizeVec3];w.x=t.x,w.y=t.y,w.z=t.z;let P=w,E=Math.cos(v);P.x+=b.x*E,P.y+=b.y*E,P.z+=b.z*E;let C=Math.sin(v);P.x+=Y.x*C,P.y+=Y.y*C,P.z+=Y.z*C,this.line(d,P,e);let S=this.p;if(d!=null){if(d.zero(),S.sizeVec3==S.stackVec3.length){let A=new Array(S.sizeVec3<<1),R=0,H=S.sizeVec3;for(;R<H;){let y=R++;A[y]=S.stackVec3[y],S.stackVec3[y]=null}S.stackVec3=A}S.stackVec3[S.sizeVec3++]=d}d=P}r&&this.line(t,d,e);let j=this.p;if(d!=null){if(d.zero(),j.sizeVec3==j.stackVec3.length){let M=new Array(j.sizeVec3<<1),w=0,P=j.sizeVec3;for(;w<P;){let E=w++;M[E]=j.stackVec3[E],j.stackVec3[E]=null}j.stackVec3=M}j.stackVec3[j.sizeVec3++]=d}let L=this.p;if(b!=null){if(b.zero(),L.sizeVec3==L.stackVec3.length){let M=new Array(L.sizeVec3<<1),w=0,P=L.sizeVec3;for(;w<P;){let E=w++;M[E]=L.stackVec3[E],L.stackVec3[E]=null}L.stackVec3=M}L.stackVec3[L.sizeVec3++]=b}let V=this.p;if(Y!=null){if(Y.zero(),V.sizeVec3==V.stackVec3.length){let M=new Array(V.sizeVec3<<1),w=0,P=V.sizeVec3;for(;w<P;){let E=w++;M[E]=V.stackVec3[E],V.stackVec3[E]=null}V.stackVec3=M}V.stackVec3[V.sizeVec3++]=Y}}cone(t,i,s,o){let n=this.p,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],_=this.p,r=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],e=this.p,a=e.sizeVec3==0?new m.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this.p,c=X.sizeMat3==0?new m.common.Mat3:X.stackMat3[--X.sizeMat3],Y=b;Y.x=t._positionX,Y.y=t._positionY,Y.z=t._positionZ;let p=c;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(c.e00,c.e10,c.e20),r.init(c.e01,c.e11,c.e21),a.init(c.e02,c.e12,c.e22);let x=this.p,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3];v.x=b.x,v.y=b.y,v.z=b.z;let f=v;f.x+=r.x*s,f.y+=r.y*s,f.z+=r.z*s;let Z=this.p,k=Z.sizeVec3==0?new m.common.Vec3:Z.stackVec3[--Z.sizeVec3];k.x=b.x,k.y=b.y,k.z=b.z;let g=k,I=-s;if(g.x+=r.x*I,g.y+=r.y*I,g.z+=r.z*I,this.wireframe){let M=this.p,w=M.sizeVec3==0?new m.common.Vec3:M.stackVec3[--M.sizeVec3];w.x=g.x,w.y=g.y,w.z=g.z;let P=w,E=-i;P.x+=l.x*E,P.y+=l.y*E,P.z+=l.z*E,P.x+=a.x*0,P.y+=a.y*0,P.z+=a.z*0;let C=this.p,S=C.sizeVec3==0?new m.common.Vec3:C.stackVec3[--C.sizeVec3];S.x=g.x,S.y=g.y,S.z=g.z;let A=S;A.x+=l.x*i,A.y+=l.y*i,A.z+=l.z*i,A.x+=a.x*0,A.y+=a.y*0,A.z+=a.z*0;let R=this.p,H=R.sizeVec3==0?new m.common.Vec3:R.stackVec3[--R.sizeVec3];H.x=g.x,H.y=g.y,H.z=g.z;let y=H;y.x+=l.x*0,y.y+=l.y*0,y.z+=l.z*0;let D=-i;y.x+=a.x*D,y.y+=a.y*D,y.z+=a.z*D;let F=this.p,Q=F.sizeVec3==0?new m.common.Vec3:F.stackVec3[--F.sizeVec3];Q.x=g.x,Q.y=g.y,Q.z=g.z;let W=Q;W.x+=l.x*0,W.y+=l.y*0,W.z+=l.z*0,W.x+=a.x*i,W.y+=a.y*i,W.z+=a.z*i,this.ellipse(g,l,a,i,i,o),this.line(f,P,o),this.line(f,A,o),this.line(f,y,o),this.line(f,W,o);let q=this.p;if(P!=null){if(P.zero(),q.sizeVec3==q.stackVec3.length){let N=new Array(q.sizeVec3<<1),K=0,O=q.sizeVec3;for(;K<O;){let $=K++;N[$]=q.stackVec3[$],q.stackVec3[$]=null}q.stackVec3=N}q.stackVec3[q.sizeVec3++]=P}let U=this.p;if(A!=null){if(A.zero(),U.sizeVec3==U.stackVec3.length){let N=new Array(U.sizeVec3<<1),K=0,O=U.sizeVec3;for(;K<O;){let $=K++;N[$]=U.stackVec3[$],U.stackVec3[$]=null}U.stackVec3=N}U.stackVec3[U.sizeVec3++]=A}let G=this.p;if(y!=null){if(y.zero(),G.sizeVec3==G.stackVec3.length){let N=new Array(G.sizeVec3<<1),K=0,O=G.sizeVec3;for(;K<O;){let $=K++;N[$]=G.stackVec3[$],G.stackVec3[$]=null}G.stackVec3=N}G.stackVec3[G.sizeVec3++]=y}let J=this.p;if(W!=null){if(W.zero(),J.sizeVec3==J.stackVec3.length){let N=new Array(J.sizeVec3<<1),K=0,O=J.sizeVec3;for(;K<O;){let $=K++;N[$]=J.stackVec3[$],J.stackVec3[$]=null}J.stackVec3=N}J.stackVec3[J.sizeVec3++]=W}}else{let M=1/Math.sqrt(i*i+4*s*s),w=2*s*M,P=i*M,E=0;for(;E<8;){let S=E++,A=this.tmpCircleNorms[S],R=this.circleCoords[S];A.x=R.x,A.y=R.y,A.z=R.z,A.x*=w,A.y*=w,A.z*=w,A.y+=P;let H=this.tmpCircleNorms[S],y=H.x*c.e10+H.y*c.e11+H.z*c.e12,D=H.x*c.e20+H.y*c.e21+H.z*c.e22;H.x=H.x*c.e00+H.y*c.e01+H.z*c.e02,H.y=y,H.z=D;let F=this.tmpCircleVerts1[S],Q=this.circleCoordsShift[S];F.x=Q.x,F.y=Q.y,F.z=Q.z,F.x*=w,F.y*=w,F.z*=w,F.y+=P;let W=this.tmpCircleVerts1[S],q=W.x*c.e10+W.y*c.e11+W.z*c.e12,U=W.x*c.e20+W.y*c.e21+W.z*c.e22;W.x=W.x*c.e00+W.y*c.e01+W.z*c.e02,W.y=q,W.z=U;let G=this.tmpCircleVerts2[S],J=this.circleCoords[S];G.x=J.x,G.y=J.y,G.z=J.z;let N=G.x*c.e10+G.y*c.e11+G.z*c.e12,K=G.x*c.e20+G.y*c.e21+G.z*c.e22;G.x=G.x*c.e00+G.y*c.e01+G.z*c.e02,G.y=N,G.z=K,G.x*=i,G.y*=i,G.z*=i,G.x+=b.x,G.y+=b.y,G.z+=b.z;let O=this.tmpCircleVerts2[S],$=-s;O.x+=r.x*$,O.y+=r.y*$,O.z+=r.z*$}let C=0;for(;C<8;){let S=C++,A=this.tmpCircleVerts2[S],R=this.tmpCircleVerts2[(S+1)%8],H=this.tmpCircleVerts1[S];this.triangle(f,A,R,H,this.tmpCircleNorms[S],this.tmpCircleNorms[(S+1)%8],o),A=this.tmpCircleVerts2[(S+1)%8],R=this.tmpCircleVerts2[S];let y=this.p,D=y.sizeVec3==0?new m.common.Vec3:y.stackVec3[--y.sizeVec3];D.x=r.x,D.y=r.y,D.z=r.z;let F=D;F.x=-F.x,F.y=-F.y,F.z=-F.z,this.triangle(g,A,R,F,F,F,o);let Q=this.p;if(F!=null){if(F.zero(),Q.sizeVec3==Q.stackVec3.length){let W=new Array(Q.sizeVec3<<1),q=0,U=Q.sizeVec3;for(;q<U;){let G=q++;W[G]=Q.stackVec3[G],Q.stackVec3[G]=null}Q.stackVec3=W}Q.stackVec3[Q.sizeVec3++]=F}}}let z=this.p;if(f!=null){if(f.zero(),z.sizeVec3==z.stackVec3.length){let M=new Array(z.sizeVec3<<1),w=0,P=z.sizeVec3;for(;w<P;){let E=w++;M[E]=z.stackVec3[E],z.stackVec3[E]=null}z.stackVec3=M}z.stackVec3[z.sizeVec3++]=f}let d=this.p;if(g!=null){if(g.zero(),d.sizeVec3==d.stackVec3.length){let M=new Array(d.sizeVec3<<1),w=0,P=d.sizeVec3;for(;w<P;){let E=w++;M[E]=d.stackVec3[E],d.stackVec3[E]=null}d.stackVec3=M}d.stackVec3[d.sizeVec3++]=g}let u=this.p;if(b!=null){if(b.zero(),u.sizeVec3==u.stackVec3.length){let M=new Array(u.sizeVec3<<1),w=0,P=u.sizeVec3;for(;w<P;){let E=w++;M[E]=u.stackVec3[E],u.stackVec3[E]=null}u.stackVec3=M}u.stackVec3[u.sizeVec3++]=b}let B=this.p;if(c!=null){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,B.sizeMat3==B.stackMat3.length){let M=new Array(B.sizeMat3<<1),w=0,P=B.sizeMat3;for(;w<P;){let E=w++;M[E]=B.stackMat3[E],B.stackMat3[E]=null}B.stackMat3=M}B.stackMat3[B.sizeMat3++]=c}let j=this.p;if(l!=null){if(l.zero(),j.sizeVec3==j.stackVec3.length){let M=new Array(j.sizeVec3<<1),w=0,P=j.sizeVec3;for(;w<P;){let E=w++;M[E]=j.stackVec3[E],j.stackVec3[E]=null}j.stackVec3=M}j.stackVec3[j.sizeVec3++]=l}let L=this.p;if(r!=null){if(r.zero(),L.sizeVec3==L.stackVec3.length){let M=new Array(L.sizeVec3<<1),w=0,P=L.sizeVec3;for(;w<P;){let E=w++;M[E]=L.stackVec3[E],L.stackVec3[E]=null}L.stackVec3=M}L.stackVec3[L.sizeVec3++]=r}let V=this.p;if(a!=null){if(a.zero(),V.sizeVec3==V.stackVec3.length){let M=new Array(V.sizeVec3<<1),w=0,P=V.sizeVec3;for(;w<P;){let E=w++;M[E]=V.stackVec3[E],V.stackVec3[E]=null}V.stackVec3=M}V.stackVec3[V.sizeVec3++]=a}}cylinder(t,i,s,o){let n=this.p,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],_=this.p,r=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],e=this.p,a=e.sizeVec3==0?new m.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this.p,c=X.sizeMat3==0?new m.common.Mat3:X.stackMat3[--X.sizeMat3],Y=b;Y.x=t._positionX,Y.y=t._positionY,Y.z=t._positionZ;let p=c;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(c.e00,c.e10,c.e20),r.init(c.e01,c.e11,c.e21),a.init(c.e02,c.e12,c.e22);let x=this.p,v=x.sizeVec3==0?new m.common.Vec3:x.stackVec3[--x.sizeVec3];v.x=b.x,v.y=b.y,v.z=b.z;let f=v;f.x+=r.x*s,f.y+=r.y*s,f.z+=r.z*s;let Z=this.p,k=Z.sizeVec3==0?new m.common.Vec3:Z.stackVec3[--Z.sizeVec3];k.x=b.x,k.y=b.y,k.z=b.z;let g=k,I=-s;if(g.x+=r.x*I,g.y+=r.y*I,g.z+=r.z*I,this.wireframe){let M=this.p,w=M.sizeVec3==0?new m.common.Vec3:M.stackVec3[--M.sizeVec3];w.x=f.x,w.y=f.y,w.z=f.z;let P=w,E=-i;P.x+=l.x*E,P.y+=l.y*E,P.z+=l.z*E,P.x+=a.x*0,P.y+=a.y*0,P.z+=a.z*0;let C=this.p,S=C.sizeVec3==0?new m.common.Vec3:C.stackVec3[--C.sizeVec3];S.x=f.x,S.y=f.y,S.z=f.z;let A=S;A.x+=l.x*i,A.y+=l.y*i,A.z+=l.z*i,A.x+=a.x*0,A.y+=a.y*0,A.z+=a.z*0;let R=this.p,H=R.sizeVec3==0?new m.common.Vec3:R.stackVec3[--R.sizeVec3];H.x=f.x,H.y=f.y,H.z=f.z;let y=H;y.x+=l.x*0,y.y+=l.y*0,y.z+=l.z*0;let D=-i;y.x+=a.x*D,y.y+=a.y*D,y.z+=a.z*D;let F=this.p,Q=F.sizeVec3==0?new m.common.Vec3:F.stackVec3[--F.sizeVec3];Q.x=f.x,Q.y=f.y,Q.z=f.z;let W=Q;W.x+=l.x*0,W.y+=l.y*0,W.z+=l.z*0,W.x+=a.x*i,W.y+=a.y*i,W.z+=a.z*i;let q=this.p,U=q.sizeVec3==0?new m.common.Vec3:q.stackVec3[--q.sizeVec3];U.x=g.x,U.y=g.y,U.z=g.z;let G=U,J=-i;G.x+=l.x*J,G.y+=l.y*J,G.z+=l.z*J,G.x+=a.x*0,G.y+=a.y*0,G.z+=a.z*0;let N=this.p,K=N.sizeVec3==0?new m.common.Vec3:N.stackVec3[--N.sizeVec3];K.x=g.x,K.y=g.y,K.z=g.z;let O=K;O.x+=l.x*i,O.y+=l.y*i,O.z+=l.z*i,O.x+=a.x*0,O.y+=a.y*0,O.z+=a.z*0;let $=this.p,et=$.sizeVec3==0?new m.common.Vec3:$.stackVec3[--$.sizeVec3];et.x=g.x,et.y=g.y,et.z=g.z;let st=et;st.x+=l.x*0,st.y+=l.y*0,st.z+=l.z*0;let lt=-i;st.x+=a.x*lt,st.y+=a.y*lt,st.z+=a.z*lt;let rt=this.p,at=rt.sizeVec3==0?new m.common.Vec3:rt.stackVec3[--rt.sizeVec3];at.x=g.x,at.y=g.y,at.z=g.z;let ot=at;ot.x+=l.x*0,ot.y+=l.y*0,ot.z+=l.z*0,ot.x+=a.x*i,ot.y+=a.y*i,ot.z+=a.z*i,this.ellipse(f,l,a,i,i,o),this.ellipse(g,l,a,i,i,o),this.line(P,G,o),this.line(A,O,o),this.line(y,st,o),this.line(W,ot,o);let ht=this.p;if(P!=null){if(P.zero(),ht.sizeVec3==ht.stackVec3.length){let Yt=new Array(ht.sizeVec3<<1),pt=0,ct=ht.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=ht.stackVec3[nt],ht.stackVec3[nt]=null}ht.stackVec3=Yt}ht.stackVec3[ht.sizeVec3++]=P}let _t=this.p;if(A!=null){if(A.zero(),_t.sizeVec3==_t.stackVec3.length){let Yt=new Array(_t.sizeVec3<<1),pt=0,ct=_t.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=_t.stackVec3[nt],_t.stackVec3[nt]=null}_t.stackVec3=Yt}_t.stackVec3[_t.sizeVec3++]=A}let bt=this.p;if(y!=null){if(y.zero(),bt.sizeVec3==bt.stackVec3.length){let Yt=new Array(bt.sizeVec3<<1),pt=0,ct=bt.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=bt.stackVec3[nt],bt.stackVec3[nt]=null}bt.stackVec3=Yt}bt.stackVec3[bt.sizeVec3++]=y}let Xt=this.p;if(W!=null){if(W.zero(),Xt.sizeVec3==Xt.stackVec3.length){let Yt=new Array(Xt.sizeVec3<<1),pt=0,ct=Xt.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=Xt.stackVec3[nt],Xt.stackVec3[nt]=null}Xt.stackVec3=Yt}Xt.stackVec3[Xt.sizeVec3++]=W}let ft=this.p;if(G!=null){if(G.zero(),ft.sizeVec3==ft.stackVec3.length){let Yt=new Array(ft.sizeVec3<<1),pt=0,ct=ft.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=ft.stackVec3[nt],ft.stackVec3[nt]=null}ft.stackVec3=Yt}ft.stackVec3[ft.sizeVec3++]=G}let Zt=this.p;if(O!=null){if(O.zero(),Zt.sizeVec3==Zt.stackVec3.length){let Yt=new Array(Zt.sizeVec3<<1),pt=0,ct=Zt.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=Zt.stackVec3[nt],Zt.stackVec3[nt]=null}Zt.stackVec3=Yt}Zt.stackVec3[Zt.sizeVec3++]=O}let xt=this.p;if(st!=null){if(st.zero(),xt.sizeVec3==xt.stackVec3.length){let Yt=new Array(xt.sizeVec3<<1),pt=0,ct=xt.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=xt.stackVec3[nt],xt.stackVec3[nt]=null}xt.stackVec3=Yt}xt.stackVec3[xt.sizeVec3++]=st}let zt=this.p;if(ot!=null){if(ot.zero(),zt.sizeVec3==zt.stackVec3.length){let Yt=new Array(zt.sizeVec3<<1),pt=0,ct=zt.sizeVec3;for(;pt<ct;){let nt=pt++;Yt[nt]=zt.stackVec3[nt],zt.stackVec3[nt]=null}zt.stackVec3=Yt}zt.stackVec3[zt.sizeVec3++]=ot}}else{let M=0;for(;M<8;){let P=M++,E=this.tmpCircleNorms[P],C=this.circleCoords[P];E.x=C.x,E.y=C.y,E.z=C.z;let S=E.x*c.e10+E.y*c.e11+E.z*c.e12,A=E.x*c.e20+E.y*c.e21+E.z*c.e22;E.x=E.x*c.e00+E.y*c.e01+E.z*c.e02,E.y=S,E.z=A;let R=this.tmpCircleVerts1[P],H=this.tmpCircleNorms[P];R.x=H.x,R.y=H.y,R.z=H.z,R.x*=i,R.y*=i,R.z*=i,R.x+=b.x,R.y+=b.y,R.z+=b.z;let y=this.tmpCircleVerts2[P],D=this.tmpCircleVerts1[P];y.x=D.x,y.y=D.y,y.z=D.z;let F=this.tmpCircleVerts1[P];F.x+=r.x*s,F.y+=r.y*s,F.z+=r.z*s;let Q=this.tmpCircleVerts2[P],W=-s;Q.x+=r.x*W,Q.y+=r.y*W,Q.z+=r.z*W}let w=0;for(;w<8;){let P=w++,E,C=this.tmpCircleVerts1[P],S=this.tmpCircleVerts1[(P+1)%8],A=r;this.triangle(f,C,S,A,A,A,o),C=this.tmpCircleVerts2[(P+1)%8],S=this.tmpCircleVerts2[P];let R=this.p,H=R.sizeVec3==0?new m.common.Vec3:R.stackVec3[--R.sizeVec3];H.x=r.x,H.y=r.y,H.z=r.z;let y=H;y.x=-y.x,y.y=-y.y,y.z=-y.z,this.triangle(g,C,S,y,y,y,o);let D=this.p;if(y!=null){if(y.zero(),D.sizeVec3==D.stackVec3.length){let Q=new Array(D.sizeVec3<<1),W=0,q=D.sizeVec3;for(;W<q;){let U=W++;Q[U]=D.stackVec3[U],D.stackVec3[U]=null}D.stackVec3=Q}D.stackVec3[D.sizeVec3++]=y}E=this.tmpCircleVerts1[P],C=this.tmpCircleVerts2[P],S=this.tmpCircleVerts2[(P+1)%8],A=this.tmpCircleNorms[P];let F=this.tmpCircleNorms[(P+1)%8];this.rect(E,C,S,this.tmpCircleVerts1[(P+1)%8],A,A,F,F,o)}}let z=this.p;if(f!=null){if(f.zero(),z.sizeVec3==z.stackVec3.length){let M=new Array(z.sizeVec3<<1),w=0,P=z.sizeVec3;for(;w<P;){let E=w++;M[E]=z.stackVec3[E],z.stackVec3[E]=null}z.stackVec3=M}z.stackVec3[z.sizeVec3++]=f}let d=this.p;if(g!=null){if(g.zero(),d.sizeVec3==d.stackVec3.length){let M=new Array(d.sizeVec3<<1),w=0,P=d.sizeVec3;for(;w<P;){let E=w++;M[E]=d.stackVec3[E],d.stackVec3[E]=null}d.stackVec3=M}d.stackVec3[d.sizeVec3++]=g}let u=this.p;if(b!=null){if(b.zero(),u.sizeVec3==u.stackVec3.length){let M=new Array(u.sizeVec3<<1),w=0,P=u.sizeVec3;for(;w<P;){let E=w++;M[E]=u.stackVec3[E],u.stackVec3[E]=null}u.stackVec3=M}u.stackVec3[u.sizeVec3++]=b}let B=this.p;if(c!=null){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,B.sizeMat3==B.stackMat3.length){let M=new Array(B.sizeMat3<<1),w=0,P=B.sizeMat3;for(;w<P;){let E=w++;M[E]=B.stackMat3[E],B.stackMat3[E]=null}B.stackMat3=M}B.stackMat3[B.sizeMat3++]=c}let j=this.p;if(l!=null){if(l.zero(),j.sizeVec3==j.stackVec3.length){let M=new Array(j.sizeVec3<<1),w=0,P=j.sizeVec3;for(;w<P;){let E=w++;M[E]=j.stackVec3[E],j.stackVec3[E]=null}j.stackVec3=M}j.stackVec3[j.sizeVec3++]=l}let L=this.p;if(r!=null){if(r.zero(),L.sizeVec3==L.stackVec3.length){let M=new Array(L.sizeVec3<<1),w=0,P=L.sizeVec3;for(;w<P;){let E=w++;M[E]=L.stackVec3[E],L.stackVec3[E]=null}L.stackVec3=M}L.stackVec3[L.sizeVec3++]=r}let V=this.p;if(a!=null){if(a.zero(),V.sizeVec3==V.stackVec3.length){let M=new Array(V.sizeVec3<<1),w=0,P=V.sizeVec3;for(;w<P;){let E=w++;M[E]=V.stackVec3[E],V.stackVec3[E]=null}V.stackVec3=M}V.stackVec3[V.sizeVec3++]=a}}capsule(t,i,s,o){let n=this.p,l=n.sizeVec3==0?new m.common.Vec3:n.stackVec3[--n.sizeVec3],_=this.p,r=_.sizeVec3==0?new m.common.Vec3:_.stackVec3[--_.sizeVec3],e=this.p,a=e.sizeVec3==0?new m.common.Vec3:e.stackVec3[--e.sizeVec3],h=this.p,b=h.sizeVec3==0?new m.common.Vec3:h.stackVec3[--h.sizeVec3],X=this.p,c=X.sizeMat3==0?new m.common.Mat3:X.stackMat3[--X.sizeMat3],Y=b;Y.x=t._positionX,Y.y=t._positionY,Y.z=t._positionZ;let p=c;p.e00=t._rotation00,p.e01=t._rotation01,p.e02=t._rotation02,p.e10=t._rotation10,p.e11=t._rotation11,p.e12=t._rotation12,p.e20=t._rotation20,p.e21=t._rotation21,p.e22=t._rotation22,l.init(c.e00,c.e10,c.e20),r.init(c.e01,c.e11,c.e21),a.init(c.e02,c.e12,c.e22);let x=this.tmpSphereVerts,v=this.tmpSphereNorms,f=0;for(;f<5;){let C=f++,S=this.tmpSphereVerts[C].length,A=0;for(;A<S;){let R=A++,H=v[C][R],y=this.sphereCoords[C][R];H.x=y.x,H.y=y.y,H.z=y.z;let D=H.x*c.e10+H.y*c.e11+H.z*c.e12,F=H.x*c.e20+H.y*c.e21+H.z*c.e22;H.x=H.x*c.e00+H.y*c.e01+H.z*c.e02,H.y=D,H.z=F}}let Z=0;for(;Z<4;){let C=Z++;if(C==0){let A=0;for(;A<3;){let R=A++,H=this.tmpSphereVerts[R].length,y=0;for(;y<H;){let D=y++,F=x[R][D],Q=v[R][D];F.x=Q.x,F.y=Q.y,F.z=Q.z,F.x*=i,F.y*=i,F.z*=i,F.x+=b.x,F.y+=b.y,F.z+=b.z,F.x+=r.x*s,F.y+=r.y*s,F.z+=r.z*s}}}if(C==2){let A=2;for(;A<5;){let R=A++,H=this.tmpSphereVerts[R].length,y=0;for(;y<H;){let D=y++,F=x[R][D],Q=v[R][D];F.x=Q.x,F.y=Q.y,F.z=Q.z,F.x*=i,F.y*=i,F.z*=i,F.x+=b.x,F.y+=b.y,F.z+=b.z;let W=-s;F.x+=r.x*W,F.y+=r.y*W,F.z+=r.z*W}}}let S=0;for(;S<8;){let A=S++,R,H,y,D,F,Q,W,q;C==0?this.wireframe?(R=x[0][0],H=x[1][A],this.line(R,H,o)):(R=x[0][0],H=x[1][A],y=x[1][(A+1)%8],F=v[0][0],Q=v[1][A],W=v[1][(A+1)%8],this.triangle(R,H,y,F,Q,W,o)):C==3?this.wireframe?(R=x[4][0],H=x[C][(A+1)%8],y=x[C][A],this.line(R,H,o),this.line(H,y,o)):(R=x[4][0],H=x[C][(A+1)%8],y=x[C][A],F=v[4][0],Q=v[C][(A+1)%8],W=v[C][A],this.triangle(R,H,y,F,Q,W,o)):this.wireframe?(R=x[C][A],H=x[C][(A+1)%8],y=x[C+1][A],this.line(R,H,o),this.line(R,y,o)):(R=x[C][A],H=x[C][(A+1)%8],y=x[C+1][A],D=x[C+1][(A+1)%8],F=v[C][A],Q=v[C][(A+1)%8],W=v[C+1][A],q=v[C+1][(A+1)%8],this.rect(R,y,D,H,F,W,q,Q,o))}}let k=this.p,g=k.sizeVec3==0?new m.common.Vec3:k.stackVec3[--k.sizeVec3];g.x=b.x,g.y=b.y,g.z=b.z;let I=g;I.x+=r.x*s,I.y+=r.y*s,I.z+=r.z*s;let z=this.p,d=z.sizeVec3==0?new m.common.Vec3:z.stackVec3[--z.sizeVec3];d.x=b.x,d.y=b.y,d.z=b.z;let u=d,B=-s;if(u.x+=r.x*B,u.y+=r.y*B,u.z+=r.z*B,this.wireframe){let C=this.p,S=C.sizeVec3==0?new m.common.Vec3:C.stackVec3[--C.sizeVec3];S.x=I.x,S.y=I.y,S.z=I.z;let A=S,R=-i;A.x+=l.x*R,A.y+=l.y*R,A.z+=l.z*R,A.x+=a.x*0,A.y+=a.y*0,A.z+=a.z*0;let H=this.p,y=H.sizeVec3==0?new m.common.Vec3:H.stackVec3[--H.sizeVec3];y.x=I.x,y.y=I.y,y.z=I.z;let D=y;D.x+=l.x*i,D.y+=l.y*i,D.z+=l.z*i,D.x+=a.x*0,D.y+=a.y*0,D.z+=a.z*0;let F=this.p,Q=F.sizeVec3==0?new m.common.Vec3:F.stackVec3[--F.sizeVec3];Q.x=I.x,Q.y=I.y,Q.z=I.z;let W=Q;W.x+=l.x*0,W.y+=l.y*0,W.z+=l.z*0;let q=-i;W.x+=a.x*q,W.y+=a.y*q,W.z+=a.z*q;let U=this.p,G=U.sizeVec3==0?new m.common.Vec3:U.stackVec3[--U.sizeVec3];G.x=I.x,G.y=I.y,G.z=I.z;let J=G;J.x+=l.x*0,J.y+=l.y*0,J.z+=l.z*0,J.x+=a.x*i,J.y+=a.y*i,J.z+=a.z*i;let N=this.p,K=N.sizeVec3==0?new m.common.Vec3:N.stackVec3[--N.sizeVec3];K.x=u.x,K.y=u.y,K.z=u.z;let O=K,$=-i;O.x+=l.x*$,O.y+=l.y*$,O.z+=l.z*$,O.x+=a.x*0,O.y+=a.y*0,O.z+=a.z*0;let et=this.p,st=et.sizeVec3==0?new m.common.Vec3:et.stackVec3[--et.sizeVec3];st.x=u.x,st.y=u.y,st.z=u.z;let lt=st;lt.x+=l.x*i,lt.y+=l.y*i,lt.z+=l.z*i,lt.x+=a.x*0,lt.y+=a.y*0,lt.z+=a.z*0;let rt=this.p,at=rt.sizeVec3==0?new m.common.Vec3:rt.stackVec3[--rt.sizeVec3];at.x=u.x,at.y=u.y,at.z=u.z;let ot=at;ot.x+=l.x*0,ot.y+=l.y*0,ot.z+=l.z*0;let ht=-i;ot.x+=a.x*ht,ot.y+=a.y*ht,ot.z+=a.z*ht;let _t=this.p,bt=_t.sizeVec3==0?new m.common.Vec3:_t.stackVec3[--_t.sizeVec3];bt.x=u.x,bt.y=u.y,bt.z=u.z;let Xt=bt;Xt.x+=l.x*0,Xt.y+=l.y*0,Xt.z+=l.z*0,Xt.x+=a.x*i,Xt.y+=a.y*i,Xt.z+=a.z*i,this.ellipse(I,l,a,i,i,o),this.ellipse(u,l,a,i,i,o),this.line(A,O,o),this.line(D,lt,o),this.line(W,ot,o),this.line(J,Xt,o);let ft=this.p;if(A!=null){if(A.zero(),ft.sizeVec3==ft.stackVec3.length){let tt=new Array(ft.sizeVec3<<1),Lt=0,Bt=ft.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=ft.stackVec3[Mt],ft.stackVec3[Mt]=null}ft.stackVec3=tt}ft.stackVec3[ft.sizeVec3++]=A}let Zt=this.p;if(D!=null){if(D.zero(),Zt.sizeVec3==Zt.stackVec3.length){let tt=new Array(Zt.sizeVec3<<1),Lt=0,Bt=Zt.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=Zt.stackVec3[Mt],Zt.stackVec3[Mt]=null}Zt.stackVec3=tt}Zt.stackVec3[Zt.sizeVec3++]=D}let xt=this.p;if(W!=null){if(W.zero(),xt.sizeVec3==xt.stackVec3.length){let tt=new Array(xt.sizeVec3<<1),Lt=0,Bt=xt.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=xt.stackVec3[Mt],xt.stackVec3[Mt]=null}xt.stackVec3=tt}xt.stackVec3[xt.sizeVec3++]=W}let zt=this.p;if(J!=null){if(J.zero(),zt.sizeVec3==zt.stackVec3.length){let tt=new Array(zt.sizeVec3<<1),Lt=0,Bt=zt.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=zt.stackVec3[Mt],zt.stackVec3[Mt]=null}zt.stackVec3=tt}zt.stackVec3[zt.sizeVec3++]=J}let Yt=this.p;if(O!=null){if(O.zero(),Yt.sizeVec3==Yt.stackVec3.length){let tt=new Array(Yt.sizeVec3<<1),Lt=0,Bt=Yt.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=Yt.stackVec3[Mt],Yt.stackVec3[Mt]=null}Yt.stackVec3=tt}Yt.stackVec3[Yt.sizeVec3++]=O}let pt=this.p;if(lt!=null){if(lt.zero(),pt.sizeVec3==pt.stackVec3.length){let tt=new Array(pt.sizeVec3<<1),Lt=0,Bt=pt.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=pt.stackVec3[Mt],pt.stackVec3[Mt]=null}pt.stackVec3=tt}pt.stackVec3[pt.sizeVec3++]=lt}let ct=this.p;if(ot!=null){if(ot.zero(),ct.sizeVec3==ct.stackVec3.length){let tt=new Array(ct.sizeVec3<<1),Lt=0,Bt=ct.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=ct.stackVec3[Mt],ct.stackVec3[Mt]=null}ct.stackVec3=tt}ct.stackVec3[ct.sizeVec3++]=ot}let nt=this.p;if(Xt!=null){if(Xt.zero(),nt.sizeVec3==nt.stackVec3.length){let tt=new Array(nt.sizeVec3<<1),Lt=0,Bt=nt.sizeVec3;for(;Lt<Bt;){let Mt=Lt++;tt[Mt]=nt.stackVec3[Mt],nt.stackVec3[Mt]=null}nt.stackVec3=tt}nt.stackVec3[nt.sizeVec3++]=Xt}}else{let C=0;for(;C<8;){let A=C++,R=this.tmpCircleNorms[A],H=this.circleCoords[A];R.x=H.x,R.y=H.y,R.z=H.z;let y=R.x*c.e10+R.y*c.e11+R.z*c.e12,D=R.x*c.e20+R.y*c.e21+R.z*c.e22;R.x=R.x*c.e00+R.y*c.e01+R.z*c.e02,R.y=y,R.z=D;let F=this.tmpCircleVerts1[A],Q=this.tmpCircleNorms[A];F.x=Q.x,F.y=Q.y,F.z=Q.z,F.x*=i,F.y*=i,F.z*=i,F.x+=b.x,F.y+=b.y,F.z+=b.z;let W=this.tmpCircleVerts2[A],q=this.tmpCircleVerts1[A];W.x=q.x,W.y=q.y,W.z=q.z;let U=this.tmpCircleVerts1[A];U.x+=r.x*s,U.y+=r.y*s,U.z+=r.z*s;let G=this.tmpCircleVerts2[A],J=-s;G.x+=r.x*J,G.y+=r.y*J,G.z+=r.z*J}let S=0;for(;S<8;){let A=S++,R=this.tmpCircleNorms[A],H=this.tmpCircleNorms[(A+1)%8];this.rect(this.tmpCircleVerts1[A],this.tmpCircleVerts2[A],this.tmpCircleVerts2[(A+1)%8],this.tmpCircleVerts1[(A+1)%8],R,R,H,H,o)}}let j=this.p;if(I!=null){if(I.zero(),j.sizeVec3==j.stackVec3.length){let C=new Array(j.sizeVec3<<1),S=0,A=j.sizeVec3;for(;S<A;){let R=S++;C[R]=j.stackVec3[R],j.stackVec3[R]=null}j.stackVec3=C}j.stackVec3[j.sizeVec3++]=I}let L=this.p;if(u!=null){if(u.zero(),L.sizeVec3==L.stackVec3.length){let C=new Array(L.sizeVec3<<1),S=0,A=L.sizeVec3;for(;S<A;){let R=S++;C[R]=L.stackVec3[R],L.stackVec3[R]=null}L.stackVec3=C}L.stackVec3[L.sizeVec3++]=u}let V=this.p;if(b!=null){if(b.zero(),V.sizeVec3==V.stackVec3.length){let C=new Array(V.sizeVec3<<1),S=0,A=V.sizeVec3;for(;S<A;){let R=S++;C[R]=V.stackVec3[R],V.stackVec3[R]=null}V.stackVec3=C}V.stackVec3[V.sizeVec3++]=b}let M=this.p;if(c!=null){if(c.e00=1,c.e01=0,c.e02=0,c.e10=0,c.e11=1,c.e12=0,c.e20=0,c.e21=0,c.e22=1,M.sizeMat3==M.stackMat3.length){let C=new Array(M.sizeMat3<<1),S=0,A=M.sizeMat3;for(;S<A;){let R=S++;C[R]=M.stackMat3[R],M.stackMat3[R]=null}M.stackMat3=C}M.stackMat3[M.sizeMat3++]=c}let w=this.p;if(l!=null){if(l.zero(),w.sizeVec3==w.stackVec3.length){let C=new Array(w.sizeVec3<<1),S=0,A=w.sizeVec3;for(;S<A;){let R=S++;C[R]=w.stackVec3[R],w.stackVec3[R]=null}w.stackVec3=C}w.stackVec3[w.sizeVec3++]=l}let P=this.p;if(r!=null){if(r.zero(),P.sizeVec3==P.stackVec3.length){let C=new Array(P.sizeVec3<<1),S=0,A=P.sizeVec3;for(;S<A;){let R=S++;C[R]=P.stackVec3[R],P.stackVec3[R]=null}P.stackVec3=C}P.stackVec3[P.sizeVec3++]=r}let E=this.p;if(a!=null){if(a.zero(),E.sizeVec3==E.stackVec3.length){let C=new Array(E.sizeVec3<<1),S=0,A=E.sizeVec3;for(;S<A;){let R=S++;C[R]=E.stackVec3[R],E.stackVec3[R]=null}E.stackVec3=C}E.stackVec3[E.sizeVec3++]=a}}sphere(t,i,s){let o=this.p,n=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],l=this.p,_=l.sizeMat3==0?new m.common.Mat3:l.stackMat3[--l.sizeMat3],r=n;r.x=t._positionX,r.y=t._positionY,r.z=t._positionZ;let e=_;e.e00=t._rotation00,e.e01=t._rotation01,e.e02=t._rotation02,e.e10=t._rotation10,e.e11=t._rotation11,e.e12=t._rotation12,e.e20=t._rotation20,e.e21=t._rotation21,e.e22=t._rotation22;let a=this.tmpSphereVerts,h=this.tmpSphereNorms,b=0;for(;b<5;){let p=b++,x=this.tmpSphereVerts[p].length,v=0;for(;v<x;){let f=v++,Z=h[p][f],k=this.sphereCoords[p][f];Z.x=k.x,Z.y=k.y,Z.z=k.z;let g=Z.x*_.e10+Z.y*_.e11+Z.z*_.e12,I=Z.x*_.e20+Z.y*_.e21+Z.z*_.e22;Z.x=Z.x*_.e00+Z.y*_.e01+Z.z*_.e02,Z.y=g,Z.z=I;let z=a[p][f],d=h[p][f];z.x=d.x,z.y=d.y,z.z=d.z,z.x*=i,z.y*=i,z.z*=i,z.x+=n.x,z.y+=n.y,z.z+=n.z}}let X=0;for(;X<4;){let p=X++,x=0;for(;x<8;){let v=x++,f,Z,k,g,I,z,d,u;p==0?this.wireframe?(f=a[0][0],Z=a[1][v],this.line(f,Z,s)):(f=a[0][0],Z=a[1][v],k=a[1][(v+1)%8],I=h[0][0],z=h[1][v],d=h[1][(v+1)%8],this.triangle(f,Z,k,I,z,d,s)):p==3?this.wireframe?(f=a[4][0],Z=a[p][(v+1)%8],k=a[p][v],this.line(f,Z,s),this.line(Z,k,s)):(f=a[4][0],Z=a[p][(v+1)%8],k=a[p][v],I=h[4][0],z=h[p][(v+1)%8],d=h[p][v],this.triangle(f,Z,k,I,z,d,s)):this.wireframe?(f=a[p][v],Z=a[p][(v+1)%8],k=a[p+1][v],this.line(f,Z,s),this.line(f,k,s)):(f=a[p][v],Z=a[p][(v+1)%8],k=a[p+1][v],g=a[p+1][(v+1)%8],I=h[p][v],z=h[p][(v+1)%8],d=h[p+1][v],u=h[p+1][(v+1)%8],this.rect(f,k,g,Z,I,d,u,z,s))}}let c=this.p;if(n!=null){if(n.zero(),c.sizeVec3==c.stackVec3.length){let p=new Array(c.sizeVec3<<1),x=0,v=c.sizeVec3;for(;x<v;){let f=x++;p[f]=c.stackVec3[f],c.stackVec3[f]=null}c.stackVec3=p}c.stackVec3[c.sizeVec3++]=n}let Y=this.p;if(_!=null){if(_.e00=1,_.e01=0,_.e02=0,_.e10=0,_.e11=1,_.e12=0,_.e20=0,_.e21=0,_.e22=1,Y.sizeMat3==Y.stackMat3.length){let p=new Array(Y.sizeMat3<<1),x=0,v=Y.sizeMat3;for(;x<v;){let f=x++;p[f]=Y.stackMat3[f],Y.stackMat3[f]=null}Y.stackMat3=p}Y.stackMat3[Y.sizeMat3++]=_}}box(t,i,s){let o=this.p,n=o.sizeVec3==0?new m.common.Vec3:o.stackVec3[--o.sizeVec3],l=this.p,_=l.sizeVec3==0?new m.common.Vec3:l.stackVec3[--l.sizeVec3],r=this.p,e=r.sizeVec3==0?new m.common.Vec3:r.stackVec3[--r.sizeVec3],a=this.p,h=a.sizeVec3==0?new m.common.Vec3:a.stackVec3[--a.sizeVec3],b=this.p,X=b.sizeMat3==0?new m.common.Mat3:b.stackMat3[--b.sizeMat3],c=h;c.x=t._positionX,c.y=t._positionY,c.z=t._positionZ;let Y=X;Y.e00=t._rotation00,Y.e01=t._rotation01,Y.e02=t._rotation02,Y.e10=t._rotation10,Y.e11=t._rotation11,Y.e12=t._rotation12,Y.e20=t._rotation20,Y.e21=t._rotation21,Y.e22=t._rotation22,n.init(X.e00,X.e10,X.e20),_.init(X.e01,X.e11,X.e21),e.init(X.e02,X.e12,X.e22);let p=i.x,x=i.y,v=i.z,f=this.p,Z=f.sizeVec3==0?new m.common.Vec3:f.stackVec3[--f.sizeVec3];Z.x=h.x,Z.y=h.y,Z.z=h.z;let k=Z,g=-p;k.x+=n.x*g,k.y+=n.y*g,k.z+=n.z*g;let I=-x;k.x+=_.x*I,k.y+=_.y*I,k.z+=_.z*I;let z=-v;k.x+=e.x*z,k.y+=e.y*z,k.z+=e.z*z;let d=this.p,u=d.sizeVec3==0?new m.common.Vec3:d.stackVec3[--d.sizeVec3];u.x=h.x,u.y=h.y,u.z=h.z;let B=u,j=-p;B.x+=n.x*j,B.y+=n.y*j,B.z+=n.z*j;let L=-x;B.x+=_.x*L,B.y+=_.y*L,B.z+=_.z*L,B.x+=e.x*v,B.y+=e.y*v,B.z+=e.z*v;let V=this.p,M=V.sizeVec3==0?new m.common.Vec3:V.stackVec3[--V.sizeVec3];M.x=h.x,M.y=h.y,M.z=h.z;let w=M,P=-p;w.x+=n.x*P,w.y+=n.y*P,w.z+=n.z*P,w.x+=_.x*x,w.y+=_.y*x,w.z+=_.z*x;let E=-v;w.x+=e.x*E,w.y+=e.y*E,w.z+=e.z*E;let C=this.p,S=C.sizeVec3==0?new m.common.Vec3:C.stackVec3[--C.sizeVec3];S.x=h.x,S.y=h.y,S.z=h.z;let A=S,R=-p;A.x+=n.x*R,A.y+=n.y*R,A.z+=n.z*R,A.x+=_.x*x,A.y+=_.y*x,A.z+=_.z*x,A.x+=e.x*v,A.y+=e.y*v,A.z+=e.z*v;let H=this.p,y=H.sizeVec3==0?new m.common.Vec3:H.stackVec3[--H.sizeVec3];y.x=h.x,y.y=h.y,y.z=h.z;let D=y;D.x+=n.x*p,D.y+=n.y*p,D.z+=n.z*p;let F=-x;D.x+=_.x*F,D.y+=_.y*F,D.z+=_.z*F;let Q=-v;D.x+=e.x*Q,D.y+=e.y*Q,D.z+=e.z*Q;let W=this.p,q=W.sizeVec3==0?new m.common.Vec3:W.stackVec3[--W.sizeVec3];q.x=h.x,q.y=h.y,q.z=h.z;let U=q;U.x+=n.x*p,U.y+=n.y*p,U.z+=n.z*p;let G=-x;U.x+=_.x*G,U.y+=_.y*G,U.z+=_.z*G,U.x+=e.x*v,U.y+=e.y*v,U.z+=e.z*v;let J=this.p,N=J.sizeVec3==0?new m.common.Vec3:J.stackVec3[--J.sizeVec3];N.x=h.x,N.y=h.y,N.z=h.z;let K=N;K.x+=n.x*p,K.y+=n.y*p,K.z+=n.z*p,K.x+=_.x*x,K.y+=_.y*x,K.z+=_.z*x;let O=-v;K.x+=e.x*O,K.y+=e.y*O,K.z+=e.z*O;let $=this.p,et=$.sizeVec3==0?new m.common.Vec3:$.stackVec3[--$.sizeVec3];et.x=h.x,et.y=h.y,et.z=h.z;let st=et;if(st.x+=n.x*p,st.y+=n.y*p,st.z+=n.z*p,st.x+=_.x*x,st.y+=_.y*x,st.z+=_.z*x,st.x+=e.x*v,st.y+=e.y*v,st.z+=e.z*v,this.wireframe)this.line(k,B,s),this.line(w,A,s),this.line(D,U,s),this.line(K,st,s),this.line(k,w,s),this.line(B,A,s),this.line(D,K,s),this.line(U,st,s),this.line(k,D,s),this.line(B,U,s),this.line(w,K,s),this.line(A,st,s);else{let pt=this.p,ct=pt.sizeVec3==0?new m.common.Vec3:pt.stackVec3[--pt.sizeVec3];ct.x=n.x,ct.y=n.y,ct.z=n.z;let nt=ct;nt.x=-nt.x,nt.y=-nt.y,nt.z=-nt.z;let tt=this.p,Lt=tt.sizeVec3==0?new m.common.Vec3:tt.stackVec3[--tt.sizeVec3];Lt.x=_.x,Lt.y=_.y,Lt.z=_.z;let Bt=Lt;Bt.x=-Bt.x,Bt.y=-Bt.y,Bt.z=-Bt.z;let Mt=this.p,jt=Mt.sizeVec3==0?new m.common.Vec3:Mt.stackVec3[--Mt.sizeVec3];jt.x=e.x,jt.y=e.y,jt.z=e.z;let ci=jt;ci.x=-ci.x,ci.y=-ci.y,ci.z=-ci.z,this.rect(k,B,A,w,nt,nt,nt,nt,s),this.rect(D,K,st,U,n,n,n,n,s),this.rect(k,D,U,B,Bt,Bt,Bt,Bt,s),this.rect(w,A,st,K,_,_,_,_,s),this.rect(k,w,K,D,ci,ci,ci,ci,s),this.rect(B,U,st,A,e,e,e,e,s);let Xi=this.p;if(nt!=null){if(nt.zero(),Xi.sizeVec3==Xi.stackVec3.length){let wi=new Array(Xi.sizeVec3<<1),ei=0,qt=Xi.sizeVec3;for(;ei<qt;){let At=ei++;wi[At]=Xi.stackVec3[At],Xi.stackVec3[At]=null}Xi.stackVec3=wi}Xi.stackVec3[Xi.sizeVec3++]=nt}let Yi=this.p;if(Bt!=null){if(Bt.zero(),Yi.sizeVec3==Yi.stackVec3.length){let wi=new Array(Yi.sizeVec3<<1),ei=0,qt=Yi.sizeVec3;for(;ei<qt;){let At=ei++;wi[At]=Yi.stackVec3[At],Yi.stackVec3[At]=null}Yi.stackVec3=wi}Yi.stackVec3[Yi.sizeVec3++]=Bt}let Li=this.p;if(ci!=null){if(ci.zero(),Li.sizeVec3==Li.stackVec3.length){let wi=new Array(Li.sizeVec3<<1),ei=0,qt=Li.sizeVec3;for(;ei<qt;){let At=ei++;wi[At]=Li.stackVec3[At],Li.stackVec3[At]=null}Li.stackVec3=wi}Li.stackVec3[Li.sizeVec3++]=ci}}let lt=this.p;if(k!=null){if(k.zero(),lt.sizeVec3==lt.stackVec3.length){let pt=new Array(lt.sizeVec3<<1),ct=0,nt=lt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=lt.stackVec3[tt],lt.stackVec3[tt]=null}lt.stackVec3=pt}lt.stackVec3[lt.sizeVec3++]=k}let rt=this.p;if(B!=null){if(B.zero(),rt.sizeVec3==rt.stackVec3.length){let pt=new Array(rt.sizeVec3<<1),ct=0,nt=rt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=rt.stackVec3[tt],rt.stackVec3[tt]=null}rt.stackVec3=pt}rt.stackVec3[rt.sizeVec3++]=B}let at=this.p;if(w!=null){if(w.zero(),at.sizeVec3==at.stackVec3.length){let pt=new Array(at.sizeVec3<<1),ct=0,nt=at.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=at.stackVec3[tt],at.stackVec3[tt]=null}at.stackVec3=pt}at.stackVec3[at.sizeVec3++]=w}let ot=this.p;if(A!=null){if(A.zero(),ot.sizeVec3==ot.stackVec3.length){let pt=new Array(ot.sizeVec3<<1),ct=0,nt=ot.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=ot.stackVec3[tt],ot.stackVec3[tt]=null}ot.stackVec3=pt}ot.stackVec3[ot.sizeVec3++]=A}let ht=this.p;if(D!=null){if(D.zero(),ht.sizeVec3==ht.stackVec3.length){let pt=new Array(ht.sizeVec3<<1),ct=0,nt=ht.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=ht.stackVec3[tt],ht.stackVec3[tt]=null}ht.stackVec3=pt}ht.stackVec3[ht.sizeVec3++]=D}let _t=this.p;if(U!=null){if(U.zero(),_t.sizeVec3==_t.stackVec3.length){let pt=new Array(_t.sizeVec3<<1),ct=0,nt=_t.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=_t.stackVec3[tt],_t.stackVec3[tt]=null}_t.stackVec3=pt}_t.stackVec3[_t.sizeVec3++]=U}let bt=this.p;if(K!=null){if(K.zero(),bt.sizeVec3==bt.stackVec3.length){let pt=new Array(bt.sizeVec3<<1),ct=0,nt=bt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=bt.stackVec3[tt],bt.stackVec3[tt]=null}bt.stackVec3=pt}bt.stackVec3[bt.sizeVec3++]=K}let Xt=this.p;if(st!=null){if(st.zero(),Xt.sizeVec3==Xt.stackVec3.length){let pt=new Array(Xt.sizeVec3<<1),ct=0,nt=Xt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=Xt.stackVec3[tt],Xt.stackVec3[tt]=null}Xt.stackVec3=pt}Xt.stackVec3[Xt.sizeVec3++]=st}let ft=this.p;if(h!=null){if(h.zero(),ft.sizeVec3==ft.stackVec3.length){let pt=new Array(ft.sizeVec3<<1),ct=0,nt=ft.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=ft.stackVec3[tt],ft.stackVec3[tt]=null}ft.stackVec3=pt}ft.stackVec3[ft.sizeVec3++]=h}let Zt=this.p;if(X!=null){if(X.e00=1,X.e01=0,X.e02=0,X.e10=0,X.e11=1,X.e12=0,X.e20=0,X.e21=0,X.e22=1,Zt.sizeMat3==Zt.stackMat3.length){let pt=new Array(Zt.sizeMat3<<1),ct=0,nt=Zt.sizeMat3;for(;ct<nt;){let tt=ct++;pt[tt]=Zt.stackMat3[tt],Zt.stackMat3[tt]=null}Zt.stackMat3=pt}Zt.stackMat3[Zt.sizeMat3++]=X}let xt=this.p;if(n!=null){if(n.zero(),xt.sizeVec3==xt.stackVec3.length){let pt=new Array(xt.sizeVec3<<1),ct=0,nt=xt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=xt.stackVec3[tt],xt.stackVec3[tt]=null}xt.stackVec3=pt}xt.stackVec3[xt.sizeVec3++]=n}let zt=this.p;if(_!=null){if(_.zero(),zt.sizeVec3==zt.stackVec3.length){let pt=new Array(zt.sizeVec3<<1),ct=0,nt=zt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=zt.stackVec3[tt],zt.stackVec3[tt]=null}zt.stackVec3=pt}zt.stackVec3[zt.sizeVec3++]=_}let Yt=this.p;if(e!=null){if(e.zero(),Yt.sizeVec3==Yt.stackVec3.length){let pt=new Array(Yt.sizeVec3<<1),ct=0,nt=Yt.sizeVec3;for(;ct<nt;){let tt=ct++;pt[tt]=Yt.stackVec3[tt],Yt.stackVec3[tt]=null}Yt.stackVec3=pt}Yt.stackVec3[Yt.sizeVec3++]=e}}rect(t,i,s,o,n,l,_,r,e){this.triangle(t,i,s,n,l,_,e),this.triangle(t,s,o,n,_,r,e)}point(t,i){}triangle(t,i,s,o,n,l,_){}line(t,i,s){}};m.dynamics.common.DebugDrawStyle=class{constructor(){this.basisColorZ=new m.common.Vec3(0,0,1),this.basisColorY=new m.common.Vec3(0,1,0),this.basisColorX=new m.common.Vec3(1,0,0),this.basisLength=.5,this.jointRotationalConstraintRadius=.3,this.jointErrorColor=new m.common.Vec3(1,.1,.1),this.jointLineColor=new m.common.Vec3(.8,.8,.8),this.contactBinormalLength=.5,this.contactTangentLength=.5,this.contactNormalLength=.5,this.contactBinormalColor=new m.common.Vec3(.2,.2,1),this.contactTangentColor=new m.common.Vec3(.1,.8,.1),this.contactNormalColor=new m.common.Vec3(1,.1,.1),this.disabledContactColor=new m.common.Vec3(.5,.1,.1),this.newContactColor=new m.common.Vec3(1,1,.1),this.contactColor4=new m.common.Vec3(.8,.1,1),this.contactColor3=new m.common.Vec3(.1,.8,.6),this.contactColor2=new m.common.Vec3(1,.6,.1),this.contactColor=new m.common.Vec3(1,.1,.1),this.pairColor=new m.common.Vec3(1,1,.1),this.bvhNodeColor=new m.common.Vec3(.4,.4,.4),this.aabbColor=new m.common.Vec3(1,.1,.1),this.kinematicShapeColor=new m.common.Vec3(1,.5,.1),this.staticShapeColor=new m.common.Vec3(.7,.7,.7),this.sleepingShapeColor2=new m.common.Vec3(.2,.8,.5),this.sleepingShapeColor1=new m.common.Vec3(.3,.3,.8),this.sleepyShapeColor2=new m.common.Vec3(.6,.8,.3),this.sleepyShapeColor1=new m.common.Vec3(.5,.25,.6),this.shapeColor2=new m.common.Vec3(1,.8,.1),this.shapeColor1=new m.common.Vec3(.7,.2,.4)}};m.dynamics.common.Performance=class{};m.dynamics.constraint||(m.dynamics.constraint={});m.dynamics.constraint.ConstraintSolver=class{constructor(){this._b1=null,this._b2=null,this._addedToIsland=!1}preSolveVelocity(t){}warmStart(t){}solveVelocity(){}postSolveVelocity(t){}preSolvePosition(t){}solvePositionSplitImpulse(){}solvePositionNgs(t){}postSolve(){}};m.dynamics.constraint.PositionCorrectionAlgorithm=class{};m.dynamics.constraint.contact||(m.dynamics.constraint.contact={});m.dynamics.constraint.contact.ContactConstraint=class{constructor(t){this._solver=new m.dynamics.constraint.solver.pgs.PgsContactConstraintSolver(this),this._manifold=t}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2;let s,o,n,l,_,r,e,a,h;s=this._manifold._normalX,o=this._manifold._normalY,n=this._manifold._normalZ,l=this._manifold._tangentX,_=this._manifold._tangentY,r=this._manifold._tangentZ,e=this._manifold._binormalX,a=this._manifold._binormalY,h=this._manifold._binormalZ;let b=Math.sqrt(this._s1._friction*this._s2._friction),X=Math.sqrt(this._s1._restitution*this._s2._restitution),c=this._manifold._numPoints;i.numRows=0;let Y=0;for(;Y<c;){let p=this._manifold._points[Y++];if(p._depth<0){p._disabled=!0;let Z=p._impulse;Z.impulseN=0,Z.impulseT=0,Z.impulseB=0,Z.impulseP=0,Z.impulseLX=0,Z.impulseLY=0,Z.impulseLZ=0;continue}else p._disabled=!1;let x=i.rows[i.numRows++];x.friction=b,x.cfm=0;let v=x.jacobianN;v.lin1X=s,v.lin1Y=o,v.lin1Z=n,v.lin2X=s,v.lin2Y=o,v.lin2Z=n,v.ang1X=p._relPos1Y*n-p._relPos1Z*o,v.ang1Y=p._relPos1Z*s-p._relPos1X*n,v.ang1Z=p._relPos1X*o-p._relPos1Y*s,v.ang2X=p._relPos2Y*n-p._relPos2Z*o,v.ang2Y=p._relPos2Z*s-p._relPos2X*n,v.ang2Z=p._relPos2X*o-p._relPos2Y*s,v=x.jacobianT,v.lin1X=l,v.lin1Y=_,v.lin1Z=r,v.lin2X=l,v.lin2Y=_,v.lin2Z=r,v.ang1X=p._relPos1Y*r-p._relPos1Z*_,v.ang1Y=p._relPos1Z*l-p._relPos1X*r,v.ang1Z=p._relPos1X*_-p._relPos1Y*l,v.ang2X=p._relPos2Y*r-p._relPos2Z*_,v.ang2Y=p._relPos2Z*l-p._relPos2X*r,v.ang2Z=p._relPos2X*_-p._relPos2Y*l,v=x.jacobianB,v.lin1X=e,v.lin1Y=a,v.lin1Z=h,v.lin2X=e,v.lin2Y=a,v.lin2Z=h,v.ang1X=p._relPos1Y*h-p._relPos1Z*a,v.ang1Y=p._relPos1Z*e-p._relPos1X*h,v.ang1Z=p._relPos1X*a-p._relPos1Y*e,v.ang2X=p._relPos2Y*h-p._relPos2Z*a,v.ang2Y=p._relPos2Z*e-p._relPos2X*h,v.ang2Z=p._relPos2X*a-p._relPos2Y*e,v=x.jacobianN;let f=v.lin1X*this._b1._velX+v.lin1Y*this._b1._velY+v.lin1Z*this._b1._velZ+(v.ang1X*this._b1._angVelX+v.ang1Y*this._b1._angVelY+v.ang1Z*this._b1._angVelZ)-(v.lin2X*this._b2._velX+v.lin2Y*this._b2._velY+v.lin2Z*this._b2._velZ+(v.ang2X*this._b2._angVelX+v.ang2Y*this._b2._angVelY+v.ang2Z*this._b2._angVelZ));if(f<-m.common.Setting.contactEnableBounceThreshold&&!p._warmStarted?x.rhs=-f*X:x.rhs=0,this._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE&&p._depth>m.common.Setting.linearSlop){let Z=(p._depth-m.common.Setting.linearSlop)*m.common.Setting.velocityBaumgarte*t.invDt;x.rhs<Z&&(x.rhs=Z)}if(!p._warmStarted){let Z=p._impulse;Z.impulseN=0,Z.impulseT=0,Z.impulseB=0,Z.impulseP=0,Z.impulseLX=0,Z.impulseLY=0,Z.impulseLZ=0}x.impulse=p._impulse}}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2;let i,s,o;i=this._manifold._normalX,s=this._manifold._normalY,o=this._manifold._normalZ;let n=this._manifold._numPoints;t.numRows=0;let l=0;for(;l<n;){let _=this._manifold._points[l++];if(_._disabled)continue;let r=t.rows[t.numRows++],e=r.jacobianN;e.lin1X=i,e.lin1Y=s,e.lin1Z=o,e.lin2X=i,e.lin2Y=s,e.lin2Z=o,e.ang1X=_._relPos1Y*o-_._relPos1Z*s,e.ang1Y=_._relPos1Z*i-_._relPos1X*o,e.ang1Z=_._relPos1X*s-_._relPos1Y*i,e.ang2X=_._relPos2Y*o-_._relPos2Z*s,e.ang2Y=_._relPos2Z*i-_._relPos2X*o,e.ang2Z=_._relPos2X*s-_._relPos2Y*i,r.rhs=_._depth-m.common.Setting.linearSlop,r.rhs<0&&(r.rhs=0),r.impulse=_._impulse}}_syncManifold(){this._manifold._updateDepthsAndPositions(this._tf1,this._tf2)}getShape1(){return this._s1}getShape2(){return this._s2}getManifold(){return this._manifold}isTouching(){let t=0,i=this._manifold._numPoints;for(;t<i;)if(this._manifold._points[t++]._depth>=0)return!0;return!1}};m.dynamics.constraint.contact.ContactImpulse=class{constructor(){this.impulseN=0,this.impulseT=0,this.impulseB=0,this.impulseP=0,this.impulseLX=0,this.impulseLY=0,this.impulseLZ=0}copyFrom(t){this.impulseN=t.impulseN,this.impulseT=t.impulseT,this.impulseB=t.impulseB,this.impulseLX=t.impulseLX,this.impulseLY=t.impulseLY,this.impulseLZ=t.impulseLZ}};m.dynamics.constraint.contact.Manifold=class{constructor(){this._normalX=0,this._normalY=0,this._normalZ=0,this._tangentX=0,this._tangentY=0,this._tangentZ=0,this._binormalX=0,this._binormalY=0,this._binormalZ=0,this._numPoints=0,this._points=new Array(m.common.Setting.maxManifoldPoints);let t=0,i=m.common.Setting.maxManifoldPoints;for(;t<i;)this._points[t++]=new m.dynamics.constraint.contact.ManifoldPoint}_clear(){let t=0,i=this._numPoints;for(;t<i;){let s=this._points[t++];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let o=s._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}this._numPoints=0}_buildBasis(t){this._normalX=t.x,this._normalY=t.y,this._normalZ=t.z;let i=t.x,s=t.y,o=t.z,n=i*i,l=s*s,_=o*o,r,e,a,h,b,X;if(n<l)if(n<_){let c=1/Math.sqrt(l+_);r=0,e=-o*c,a=s*c,h=s*a-o*e,b=-i*a,X=i*e}else{let c=1/Math.sqrt(n+l);r=-s*c,e=i*c,a=0,h=-o*e,b=o*r,X=i*e-s*r}else if(l<_){let c=1/Math.sqrt(n+_);r=o*c,e=0,a=-i*c,h=s*a,b=o*r-i*a,X=-s*r}else{let c=1/Math.sqrt(n+l);r=-s*c,e=i*c,a=0,h=-o*e,b=o*r,X=i*e-s*r}this._tangentX=r,this._tangentY=e,this._tangentZ=a,this._binormalX=h,this._binormalY=b,this._binormalZ=X}_updateDepthsAndPositions(t,i){let s=0,o=this._numPoints;for(;s<o;){let n=this._points[s++],l,_,r;l=t._rotation00*n._localPos1X+t._rotation01*n._localPos1Y+t._rotation02*n._localPos1Z,_=t._rotation10*n._localPos1X+t._rotation11*n._localPos1Y+t._rotation12*n._localPos1Z,r=t._rotation20*n._localPos1X+t._rotation21*n._localPos1Y+t._rotation22*n._localPos1Z,n._relPos1X=l,n._relPos1Y=_,n._relPos1Z=r;let e,a,h;e=i._rotation00*n._localPos2X+i._rotation01*n._localPos2Y+i._rotation02*n._localPos2Z,a=i._rotation10*n._localPos2X+i._rotation11*n._localPos2Y+i._rotation12*n._localPos2Z,h=i._rotation20*n._localPos2X+i._rotation21*n._localPos2Y+i._rotation22*n._localPos2Z,n._relPos2X=e,n._relPos2Y=a,n._relPos2Z=h,n._pos1X=n._relPos1X+t._positionX,n._pos1Y=n._relPos1Y+t._positionY,n._pos1Z=n._relPos1Z+t._positionZ,n._pos2X=n._relPos2X+i._positionX,n._pos2Y=n._relPos2Y+i._positionY,n._pos2Z=n._relPos2Z+i._positionZ;let b,X,c;b=n._pos1X-n._pos2X,X=n._pos1Y-n._pos2Y,c=n._pos1Z-n._pos2Z,n._depth=-(b*this._normalX+X*this._normalY+c*this._normalZ)}}getNormal(){let t=new m.common.Vec3;return t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ,t}getNormalTo(t){t.x=this._normalX,t.y=this._normalY,t.z=this._normalZ}getTangent(){let t=new m.common.Vec3;return t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ,t}getTangentTo(t){t.x=this._tangentX,t.y=this._tangentY,t.z=this._tangentZ}getBinormal(){let t=new m.common.Vec3;return t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ,t}getBinormalTo(t){t.x=this._binormalX,t.y=this._binormalY,t.z=this._binormalZ}getPoints(){return this._points}getNumPoints(){return this._numPoints}};m.dynamics.constraint.contact.ManifoldPoint=class{constructor(){this._localPos1X=0,this._localPos1Y=0,this._localPos1Z=0,this._localPos2X=0,this._localPos2Y=0,this._localPos2Z=0,this._relPos1X=0,this._relPos1Y=0,this._relPos1Z=0,this._relPos2X=0,this._relPos2Y=0,this._relPos2Z=0,this._pos1X=0,this._pos1Y=0,this._pos1Z=0,this._pos2X=0,this._pos2Y=0,this._pos2Z=0,this._depth=0,this._impulse=new m.dynamics.constraint.contact.ContactImpulse,this._warmStarted=!1,this._disabled=!1,this._id=-1}getPosition1(){let t=new m.common.Vec3;return t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z,t}getPosition1To(t){t.x=this._pos1X,t.y=this._pos1Y,t.z=this._pos1Z}getPosition2(){let t=new m.common.Vec3;return t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z,t}getPosition2To(t){t.x=this._pos2X,t.y=this._pos2Y,t.z=this._pos2Z}getDepth(){return this._depth}isWarmStarted(){return this._warmStarted}getNormalImpulse(){return this._impulse.impulseN}getTangentImpulse(){return this._impulse.impulseT}getBinormalImpulse(){return this._impulse.impulseB}isEnabled(){return!this._disabled}};m.dynamics.constraint.contact.ManifoldUpdater=class{constructor(t){this._manifold=t,this.numOldPoints=0,this.oldPoints=new Array(m.common.Setting.maxManifoldPoints);let i=0,s=m.common.Setting.maxManifoldPoints;for(;i<s;)this.oldPoints[i++]=new m.dynamics.constraint.contact.ManifoldPoint}removeOutdatedPoints(){let t=this._manifold._numPoints;for(;--t>=0;){let i=this._manifold._points[t],s,o,n;s=i._pos1X-i._pos2X,o=i._pos1Y-i._pos2Y,n=i._pos1Z-i._pos2Z;let l=this._manifold._normalX*s+this._manifold._normalY*o+this._manifold._normalZ*n;if(l>m.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}if(s+=this._manifold._normalX*-l,o+=this._manifold._normalY*-l,n+=this._manifold._normalZ*-l,s*s+o*o+n*n>m.common.Setting.contactPersistenceThreshold*m.common.Setting.contactPersistenceThreshold){this.removeManifoldPoint(t);continue}}}removeManifoldPoint(t){let i=--this._manifold._numPoints;if(t!=i){let n=this._manifold._points[t];this._manifold._points[t]=this._manifold._points[i],this._manifold._points[i]=n}let s=this._manifold._points[i];s._localPos1X=0,s._localPos1Y=0,s._localPos1Z=0,s._localPos2X=0,s._localPos2Y=0,s._localPos2Z=0,s._relPos1X=0,s._relPos1Y=0,s._relPos1Z=0,s._relPos2X=0,s._relPos2Y=0,s._relPos2Z=0,s._pos1X=0,s._pos1Y=0,s._pos1Z=0,s._pos2X=0,s._pos2Y=0,s._pos2Z=0,s._depth=0;let o=s._impulse;o.impulseN=0,o.impulseT=0,o.impulseB=0,o.impulseP=0,o.impulseLX=0,o.impulseLY=0,o.impulseLZ=0,s._warmStarted=!1,s._disabled=!1,s._id=-1}addManifoldPoint(t,i,s){let o=this._manifold._numPoints;if(o==m.common.Setting.maxManifoldPoints){let Y=this.computeTargetIndex(t,i,s),p=this._manifold._points[Y],x=t.position1;p._pos1X=x.x,p._pos1Y=x.y,p._pos1Z=x.z;let v=t.position2;p._pos2X=v.x,p._pos2Y=v.y,p._pos2Z=v.z,p._relPos1X=p._pos1X-i._positionX,p._relPos1Y=p._pos1Y-i._positionY,p._relPos1Z=p._pos1Z-i._positionZ,p._relPos2X=p._pos2X-s._positionX,p._relPos2Y=p._pos2Y-s._positionY,p._relPos2Z=p._pos2Z-s._positionZ;let f,Z,k;f=i._rotation00*p._relPos1X+i._rotation10*p._relPos1Y+i._rotation20*p._relPos1Z,Z=i._rotation01*p._relPos1X+i._rotation11*p._relPos1Y+i._rotation21*p._relPos1Z,k=i._rotation02*p._relPos1X+i._rotation12*p._relPos1Y+i._rotation22*p._relPos1Z,p._localPos1X=f,p._localPos1Y=Z,p._localPos1Z=k;let g,I,z;g=s._rotation00*p._relPos2X+s._rotation10*p._relPos2Y+s._rotation20*p._relPos2Z,I=s._rotation01*p._relPos2X+s._rotation11*p._relPos2Y+s._rotation21*p._relPos2Z,z=s._rotation02*p._relPos2X+s._rotation12*p._relPos2Y+s._rotation22*p._relPos2Z,p._localPos2X=g,p._localPos2Y=I,p._localPos2Z=z,p._depth=t.depth;let d=p._impulse;d.impulseN=0,d.impulseT=0,d.impulseB=0,d.impulseP=0,d.impulseLX=0,d.impulseLY=0,d.impulseLZ=0,p._id=t.id,p._warmStarted=!1,p._disabled=!1;return}let n=this._manifold._points[o],l=t.position1;n._pos1X=l.x,n._pos1Y=l.y,n._pos1Z=l.z;let _=t.position2;n._pos2X=_.x,n._pos2Y=_.y,n._pos2Z=_.z,n._relPos1X=n._pos1X-i._positionX,n._relPos1Y=n._pos1Y-i._positionY,n._relPos1Z=n._pos1Z-i._positionZ,n._relPos2X=n._pos2X-s._positionX,n._relPos2Y=n._pos2Y-s._positionY,n._relPos2Z=n._pos2Z-s._positionZ;let r,e,a;r=i._rotation00*n._relPos1X+i._rotation10*n._relPos1Y+i._rotation20*n._relPos1Z,e=i._rotation01*n._relPos1X+i._rotation11*n._relPos1Y+i._rotation21*n._relPos1Z,a=i._rotation02*n._relPos1X+i._rotation12*n._relPos1Y+i._rotation22*n._relPos1Z,n._localPos1X=r,n._localPos1Y=e,n._localPos1Z=a;let h,b,X;h=s._rotation00*n._relPos2X+s._rotation10*n._relPos2Y+s._rotation20*n._relPos2Z,b=s._rotation01*n._relPos2X+s._rotation11*n._relPos2Y+s._rotation21*n._relPos2Z,X=s._rotation02*n._relPos2X+s._rotation12*n._relPos2Y+s._rotation22*n._relPos2Z,n._localPos2X=h,n._localPos2Y=b,n._localPos2Z=X,n._depth=t.depth;let c=n._impulse;c.impulseN=0,c.impulseT=0,c.impulseB=0,c.impulseP=0,c.impulseLX=0,c.impulseLY=0,c.impulseLZ=0,n._id=t.id,n._warmStarted=!1,n._disabled=!1,this._manifold._numPoints++}computeTargetIndex(t,i,s){let o=this._manifold._points[0],n=this._manifold._points[1],l=this._manifold._points[2],_=this._manifold._points[3],r=o._depth,e=0;n._depth>r&&(r=n._depth,e=1),l._depth>r&&(r=l._depth,e=2),_._depth>r&&(e=3);let a,h,b,X=t.position1;a=X.x,h=X.y,b=X.z,a-=i._positionX,h-=i._positionY,b-=i._positionZ;let c=n._relPos1X,Y=n._relPos1Y,p=n._relPos1Z,x=l._relPos1X,v=l._relPos1Y,f=l._relPos1Z,Z=_._relPos1X,k=_._relPos1Y,g=_._relPos1Z,I,z,d,u,B,j,L,V,M,w,P,E,C,S,A,R,H,y;I=x-c,z=v-Y,d=f-p,u=a-Z,B=h-k,j=b-g,L=Z-c,V=k-Y,M=g-p,w=a-x,P=h-v,E=b-f,C=a-c,S=h-Y,A=b-p,R=Z-x,H=k-v,y=g-f;let D,F,Q,W,q,U,G,J,N;D=z*j-d*B,F=d*u-I*j,Q=I*B-z*u,W=V*E-M*P,q=M*w-L*E,U=L*P-V*w,G=S*y-A*H,J=A*R-C*y,N=C*H-S*R;let K=D*D+F*F+Q*Q,O=W*W+q*q+U*U,$=G*G+J*J+N*N,et=o._relPos1X,st=o._relPos1Y,lt=o._relPos1Z,rt=l._relPos1X,at=l._relPos1Y,ot=l._relPos1Z,ht=_._relPos1X,_t=_._relPos1Y,bt=_._relPos1Z,Xt,ft,Zt,xt,zt,Yt,pt,ct,nt,tt,Lt,Bt,Mt,jt,ci,Xi,Yi,Li;Xt=rt-et,ft=at-st,Zt=ot-lt,xt=a-ht,zt=h-_t,Yt=b-bt,pt=ht-et,ct=_t-st,nt=bt-lt,tt=a-rt,Lt=h-at,Bt=b-ot,Mt=a-et,jt=h-st,ci=b-lt,Xi=ht-rt,Yi=_t-at,Li=bt-ot;let wi,ei,qt,At,ni,ui,Oi,Bi,kt;wi=ft*Yt-Zt*zt,ei=Zt*xt-Xt*Yt,qt=Xt*zt-ft*xt,At=ct*Bt-nt*Lt,ni=nt*tt-pt*Bt,ui=pt*Lt-ct*tt,Oi=jt*Li-ci*Yi,Bi=ci*Xi-Mt*Li,kt=Mt*Yi-jt*Xi;let wt=wi*wi+ei*ei+qt*qt,$t=At*At+ni*ni+ui*ui,fi=Oi*Oi+Bi*Bi+kt*kt,gi=wt>$t?wt>fi?wt:fi:$t>fi?$t:fi,it=o._relPos1X,Ht=o._relPos1Y,ii=o._relPos1Z,T=n._relPos1X,Gt=n._relPos1Y,Et=n._relPos1Z,si=_._relPos1X,oi=_._relPos1Y,Pt=_._relPos1Z,ai,Ri,Zi,yt,dt,vt,di,Ii,bi,se,me,Di,he,ve,_i,ce,be,xe;ai=T-it,Ri=Gt-Ht,Zi=Et-ii,yt=a-si,dt=h-oi,vt=b-Pt,di=si-it,Ii=oi-Ht,bi=Pt-ii,se=a-T,me=h-Gt,Di=b-Et,he=a-it,ve=h-Ht,_i=b-ii,ce=si-T,be=oi-Gt,xe=Pt-Et;let ye,Ni,Ji,Ui,oe,ne,Ki,ie,Hi;ye=Ri*vt-Zi*dt,Ni=Zi*yt-ai*vt,Ji=ai*dt-Ri*yt,Ui=Ii*Di-bi*me,oe=bi*se-di*Di,ne=di*me-Ii*se,Ki=ve*xe-_i*be,ie=_i*ce-he*xe,Hi=he*be-ve*ce;let Wi=ye*ye+Ni*Ni+Ji*Ji,Pi=Ui*Ui+oe*oe+ne*ne,Ut=Ki*Ki+ie*ie+Hi*Hi,ri=Wi>Pi?Wi>Ut?Wi:Ut:Pi>Ut?Pi:Ut,Ct=o._relPos1X,Mi=o._relPos1Y,zi=o._relPos1Z,Ei=n._relPos1X,ki=n._relPos1Y,Ti=n._relPos1Z,Wt=l._relPos1X,ut=l._relPos1Y,Vt=l._relPos1Z,Ai,Vi,Fi,$i,ae,re,pe,ti,qi,vi,Ci,mi,St,Tt,hi,Rt,mt,gt;Ai=Ei-Ct,Vi=ki-Mi,Fi=Ti-zi,$i=a-Wt,ae=h-ut,re=b-Vt,pe=Wt-Ct,ti=ut-Mi,qi=Vt-zi,vi=a-Ei,Ci=h-ki,mi=b-Ti,St=a-Ct,Tt=h-Mi,hi=b-zi,Rt=Wt-Ei,mt=ut-ki,gt=Vt-Ti;let Ft,Dt,Nt,Kt,li,yi,pi,Ot,It;Ft=Vi*re-Fi*ae,Dt=Fi*$i-Ai*re,Nt=Ai*ae-Vi*$i,Kt=ti*mi-qi*Ci,li=qi*vi-pe*mi,yi=pe*Ci-ti*vi,pi=Tt*gt-hi*mt,Ot=hi*Rt-St*gt,It=St*mt-Tt*Rt;let Jt=Ft*Ft+Dt*Dt+Nt*Nt,xi=Kt*Kt+li*li+yi*yi,ji=pi*pi+Ot*Ot+It*It,ee=Jt>xi?Jt>ji?Jt:ji:xi>ji?xi:ji,_e=K>O?K>$?K:$:O>$?O:$,Qi=0;return(gi>_e&&e!=1||e==0)&&(_e=gi,Qi=1),ri>_e&&e!=2&&(_e=ri,Qi=2),ee>_e&&e!=3&&(Qi=3),Qi}computeRelativePositions(t,i){let s=this._manifold._numPoints,o=0;for(;o<s;){let n=this._manifold._points[o++],l,_,r;l=t._rotation00*n._localPos1X+t._rotation01*n._localPos1Y+t._rotation02*n._localPos1Z,_=t._rotation10*n._localPos1X+t._rotation11*n._localPos1Y+t._rotation12*n._localPos1Z,r=t._rotation20*n._localPos1X+t._rotation21*n._localPos1Y+t._rotation22*n._localPos1Z,n._relPos1X=l,n._relPos1Y=_,n._relPos1Z=r;let e,a,h;e=i._rotation00*n._localPos2X+i._rotation01*n._localPos2Y+i._rotation02*n._localPos2Z,a=i._rotation10*n._localPos2X+i._rotation11*n._localPos2Y+i._rotation12*n._localPos2Z,h=i._rotation20*n._localPos2X+i._rotation21*n._localPos2Y+i._rotation22*n._localPos2Z,n._relPos2X=e,n._relPos2Y=a,n._relPos2Z=h,n._warmStarted=!0}}findNearestContactPointIndex(t,i,s){let o=m.common.Setting.contactPersistenceThreshold*m.common.Setting.contactPersistenceThreshold,n=-1,l=0,_=this._manifold._numPoints;for(;l<_;){let r=l++,e=this._manifold._points[r],a,h,b,X,c,Y,p=t.position1;a=p.x,h=p.y,b=p.z;let x=t.position2;X=x.x,c=x.y,Y=x.z,a-=i._positionX,h-=i._positionY,b-=i._positionZ,X-=s._positionX,c-=s._positionY,Y-=s._positionZ;let v,f,Z,k,g,I;v=e._relPos1X-a,f=e._relPos1Y-h,Z=e._relPos1Z-b,k=e._relPos2X-X,g=e._relPos2Y-c,I=e._relPos2Z-Y;let z=v*v+f*f+Z*Z,d=k*k+g*g+I*I,u=z<d?z:d;u<o&&(o=u,n=r)}return n}totalUpdate(t,i,s){this.numOldPoints=this._manifold._numPoints;let o=0,n=this.numOldPoints;for(;o<n;){let r=o++,e=this.oldPoints[r],a=this._manifold._points[r];e._localPos1X=a._localPos1X,e._localPos1Y=a._localPos1Y,e._localPos1Z=a._localPos1Z,e._localPos2X=a._localPos2X,e._localPos2Y=a._localPos2Y,e._localPos2Z=a._localPos2Z,e._relPos1X=a._relPos1X,e._relPos1Y=a._relPos1Y,e._relPos1Z=a._relPos1Z,e._relPos2X=a._relPos2X,e._relPos2Y=a._relPos2Y,e._relPos2Z=a._relPos2Z,e._pos1X=a._pos1X,e._pos1Y=a._pos1Y,e._pos1Z=a._pos1Z,e._pos2X=a._pos2X,e._pos2Y=a._pos2Y,e._pos2Z=a._pos2Z,e._depth=a._depth,e._impulse.copyFrom(a._impulse),e._id=a._id,e._warmStarted=a._warmStarted,e._disabled=!1}let l=t.numPoints;this._manifold._numPoints=l;let _=0;for(;_<l;){let r=_++,e=this._manifold._points[r],a=t.points[r],h=a.position1;e._pos1X=h.x,e._pos1Y=h.y,e._pos1Z=h.z;let b=a.position2;e._pos2X=b.x,e._pos2Y=b.y,e._pos2Z=b.z,e._relPos1X=e._pos1X-i._positionX,e._relPos1Y=e._pos1Y-i._positionY,e._relPos1Z=e._pos1Z-i._positionZ,e._relPos2X=e._pos2X-s._positionX,e._relPos2Y=e._pos2Y-s._positionY,e._relPos2Z=e._pos2Z-s._positionZ;let X,c,Y;X=i._rotation00*e._relPos1X+i._rotation10*e._relPos1Y+i._rotation20*e._relPos1Z,c=i._rotation01*e._relPos1X+i._rotation11*e._relPos1Y+i._rotation21*e._relPos1Z,Y=i._rotation02*e._relPos1X+i._rotation12*e._relPos1Y+i._rotation22*e._relPos1Z,e._localPos1X=X,e._localPos1Y=c,e._localPos1Z=Y;let p,x,v;p=s._rotation00*e._relPos2X+s._rotation10*e._relPos2Y+s._rotation20*e._relPos2Z,x=s._rotation01*e._relPos2X+s._rotation11*e._relPos2Y+s._rotation21*e._relPos2Z,v=s._rotation02*e._relPos2X+s._rotation12*e._relPos2Y+s._rotation22*e._relPos2Z,e._localPos2X=p,e._localPos2Y=x,e._localPos2Z=v,e._depth=a.depth;let f=e._impulse;f.impulseN=0,f.impulseT=0,f.impulseB=0,f.impulseP=0,f.impulseLX=0,f.impulseLY=0,f.impulseLZ=0,e._id=a.id,e._warmStarted=!1,e._disabled=!1;let Z=0,k=this.numOldPoints;for(;Z<k;){let g=this.oldPoints[Z++];if(e._id==g._id){e._impulse.copyFrom(g._impulse),e._warmStarted=!0;break}}}}incrementalUpdate(t,i,s){this._manifold._updateDepthsAndPositions(i,s);let o=0,n=this._manifold._numPoints;for(;o<n;)this._manifold._points[o++]._warmStarted=!0;let l=t.points[0],_=this.findNearestContactPointIndex(l,i,s);if(_==-1)this.addManifoldPoint(l,i,s);else{let r=this._manifold._points[_],e=l.position1;r._pos1X=e.x,r._pos1Y=e.y,r._pos1Z=e.z;let a=l.position2;r._pos2X=a.x,r._pos2Y=a.y,r._pos2Z=a.z,r._relPos1X=r._pos1X-i._positionX,r._relPos1Y=r._pos1Y-i._positionY,r._relPos1Z=r._pos1Z-i._positionZ,r._relPos2X=r._pos2X-s._positionX,r._relPos2Y=r._pos2Y-s._positionY,r._relPos2Z=r._pos2Z-s._positionZ;let h,b,X;h=i._rotation00*r._relPos1X+i._rotation10*r._relPos1Y+i._rotation20*r._relPos1Z,b=i._rotation01*r._relPos1X+i._rotation11*r._relPos1Y+i._rotation21*r._relPos1Z,X=i._rotation02*r._relPos1X+i._rotation12*r._relPos1Y+i._rotation22*r._relPos1Z,r._localPos1X=h,r._localPos1Y=b,r._localPos1Z=X;let c,Y,p;c=s._rotation00*r._relPos2X+s._rotation10*r._relPos2Y+s._rotation20*r._relPos2Z,Y=s._rotation01*r._relPos2X+s._rotation11*r._relPos2Y+s._rotation21*r._relPos2Z,p=s._rotation02*r._relPos2X+s._rotation12*r._relPos2Y+s._rotation22*r._relPos2Z,r._localPos2X=c,r._localPos2Y=Y,r._localPos2Z=p,r._depth=l.depth}this.removeOutdatedPoints()}};m.dynamics.constraint.info||(m.dynamics.constraint.info={});m.dynamics.constraint.info.JacobianRow=class{constructor(){this.lin1X=0,this.lin1Y=0,this.lin1Z=0,this.lin2X=0,this.lin2Y=0,this.lin2Z=0,this.ang1X=0,this.ang1Y=0,this.ang1Z=0,this.ang2X=0,this.ang2Y=0,this.ang2Z=0,this.flag=0}updateSparsity(){this.flag=0,(!(this.lin1X==0&&this.lin1Y==0&&this.lin1Z==0)||!(this.lin2X==0&&this.lin2Y==0&&this.lin2Z==0))&&(this.flag|=1),(!(this.ang1X==0&&this.ang1Y==0&&this.ang1Z==0)||!(this.ang2X==0&&this.ang2Y==0&&this.ang2Z==0))&&(this.flag|=2)}};m.dynamics.constraint.info.contact||(m.dynamics.constraint.info.contact={});m.dynamics.constraint.info.contact.ContactSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(m.common.Setting.maxManifoldPoints);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new m.dynamics.constraint.info.contact.ContactSolverInfoRow}};m.dynamics.constraint.info.contact.ContactSolverInfoRow=class{constructor(){this.jacobianN=new m.dynamics.constraint.info.JacobianRow,this.jacobianT=new m.dynamics.constraint.info.JacobianRow,this.jacobianB=new m.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.friction=0,this.impulse=null}};m.dynamics.constraint.info.joint||(m.dynamics.constraint.info.joint={});m.dynamics.constraint.info.joint.JointSolverInfo=class{constructor(){this.b1=null,this.b2=null,this.numRows=0,this.rows=new Array(m.common.Setting.maxJacobianRows);let t=0,i=this.rows.length;for(;t<i;)this.rows[t++]=new m.dynamics.constraint.info.joint.JointSolverInfoRow}};m.dynamics.constraint.info.joint.JointSolverInfoRow=class{constructor(){this.jacobian=new m.dynamics.constraint.info.JacobianRow,this.rhs=0,this.cfm=0,this.minImpulse=0,this.maxImpulse=0,this.motorSpeed=0,this.motorMaxImpulse=0,this.impulse=null}};m.dynamics.constraint.joint||(m.dynamics.constraint.joint={});m.dynamics.constraint.joint.BasisTracker=class{constructor(t){this.joint=t,this.xX=0,this.xY=0,this.xZ=0,this.yX=0,this.yY=0,this.yZ=0,this.zX=0,this.zY=0,this.zZ=0}};m.dynamics.constraint.joint.Joint=class{constructor(t,i){switch(this._link1=new m.dynamics.constraint.joint.JointLink(this),this._link2=new m.dynamics.constraint.joint.JointLink(this),this._positionCorrectionAlgorithm=m.common.Setting.defaultJointPositionCorrectionAlgorithm,this._type=i,this._world=null,this._b1=t.rigidBody1,this._b2=t.rigidBody2,this._allowCollision=t.allowCollision,this._breakForce=t.breakForce,this._breakTorque=t.breakTorque,t.solverType){case 0:this._solver=new m.dynamics.constraint.solver.pgs.PgsJointConstraintSolver(this);break;case 1:this._solver=new m.dynamics.constraint.solver.direct.DirectJointConstraintSolver(this);break}let s=t.localAnchor1;this._localAnchor1X=s.x,this._localAnchor1Y=s.y,this._localAnchor1Z=s.z;let o=t.localAnchor2;this._localAnchor2X=o.x,this._localAnchor2Y=o.y,this._localAnchor2Z=o.z,this._relativeAnchor1X=0,this._relativeAnchor1Y=0,this._relativeAnchor1Z=0,this._relativeAnchor2X=0,this._relativeAnchor2Y=0,this._relativeAnchor2Z=0,this._anchor1X=0,this._anchor1Y=0,this._anchor1Z=0,this._anchor2X=0,this._anchor2Y=0,this._anchor2Z=0,this._localBasisX1X=0,this._localBasisX1Y=0,this._localBasisX1Z=0,this._localBasisY1X=0,this._localBasisY1Y=0,this._localBasisY1Z=0,this._localBasisZ1X=0,this._localBasisZ1Y=0,this._localBasisZ1Z=0,this._localBasisX2X=0,this._localBasisX2Y=0,this._localBasisX2Z=0,this._localBasisY2X=0,this._localBasisY2Y=0,this._localBasisY2Z=0,this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=0,this._impulses=new Array(m.common.Setting.maxJacobianRows);let n=0,l=m.common.Setting.maxJacobianRows;for(;n<l;)this._impulses[n++]=new m.dynamics.constraint.joint.JointImpulse}buildLocalBasesFromX(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let G=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;G>0&&(G=1/Math.sqrt(G)),this._localBasisX1X*=G,this._localBasisX1Y*=G,this._localBasisX1Z*=G}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let G=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;G>0&&(G=1/Math.sqrt(G)),this._localBasisX2X*=G,this._localBasisX2Y*=G,this._localBasisX2Z*=G}let t,i,s,o,n,l,_,r,e,a,h,b,X,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){let G,J,N,K=this._localBasisX1X,O=this._localBasisX1Y,$=this._localBasisX1Z,et=K*K,st=O*O,lt=$*$,rt;et<st?et<lt?(rt=1/Math.sqrt(st+lt),G=0,J=$*rt,N=-O*rt):(rt=1/Math.sqrt(et+st),G=O*rt,J=-K*rt,N=0):st<lt?(rt=1/Math.sqrt(lt+et),G=-$*rt,J=0,N=K*rt):(rt=1/Math.sqrt(et+st),G=O*rt,J=-K*rt,N=0),t=G,i=J,s=N,o=0}else{let G,J,N;G=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,J=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,N=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let K=Math.sqrt((1+c)*.5);c=.5/K,G*=c,J*=c,N*=c,t=G,i=J,s=N,o=K}let Y=t,p=i,x=s,v=o,f=2*Y,Z=2*p,k=2*x,g=Y*f,I=p*Z,z=x*k,d=Y*Z,u=p*k,B=Y*k,j=v*f,L=v*Z,V=v*k;n=1-I-z,l=d-V,_=B+L,r=d+V,e=1-g-z,a=u-j,h=B-L,b=u+j,X=1-g-I;let M=this._localBasisX1X,w=this._localBasisX1Y,P=this._localBasisX1Z,E=M*M,C=w*w,S=P*P,A;E<C?E<S?(A=1/Math.sqrt(C+S),this._localBasisY1X=0,this._localBasisY1Y=P*A,this._localBasisY1Z=-w*A):(A=1/Math.sqrt(E+C),this._localBasisY1X=w*A,this._localBasisY1Y=-M*A,this._localBasisY1Z=0):C<S?(A=1/Math.sqrt(S+E),this._localBasisY1X=-P*A,this._localBasisY1Y=0,this._localBasisY1Z=M*A):(A=1/Math.sqrt(E+C),this._localBasisY1X=w*A,this._localBasisY1Y=-M*A,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X;let R,H,y;R=n*this._localBasisX1X+l*this._localBasisX1Y+_*this._localBasisX1Z,H=r*this._localBasisX1X+e*this._localBasisX1Y+a*this._localBasisX1Z,y=h*this._localBasisX1X+b*this._localBasisX1Y+X*this._localBasisX1Z,this._localBasisX2X=R,this._localBasisX2Y=H,this._localBasisX2Z=y;let D,F,Q;D=n*this._localBasisY1X+l*this._localBasisY1Y+_*this._localBasisY1Z,F=r*this._localBasisY1X+e*this._localBasisY1Y+a*this._localBasisY1Z,Q=h*this._localBasisY1X+b*this._localBasisY1Y+X*this._localBasisY1Z,this._localBasisY2X=D,this._localBasisY2Y=F,this._localBasisY2Z=Q;let W,q,U;W=n*this._localBasisZ1X+l*this._localBasisZ1Y+_*this._localBasisZ1Z,q=r*this._localBasisZ1X+e*this._localBasisZ1Y+a*this._localBasisZ1Z,U=h*this._localBasisZ1X+b*this._localBasisZ1Y+X*this._localBasisZ1Z,this._localBasisZ2X=W,this._localBasisZ2Y=q,this._localBasisZ2Z=U}buildLocalBasesFromXY(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let t=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX1X*=t,this._localBasisX1Y*=t,this._localBasisX1Z*=t}if(this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z==0)this._localBasisX2X=1,this._localBasisX2Y=0,this._localBasisX2Z=0;else{let t=this._localBasisX2X*this._localBasisX2X+this._localBasisX2Y*this._localBasisX2Y+this._localBasisX2Z*this._localBasisX2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisX2X*=t,this._localBasisX2Y*=t,this._localBasisX2Z*=t}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let t=this._localBasisX1X,i=this._localBasisX1Y,s=this._localBasisX1Z,o=t*t,n=i*i,l=s*s,_;o<n?o<l?(_=1/Math.sqrt(n+l),this._localBasisY1X=0,this._localBasisY1Y=s*_,this._localBasisY1Z=-i*_):(_=1/Math.sqrt(o+n),this._localBasisY1X=i*_,this._localBasisY1Y=-t*_,this._localBasisY1Z=0):n<l?(_=1/Math.sqrt(l+o),this._localBasisY1X=-s*_,this._localBasisY1Y=0,this._localBasisY1Z=t*_):(_=1/Math.sqrt(o+n),this._localBasisY1X=i*_,this._localBasisY1Y=-t*_,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let t=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ1X*=t,this._localBasisZ1Y*=t,this._localBasisZ1Z*=t,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0){let t=this._localBasisX2X,i=this._localBasisX2Y,s=this._localBasisX2Z,o=t*t,n=i*i,l=s*s,_;o<n?o<l?(_=1/Math.sqrt(n+l),this._localBasisY2X=0,this._localBasisY2Y=s*_,this._localBasisY2Z=-i*_):(_=1/Math.sqrt(o+n),this._localBasisY2X=i*_,this._localBasisY2Y=-t*_,this._localBasisY2Z=0):n<l?(_=1/Math.sqrt(l+o),this._localBasisY2X=-s*_,this._localBasisY2Y=0,this._localBasisY2Z=t*_):(_=1/Math.sqrt(o+n),this._localBasisY2X=i*_,this._localBasisY2Y=-t*_,this._localBasisY2Z=0),this._localBasisZ2X=this._localBasisX2Y*this._localBasisY2Z-this._localBasisX2Z*this._localBasisY2Y,this._localBasisZ2Y=this._localBasisX2Z*this._localBasisY2X-this._localBasisX2X*this._localBasisY2Z,this._localBasisZ2Z=this._localBasisX2X*this._localBasisY2Y-this._localBasisX2Y*this._localBasisY2X}else{let t=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;t>0&&(t=1/Math.sqrt(t)),this._localBasisZ2X*=t,this._localBasisZ2Y*=t,this._localBasisZ2Z*=t,this._localBasisY2X=this._localBasisZ2Y*this._localBasisX2Z-this._localBasisZ2Z*this._localBasisX2Y,this._localBasisY2Y=this._localBasisZ2Z*this._localBasisX2X-this._localBasisZ2X*this._localBasisX2Z,this._localBasisY2Z=this._localBasisZ2X*this._localBasisX2Y-this._localBasisZ2Y*this._localBasisX2X}}buildLocalBasesFromX1Z2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let F=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;F>0&&(F=1/Math.sqrt(F)),this._localBasisX1X*=F,this._localBasisX1Y*=F,this._localBasisX1Z*=F}if(this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z==0)this._localBasisZ2X=0,this._localBasisZ2Y=0,this._localBasisZ2Z=1;else{let F=this._localBasisZ2X*this._localBasisZ2X+this._localBasisZ2Y*this._localBasisZ2Y+this._localBasisZ2Z*this._localBasisZ2Z;F>0&&(F=1/Math.sqrt(F)),this._localBasisZ2X*=F,this._localBasisZ2Y*=F,this._localBasisZ2Z*=F}let t=this._b1._transform,i=this._b2._transform,s,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z;v=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,f=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,Z=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,s=v,o=f,n=Z;let k,g,I;if(k=i._rotation00*this._localBasisZ2X+i._rotation01*this._localBasisZ2Y+i._rotation02*this._localBasisZ2Z,g=i._rotation10*this._localBasisZ2X+i._rotation11*this._localBasisZ2Y+i._rotation12*this._localBasisZ2Z,I=i._rotation20*this._localBasisZ2X+i._rotation21*this._localBasisZ2Y+i._rotation22*this._localBasisZ2Z,Y=k,p=g,x=I,e=p*n-x*o,a=x*s-Y*n,h=Y*o-p*s,e*e+a*a+h*h==0){let F=s,Q=o,W=n,q=F*F,U=Q*Q,G=W*W,J;q<U?q<G?(J=1/Math.sqrt(U+G),e=0,a=W*J,h=-Q*J):(J=1/Math.sqrt(q+U),e=Q*J,a=-F*J,h=0):U<G?(J=1/Math.sqrt(G+q),e=-W*J,a=0,h=F*J):(J=1/Math.sqrt(q+U),e=Q*J,a=-F*J,h=0)}l=o*h-n*a,_=n*e-s*h,r=s*a-o*e,b=a*x-h*p,X=h*Y-e*x,c=e*p-a*Y;let z,d,u;z=t._rotation00*s+t._rotation10*o+t._rotation20*n,d=t._rotation01*s+t._rotation11*o+t._rotation21*n,u=t._rotation02*s+t._rotation12*o+t._rotation22*n,this._localBasisX1X=z,this._localBasisX1Y=d,this._localBasisX1Z=u;let B,j,L;B=t._rotation00*e+t._rotation10*a+t._rotation20*h,j=t._rotation01*e+t._rotation11*a+t._rotation21*h,L=t._rotation02*e+t._rotation12*a+t._rotation22*h,this._localBasisY1X=B,this._localBasisY1Y=j,this._localBasisY1Z=L;let V,M,w;V=t._rotation00*l+t._rotation10*_+t._rotation20*r,M=t._rotation01*l+t._rotation11*_+t._rotation21*r,w=t._rotation02*l+t._rotation12*_+t._rotation22*r,this._localBasisZ1X=V,this._localBasisZ1Y=M,this._localBasisZ1Z=w;let P,E,C;P=i._rotation00*b+i._rotation10*X+i._rotation20*c,E=i._rotation01*b+i._rotation11*X+i._rotation21*c,C=i._rotation02*b+i._rotation12*X+i._rotation22*c,this._localBasisX2X=P,this._localBasisX2Y=E,this._localBasisX2Z=C;let S,A,R;S=i._rotation00*e+i._rotation10*a+i._rotation20*h,A=i._rotation01*e+i._rotation11*a+i._rotation21*h,R=i._rotation02*e+i._rotation12*a+i._rotation22*h,this._localBasisY2X=S,this._localBasisY2Y=A,this._localBasisY2Z=R;let H,y,D;H=i._rotation00*Y+i._rotation10*p+i._rotation20*x,y=i._rotation01*Y+i._rotation11*p+i._rotation21*x,D=i._rotation02*Y+i._rotation12*p+i._rotation22*x,this._localBasisZ2X=H,this._localBasisZ2Y=y,this._localBasisZ2Z=D}buildLocalBasesFromXY1X2(){if(this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z==0)this._localBasisX1X=1,this._localBasisX1Y=0,this._localBasisX1Z=0;else{let y=this._localBasisX1X*this._localBasisX1X+this._localBasisX1Y*this._localBasisX1Y+this._localBasisX1Z*this._localBasisX1Z;y>0&&(y=1/Math.sqrt(y)),this._localBasisX1X*=y,this._localBasisX1Y*=y,this._localBasisX1Z*=y}if(this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X,this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z==0){let y=this._localBasisX1X,D=this._localBasisX1Y,F=this._localBasisX1Z,Q=y*y,W=D*D,q=F*F,U;Q<W?Q<q?(U=1/Math.sqrt(W+q),this._localBasisY1X=0,this._localBasisY1Y=F*U,this._localBasisY1Z=-D*U):(U=1/Math.sqrt(Q+W),this._localBasisY1X=D*U,this._localBasisY1Y=-y*U,this._localBasisY1Z=0):W<q?(U=1/Math.sqrt(q+Q),this._localBasisY1X=-F*U,this._localBasisY1Y=0,this._localBasisY1Z=y*U):(U=1/Math.sqrt(Q+W),this._localBasisY1X=D*U,this._localBasisY1Y=-y*U,this._localBasisY1Z=0),this._localBasisZ1X=this._localBasisX1Y*this._localBasisY1Z-this._localBasisX1Z*this._localBasisY1Y,this._localBasisZ1Y=this._localBasisX1Z*this._localBasisY1X-this._localBasisX1X*this._localBasisY1Z,this._localBasisZ1Z=this._localBasisX1X*this._localBasisY1Y-this._localBasisX1Y*this._localBasisY1X}else{let y=this._localBasisZ1X*this._localBasisZ1X+this._localBasisZ1Y*this._localBasisZ1Y+this._localBasisZ1Z*this._localBasisZ1Z;y>0&&(y=1/Math.sqrt(y)),this._localBasisZ1X*=y,this._localBasisZ1Y*=y,this._localBasisZ1Z*=y,this._localBasisY1X=this._localBasisZ1Y*this._localBasisX1Z-this._localBasisZ1Z*this._localBasisX1Y,this._localBasisY1Y=this._localBasisZ1Z*this._localBasisX1X-this._localBasisZ1X*this._localBasisX1Z,this._localBasisY1Z=this._localBasisZ1X*this._localBasisX1Y-this._localBasisZ1Y*this._localBasisX1X}let t,i,s,o,n,l,_,r,e,a,h,b,X,c=this._localBasisX1X*this._localBasisX2X+this._localBasisX1Y*this._localBasisX2Y+this._localBasisX1Z*this._localBasisX2Z;if(c<-.999999999){let y,D,F,Q=this._localBasisX1X,W=this._localBasisX1Y,q=this._localBasisX1Z,U=Q*Q,G=W*W,J=q*q,N;U<G?U<J?(N=1/Math.sqrt(G+J),y=0,D=q*N,F=-W*N):(N=1/Math.sqrt(U+G),y=W*N,D=-Q*N,F=0):G<J?(N=1/Math.sqrt(J+U),y=-q*N,D=0,F=Q*N):(N=1/Math.sqrt(U+G),y=W*N,D=-Q*N,F=0),t=y,i=D,s=F,o=0}else{let y,D,F;y=this._localBasisX1Y*this._localBasisX2Z-this._localBasisX1Z*this._localBasisX2Y,D=this._localBasisX1Z*this._localBasisX2X-this._localBasisX1X*this._localBasisX2Z,F=this._localBasisX1X*this._localBasisX2Y-this._localBasisX1Y*this._localBasisX2X;let Q=Math.sqrt((1+c)*.5);c=.5/Q,y*=c,D*=c,F*=c,t=y,i=D,s=F,o=Q}let Y=t,p=i,x=s,v=o,f=2*Y,Z=2*p,k=2*x,g=Y*f,I=p*Z,z=x*k,d=Y*Z,u=p*k,B=Y*k,j=v*f,L=v*Z,V=v*k;n=1-I-z,l=d-V,_=B+L,r=d+V,e=1-g-z,a=u-j,h=B-L,b=u+j,X=1-g-I;let M,w,P;M=n*this._localBasisX1X+l*this._localBasisX1Y+_*this._localBasisX1Z,w=r*this._localBasisX1X+e*this._localBasisX1Y+a*this._localBasisX1Z,P=h*this._localBasisX1X+b*this._localBasisX1Y+X*this._localBasisX1Z,this._localBasisX2X=M,this._localBasisX2Y=w,this._localBasisX2Z=P;let E,C,S;E=n*this._localBasisY1X+l*this._localBasisY1Y+_*this._localBasisY1Z,C=r*this._localBasisY1X+e*this._localBasisY1Y+a*this._localBasisY1Z,S=h*this._localBasisY1X+b*this._localBasisY1Y+X*this._localBasisY1Z,this._localBasisY2X=E,this._localBasisY2Y=C,this._localBasisY2Z=S;let A,R,H;A=n*this._localBasisZ1X+l*this._localBasisZ1Y+_*this._localBasisZ1Z,R=r*this._localBasisZ1X+e*this._localBasisZ1Y+a*this._localBasisZ1Z,H=h*this._localBasisZ1X+b*this._localBasisZ1Y+X*this._localBasisZ1Z,this._localBasisZ2X=A,this._localBasisZ2Y=R,this._localBasisZ2Z=H}setSolverInfoRowLinear(t,i,s,o,n,l,_){let r,e,a=m.common.Setting.linearSlop;if(_)r=0,e=1;else{if(n.frequency>0){a=0;let p=6.28318530717958*n.frequency,x=n.dampingRatio;x<m.common.Setting.minSpringDamperDampingRatio&&(x=m.common.Setting.minSpringDamperDampingRatio);let v=l.dt,f=2*x*p,Z=p*p;n.useSymplecticEuler?(r=1/(v*f),e=Z/f):(r=1/(v*(v*Z+f)),e=Z/(v*Z+f))}else r=0,e=this.getErp(l,!1);s.motorForce>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorForce*l.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=s.lowerLimit,b=s.upperLimit,X,c,Y;h>b?(X=0,c=0,Y=0):h==b?(X=-1/0,c=1/0,Y=i-h):i<h?(X=-1/0,c=0,Y=i-h+a,Y>0&&(Y=0)):i>b?(X=0,c=1/0,Y=i-b-a,Y<0&&(Y=0)):(X=0,c=0,Y=0),t.minImpulse=X,t.maxImpulse=c,t.cfm=r*(o==0?0:1/o),t.rhs=Y*e}setSolverInfoRowAngular(t,i,s,o,n,l,_){let r,e,a=m.common.Setting.angularSlop;if(_)r=0,e=1;else{if(n.frequency>0){a=0;let x=6.28318530717958*n.frequency,v=n.dampingRatio;v<m.common.Setting.minSpringDamperDampingRatio&&(v=m.common.Setting.minSpringDamperDampingRatio);let f=l.dt,Z=2*v*x,k=x*x;n.useSymplecticEuler?(r=1/(f*Z),e=k/Z):(r=1/(f*(f*k+Z)),e=k/(f*k+Z))}else r=0,e=this.getErp(l,!1);s.motorTorque>0?(t.motorSpeed=s.motorSpeed,t.motorMaxImpulse=s.motorTorque*l.dt):(t.motorSpeed=0,t.motorMaxImpulse=0)}let h=s.lowerLimit,b=s.upperLimit,X=(h+b)*.5;i-=X,i=((i+3.14159265358979)%6.28318530717958+6.28318530717958)%6.28318530717958-3.14159265358979,i+=X;let c,Y,p;h>b?(c=0,Y=0,p=0):h==b?(c=-1/0,Y=1/0,p=i-h):i<h?(c=-1/0,Y=0,p=i-h+a,p>0&&(p=0)):i>b?(c=0,Y=1/0,p=i-b-a,p<0&&(p=0)):(c=0,Y=0,p=0),t.minImpulse=c,t.maxImpulse=Y,t.cfm=r*(o==0?0:1/o),t.rhs=p*e}getErp(t,i){return i?1:this._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?t.invDt*m.common.Setting.velocityBaumgarte:0}computeEffectiveInertiaMoment(t,i,s){let o,n,l,_,r,e,a,h,b;a=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,h=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,b=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,o=a,n=h,l=b;let X,c,Y;X=this._b2._invInertia00*t+this._b2._invInertia01*i+this._b2._invInertia02*s,c=this._b2._invInertia10*t+this._b2._invInertia11*i+this._b2._invInertia12*s,Y=this._b2._invInertia20*t+this._b2._invInertia21*i+this._b2._invInertia22*s,_=X,r=c,e=Y;let p=o*t+n*i+l*s,x=_*t+r*i+e*s;if(p>0){let v=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,f=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z-v*v;f>0&&(this._b1._invMass>0?p=1/(1/p+this._b1._mass*f):p=0)}if(x>0){let v=t*this._relativeAnchor2X+i*this._relativeAnchor2Y+s*this._relativeAnchor2Z,f=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z-v*v;f>0&&(this._b2._invMass>0?x=1/(1/x+this._b2._mass*f):x=0)}return p+x==0?0:1/(p+x)}computeEffectiveInertiaMoment2(t,i,s,o,n,l){let _,r,e,a,h,b,X,c,Y;X=this._b1._invInertia00*t+this._b1._invInertia01*i+this._b1._invInertia02*s,c=this._b1._invInertia10*t+this._b1._invInertia11*i+this._b1._invInertia12*s,Y=this._b1._invInertia20*t+this._b1._invInertia21*i+this._b1._invInertia22*s,_=X,r=c,e=Y;let p,x,v;p=this._b2._invInertia00*o+this._b2._invInertia01*n+this._b2._invInertia02*l,x=this._b2._invInertia10*o+this._b2._invInertia11*n+this._b2._invInertia12*l,v=this._b2._invInertia20*o+this._b2._invInertia21*n+this._b2._invInertia22*l,a=p,h=x,b=v;let f=_*t+r*i+e*s,Z=a*o+h*n+b*l;if(f>0){let k=this._relativeAnchor1X*this._relativeAnchor1X+this._relativeAnchor1Y*this._relativeAnchor1Y+this._relativeAnchor1Z*this._relativeAnchor1Z,g=t*this._relativeAnchor1X+i*this._relativeAnchor1Y+s*this._relativeAnchor1Z,I=k*k-g*g;I>0&&(this._b1._invMass>0?f=1/(1/f+this._b1._mass*I):f=0)}if(Z>0){let k=this._relativeAnchor2X*this._relativeAnchor2X+this._relativeAnchor2Y*this._relativeAnchor2Y+this._relativeAnchor2Z*this._relativeAnchor2Z,g=o*this._relativeAnchor2X+n*this._relativeAnchor2Y+l*this._relativeAnchor2Z,I=k*k-g*g;I>0&&(this._b2._invMass>0?Z=1/(1/Z+this._b2._mass*I):Z=0)}return f+Z==0?0:1/(f+Z)}_syncAnchors(){let t=this._b1._transform,i=this._b2._transform,s,o,n;s=t._rotation00*this._localAnchor1X+t._rotation01*this._localAnchor1Y+t._rotation02*this._localAnchor1Z,o=t._rotation10*this._localAnchor1X+t._rotation11*this._localAnchor1Y+t._rotation12*this._localAnchor1Z,n=t._rotation20*this._localAnchor1X+t._rotation21*this._localAnchor1Y+t._rotation22*this._localAnchor1Z,this._relativeAnchor1X=s,this._relativeAnchor1Y=o,this._relativeAnchor1Z=n;let l,_,r;l=i._rotation00*this._localAnchor2X+i._rotation01*this._localAnchor2Y+i._rotation02*this._localAnchor2Z,_=i._rotation10*this._localAnchor2X+i._rotation11*this._localAnchor2Y+i._rotation12*this._localAnchor2Z,r=i._rotation20*this._localAnchor2X+i._rotation21*this._localAnchor2Y+i._rotation22*this._localAnchor2Z,this._relativeAnchor2X=l,this._relativeAnchor2Y=_,this._relativeAnchor2Z=r,this._anchor1X=this._relativeAnchor1X+t._positionX,this._anchor1Y=this._relativeAnchor1Y+t._positionY,this._anchor1Z=this._relativeAnchor1Z+t._positionZ,this._anchor2X=this._relativeAnchor2X+i._positionX,this._anchor2Y=this._relativeAnchor2Y+i._positionY,this._anchor2Z=this._relativeAnchor2Z+i._positionZ;let e,a,h;e=t._rotation00*this._localBasisX1X+t._rotation01*this._localBasisX1Y+t._rotation02*this._localBasisX1Z,a=t._rotation10*this._localBasisX1X+t._rotation11*this._localBasisX1Y+t._rotation12*this._localBasisX1Z,h=t._rotation20*this._localBasisX1X+t._rotation21*this._localBasisX1Y+t._rotation22*this._localBasisX1Z,this._basisX1X=e,this._basisX1Y=a,this._basisX1Z=h;let b,X,c;b=t._rotation00*this._localBasisY1X+t._rotation01*this._localBasisY1Y+t._rotation02*this._localBasisY1Z,X=t._rotation10*this._localBasisY1X+t._rotation11*this._localBasisY1Y+t._rotation12*this._localBasisY1Z,c=t._rotation20*this._localBasisY1X+t._rotation21*this._localBasisY1Y+t._rotation22*this._localBasisY1Z,this._basisY1X=b,this._basisY1Y=X,this._basisY1Z=c;let Y,p,x;Y=t._rotation00*this._localBasisZ1X+t._rotation01*this._localBasisZ1Y+t._rotation02*this._localBasisZ1Z,p=t._rotation10*this._localBasisZ1X+t._rotation11*this._localBasisZ1Y+t._rotation12*this._localBasisZ1Z,x=t._rotation20*this._localBasisZ1X+t._rotation21*this._localBasisZ1Y+t._rotation22*this._localBasisZ1Z,this._basisZ1X=Y,this._basisZ1Y=p,this._basisZ1Z=x;let v,f,Z;v=i._rotation00*this._localBasisX2X+i._rotation01*this._localBasisX2Y+i._rotation02*this._localBasisX2Z,f=i._rotation10*this._localBasisX2X+i._rotation11*this._localBasisX2Y+i._rotation12*this._localBasisX2Z,Z=i._rotation20*this._localBasisX2X+i._rotation21*this._localBasisX2Y+i._rotation22*this._localBasisX2Z,this._basisX2X=v,this._basisX2Y=f,this._basisX2Z=Z;let k,g,I;k=i._rotation00*this._localBasisY2X+i._rotation01*this._localBasisY2Y+i._rotation02*this._localBasisY2Z,g=i._rotation10*this._localBasisY2X+i._rotation11*this._localBasisY2Y+i._rotation12*this._localBasisY2Z,I=i._rotation20*this._localBasisY2X+i._rotation21*this._localBasisY2Y+i._rotation22*this._localBasisY2Z,this._basisY2X=k,this._basisY2Y=g,this._basisY2Z=I;let z,d,u;z=i._rotation00*this._localBasisZ2X+i._rotation01*this._localBasisZ2Y+i._rotation02*this._localBasisZ2Z,d=i._rotation10*this._localBasisZ2X+i._rotation11*this._localBasisZ2Y+i._rotation12*this._localBasisZ2Z,u=i._rotation20*this._localBasisZ2X+i._rotation21*this._localBasisZ2Y+i._rotation22*this._localBasisZ2Z,this._basisZ2X=z,this._basisZ2Y=d,this._basisZ2Z=u}_getVelocitySolverInfo(t,i){i.b1=this._b1,i.b2=this._b2,i.numRows=0}_getPositionSolverInfo(t){t.b1=this._b1,t.b2=this._b2,t.numRows=0}_checkDestruction(){let t=this._appliedTorqueX*this._appliedTorqueX+this._appliedTorqueY*this._appliedTorqueY+this._appliedTorqueZ*this._appliedTorqueZ;if(this._breakForce>0&&this._appliedForceX*this._appliedForceX+this._appliedForceY*this._appliedForceY+this._appliedForceZ*this._appliedForceZ>this._breakForce*this._breakForce){this._world.removeJoint(this);return}if(this._breakTorque>0&&t>this._breakTorque*this._breakTorque){this._world.removeJoint(this);return}}getRigidBody1(){return this._b1}getRigidBody2(){return this._b2}getType(){return this._type}getAnchor1(){let t=new m.common.Vec3;return t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z,t}getAnchor2(){let t=new m.common.Vec3;return t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z,t}getAnchor1To(t){t.x=this._anchor1X,t.y=this._anchor1Y,t.z=this._anchor1Z}getAnchor2To(t){t.x=this._anchor2X,t.y=this._anchor2Y,t.z=this._anchor2Z}getLocalAnchor1(){let t=new m.common.Vec3;return t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z,t}getLocalAnchor2(){let t=new m.common.Vec3;return t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z,t}getLocalAnchor1To(t){t.x=this._localAnchor1X,t.y=this._localAnchor1Y,t.z=this._localAnchor1Z}getLocalAnchor2To(t){t.x=this._localAnchor2X,t.y=this._localAnchor2Y,t.z=this._localAnchor2Z}getBasis1(){let t=new m.common.Mat3,i,s,o,n,l,_,r,e,a;return i=this._basisX1X,s=this._basisY1X,o=this._basisZ1X,n=this._basisX1Y,l=this._basisY1Y,_=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,a=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=o,t.e10=n,t.e11=l,t.e12=_,t.e20=r,t.e21=e,t.e22=a,t}getBasis2(){let t=new m.common.Mat3,i,s,o,n,l,_,r,e,a;return i=this._basisX2X,s=this._basisY2X,o=this._basisZ2X,n=this._basisX2Y,l=this._basisY2Y,_=this._basisZ2Y,r=this._basisX2Z,e=this._basisY2Z,a=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=o,t.e10=n,t.e11=l,t.e12=_,t.e20=r,t.e21=e,t.e22=a,t}getBasis1To(t){let i,s,o,n,l,_,r,e,a;i=this._basisX1X,s=this._basisY1X,o=this._basisZ1X,n=this._basisX1Y,l=this._basisY1Y,_=this._basisZ1Y,r=this._basisX1Z,e=this._basisY1Z,a=this._basisZ1Z,t.e00=i,t.e01=s,t.e02=o,t.e10=n,t.e11=l,t.e12=_,t.e20=r,t.e21=e,t.e22=a}getBasis2To(t){let i,s,o,n,l,_,r,e,a;i=this._basisX2X,s=this._basisY2X,o=this._basisZ2X,n=this._basisX2Y,l=this._basisY2Y,_=this._basisZ2Y,r=this._basisX2Z,e=this._basisY2Z,a=this._basisZ2Z,t.e00=i,t.e01=s,t.e02=o,t.e10=n,t.e11=l,t.e12=_,t.e20=r,t.e21=e,t.e22=a}getAllowCollision(){return this._allowCollision}setAllowCollision(t){this._allowCollision=t}getBreakForce(){return this._breakForce}setBreakForce(t){this._breakForce=t}getBreakTorque(){return this._breakTorque}setBreakTorque(t){this._breakTorque=t}getPositionCorrectionAlgorithm(){return this._positionCorrectionAlgorithm}setPositionCorrectionAlgorithm(t){switch(t){case 0:case 1:case 2:break;default:throw new Error("invalid position correction algorithm id: "+t)}this._positionCorrectionAlgorithm=t}getAppliedForce(){let t=new m.common.Vec3;return t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ,t}getAppliedForceTo(t){t.x=this._appliedForceX,t.y=this._appliedForceY,t.z=this._appliedForceZ}getAppliedTorque(){let t=new m.common.Vec3;return t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ,t}getAppliedTorqueTo(t){t.x=this._appliedTorqueX,t.y=this._appliedTorqueY,t.z=this._appliedTorqueZ}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.constraint.joint.CylindricalJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,2);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this._basis=new m.dynamics.constraint.joint.BasisTracker(this),this._translSd=t.translationalSpringDamper.clone(),this._translLm=t.translationalLimitMotor.clone(),this._rotSd=t.rotationalSpringDamper.clone(),this._rotLm=t.rotationalLimitMotor.clone()}getInfo(t,i,s){let o=this.getErp(i,s),n=this.linearErrorY*o,l=this.linearErrorZ*o,_=this.angularErrorY*o,r=this.angularErrorZ*o,e,a=1/(this._b1._invMass+this._b2._invMass),h=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ);if(this._translSd.frequency<=0||!s){let z=this._impulses[0],d=t.rows[t.numRows++],u=d.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=z,this.setSolverInfoRowLinear(d,this.translation,this._translLm,a,this._translSd,i,s),e=d.jacobian,e.lin1X=this._basis.xX,e.lin1Y=this._basis.xY,e.lin1Z=this._basis.xZ,e.lin2X=this._basis.xX,e.lin2Y=this._basis.xY,e.lin2Z=this._basis.xZ,e.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,e.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,e.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,e.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,e.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,e.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let b=this._impulses[1],X=t.rows[t.numRows++],c=X.jacobian;c.lin1X=0,c.lin1Y=0,c.lin1Z=0,c.lin2X=0,c.lin2Y=0,c.lin2Z=0,c.ang1X=0,c.ang1Y=0,c.ang1Z=0,c.ang2X=0,c.ang2Y=0,c.ang2Z=0,X.rhs=0,X.cfm=0,X.minImpulse=0,X.maxImpulse=0,X.motorSpeed=0,X.motorMaxImpulse=0,X.impulse=null,X.impulse=b,X.rhs=n,X.cfm=0,X.minImpulse=-1/0,X.maxImpulse=1/0,e=X.jacobian,e.lin1X=this._basis.yX,e.lin1Y=this._basis.yY,e.lin1Z=this._basis.yZ,e.lin2X=this._basis.yX,e.lin2Y=this._basis.yY,e.lin2Z=this._basis.yZ,e.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,e.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,e.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,e.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,e.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,e.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let Y=this._impulses[2],p=t.rows[t.numRows++],x=p.jacobian;if(x.lin1X=0,x.lin1Y=0,x.lin1Z=0,x.lin2X=0,x.lin2Y=0,x.lin2Z=0,x.ang1X=0,x.ang1Y=0,x.ang1Z=0,x.ang2X=0,x.ang2Y=0,x.ang2Z=0,p.rhs=0,p.cfm=0,p.minImpulse=0,p.maxImpulse=0,p.motorSpeed=0,p.motorMaxImpulse=0,p.impulse=null,p.impulse=Y,p.rhs=l,p.cfm=0,p.minImpulse=-1/0,p.maxImpulse=1/0,e=p.jacobian,e.lin1X=this._basis.zX,e.lin1Y=this._basis.zY,e.lin1Z=this._basis.zZ,e.lin2X=this._basis.zX,e.lin2Y=this._basis.zY,e.lin2Z=this._basis.zZ,e.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,e.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,e.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,e.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,e.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,e.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX,this._rotSd.frequency<=0||!s){let z=this._impulses[3],d=t.rows[t.numRows++],u=d.jacobian;u.lin1X=0,u.lin1Y=0,u.lin1Z=0,u.lin2X=0,u.lin2Y=0,u.lin2Z=0,u.ang1X=0,u.ang1Y=0,u.ang1Z=0,u.ang2X=0,u.ang2Y=0,u.ang2Z=0,d.rhs=0,d.cfm=0,d.minImpulse=0,d.maxImpulse=0,d.motorSpeed=0,d.motorMaxImpulse=0,d.impulse=null,d.impulse=z,this.setSolverInfoRowAngular(d,this.angle,this._rotLm,h,this._rotSd,i,s),e=d.jacobian,e.ang1X=this._basis.xX,e.ang1Y=this._basis.xY,e.ang1Z=this._basis.xZ,e.ang2X=this._basis.xX,e.ang2Y=this._basis.xY,e.ang2Z=this._basis.xZ}let v=this._impulses[4],f=t.rows[t.numRows++],Z=f.jacobian;Z.lin1X=0,Z.lin1Y=0,Z.lin1Z=0,Z.lin2X=0,Z.lin2Y=0,Z.lin2Z=0,Z.ang1X=0,Z.ang1Y=0,Z.ang1Z=0,Z.ang2X=0,Z.ang2Y=0,Z.ang2Z=0,f.rhs=0,f.cfm=0,f.minImpulse=0,f.maxImpulse=0,f.motorSpeed=0,f.motorMaxImpulse=0,f.impulse=null,f.impulse=v,f.rhs=_,f.cfm=0,f.minImpulse=-1/0,f.maxImpulse=1/0,e=f.jacobian,e.ang1X=this._basis.yX,e.ang1Y=this._basis.yY,e.ang1Z=this._basis.yZ,e.ang2X=this._basis.yX,e.ang2Y=this._basis.yY,e.ang2Z=this._basis.yZ;let k=this._impulses[5],g=t.rows[t.numRows++],I=g.jacobian;I.lin1X=0,I.lin1Y=0,I.lin1Z=0,I.lin2X=0,I.lin2Y=0,I.lin2Z=0,I.ang1X=0,I.ang1Y=0,I.ang1Z=0,I.ang2X=0,I.ang2Y=0,I.ang2Z=0,g.rhs=0,g.cfm=0,g.minImpulse=0,g.maxImpulse=0,g.motorSpeed=0,g.motorMaxImpulse=0,g.impulse=null,g.impulse=k,g.rhs=r,g.cfm=0,g.minImpulse=-1/0,g.maxImpulse=1/0,e=g.jacobian,e.ang1X=this._basis.zX,e.ang1Y=this._basis.zY,e.ang1Z=this._basis.zZ,e.ang2X=this._basis.zX,e.ang2Y=this._basis.zY,e.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,i=t.joint._b1._invMass,s=t.joint._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w,P,E,C,S,A,R,H,y=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(y<-.999999999){let Pt,ai,Ri,Zi=t.joint._basisX1X,yt=t.joint._basisX1Y,dt=t.joint._basisX1Z,vt=Zi*Zi,di=yt*yt,Ii=dt*dt,bi;vt<di?vt<Ii?(bi=1/Math.sqrt(di+Ii),Pt=0,ai=dt*bi,Ri=-yt*bi):(bi=1/Math.sqrt(vt+di),Pt=yt*bi,ai=-Zi*bi,Ri=0):di<Ii?(bi=1/Math.sqrt(Ii+vt),Pt=-dt*bi,ai=0,Ri=Zi*bi):(bi=1/Math.sqrt(vt+di),Pt=yt*bi,ai=-Zi*bi,Ri=0),o=Pt,n=ai,l=Ri,_=0}else{let Pt,ai,Ri;Pt=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,ai=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Ri=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Zi=Math.sqrt((1+y)*.5);y=.5/Zi,Pt*=y,ai*=y,Ri*=y,o=Pt,n=ai,l=Ri,_=Zi}r=0,e=0,a=0,h=1;let D,F,Q,W,q,U,G,J;D=r,F=e,Q=a,W=h,q=o,U=n,G=l,J=_;let N=D*q+F*U+Q*G+W*J;if(N<0&&(N=-N,q=-q,U=-U,G=-G,J=-J),N>.999999){let Pt,ai,Ri,Zi;Pt=q-D,ai=U-F,Ri=G-Q,Zi=J-W,q=D+Pt*(i/(i+s)),U=F+ai*(i/(i+s)),G=Q+Ri*(i/(i+s)),J=W+Zi*(i/(i+s));let yt=q*q+U*U+G*G+J*J;yt>1e-32&&(yt=1/Math.sqrt(yt)),b=q*yt,X=U*yt,c=G*yt,Y=J*yt}else{let Pt=i/(i+s)*Math.acos(N);q+=D*-N,U+=F*-N,G+=Q*-N,J+=W*-N;let ai=q*q+U*U+G*G+J*J;ai>1e-32&&(ai=1/Math.sqrt(ai)),q*=ai,U*=ai,G*=ai,J*=ai;let Ri=Math.sin(Pt),Zi=Math.cos(Pt);D*=Zi,F*=Zi,Q*=Zi,W*=Zi,b=D+q*Ri,X=F+U*Ri,c=Q+G*Ri,Y=W+J*Ri}let K=b,O=X,$=c,et=Y,st=2*K,lt=2*O,rt=2*$,at=K*st,ot=O*lt,ht=$*rt,_t=K*lt,bt=O*rt,Xt=K*rt,ft=et*st,Zt=et*lt,xt=et*rt;p=1-ot-ht,x=_t-xt,v=Xt+Zt,f=_t+xt,Z=1-at-ht,k=bt-ft,g=Xt-Zt,I=bt+ft,z=1-at-ot;let zt,Yt,pt;zt=p*t.joint._basisX1X+x*t.joint._basisX1Y+v*t.joint._basisX1Z,Yt=f*t.joint._basisX1X+Z*t.joint._basisX1Y+k*t.joint._basisX1Z,pt=g*t.joint._basisX1X+I*t.joint._basisX1Y+z*t.joint._basisX1Z,d=zt,u=Yt,B=pt,E=t.xX,C=t.xY,S=t.xZ,A=t.yX,R=t.yY,H=t.yZ;let ct=E*d+C*u+S*B;if(ct<-.999999999){let Pt,ai,Ri,Zi=E,yt=C,dt=S,vt=Zi*Zi,di=yt*yt,Ii=dt*dt,bi;vt<di?vt<Ii?(bi=1/Math.sqrt(di+Ii),Pt=0,ai=dt*bi,Ri=-yt*bi):(bi=1/Math.sqrt(vt+di),Pt=yt*bi,ai=-Zi*bi,Ri=0):di<Ii?(bi=1/Math.sqrt(Ii+vt),Pt=-dt*bi,ai=0,Ri=Zi*bi):(bi=1/Math.sqrt(vt+di),Pt=yt*bi,ai=-Zi*bi,Ri=0),b=Pt,X=ai,c=Ri,Y=0}else{let Pt,ai,Ri;Pt=C*B-S*u,ai=S*d-E*B,Ri=E*u-C*d;let Zi=Math.sqrt((1+ct)*.5);ct=.5/Zi,Pt*=ct,ai*=ct,Ri*=ct,b=Pt,X=ai,c=Ri,Y=Zi}let nt=b,tt=X,Lt=c,Bt=Y,Mt=2*nt,jt=2*tt,ci=2*Lt,Xi=nt*Mt,Yi=tt*jt,Li=Lt*ci,wi=nt*jt,ei=tt*ci,qt=nt*ci,At=Bt*Mt,ni=Bt*jt,ui=Bt*ci;p=1-Yi-Li,x=wi-ui,v=qt+ni,f=wi+ui,Z=1-Xi-Li,k=ei-At,g=qt-ni,I=ei+At,z=1-Xi-Yi;let Oi,Bi,kt;if(Oi=p*A+x*R+v*H,Bi=f*A+Z*R+k*H,kt=g*A+I*R+z*H,j=Oi,L=Bi,V=kt,M=u*V-B*L,w=B*j-d*V,P=d*L-u*j,M*M+w*w+P*P>1e-6){let Pt=M*M+w*w+P*P;Pt>0&&(Pt=1/Math.sqrt(Pt)),M*=Pt,w*=Pt,P*=Pt}else{let Pt=d,ai=u,Ri=B,Zi=Pt*Pt,yt=ai*ai,dt=Ri*Ri,vt;Zi<yt?Zi<dt?(vt=1/Math.sqrt(yt+dt),M=0,w=Ri*vt,P=-ai*vt):(vt=1/Math.sqrt(Zi+yt),M=ai*vt,w=-Pt*vt,P=0):yt<dt?(vt=1/Math.sqrt(dt+Zi),M=-Ri*vt,w=0,P=Pt*vt):(vt=1/Math.sqrt(Zi+yt),M=ai*vt,w=-Pt*vt,P=0)}j=w*B-P*u,L=P*d-M*B,V=M*u-w*d,t.xX=d,t.xY=u,t.xZ=B,t.yX=j,t.yY=L,t.yZ=V,t.zX=M,t.zY=w,t.zZ=P;let wt,$t,fi;wt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,$t=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,fi=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let gi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,it=gi<=-1?3.14159265358979:gi>=1?0:Math.acos(gi),Ht=wt*wt+$t*$t+fi*fi;Ht>0&&(Ht=1/Math.sqrt(Ht)),wt*=Ht,$t*=Ht,fi*=Ht,wt*=it,$t*=it,fi*=it,this.angularErrorY=wt*this._basis.yX+$t*this._basis.yY+fi*this._basis.yZ,this.angularErrorZ=wt*this._basis.zX+$t*this._basis.zY+fi*this._basis.zZ;let ii,T,Gt;ii=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,T=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Gt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,gi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=gi<=-1?3.14159265358979:gi>=1?0:Math.acos(gi),ii*this._basis.xX+T*this._basis.xY+Gt*this._basis.xZ<0&&(this.angle=-this.angle);let Et,si,oi;Et=this._anchor2X-this._anchor1X,si=this._anchor2Y-this._anchor1Y,oi=this._anchor2Z-this._anchor1Z,this.translation=Et*this._basis.xX+si*this._basis.xY+oi*this._basis.xZ,this.linearErrorY=Et*this._basis.yX+si*this._basis.yY+oi*this._basis.yZ,this.linearErrorZ=Et*this._basis.zX+si*this._basis.zY+oi*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTranslationalSpringDamper(){return this._translSd}getRotationalSpringDamper(){return this._rotSd}getTranslationalLimitMotor(){return this._translLm}getRotationalLimitMotor(){return this._rotLm}getAngle(){return this.angle}getTranslation(){return this.translation}};m.dynamics.constraint.joint.JointConfig=class{constructor(){this.rigidBody1=null,this.rigidBody2=null,this.localAnchor1=new m.common.Vec3,this.localAnchor2=new m.common.Vec3,this.allowCollision=!1,this.solverType=m.common.Setting.defaultJointConstraintSolverType,this.positionCorrectionAlgorithm=m.common.Setting.defaultJointPositionCorrectionAlgorithm,this.breakForce=0,this.breakTorque=0}_init(t,i,s){this.rigidBody1=t,this.rigidBody2=i;let o=this.rigidBody1,n=this.localAnchor1,l,_,r;l=s.x,_=s.y,r=s.z,l-=o._transform._positionX,_-=o._transform._positionY,r-=o._transform._positionZ;let e,a,h;e=o._transform._rotation00*l+o._transform._rotation10*_+o._transform._rotation20*r,a=o._transform._rotation01*l+o._transform._rotation11*_+o._transform._rotation21*r,h=o._transform._rotation02*l+o._transform._rotation12*_+o._transform._rotation22*r,l=e,_=a,r=h,n.x=l,n.y=_,n.z=r;let b=this.rigidBody2,X=this.localAnchor2,c,Y,p;c=s.x,Y=s.y,p=s.z,c-=b._transform._positionX,Y-=b._transform._positionY,p-=b._transform._positionZ;let x,v,f;x=b._transform._rotation00*c+b._transform._rotation10*Y+b._transform._rotation20*p,v=b._transform._rotation01*c+b._transform._rotation11*Y+b._transform._rotation21*p,f=b._transform._rotation02*c+b._transform._rotation12*Y+b._transform._rotation22*p,c=x,Y=v,p=f,X.x=c,X.y=Y,X.z=p}};m.dynamics.constraint.joint.CylindricalJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.translationalLimitMotor=new m.dynamics.constraint.joint.TranslationalLimitMotor,this.translationalSpringDamper=new m.dynamics.constraint.joint.SpringDamper,this.rotationalLimitMotor=new m.dynamics.constraint.joint.RotationalLimitMotor,this.rotationalSpringDamper=new m.dynamics.constraint.joint.SpringDamper}init(t,i,s,o){this._init(t,i,s);let n=this.localAxis1,l,_,r;l=o.x,_=o.y,r=o.z;let e,a,h;e=t._transform._rotation00*l+t._transform._rotation10*_+t._transform._rotation20*r,a=t._transform._rotation01*l+t._transform._rotation11*_+t._transform._rotation21*r,h=t._transform._rotation02*l+t._transform._rotation12*_+t._transform._rotation22*r,l=e,_=a,r=h,n.x=l,n.y=_,n.z=r;let b=this.localAxis2,X,c,Y;X=o.x,c=o.y,Y=o.z;let p,x,v;return p=i._transform._rotation00*X+i._transform._rotation10*c+i._transform._rotation20*Y,x=i._transform._rotation01*X+i._transform._rotation11*c+i._transform._rotation21*Y,v=i._transform._rotation02*X+i._transform._rotation12*c+i._transform._rotation22*Y,X=p,c=x,Y=v,b.x=X,b.y=c,b.z=Y,this}};m.dynamics.constraint.joint.GenericJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.GENERIC);let i,s=t.localBasis1;if(s.e00*(s.e11*s.e22-s.e12*s.e21)-s.e01*(s.e10*s.e22-s.e12*s.e20)+s.e02*(s.e10*s.e21-s.e11*s.e20)<0)i=!0;else{let z=t.localBasis2;i=z.e00*(z.e11*z.e22-z.e12*z.e21)-z.e01*(z.e10*z.e22-z.e12*z.e20)+z.e02*(z.e10*z.e21-z.e11*z.e20)<0}i&&console.log("src/oimo/dynamics/constraint/joint/GenericJoint.hx:50:","[warning] joint basis must be right handed");let o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g=t.localBasis1;o=g.e00,n=g.e01,l=g.e02,_=g.e10,r=g.e11,e=g.e12,a=g.e20,h=g.e21,b=g.e22;let I=t.localBasis2;X=I.e00,c=I.e01,Y=I.e02,p=I.e10,x=I.e11,v=I.e12,f=I.e20,Z=I.e21,k=I.e22,this._localBasisX1X=o,this._localBasisX1Y=_,this._localBasisX1Z=a,this._localBasisY1X=n,this._localBasisY1Y=r,this._localBasisY1Z=h,this._localBasisZ1X=l,this._localBasisZ1Y=e,this._localBasisZ1Z=b,this._localBasisX2X=X,this._localBasisX2Y=p,this._localBasisX2Z=f,this._localBasisY2X=c,this._localBasisY2Y=x,this._localBasisY2Z=Z,this._localBasisZ2X=Y,this._localBasisZ2Y=v,this._localBasisZ2Z=k,this._angleX=0,this._angleY=0,this._angleZ=0,this.translationX=0,this.translationY=0,this.translationZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._translLms=new Array(3),this._translSds=new Array(3),this._rotLms=new Array(3),this._rotSds=new Array(3),this._translLms[0]=t.translationalLimitMotors[0].clone(),this._translLms[1]=t.translationalLimitMotors[1].clone(),this._translLms[2]=t.translationalLimitMotors[2].clone(),this._translSds[0]=t.translationalSpringDampers[0].clone(),this._translSds[1]=t.translationalSpringDampers[1].clone(),this._translSds[2]=t.translationalSpringDampers[2].clone(),this._rotLms[0]=t.rotationalLimitMotors[0].clone(),this._rotLms[1]=t.rotationalLimitMotors[1].clone(),this._rotLms[2]=t.rotationalLimitMotors[2].clone(),this._rotSds[0]=t.rotationalSpringDampers[0].clone(),this._rotSds[1]=t.rotationalSpringDampers[1].clone(),this._rotSds[2]=t.rotationalSpringDampers[2].clone()}getInfo(t,i,s){let o,n=1/(this._b1._invMass+this._b2._invMass),l=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),_=this.computeEffectiveInertiaMoment(this._axisYX,this._axisYY,this._axisYZ),r=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ);if(this._translSds[0].frequency<=0||!s){let e=this._impulses[0],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowLinear(a,this.translationX,this._translLms[0],n,this._translSds[0],i,s),o=a.jacobian,o.lin1X=this._basisX1X,o.lin1Y=this._basisX1Y,o.lin1Z=this._basisX1Z,o.lin2X=this._basisX1X,o.lin2Y=this._basisX1Y,o.lin2Z=this._basisX1Z,o.ang1X=this._relativeAnchor1Y*this._basisX1Z-this._relativeAnchor1Z*this._basisX1Y,o.ang1Y=this._relativeAnchor1Z*this._basisX1X-this._relativeAnchor1X*this._basisX1Z,o.ang1Z=this._relativeAnchor1X*this._basisX1Y-this._relativeAnchor1Y*this._basisX1X,o.ang2X=this._relativeAnchor2Y*this._basisX1Z-this._relativeAnchor2Z*this._basisX1Y,o.ang2Y=this._relativeAnchor2Z*this._basisX1X-this._relativeAnchor2X*this._basisX1Z,o.ang2Z=this._relativeAnchor2X*this._basisX1Y-this._relativeAnchor2Y*this._basisX1X}if(this._translSds[1].frequency<=0||!s){let e=this._impulses[1],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowLinear(a,this.translationY,this._translLms[1],n,this._translSds[1],i,s),o=a.jacobian,o.lin1X=this._basisY1X,o.lin1Y=this._basisY1Y,o.lin1Z=this._basisY1Z,o.lin2X=this._basisY1X,o.lin2Y=this._basisY1Y,o.lin2Z=this._basisY1Z,o.ang1X=this._relativeAnchor1Y*this._basisY1Z-this._relativeAnchor1Z*this._basisY1Y,o.ang1Y=this._relativeAnchor1Z*this._basisY1X-this._relativeAnchor1X*this._basisY1Z,o.ang1Z=this._relativeAnchor1X*this._basisY1Y-this._relativeAnchor1Y*this._basisY1X,o.ang2X=this._relativeAnchor2Y*this._basisY1Z-this._relativeAnchor2Z*this._basisY1Y,o.ang2Y=this._relativeAnchor2Z*this._basisY1X-this._relativeAnchor2X*this._basisY1Z,o.ang2Z=this._relativeAnchor2X*this._basisY1Y-this._relativeAnchor2Y*this._basisY1X}if(this._translSds[2].frequency<=0||!s){let e=this._impulses[2],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowLinear(a,this.translationZ,this._translLms[2],n,this._translSds[2],i,s),o=a.jacobian,o.lin1X=this._basisZ1X,o.lin1Y=this._basisZ1Y,o.lin1Z=this._basisZ1Z,o.lin2X=this._basisZ1X,o.lin2Y=this._basisZ1Y,o.lin2Z=this._basisZ1Z,o.ang1X=this._relativeAnchor1Y*this._basisZ1Z-this._relativeAnchor1Z*this._basisZ1Y,o.ang1Y=this._relativeAnchor1Z*this._basisZ1X-this._relativeAnchor1X*this._basisZ1Z,o.ang1Z=this._relativeAnchor1X*this._basisZ1Y-this._relativeAnchor1Y*this._basisZ1X,o.ang2X=this._relativeAnchor2Y*this._basisZ1Z-this._relativeAnchor2Z*this._basisZ1Y,o.ang2Y=this._relativeAnchor2Z*this._basisZ1X-this._relativeAnchor2X*this._basisZ1Z,o.ang2Z=this._relativeAnchor2X*this._basisZ1Y-this._relativeAnchor2Y*this._basisZ1X}if(!this.xSingular&&(this._rotSds[0].frequency<=0||!s)){let e=this._impulses[3],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowAngular(a,this._angleX,this._rotLms[0],l,this._rotSds[0],i,s),o=a.jacobian,o.ang1X=this._axisXX,o.ang1Y=this._axisXY,o.ang1Z=this._axisXZ,o.ang2X=this._axisXX,o.ang2Y=this._axisXY,o.ang2Z=this._axisXZ}if(!this.ySingular&&(this._rotSds[1].frequency<=0||!s)){let e=this._impulses[4],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowAngular(a,this._angleY,this._rotLms[1],_,this._rotSds[1],i,s),o=a.jacobian,o.ang1X=this._axisYX,o.ang1Y=this._axisYY,o.ang1Z=this._axisYZ,o.ang2X=this._axisYX,o.ang2Y=this._axisYY,o.ang2Z=this._axisYZ}if(!this.zSingular&&(this._rotSds[2].frequency<=0||!s)){let e=this._impulses[5],a=t.rows[t.numRows++],h=a.jacobian;h.lin1X=0,h.lin1Y=0,h.lin1Z=0,h.lin2X=0,h.lin2Y=0,h.lin2Z=0,h.ang1X=0,h.ang1Y=0,h.ang1Z=0,h.ang2X=0,h.ang2Y=0,h.ang2Z=0,a.rhs=0,a.cfm=0,a.minImpulse=0,a.maxImpulse=0,a.motorSpeed=0,a.motorMaxImpulse=0,a.impulse=null,a.impulse=e,this.setSolverInfoRowAngular(a,this._angleZ,this._rotLms[2],r,this._rotSds[2],i,s),o=a.jacobian,o.ang1X=this._axisZX,o.ang1Y=this._axisZY,o.ang1Z=this._axisZZ,o.ang2X=this._axisZX,o.ang2Y=this._axisZY,o.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,i,s,o,n,l,_,r,e;t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,_=this._basisZ2X,r=this._basisZ2Y,e=this._basisZ2Z,o=r*s-e*i,n=e*t-_*s,l=_*i-r*t,this._axisXX=n*e-l*r,this._axisXY=l*_-o*e,this._axisXZ=o*r-n*_,this._axisYX=o,this._axisYY=n,this._axisYZ=l,this._axisZX=i*l-s*n,this._axisZY=s*o-t*l,this._axisZZ=t*n-i*o;let a=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;a>0&&(a=1/Math.sqrt(a)),this._axisXX*=a,this._axisXY*=a,this._axisXZ*=a;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let b=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;b>0&&(b=1/Math.sqrt(b)),this._axisZX*=b,this._axisZY*=b,this._axisZZ*=b,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V;X=this._basisX1X,c=this._basisY1X,Y=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,v=this._basisZ1Y,f=this._basisX1Z,Z=this._basisY1Z,k=this._basisZ1Z,g=this._basisX2X,I=this._basisY2X,z=this._basisZ2X,d=this._basisX2Y,u=this._basisY2Y,B=this._basisZ2Y,j=this._basisX2Z,L=this._basisY2Z,V=this._basisZ2Z;let M,w,P,E,C,S,A,R,H,y,D,F,Q,W;R=X*g+p*d+f*j,H=X*I+p*u+f*L,y=X*z+p*B+f*V,D=c*I+x*u+Z*L,F=c*z+x*B+Z*V,Q=Y*I+v*u+k*L,W=Y*z+v*B+k*V,M=R,w=H,P=y,E=D,C=F,S=Q,A=W;let q,U,G,J=P;if(J<=-1){let $=Math.atan2(S,E);q=$*.5,U=-1.570796326794895,G=-$*.5}else if(J>=1){let $=Math.atan2(S,E);q=$*.5,U=1.570796326794895,G=$*.5}else q=Math.atan2(-C,A),U=Math.asin(J),G=Math.atan2(-w,M);this._angleX=q,this._angleY=U,this._angleZ=G;let N,K,O;N=this._anchor2X-this._anchor1X,K=this._anchor2Y-this._anchor1Y,O=this._anchor2Z-this._anchor1Z,this.translationX=N*this._basisX1X+K*this._basisX1Y+O*this._basisX1Z,this.translationY=N*this._basisY1X+K*this._basisY1Y+O*this._basisY1Z,this.translationZ=N*this._basisZ1X+K*this._basisZ1Y+O*this._basisZ1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxisX(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxisY(){let t=new m.common.Vec3;return t.x=this._axisYX,t.y=this._axisYY,t.z=this._axisYZ,t}getAxisZ(){let t=new m.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getTranslationalSpringDampers(){return this._translSds.slice(0)}getRotationalSpringDampers(){return this._translSds.slice(0)}getTranslationalLimitMotors(){return this._translLms.slice(0)}getRotationalLimitMotors(){return this._rotLms.slice(0)}getAngles(){return new m.common.Vec3(this._angleX,this._angleY,this._angleZ)}getTranslations(){return new m.common.Vec3(this.translationX,this.translationY,this.translationZ)}};m.dynamics.constraint.joint.GenericJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localBasis1=new m.common.Mat3,this.localBasis2=new m.common.Mat3;let t=[];t.push(new m.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new m.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),t.push(new m.dynamics.constraint.joint.TranslationalLimitMotor().setLimits(0,0)),this.translationalLimitMotors=t;let i=[];i.push(new m.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),i.push(new m.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),i.push(new m.dynamics.constraint.joint.RotationalLimitMotor().setLimits(0,0)),this.rotationalLimitMotors=i,this.translationalSpringDampers=[new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper],this.rotationalSpringDampers=[new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper,new m.dynamics.constraint.joint.SpringDamper]}init(t,i,s,o,n){this._init(t,i,s);let l=t._transform,_=i._transform,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w,P,E,C,S,A,R,H,y,D,F,Q;r=o.e00,e=o.e01,a=o.e02,h=o.e10,b=o.e11,X=o.e12,c=o.e20,Y=o.e21,p=o.e22,x=n.e00,v=n.e01,f=n.e02,Z=n.e10,k=n.e11,g=n.e12,I=n.e20,z=n.e21,d=n.e22;let W,q,U,G,J,N,K,O,$;W=l._rotation00*r+l._rotation10*h+l._rotation20*c,q=l._rotation00*e+l._rotation10*b+l._rotation20*Y,U=l._rotation00*a+l._rotation10*X+l._rotation20*p,G=l._rotation01*r+l._rotation11*h+l._rotation21*c,J=l._rotation01*e+l._rotation11*b+l._rotation21*Y,N=l._rotation01*a+l._rotation11*X+l._rotation21*p,K=l._rotation02*r+l._rotation12*h+l._rotation22*c,O=l._rotation02*e+l._rotation12*b+l._rotation22*Y,$=l._rotation02*a+l._rotation12*X+l._rotation22*p,u=W,B=q,j=U,L=G,V=J,M=N,w=K,P=O,E=$;let et,st,lt,rt,at,ot,ht,_t,bt;et=_._rotation00*x+_._rotation10*Z+_._rotation20*I,st=_._rotation00*v+_._rotation10*k+_._rotation20*z,lt=_._rotation00*f+_._rotation10*g+_._rotation20*d,rt=_._rotation01*x+_._rotation11*Z+_._rotation21*I,at=_._rotation01*v+_._rotation11*k+_._rotation21*z,ot=_._rotation01*f+_._rotation11*g+_._rotation21*d,ht=_._rotation02*x+_._rotation12*Z+_._rotation22*I,_t=_._rotation02*v+_._rotation12*k+_._rotation22*z,bt=_._rotation02*f+_._rotation12*g+_._rotation22*d,C=et,S=st,A=lt,R=rt,H=at,y=ot,D=ht,F=_t,Q=bt;let Xt=this.localBasis1;Xt.e00=u,Xt.e01=B,Xt.e02=j,Xt.e10=L,Xt.e11=V,Xt.e12=M,Xt.e20=w,Xt.e21=P,Xt.e22=E;let ft=this.localBasis2;return ft.e00=C,ft.e01=S,ft.e02=A,ft.e10=R,ft.e11=H,ft.e12=y,ft.e20=D,ft.e21=F,ft.e22=Q,this}};m.dynamics.constraint.joint.JointImpulse=class{constructor(){this.impulse=0,this.impulseM=0,this.impulseP=0}};m.dynamics.constraint.joint.JointLink=class{constructor(t){this._joint=t}getContact(){return this._joint}getOther(){return this._other}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.constraint.joint.JointMacro=class{};m.dynamics.constraint.joint.JointType=class{};m.dynamics.constraint.joint.PrismaticJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.PRISMATIC);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this._basis=new m.dynamics.constraint.joint.BasisTracker(this),this.translation=0,this.linearErrorY=0,this.linearErrorZ=0,this.angularErrorX=0,this.angularErrorY=0,this.angularErrorZ=0,this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let o=this.getErp(i,s),n=this.linearErrorY*o,l=this.linearErrorZ*o,_=this.angularErrorX*o,r=this.angularErrorY*o,e=this.angularErrorZ*o,a;if(this._sd.frequency<=0||!s){let u=this._impulses[0],B=t.rows[t.numRows++],j=B.jacobian;j.lin1X=0,j.lin1Y=0,j.lin1Z=0,j.lin2X=0,j.lin2Y=0,j.lin2Z=0,j.ang1X=0,j.ang1Y=0,j.ang1Z=0,j.ang2X=0,j.ang2Y=0,j.ang2Z=0,B.rhs=0,B.cfm=0,B.minImpulse=0,B.maxImpulse=0,B.motorSpeed=0,B.motorMaxImpulse=0,B.impulse=null,B.impulse=u,this.setSolverInfoRowLinear(B,this.translation,this._lm,1/(this._b1._invMass+this._b2._invMass),this._sd,i,s),a=B.jacobian,a.lin1X=this._basis.xX,a.lin1Y=this._basis.xY,a.lin1Z=this._basis.xZ,a.lin2X=this._basis.xX,a.lin2Y=this._basis.xY,a.lin2Z=this._basis.xZ,a.ang1X=this._relativeAnchor1Y*this._basis.xZ-this._relativeAnchor1Z*this._basis.xY,a.ang1Y=this._relativeAnchor1Z*this._basis.xX-this._relativeAnchor1X*this._basis.xZ,a.ang1Z=this._relativeAnchor1X*this._basis.xY-this._relativeAnchor1Y*this._basis.xX,a.ang2X=this._relativeAnchor2Y*this._basis.xZ-this._relativeAnchor2Z*this._basis.xY,a.ang2Y=this._relativeAnchor2Z*this._basis.xX-this._relativeAnchor2X*this._basis.xZ,a.ang2Z=this._relativeAnchor2X*this._basis.xY-this._relativeAnchor2Y*this._basis.xX}let h=this._impulses[1],b=t.rows[t.numRows++],X=b.jacobian;X.lin1X=0,X.lin1Y=0,X.lin1Z=0,X.lin2X=0,X.lin2Y=0,X.lin2Z=0,X.ang1X=0,X.ang1Y=0,X.ang1Z=0,X.ang2X=0,X.ang2Y=0,X.ang2Z=0,b.rhs=0,b.cfm=0,b.minImpulse=0,b.maxImpulse=0,b.motorSpeed=0,b.motorMaxImpulse=0,b.impulse=null,b.impulse=h,b.rhs=n,b.cfm=0,b.minImpulse=-1/0,b.maxImpulse=1/0,a=b.jacobian,a.lin1X=this._basis.yX,a.lin1Y=this._basis.yY,a.lin1Z=this._basis.yZ,a.lin2X=this._basis.yX,a.lin2Y=this._basis.yY,a.lin2Z=this._basis.yZ,a.ang1X=this._relativeAnchor1Y*this._basis.yZ-this._relativeAnchor1Z*this._basis.yY,a.ang1Y=this._relativeAnchor1Z*this._basis.yX-this._relativeAnchor1X*this._basis.yZ,a.ang1Z=this._relativeAnchor1X*this._basis.yY-this._relativeAnchor1Y*this._basis.yX,a.ang2X=this._relativeAnchor2Y*this._basis.yZ-this._relativeAnchor2Z*this._basis.yY,a.ang2Y=this._relativeAnchor2Z*this._basis.yX-this._relativeAnchor2X*this._basis.yZ,a.ang2Z=this._relativeAnchor2X*this._basis.yY-this._relativeAnchor2Y*this._basis.yX;let c=this._impulses[2],Y=t.rows[t.numRows++],p=Y.jacobian;p.lin1X=0,p.lin1Y=0,p.lin1Z=0,p.lin2X=0,p.lin2Y=0,p.lin2Z=0,p.ang1X=0,p.ang1Y=0,p.ang1Z=0,p.ang2X=0,p.ang2Y=0,p.ang2Z=0,Y.rhs=0,Y.cfm=0,Y.minImpulse=0,Y.maxImpulse=0,Y.motorSpeed=0,Y.motorMaxImpulse=0,Y.impulse=null,Y.impulse=c,Y.rhs=l,Y.cfm=0,Y.minImpulse=-1/0,Y.maxImpulse=1/0,a=Y.jacobian,a.lin1X=this._basis.zX,a.lin1Y=this._basis.zY,a.lin1Z=this._basis.zZ,a.lin2X=this._basis.zX,a.lin2Y=this._basis.zY,a.lin2Z=this._basis.zZ,a.ang1X=this._relativeAnchor1Y*this._basis.zZ-this._relativeAnchor1Z*this._basis.zY,a.ang1Y=this._relativeAnchor1Z*this._basis.zX-this._relativeAnchor1X*this._basis.zZ,a.ang1Z=this._relativeAnchor1X*this._basis.zY-this._relativeAnchor1Y*this._basis.zX,a.ang2X=this._relativeAnchor2Y*this._basis.zZ-this._relativeAnchor2Z*this._basis.zY,a.ang2Y=this._relativeAnchor2Z*this._basis.zX-this._relativeAnchor2X*this._basis.zZ,a.ang2Z=this._relativeAnchor2X*this._basis.zY-this._relativeAnchor2Y*this._basis.zX;let x=this._impulses[3],v=t.rows[t.numRows++],f=v.jacobian;f.lin1X=0,f.lin1Y=0,f.lin1Z=0,f.lin2X=0,f.lin2Y=0,f.lin2Z=0,f.ang1X=0,f.ang1Y=0,f.ang1Z=0,f.ang2X=0,f.ang2Y=0,f.ang2Z=0,v.rhs=0,v.cfm=0,v.minImpulse=0,v.maxImpulse=0,v.motorSpeed=0,v.motorMaxImpulse=0,v.impulse=null,v.impulse=x,v.rhs=_,v.cfm=0,v.minImpulse=-1/0,v.maxImpulse=1/0,a=v.jacobian,a.ang1X=1,a.ang1Y=0,a.ang1Z=0,a.ang2X=1,a.ang2Y=0,a.ang2Z=0;let Z=this._impulses[4],k=t.rows[t.numRows++],g=k.jacobian;g.lin1X=0,g.lin1Y=0,g.lin1Z=0,g.lin2X=0,g.lin2Y=0,g.lin2Z=0,g.ang1X=0,g.ang1Y=0,g.ang1Z=0,g.ang2X=0,g.ang2Y=0,g.ang2Z=0,k.rhs=0,k.cfm=0,k.minImpulse=0,k.maxImpulse=0,k.motorSpeed=0,k.motorMaxImpulse=0,k.impulse=null,k.impulse=Z,k.rhs=r,k.cfm=0,k.minImpulse=-1/0,k.maxImpulse=1/0,a=k.jacobian,a.ang1X=0,a.ang1Y=1,a.ang1Z=0,a.ang2X=0,a.ang2Y=1,a.ang2Z=0;let I=this._impulses[5],z=t.rows[t.numRows++],d=z.jacobian;d.lin1X=0,d.lin1Y=0,d.lin1Z=0,d.lin2X=0,d.lin2Y=0,d.lin2Z=0,d.ang1X=0,d.ang1Y=0,d.ang1Z=0,d.ang2X=0,d.ang2Y=0,d.ang2Z=0,z.rhs=0,z.cfm=0,z.minImpulse=0,z.maxImpulse=0,z.motorSpeed=0,z.motorMaxImpulse=0,z.impulse=null,z.impulse=I,z.rhs=e,z.cfm=0,z.minImpulse=-1/0,z.maxImpulse=1/0,a=z.jacobian,a.ang1X=0,a.ang1Y=0,a.ang1Z=1,a.ang2X=0,a.ang2Y=0,a.ang2Z=1}_syncAnchors(){super._syncAnchors();let t=this._basis,i=t.joint._b1._invMass,s=t.joint._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w,P,E,C,S,A,R,H,y=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(y<-.999999999){let ut,Vt,Ai,Vi=t.joint._basisX1X,Fi=t.joint._basisX1Y,$i=t.joint._basisX1Z,ae=Vi*Vi,re=Fi*Fi,pe=$i*$i,ti;ae<re?ae<pe?(ti=1/Math.sqrt(re+pe),ut=0,Vt=$i*ti,Ai=-Fi*ti):(ti=1/Math.sqrt(ae+re),ut=Fi*ti,Vt=-Vi*ti,Ai=0):re<pe?(ti=1/Math.sqrt(pe+ae),ut=-$i*ti,Vt=0,Ai=Vi*ti):(ti=1/Math.sqrt(ae+re),ut=Fi*ti,Vt=-Vi*ti,Ai=0),o=ut,n=Vt,l=Ai,_=0}else{let ut,Vt,Ai;ut=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,Vt=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,Ai=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Vi=Math.sqrt((1+y)*.5);y=.5/Vi,ut*=y,Vt*=y,Ai*=y,o=ut,n=Vt,l=Ai,_=Vi}r=0,e=0,a=0,h=1;let D,F,Q,W,q,U,G,J;D=r,F=e,Q=a,W=h,q=o,U=n,G=l,J=_;let N=D*q+F*U+Q*G+W*J;if(N<0&&(N=-N,q=-q,U=-U,G=-G,J=-J),N>.999999){let ut,Vt,Ai,Vi;ut=q-D,Vt=U-F,Ai=G-Q,Vi=J-W,q=D+ut*(i/(i+s)),U=F+Vt*(i/(i+s)),G=Q+Ai*(i/(i+s)),J=W+Vi*(i/(i+s));let Fi=q*q+U*U+G*G+J*J;Fi>1e-32&&(Fi=1/Math.sqrt(Fi)),b=q*Fi,X=U*Fi,c=G*Fi,Y=J*Fi}else{let ut=i/(i+s)*Math.acos(N);q+=D*-N,U+=F*-N,G+=Q*-N,J+=W*-N;let Vt=q*q+U*U+G*G+J*J;Vt>1e-32&&(Vt=1/Math.sqrt(Vt)),q*=Vt,U*=Vt,G*=Vt,J*=Vt;let Ai=Math.sin(ut),Vi=Math.cos(ut);D*=Vi,F*=Vi,Q*=Vi,W*=Vi,b=D+q*Ai,X=F+U*Ai,c=Q+G*Ai,Y=W+J*Ai}let K=b,O=X,$=c,et=Y,st=2*K,lt=2*O,rt=2*$,at=K*st,ot=O*lt,ht=$*rt,_t=K*lt,bt=O*rt,Xt=K*rt,ft=et*st,Zt=et*lt,xt=et*rt;p=1-ot-ht,x=_t-xt,v=Xt+Zt,f=_t+xt,Z=1-at-ht,k=bt-ft,g=Xt-Zt,I=bt+ft,z=1-at-ot;let zt,Yt,pt;zt=p*t.joint._basisX1X+x*t.joint._basisX1Y+v*t.joint._basisX1Z,Yt=f*t.joint._basisX1X+Z*t.joint._basisX1Y+k*t.joint._basisX1Z,pt=g*t.joint._basisX1X+I*t.joint._basisX1Y+z*t.joint._basisX1Z,d=zt,u=Yt,B=pt,E=t.xX,C=t.xY,S=t.xZ,A=t.yX,R=t.yY,H=t.yZ;let ct=E*d+C*u+S*B;if(ct<-.999999999){let ut,Vt,Ai,Vi=E,Fi=C,$i=S,ae=Vi*Vi,re=Fi*Fi,pe=$i*$i,ti;ae<re?ae<pe?(ti=1/Math.sqrt(re+pe),ut=0,Vt=$i*ti,Ai=-Fi*ti):(ti=1/Math.sqrt(ae+re),ut=Fi*ti,Vt=-Vi*ti,Ai=0):re<pe?(ti=1/Math.sqrt(pe+ae),ut=-$i*ti,Vt=0,Ai=Vi*ti):(ti=1/Math.sqrt(ae+re),ut=Fi*ti,Vt=-Vi*ti,Ai=0),b=ut,X=Vt,c=Ai,Y=0}else{let ut,Vt,Ai;ut=C*B-S*u,Vt=S*d-E*B,Ai=E*u-C*d;let Vi=Math.sqrt((1+ct)*.5);ct=.5/Vi,ut*=ct,Vt*=ct,Ai*=ct,b=ut,X=Vt,c=Ai,Y=Vi}let nt=b,tt=X,Lt=c,Bt=Y,Mt=2*nt,jt=2*tt,ci=2*Lt,Xi=nt*Mt,Yi=tt*jt,Li=Lt*ci,wi=nt*jt,ei=tt*ci,qt=nt*ci,At=Bt*Mt,ni=Bt*jt,ui=Bt*ci;p=1-Yi-Li,x=wi-ui,v=qt+ni,f=wi+ui,Z=1-Xi-Li,k=ei-At,g=qt-ni,I=ei+At,z=1-Xi-Yi;let Oi,Bi,kt;if(Oi=p*A+x*R+v*H,Bi=f*A+Z*R+k*H,kt=g*A+I*R+z*H,j=Oi,L=Bi,V=kt,M=u*V-B*L,w=B*j-d*V,P=d*L-u*j,M*M+w*w+P*P>1e-6){let ut=M*M+w*w+P*P;ut>0&&(ut=1/Math.sqrt(ut)),M*=ut,w*=ut,P*=ut}else{let ut=d,Vt=u,Ai=B,Vi=ut*ut,Fi=Vt*Vt,$i=Ai*Ai,ae;Vi<Fi?Vi<$i?(ae=1/Math.sqrt(Fi+$i),M=0,w=Ai*ae,P=-Vt*ae):(ae=1/Math.sqrt(Vi+Fi),M=Vt*ae,w=-ut*ae,P=0):Fi<$i?(ae=1/Math.sqrt($i+Vi),M=-Ai*ae,w=0,P=ut*ae):(ae=1/Math.sqrt(Vi+Fi),M=Vt*ae,w=-ut*ae,P=0)}j=w*B-P*u,L=P*d-M*B,V=M*u-w*d,t.xX=d,t.xY=u,t.xZ=B,t.yX=j,t.yY=L,t.yZ=V,t.zX=M,t.zY=w,t.zZ=P;let wt,$t,fi,gi,it,Ht,ii,T,Gt,Et,si,oi,Pt,ai,Ri,Zi,yt,dt;wt=this._basisX1X,$t=this._basisY1X,fi=this._basisZ1X,gi=this._basisX1Y,it=this._basisY1Y,Ht=this._basisZ1Y,ii=this._basisX1Z,T=this._basisY1Z,Gt=this._basisZ1Z,Et=this._basisX2X,si=this._basisY2X,oi=this._basisZ2X,Pt=this._basisX2Y,ai=this._basisY2Y,Ri=this._basisZ2Y,Zi=this._basisX2Z,yt=this._basisY2Z,dt=this._basisZ2Z;let vt,di,Ii,bi,se,me,Di,he,ve,_i,ce,be,xe,ye,Ni,Ji,Ui,oe;_i=Et*wt+si*$t+oi*fi,ce=Et*gi+si*it+oi*Ht,be=Et*ii+si*T+oi*Gt,xe=Pt*wt+ai*$t+Ri*fi,ye=Pt*gi+ai*it+Ri*Ht,Ni=Pt*ii+ai*T+Ri*Gt,Ji=Zi*wt+yt*$t+dt*fi,Ui=Zi*gi+yt*it+dt*Ht,oe=Zi*ii+yt*T+dt*Gt,vt=_i,di=ce,Ii=be,bi=xe,se=ye,me=Ni,Di=Ji,he=Ui,ve=oe;let ne,Ki,ie,Hi,Wi=vt,Pi=se,Ut=ve,ri=Wi+Pi+Ut,Ct;ri>0?(Ct=Math.sqrt(ri+1),Hi=.5*Ct,Ct=.5/Ct,ne=(he-me)*Ct,Ki=(Ii-Di)*Ct,ie=(bi-di)*Ct):Wi>Pi?Wi>Ut?(Ct=Math.sqrt(Wi-Pi-Ut+1),ne=.5*Ct,Ct=.5/Ct,Ki=(di+bi)*Ct,ie=(Ii+Di)*Ct,Hi=(he-me)*Ct):(Ct=Math.sqrt(Ut-Wi-Pi+1),ie=.5*Ct,Ct=.5/Ct,ne=(Ii+Di)*Ct,Ki=(me+he)*Ct,Hi=(bi-di)*Ct):Pi>Ut?(Ct=Math.sqrt(Pi-Ut-Wi+1),Ki=.5*Ct,Ct=.5/Ct,ne=(di+bi)*Ct,ie=(me+he)*Ct,Hi=(Ii-Di)*Ct):(Ct=Math.sqrt(Ut-Wi-Pi+1),ie=.5*Ct,Ct=.5/Ct,ne=(Ii+Di)*Ct,Ki=(me+he)*Ct,Hi=(bi-di)*Ct);let Mi=Hi,zi=(Mi<=-1?3.14159265358979:Mi>=1?0:Math.acos(Mi))*2;this.angularErrorX=ne,this.angularErrorY=Ki,this.angularErrorZ=ie;let Ei=this.angularErrorX*this.angularErrorX+this.angularErrorY*this.angularErrorY+this.angularErrorZ*this.angularErrorZ;Ei>0&&(Ei=1/Math.sqrt(Ei)),this.angularErrorX*=Ei,this.angularErrorY*=Ei,this.angularErrorZ*=Ei,this.angularErrorX*=zi,this.angularErrorY*=zi,this.angularErrorZ*=zi;let ki,Ti,Wt;ki=this._anchor2X-this._anchor1X,Ti=this._anchor2Y-this._anchor1Y,Wt=this._anchor2Z-this._anchor1Z,this.translation=ki*this._basis.xX+Ti*this._basis.xY+Wt*this._basis.xZ,this.linearErrorY=ki*this._basis.yX+Ti*this._basis.yY+Wt*this._basis.yZ,this.linearErrorZ=ki*this._basis.zX+Ti*this._basis.zY+Wt*this._basis.zZ}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getTranslation(){return this.translation}};m.dynamics.constraint.joint.PrismaticJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.limitMotor=new m.dynamics.constraint.joint.TranslationalLimitMotor,this.springDamper=new m.dynamics.constraint.joint.SpringDamper}init(t,i,s,o){this._init(t,i,s);let n=this.localAxis1,l,_,r;l=o.x,_=o.y,r=o.z;let e,a,h;e=t._transform._rotation00*l+t._transform._rotation10*_+t._transform._rotation20*r,a=t._transform._rotation01*l+t._transform._rotation11*_+t._transform._rotation21*r,h=t._transform._rotation02*l+t._transform._rotation12*_+t._transform._rotation22*r,l=e,_=a,r=h,n.x=l,n.y=_,n.z=r;let b=this.localAxis2,X,c,Y;X=o.x,c=o.y,Y=o.z;let p,x,v;return p=i._transform._rotation00*X+i._transform._rotation10*c+i._transform._rotation20*Y,x=i._transform._rotation01*X+i._transform._rotation11*c+i._transform._rotation21*Y,v=i._transform._rotation02*X+i._transform._rotation12*c+i._transform._rotation22*Y,X=p,c=x,Y=v,b.x=X,b.y=c,b.z=Y,this}};m.dynamics.constraint.joint.RagdollJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.RAGDOLL);let i=t.localTwistAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localSwingAxis1;this._localBasisY1X=s.x,this._localBasisY1Y=s.y,this._localBasisY1Z=s.z;let o=t.localTwistAxis2;this._localBasisX2X=o.x,this._localBasisX2Y=o.y,this._localBasisX2Z=o.z,this.buildLocalBasesFromXY1X2(),this._twistSd=t.twistSpringDamper.clone(),this._twistLm=t.twistLimitMotor.clone(),this._swingSd=t.swingSpringDamper.clone(),this._maxSwingAngle1=t.maxSwingAngle1,this._maxSwingAngle2=t.maxSwingAngle2,this._maxSwingAngle1<m.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle1=m.common.Setting.minRagdollMaxSwingAngle),this._maxSwingAngle2<m.common.Setting.minRagdollMaxSwingAngle&&(this._maxSwingAngle2=m.common.Setting.minRagdollMaxSwingAngle),this.dummySwingLm=new m.dynamics.constraint.joint.RotationalLimitMotor,this.dummySwingLm.lowerLimit=-1,this.dummySwingLm.upperLimit=0,this._swingAngle=0,this._twistAngle=0,this.swingError=0,this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.twistAxisX=0,this.twistAxisY=0,this.twistAxisZ=0}getInfo(t,i,s){let o=this.getErp(i,s),n,l,_;n=this.linearErrorX*o,l=this.linearErrorY*o,_=this.linearErrorZ*o;let r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d;r=0,e=-this._relativeAnchor1Z,a=this._relativeAnchor1Y,h=this._relativeAnchor1Z,b=0,X=-this._relativeAnchor1X,c=-this._relativeAnchor1Y,Y=this._relativeAnchor1X,p=0,x=0,v=-this._relativeAnchor2Z,f=this._relativeAnchor2Y,Z=this._relativeAnchor2Z,k=0,g=-this._relativeAnchor2X,I=-this._relativeAnchor2Y,z=this._relativeAnchor2X,d=0,r=-r,e=-e,a=-a,h=-h,b=-b,X=-X,c=-c,Y=-Y,p=-p,x=-x,v=-v,f=-f,Z=-Z,k=-k,g=-g,I=-I,z=-z,d=-d;let u=this.computeEffectiveInertiaMoment(this.swingAxisX,this.swingAxisY,this.swingAxisZ),B=this.computeEffectiveInertiaMoment(this._basisX2X,this._basisX2Y,this._basisX2Z),j=this._impulses[0],L=t.rows[t.numRows++],V=L.jacobian;V.lin1X=0,V.lin1Y=0,V.lin1Z=0,V.lin2X=0,V.lin2Y=0,V.lin2Z=0,V.ang1X=0,V.ang1Y=0,V.ang1Z=0,V.ang2X=0,V.ang2Y=0,V.ang2Z=0,L.rhs=0,L.cfm=0,L.minImpulse=0,L.maxImpulse=0,L.motorSpeed=0,L.motorMaxImpulse=0,L.impulse=null,L.impulse=j,L.rhs=n,L.cfm=0,L.minImpulse=-1/0,L.maxImpulse=1/0;let M=L.jacobian;M.lin1X=1,M.lin1Y=0,M.lin1Z=0,M.lin2X=1,M.lin2Y=0,M.lin2Z=0,M.ang1X=r,M.ang1Y=e,M.ang1Z=a,M.ang2X=x,M.ang2Y=v,M.ang2Z=f;let w=this._impulses[1],P=t.rows[t.numRows++],E=P.jacobian;E.lin1X=0,E.lin1Y=0,E.lin1Z=0,E.lin2X=0,E.lin2Y=0,E.lin2Z=0,E.ang1X=0,E.ang1Y=0,E.ang1Z=0,E.ang2X=0,E.ang2Y=0,E.ang2Z=0,P.rhs=0,P.cfm=0,P.minImpulse=0,P.maxImpulse=0,P.motorSpeed=0,P.motorMaxImpulse=0,P.impulse=null,P.impulse=w,P.rhs=l,P.cfm=0,P.minImpulse=-1/0,P.maxImpulse=1/0,M=P.jacobian,M.lin1X=0,M.lin1Y=1,M.lin1Z=0,M.lin2X=0,M.lin2Y=1,M.lin2Z=0,M.ang1X=h,M.ang1Y=b,M.ang1Z=X,M.ang2X=Z,M.ang2Y=k,M.ang2Z=g;let C=this._impulses[2],S=t.rows[t.numRows++],A=S.jacobian;if(A.lin1X=0,A.lin1Y=0,A.lin1Z=0,A.lin2X=0,A.lin2Y=0,A.lin2Z=0,A.ang1X=0,A.ang1Y=0,A.ang1Z=0,A.ang2X=0,A.ang2Y=0,A.ang2Z=0,S.rhs=0,S.cfm=0,S.minImpulse=0,S.maxImpulse=0,S.motorSpeed=0,S.motorMaxImpulse=0,S.impulse=null,S.impulse=C,S.rhs=_,S.cfm=0,S.minImpulse=-1/0,S.maxImpulse=1/0,M=S.jacobian,M.lin1X=0,M.lin1Y=0,M.lin1Z=1,M.lin2X=0,M.lin2Y=0,M.lin2Z=1,M.ang1X=c,M.ang1Y=Y,M.ang1Z=p,M.ang2X=I,M.ang2Y=z,M.ang2Z=d,this.swingError>0&&(this._swingSd.frequency<=0||!s)){let R=this._impulses[3],H=t.rows[t.numRows++],y=H.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=R,this.setSolverInfoRowAngular(H,this.swingError,this.dummySwingLm,u,this._swingSd,i,s),M=H.jacobian,M.ang1X=this.swingAxisX,M.ang1Y=this.swingAxisY,M.ang1Z=this.swingAxisZ,M.ang2X=this.swingAxisX,M.ang2Y=this.swingAxisY,M.ang2Z=this.swingAxisZ}if(this._twistSd.frequency<=0||!s){let R=this._impulses[4],H=t.rows[t.numRows++],y=H.jacobian;y.lin1X=0,y.lin1Y=0,y.lin1Z=0,y.lin2X=0,y.lin2Y=0,y.lin2Z=0,y.ang1X=0,y.ang1Y=0,y.ang1Z=0,y.ang2X=0,y.ang2Y=0,y.ang2Z=0,H.rhs=0,H.cfm=0,H.minImpulse=0,H.maxImpulse=0,H.motorSpeed=0,H.motorMaxImpulse=0,H.impulse=null,H.impulse=R,this.setSolverInfoRowAngular(H,this._twistAngle,this._twistLm,B,this._twistSd,i,s),M=H.jacobian,M.ang1X=this.twistAxisX,M.ang1Y=this.twistAxisY,M.ang1Z=this.twistAxisZ,M.ang2X=this.twistAxisX,M.ang2Y=this.twistAxisY,M.ang2Z=this.twistAxisZ}}_syncAnchors(){super._syncAnchors();let t,i,s,o,n,l;t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,o=this._basisX2X,n=this._basisX2Y,l=this._basisX2Z;let _,r,e,a,h,b,X,c,Y;_=this._basisX1X,r=this._basisY1X,e=this._basisZ1X,a=this._basisX1Y,h=this._basisY1Y,b=this._basisZ1Y,X=this._basisX1Z,c=this._basisY1Z,Y=this._basisZ1Z;let p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w=t*o+i*n+s*l;if(w<-.999999999){let zt,Yt,pt,ct=t,nt=i,tt=s,Lt=ct*ct,Bt=nt*nt,Mt=tt*tt,jt;Lt<Bt?Lt<Mt?(jt=1/Math.sqrt(Bt+Mt),zt=0,Yt=tt*jt,pt=-nt*jt):(jt=1/Math.sqrt(Lt+Bt),zt=nt*jt,Yt=-ct*jt,pt=0):Bt<Mt?(jt=1/Math.sqrt(Mt+Lt),zt=-tt*jt,Yt=0,pt=ct*jt):(jt=1/Math.sqrt(Lt+Bt),zt=nt*jt,Yt=-ct*jt,pt=0),p=zt,x=Yt,v=pt,f=0}else{let zt,Yt,pt;zt=i*l-s*n,Yt=s*o-t*l,pt=t*n-i*o;let ct=Math.sqrt((1+w)*.5);w=.5/ct,zt*=w,Yt*=w,pt*=w,p=zt,x=Yt,v=pt,f=ct}let P=p,E=x,C=v,S=f,A=2*P,R=2*E,H=2*C,y=P*A,D=E*R,F=C*H,Q=P*R,W=E*H,q=P*H,U=S*A,G=S*R,J=S*H;Z=1-D-F,k=Q-J,g=q+G,I=Q+J,z=1-y-F,d=W-U,u=q-G,B=W+U,j=1-y-D,this._swingAngle=(f<=-1?3.14159265358979:f>=1?0:Math.acos(f))*2,L=p,V=x,M=v;let N,K,O,$,et,st;$=Z*this._basisY2X+I*this._basisY2Y+u*this._basisY2Z,et=k*this._basisY2X+z*this._basisY2Y+B*this._basisY2Z,st=g*this._basisY2X+d*this._basisY2Y+j*this._basisY2Z,N=$,K=et,O=st,this._twistAngle=Math.atan2(this._basisZ1X*N+this._basisZ1Y*K+this._basisZ1Z*O,this._basisY1X*N+this._basisY1Y*K+this._basisY1Z*O),this.twistAxisX=this._basisX1X+this._basisX2X,this.twistAxisY=this._basisX1Y+this._basisX2Y,this.twistAxisZ=this._basisX1Z+this._basisX2Z;let lt=this.twistAxisX*this.twistAxisX+this.twistAxisY*this.twistAxisY+this.twistAxisZ*this.twistAxisZ;lt>0&&(lt=1/Math.sqrt(lt)),this.twistAxisX*=lt,this.twistAxisY*=lt,this.twistAxisZ*=lt;let rt=Math.sqrt(L*L+V*V+M*M);rt>0&&(rt=1/rt),L*=rt*this._swingAngle,V*=rt*this._swingAngle,M*=rt*this._swingAngle;let at,ot;at=r*L+h*V+c*M,ot=e*L+b*V+Y*M,V=at,M=ot;let ht=V,_t=M,bt=this._maxSwingAngle1,Xt=this._maxSwingAngle2,ft=1/(bt*bt),Zt=1/(Xt*Xt),xt=ht*ht*ft+_t*_t*Zt;if(xt==0)this.swingAxisX=0,this.swingAxisY=0,this.swingAxisZ=0,this.swingError=0;else{let zt=Math.sqrt(1/xt),Yt=ht*zt,pt=_t*zt,ct=Yt*ft,nt=pt*Zt;rt=1/Math.sqrt(ct*ct+nt*nt),ct*=rt,nt*=rt;let tt=(ht-Yt)*ct+(_t-pt)*nt;if(tt>0){this.swingError=tt,this.swingAxisX=0,this.swingAxisY=ct,this.swingAxisZ=nt;let Lt,Bt,Mt;Lt=_*this.swingAxisX+r*this.swingAxisY+e*this.swingAxisZ,Bt=a*this.swingAxisX+h*this.swingAxisY+b*this.swingAxisZ,Mt=X*this.swingAxisX+c*this.swingAxisY+Y*this.swingAxisZ,this.swingAxisX=Lt,this.swingAxisY=Bt,this.swingAxisZ=Mt;let jt,ci,Xi;jt=Z*this.swingAxisX+k*this.swingAxisY+g*this.swingAxisZ,ci=I*this.swingAxisX+z*this.swingAxisY+d*this.swingAxisZ,Xi=u*this.swingAxisX+B*this.swingAxisY+j*this.swingAxisZ,this.swingAxisX=jt,this.swingAxisY=ci,this.swingAxisZ=Xi}else this.swingError=0}this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getTwistSpringDamper(){return this._twistSd}getTwistLimitMotor(){return this._twistLm}getSwingSpringDamper(){return this._swingSd}getSwingAxis(){let t=new m.common.Vec3;return t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ,t}getSwingAxisTo(t){t.x=this.swingAxisX,t.y=this.swingAxisY,t.z=this.swingAxisZ}getSwingAngle(){return this._swingAngle}getTwistAngle(){return this._twistAngle}};m.dynamics.constraint.joint.RagdollJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localTwistAxis1=new m.common.Vec3(1,0,0),this.localTwistAxis2=new m.common.Vec3(1,0,0),this.localSwingAxis1=new m.common.Vec3(0,1,0),this.twistSpringDamper=new m.dynamics.constraint.joint.SpringDamper,this.swingSpringDamper=new m.dynamics.constraint.joint.SpringDamper,this.twistLimitMotor=new m.dynamics.constraint.joint.RotationalLimitMotor,this.maxSwingAngle1=3.14159265358979,this.maxSwingAngle2=3.14159265358979}init(t,i,s,o,n){this._init(t,i,s);let l=this.localTwistAxis1,_,r,e;_=o.x,r=o.y,e=o.z;let a,h,b;a=t._transform._rotation00*_+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*_+t._transform._rotation11*r+t._transform._rotation21*e,b=t._transform._rotation02*_+t._transform._rotation12*r+t._transform._rotation22*e,_=a,r=h,e=b,l.x=_,l.y=r,l.z=e;let X=this.localTwistAxis2,c,Y,p;c=o.x,Y=o.y,p=o.z;let x,v,f;x=i._transform._rotation00*c+i._transform._rotation10*Y+i._transform._rotation20*p,v=i._transform._rotation01*c+i._transform._rotation11*Y+i._transform._rotation21*p,f=i._transform._rotation02*c+i._transform._rotation12*Y+i._transform._rotation22*p,c=x,Y=v,p=f,X.x=c,X.y=Y,X.z=p;let Z=this.localSwingAxis1,k,g,I;k=n.x,g=n.y,I=n.z;let z,d,u;return z=t._transform._rotation00*k+t._transform._rotation10*g+t._transform._rotation20*I,d=t._transform._rotation01*k+t._transform._rotation11*g+t._transform._rotation21*I,u=t._transform._rotation02*k+t._transform._rotation12*g+t._transform._rotation22*I,k=z,g=d,I=u,Z.x=k,Z.y=g,Z.z=I,this}};m.dynamics.constraint.joint.RevoluteJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,1);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisX2X=s.x,this._localBasisX2Y=s.y,this._localBasisX2Z=s.z,this.buildLocalBasesFromX(),this.angle=0,this.angularErrorY=0,this.angularErrorZ=0,this._basis=new m.dynamics.constraint.joint.BasisTracker(this),this._sd=t.springDamper.clone(),this._lm=t.limitMotor.clone()}getInfo(t,i,s){let o=this.getErp(i,s),n,l,_;n=this.linearErrorX*o,l=this.linearErrorY*o,_=this.linearErrorZ*o;let r=this.angularErrorY*o,e=this.angularErrorZ*o,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B;a=0,h=-this._relativeAnchor1Z,b=this._relativeAnchor1Y,X=this._relativeAnchor1Z,c=0,Y=-this._relativeAnchor1X,p=-this._relativeAnchor1Y,x=this._relativeAnchor1X,v=0,f=0,Z=-this._relativeAnchor2Z,k=this._relativeAnchor2Y,g=this._relativeAnchor2Z,I=0,z=-this._relativeAnchor2X,d=-this._relativeAnchor2Y,u=this._relativeAnchor2X,B=0,a=-a,h=-h,b=-b,X=-X,c=-c,Y=-Y,p=-p,x=-x,v=-v,f=-f,Z=-Z,k=-k,g=-g,I=-I,z=-z,d=-d,u=-u,B=-B;let j=this.computeEffectiveInertiaMoment(this._basis.xX,this._basis.xY,this._basis.xZ),L=this._impulses[0],V=t.rows[t.numRows++],M=V.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=L,V.rhs=n,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0;let w=V.jacobian;w.lin1X=1,w.lin1Y=0,w.lin1Z=0,w.lin2X=1,w.lin2Y=0,w.lin2Z=0,w.ang1X=a,w.ang1Y=h,w.ang1Z=b,w.ang2X=f,w.ang2Y=Z,w.ang2Z=k;let P=this._impulses[1],E=t.rows[t.numRows++],C=E.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=P,E.rhs=l,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,w=E.jacobian,w.lin1X=0,w.lin1Y=1,w.lin1Z=0,w.lin2X=0,w.lin2Y=1,w.lin2Z=0,w.ang1X=X,w.ang1Y=c,w.ang1Z=Y,w.ang2X=g,w.ang2Y=I,w.ang2Z=z;let S=this._impulses[2],A=t.rows[t.numRows++],R=A.jacobian;if(R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=S,A.rhs=_,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0,w=A.jacobian,w.lin1X=0,w.lin1Y=0,w.lin1Z=1,w.lin2X=0,w.lin2Y=0,w.lin2Z=1,w.ang1X=p,w.ang1Y=x,w.ang1Z=v,w.ang2X=d,w.ang2Y=u,w.ang2Z=B,this._sd.frequency<=0||!s){let q=this._impulses[3],U=t.rows[t.numRows++],G=U.jacobian;G.lin1X=0,G.lin1Y=0,G.lin1Z=0,G.lin2X=0,G.lin2Y=0,G.lin2Z=0,G.ang1X=0,G.ang1Y=0,G.ang1Z=0,G.ang2X=0,G.ang2Y=0,G.ang2Z=0,U.rhs=0,U.cfm=0,U.minImpulse=0,U.maxImpulse=0,U.motorSpeed=0,U.motorMaxImpulse=0,U.impulse=null,U.impulse=q,this.setSolverInfoRowAngular(U,this.angle,this._lm,j,this._sd,i,s),w=U.jacobian,w.ang1X=this._basis.xX,w.ang1Y=this._basis.xY,w.ang1Z=this._basis.xZ,w.ang2X=this._basis.xX,w.ang2Y=this._basis.xY,w.ang2Z=this._basis.xZ}let H=this._impulses[4],y=t.rows[t.numRows++],D=y.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=H,y.rhs=r,y.cfm=0,y.minImpulse=-1/0,y.maxImpulse=1/0,w=y.jacobian,w.ang1X=this._basis.yX,w.ang1Y=this._basis.yY,w.ang1Z=this._basis.yZ,w.ang2X=this._basis.yX,w.ang2Y=this._basis.yY,w.ang2Z=this._basis.yZ;let F=this._impulses[5],Q=t.rows[t.numRows++],W=Q.jacobian;W.lin1X=0,W.lin1Y=0,W.lin1Z=0,W.lin2X=0,W.lin2Y=0,W.lin2Z=0,W.ang1X=0,W.ang1Y=0,W.ang1Z=0,W.ang2X=0,W.ang2Y=0,W.ang2Z=0,Q.rhs=0,Q.cfm=0,Q.minImpulse=0,Q.maxImpulse=0,Q.motorSpeed=0,Q.motorMaxImpulse=0,Q.impulse=null,Q.impulse=F,Q.rhs=e,Q.cfm=0,Q.minImpulse=-1/0,Q.maxImpulse=1/0,w=Q.jacobian,w.ang1X=this._basis.zX,w.ang1Y=this._basis.zY,w.ang1Z=this._basis.zZ,w.ang2X=this._basis.zX,w.ang2Y=this._basis.zY,w.ang2Z=this._basis.zZ}_syncAnchors(){super._syncAnchors();let t=this._basis,i=t.joint._b1._invMass,s=t.joint._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V,M,w,P,E,C,S,A,R,H,y=t.joint._basisX1X*t.joint._basisX2X+t.joint._basisX1Y*t.joint._basisX2Y+t.joint._basisX1Z*t.joint._basisX2Z;if(y<-.999999999){let Et,si,oi,Pt=t.joint._basisX1X,ai=t.joint._basisX1Y,Ri=t.joint._basisX1Z,Zi=Pt*Pt,yt=ai*ai,dt=Ri*Ri,vt;Zi<yt?Zi<dt?(vt=1/Math.sqrt(yt+dt),Et=0,si=Ri*vt,oi=-ai*vt):(vt=1/Math.sqrt(Zi+yt),Et=ai*vt,si=-Pt*vt,oi=0):yt<dt?(vt=1/Math.sqrt(dt+Zi),Et=-Ri*vt,si=0,oi=Pt*vt):(vt=1/Math.sqrt(Zi+yt),Et=ai*vt,si=-Pt*vt,oi=0),o=Et,n=si,l=oi,_=0}else{let Et,si,oi;Et=t.joint._basisX1Y*t.joint._basisX2Z-t.joint._basisX1Z*t.joint._basisX2Y,si=t.joint._basisX1Z*t.joint._basisX2X-t.joint._basisX1X*t.joint._basisX2Z,oi=t.joint._basisX1X*t.joint._basisX2Y-t.joint._basisX1Y*t.joint._basisX2X;let Pt=Math.sqrt((1+y)*.5);y=.5/Pt,Et*=y,si*=y,oi*=y,o=Et,n=si,l=oi,_=Pt}r=0,e=0,a=0,h=1;let D,F,Q,W,q,U,G,J;D=r,F=e,Q=a,W=h,q=o,U=n,G=l,J=_;let N=D*q+F*U+Q*G+W*J;if(N<0&&(N=-N,q=-q,U=-U,G=-G,J=-J),N>.999999){let Et,si,oi,Pt;Et=q-D,si=U-F,oi=G-Q,Pt=J-W,q=D+Et*(i/(i+s)),U=F+si*(i/(i+s)),G=Q+oi*(i/(i+s)),J=W+Pt*(i/(i+s));let ai=q*q+U*U+G*G+J*J;ai>1e-32&&(ai=1/Math.sqrt(ai)),b=q*ai,X=U*ai,c=G*ai,Y=J*ai}else{let Et=i/(i+s)*Math.acos(N);q+=D*-N,U+=F*-N,G+=Q*-N,J+=W*-N;let si=q*q+U*U+G*G+J*J;si>1e-32&&(si=1/Math.sqrt(si)),q*=si,U*=si,G*=si,J*=si;let oi=Math.sin(Et),Pt=Math.cos(Et);D*=Pt,F*=Pt,Q*=Pt,W*=Pt,b=D+q*oi,X=F+U*oi,c=Q+G*oi,Y=W+J*oi}let K=b,O=X,$=c,et=Y,st=2*K,lt=2*O,rt=2*$,at=K*st,ot=O*lt,ht=$*rt,_t=K*lt,bt=O*rt,Xt=K*rt,ft=et*st,Zt=et*lt,xt=et*rt;p=1-ot-ht,x=_t-xt,v=Xt+Zt,f=_t+xt,Z=1-at-ht,k=bt-ft,g=Xt-Zt,I=bt+ft,z=1-at-ot;let zt,Yt,pt;zt=p*t.joint._basisX1X+x*t.joint._basisX1Y+v*t.joint._basisX1Z,Yt=f*t.joint._basisX1X+Z*t.joint._basisX1Y+k*t.joint._basisX1Z,pt=g*t.joint._basisX1X+I*t.joint._basisX1Y+z*t.joint._basisX1Z,d=zt,u=Yt,B=pt,E=t.xX,C=t.xY,S=t.xZ,A=t.yX,R=t.yY,H=t.yZ;let ct=E*d+C*u+S*B;if(ct<-.999999999){let Et,si,oi,Pt=E,ai=C,Ri=S,Zi=Pt*Pt,yt=ai*ai,dt=Ri*Ri,vt;Zi<yt?Zi<dt?(vt=1/Math.sqrt(yt+dt),Et=0,si=Ri*vt,oi=-ai*vt):(vt=1/Math.sqrt(Zi+yt),Et=ai*vt,si=-Pt*vt,oi=0):yt<dt?(vt=1/Math.sqrt(dt+Zi),Et=-Ri*vt,si=0,oi=Pt*vt):(vt=1/Math.sqrt(Zi+yt),Et=ai*vt,si=-Pt*vt,oi=0),b=Et,X=si,c=oi,Y=0}else{let Et,si,oi;Et=C*B-S*u,si=S*d-E*B,oi=E*u-C*d;let Pt=Math.sqrt((1+ct)*.5);ct=.5/Pt,Et*=ct,si*=ct,oi*=ct,b=Et,X=si,c=oi,Y=Pt}let nt=b,tt=X,Lt=c,Bt=Y,Mt=2*nt,jt=2*tt,ci=2*Lt,Xi=nt*Mt,Yi=tt*jt,Li=Lt*ci,wi=nt*jt,ei=tt*ci,qt=nt*ci,At=Bt*Mt,ni=Bt*jt,ui=Bt*ci;p=1-Yi-Li,x=wi-ui,v=qt+ni,f=wi+ui,Z=1-Xi-Li,k=ei-At,g=qt-ni,I=ei+At,z=1-Xi-Yi;let Oi,Bi,kt;if(Oi=p*A+x*R+v*H,Bi=f*A+Z*R+k*H,kt=g*A+I*R+z*H,j=Oi,L=Bi,V=kt,M=u*V-B*L,w=B*j-d*V,P=d*L-u*j,M*M+w*w+P*P>1e-6){let Et=M*M+w*w+P*P;Et>0&&(Et=1/Math.sqrt(Et)),M*=Et,w*=Et,P*=Et}else{let Et=d,si=u,oi=B,Pt=Et*Et,ai=si*si,Ri=oi*oi,Zi;Pt<ai?Pt<Ri?(Zi=1/Math.sqrt(ai+Ri),M=0,w=oi*Zi,P=-si*Zi):(Zi=1/Math.sqrt(Pt+ai),M=si*Zi,w=-Et*Zi,P=0):ai<Ri?(Zi=1/Math.sqrt(Ri+Pt),M=-oi*Zi,w=0,P=Et*Zi):(Zi=1/Math.sqrt(Pt+ai),M=si*Zi,w=-Et*Zi,P=0)}j=w*B-P*u,L=P*d-M*B,V=M*u-w*d,t.xX=d,t.xY=u,t.xZ=B,t.yX=j,t.yY=L,t.yZ=V,t.zX=M,t.zY=w,t.zZ=P;let wt,$t,fi;wt=this._basisX1Y*this._basisX2Z-this._basisX1Z*this._basisX2Y,$t=this._basisX1Z*this._basisX2X-this._basisX1X*this._basisX2Z,fi=this._basisX1X*this._basisX2Y-this._basisX1Y*this._basisX2X;let gi=this._basisX1X*this._basisX2X+this._basisX1Y*this._basisX2Y+this._basisX1Z*this._basisX2Z,it=gi<=-1?3.14159265358979:gi>=1?0:Math.acos(gi),Ht=wt*wt+$t*$t+fi*fi;Ht>0&&(Ht=1/Math.sqrt(Ht)),wt*=Ht,$t*=Ht,fi*=Ht,wt*=it,$t*=it,fi*=it,this.angularErrorY=wt*this._basis.yX+$t*this._basis.yY+fi*this._basis.yZ,this.angularErrorZ=wt*this._basis.zX+$t*this._basis.zY+fi*this._basis.zZ;let ii,T,Gt;ii=this._basisY1Y*this._basisY2Z-this._basisY1Z*this._basisY2Y,T=this._basisY1Z*this._basisY2X-this._basisY1X*this._basisY2Z,Gt=this._basisY1X*this._basisY2Y-this._basisY1Y*this._basisY2X,gi=this._basisY1X*this._basisY2X+this._basisY1Y*this._basisY2Y+this._basisY1Z*this._basisY2Z,this.angle=gi<=-1?3.14159265358979:gi>=1?0:Math.acos(gi),ii*this._basis.xX+T*this._basis.xY+Gt*this._basis.xZ<0&&(this.angle=-this.angle),this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisX2X,t.y=this._basisX2Y,t.z=this._basisX2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisX2X,t.y=this._localBasisX2Y,t.z=this._localBasisX2Z}getSpringDamper(){return this._sd}getLimitMotor(){return this._lm}getAngle(){return this.angle}};m.dynamics.constraint.joint.RevoluteJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.springDamper=new m.dynamics.constraint.joint.SpringDamper,this.limitMotor=new m.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,o){this._init(t,i,s);let n=this.localAxis1,l,_,r;l=o.x,_=o.y,r=o.z;let e,a,h;e=t._transform._rotation00*l+t._transform._rotation10*_+t._transform._rotation20*r,a=t._transform._rotation01*l+t._transform._rotation11*_+t._transform._rotation21*r,h=t._transform._rotation02*l+t._transform._rotation12*_+t._transform._rotation22*r,l=e,_=a,r=h,n.x=l,n.y=_,n.z=r;let b=this.localAxis2,X,c,Y;X=o.x,c=o.y,Y=o.z;let p,x,v;return p=i._transform._rotation00*X+i._transform._rotation10*c+i._transform._rotation20*Y,x=i._transform._rotation01*X+i._transform._rotation11*c+i._transform._rotation21*Y,v=i._transform._rotation02*X+i._transform._rotation12*c+i._transform._rotation22*Y,X=p,c=x,Y=v,b.x=X,b.y=c,b.z=Y,this}};m.dynamics.constraint.joint.RotationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorTorque=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorTorque=i,this}clone(){let t=new m.dynamics.constraint.joint.RotationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorTorque=this.motorTorque,t}};m.dynamics.constraint.joint.SphericalJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,0),this._sd=t.springDamper.clone()}getInfo(t,i,s){if(this._sd.frequency>0&&s)return;let o,n,l;o=this._anchor2X-this._anchor1X,n=this._anchor2Y-this._anchor1Y,l=this._anchor2Z-this._anchor1Z;let _,r;if(this._sd.frequency>0){let y=6.28318530717958*this._sd.frequency,D=this._sd.dampingRatio;D<m.common.Setting.minSpringDamperDampingRatio&&(D=m.common.Setting.minSpringDamperDampingRatio);let F=i.dt,Q=2*D*y,W=y*y;this._sd.useSymplecticEuler?(_=1/(F*Q),r=W/Q):(_=1/(F*(F*W+Q)),r=W/(F*W+Q)),_*=this._b1._invMass+this._b2._invMass}else _=0,r=this.getErp(i,s);let e,a,h;e=o*r,a=n*r,h=l*r;let b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L;b=0,X=-this._relativeAnchor1Z,c=this._relativeAnchor1Y,Y=this._relativeAnchor1Z,p=0,x=-this._relativeAnchor1X,v=-this._relativeAnchor1Y,f=this._relativeAnchor1X,Z=0,k=0,g=-this._relativeAnchor2Z,I=this._relativeAnchor2Y,z=this._relativeAnchor2Z,d=0,u=-this._relativeAnchor2X,B=-this._relativeAnchor2Y,j=this._relativeAnchor2X,L=0,b=-b,X=-X,c=-c,Y=-Y,p=-p,x=-x,v=-v,f=-f,Z=-Z,k=-k,g=-g,I=-I,z=-z,d=-d,u=-u,B=-B,j=-j,L=-L;let V=this._impulses[0],M=t.rows[t.numRows++],w=M.jacobian;w.lin1X=0,w.lin1Y=0,w.lin1Z=0,w.lin2X=0,w.lin2Y=0,w.lin2Z=0,w.ang1X=0,w.ang1Y=0,w.ang1Z=0,w.ang2X=0,w.ang2Y=0,w.ang2Z=0,M.rhs=0,M.cfm=0,M.minImpulse=0,M.maxImpulse=0,M.motorSpeed=0,M.motorMaxImpulse=0,M.impulse=null,M.impulse=V,M.rhs=e,M.cfm=_,M.minImpulse=-1/0,M.maxImpulse=1/0;let P=M.jacobian;P.lin1X=1,P.lin1Y=0,P.lin1Z=0,P.lin2X=1,P.lin2Y=0,P.lin2Z=0,P.ang1X=b,P.ang1Y=X,P.ang1Z=c,P.ang2X=k,P.ang2Y=g,P.ang2Z=I;let E=this._impulses[1],C=t.rows[t.numRows++],S=C.jacobian;S.lin1X=0,S.lin1Y=0,S.lin1Z=0,S.lin2X=0,S.lin2Y=0,S.lin2Z=0,S.ang1X=0,S.ang1Y=0,S.ang1Z=0,S.ang2X=0,S.ang2Y=0,S.ang2Z=0,C.rhs=0,C.cfm=0,C.minImpulse=0,C.maxImpulse=0,C.motorSpeed=0,C.motorMaxImpulse=0,C.impulse=null,C.impulse=E,C.rhs=a,C.cfm=_,C.minImpulse=-1/0,C.maxImpulse=1/0,P=C.jacobian,P.lin1X=0,P.lin1Y=1,P.lin1Z=0,P.lin2X=0,P.lin2Y=1,P.lin2Z=0,P.ang1X=Y,P.ang1Y=p,P.ang1Z=x,P.ang2X=z,P.ang2Y=d,P.ang2Z=u;let A=this._impulses[2],R=t.rows[t.numRows++],H=R.jacobian;H.lin1X=0,H.lin1Y=0,H.lin1Z=0,H.lin2X=0,H.lin2Y=0,H.lin2Z=0,H.ang1X=0,H.ang1Y=0,H.ang1Z=0,H.ang2X=0,H.ang2Y=0,H.ang2Z=0,R.rhs=0,R.cfm=0,R.minImpulse=0,R.maxImpulse=0,R.motorSpeed=0,R.motorMaxImpulse=0,R.impulse=null,R.impulse=A,R.rhs=h,R.cfm=_,R.minImpulse=-1/0,R.maxImpulse=1/0,P=R.jacobian,P.lin1X=0,P.lin1Y=0,P.lin1Z=1,P.lin2X=0,P.lin2Y=0,P.lin2Z=1,P.ang1X=v,P.ang1Y=f,P.ang1Z=Z,P.ang2X=B,P.ang2Y=j,P.ang2Z=L}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getSpringDamper(){return this._sd}};m.dynamics.constraint.joint.SphericalJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.springDamper=new m.dynamics.constraint.joint.SpringDamper}init(t,i,s){return this._init(t,i,s),this}};m.dynamics.constraint.joint.SpringDamper=class{constructor(){this.frequency=0,this.dampingRatio=0,this.useSymplecticEuler=!1}setSpring(t,i){return this.frequency=t,this.dampingRatio=i,this}setSymplecticEuler(t){return this.useSymplecticEuler=t,this}clone(){let t=new m.dynamics.constraint.joint.SpringDamper;return t.frequency=this.frequency,t.dampingRatio=this.dampingRatio,t.useSymplecticEuler=this.useSymplecticEuler,t}};m.dynamics.constraint.joint.TranslationalLimitMotor=class{constructor(){this.lowerLimit=1,this.upperLimit=0,this.motorForce=0}setLimits(t,i){return this.lowerLimit=t,this.upperLimit=i,this}setMotor(t,i){return this.motorSpeed=t,this.motorForce=i,this}clone(){let t=new m.dynamics.constraint.joint.TranslationalLimitMotor;return t.lowerLimit=this.lowerLimit,t.upperLimit=this.upperLimit,t.motorSpeed=this.motorSpeed,t.motorForce=this.motorForce,t}};m.dynamics.constraint.joint.UniversalJoint=class extends m.dynamics.constraint.joint.Joint{constructor(t){super(t,m.dynamics.constraint.joint.JointType.UNIVERSAL);let i=t.localAxis1;this._localBasisX1X=i.x,this._localBasisX1Y=i.y,this._localBasisX1Z=i.z;let s=t.localAxis2;this._localBasisZ2X=s.x,this._localBasisZ2Y=s.y,this._localBasisZ2Z=s.z,this.buildLocalBasesFromX1Z2(),this._angleX=0,this._angleY=0,this._angleZ=0,this.xSingular=!1,this.ySingular=!1,this.zSingular=!1,this._sd1=t.springDamper1.clone(),this._sd2=t.springDamper2.clone(),this._lm1=t.limitMotor1.clone(),this._lm2=t.limitMotor2.clone()}getInfo(t,i,s){let o=this.getErp(i,s),n,l,_;n=this.linearErrorX*o,l=this.linearErrorY*o,_=this.linearErrorZ*o;let r=this._angleY*o,e,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u;e=0,a=-this._relativeAnchor1Z,h=this._relativeAnchor1Y,b=this._relativeAnchor1Z,X=0,c=-this._relativeAnchor1X,Y=-this._relativeAnchor1Y,p=this._relativeAnchor1X,x=0,v=0,f=-this._relativeAnchor2Z,Z=this._relativeAnchor2Y,k=this._relativeAnchor2Z,g=0,I=-this._relativeAnchor2X,z=-this._relativeAnchor2Y,d=this._relativeAnchor2X,u=0,e=-e,a=-a,h=-h,b=-b,X=-X,c=-c,Y=-Y,p=-p,x=-x,v=-v,f=-f,Z=-Z,k=-k,g=-g,I=-I,z=-z,d=-d,u=-u;let B=this.computeEffectiveInertiaMoment(this._axisXX,this._axisXY,this._axisXZ),j=this.computeEffectiveInertiaMoment(this._axisZX,this._axisZY,this._axisZZ),L=this._impulses[0],V=t.rows[t.numRows++],M=V.jacobian;M.lin1X=0,M.lin1Y=0,M.lin1Z=0,M.lin2X=0,M.lin2Y=0,M.lin2Z=0,M.ang1X=0,M.ang1Y=0,M.ang1Z=0,M.ang2X=0,M.ang2Y=0,M.ang2Z=0,V.rhs=0,V.cfm=0,V.minImpulse=0,V.maxImpulse=0,V.motorSpeed=0,V.motorMaxImpulse=0,V.impulse=null,V.impulse=L,V.rhs=n,V.cfm=0,V.minImpulse=-1/0,V.maxImpulse=1/0;let w=V.jacobian;w.lin1X=1,w.lin1Y=0,w.lin1Z=0,w.lin2X=1,w.lin2Y=0,w.lin2Z=0,w.ang1X=e,w.ang1Y=a,w.ang1Z=h,w.ang2X=v,w.ang2Y=f,w.ang2Z=Z;let P=this._impulses[1],E=t.rows[t.numRows++],C=E.jacobian;C.lin1X=0,C.lin1Y=0,C.lin1Z=0,C.lin2X=0,C.lin2Y=0,C.lin2Z=0,C.ang1X=0,C.ang1Y=0,C.ang1Z=0,C.ang2X=0,C.ang2Y=0,C.ang2Z=0,E.rhs=0,E.cfm=0,E.minImpulse=0,E.maxImpulse=0,E.motorSpeed=0,E.motorMaxImpulse=0,E.impulse=null,E.impulse=P,E.rhs=l,E.cfm=0,E.minImpulse=-1/0,E.maxImpulse=1/0,w=E.jacobian,w.lin1X=0,w.lin1Y=1,w.lin1Z=0,w.lin2X=0,w.lin2Y=1,w.lin2Z=0,w.ang1X=b,w.ang1Y=X,w.ang1Z=c,w.ang2X=k,w.ang2Y=g,w.ang2Z=I;let S=this._impulses[2],A=t.rows[t.numRows++],R=A.jacobian;if(R.lin1X=0,R.lin1Y=0,R.lin1Z=0,R.lin2X=0,R.lin2Y=0,R.lin2Z=0,R.ang1X=0,R.ang1Y=0,R.ang1Z=0,R.ang2X=0,R.ang2Y=0,R.ang2Z=0,A.rhs=0,A.cfm=0,A.minImpulse=0,A.maxImpulse=0,A.motorSpeed=0,A.motorMaxImpulse=0,A.impulse=null,A.impulse=S,A.rhs=_,A.cfm=0,A.minImpulse=-1/0,A.maxImpulse=1/0,w=A.jacobian,w.lin1X=0,w.lin1Y=0,w.lin1Z=1,w.lin2X=0,w.lin2Y=0,w.lin2Z=1,w.ang1X=Y,w.ang1Y=p,w.ang1Z=x,w.ang2X=z,w.ang2Y=d,w.ang2Z=u,!this.xSingular&&(this._sd1.frequency<=0||!s)){let H=this._impulses[3],y=t.rows[t.numRows++],D=y.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=H,this.setSolverInfoRowAngular(y,this._angleX,this._lm1,B,this._sd1,i,s),w=y.jacobian,w.ang1X=this._axisXX,w.ang1Y=this._axisXY,w.ang1Z=this._axisXZ,w.ang2X=this._axisXX,w.ang2Y=this._axisXY,w.ang2Z=this._axisXZ}if(!this.ySingular){let H=this._impulses[4],y=t.rows[t.numRows++],D=y.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=H,y.rhs=r,y.cfm=0,y.minImpulse=-1/0,y.maxImpulse=1/0,w=y.jacobian,w.ang1X=this._axisYX,w.ang1Y=this._axisYY,w.ang1Z=this._axisYZ,w.ang2X=this._axisYX,w.ang2Y=this._axisYY,w.ang2Z=this._axisYZ}if(!this.zSingular&&(this._sd2.frequency<=0||!s)){let H=this._impulses[5],y=t.rows[t.numRows++],D=y.jacobian;D.lin1X=0,D.lin1Y=0,D.lin1Z=0,D.lin2X=0,D.lin2Y=0,D.lin2Z=0,D.ang1X=0,D.ang1Y=0,D.ang1Z=0,D.ang2X=0,D.ang2Y=0,D.ang2Z=0,y.rhs=0,y.cfm=0,y.minImpulse=0,y.maxImpulse=0,y.motorSpeed=0,y.motorMaxImpulse=0,y.impulse=null,y.impulse=H,this.setSolverInfoRowAngular(y,this._angleZ,this._lm2,j,this._sd2,i,s),w=y.jacobian,w.ang1X=this._axisZX,w.ang1Y=this._axisZY,w.ang1Z=this._axisZZ,w.ang2X=this._axisZX,w.ang2Y=this._axisZY,w.ang2Z=this._axisZZ}}_syncAnchors(){super._syncAnchors();let t,i,s,o,n,l,_,r,e;t=this._basisX1X,i=this._basisX1Y,s=this._basisX1Z,_=this._basisZ2X,r=this._basisZ2Y,e=this._basisZ2Z,o=r*s-e*i,n=e*t-_*s,l=_*i-r*t,this._axisXX=n*e-l*r,this._axisXY=l*_-o*e,this._axisXZ=o*r-n*_,this._axisYX=o,this._axisYY=n,this._axisYZ=l,this._axisZX=i*l-s*n,this._axisZY=s*o-t*l,this._axisZZ=t*n-i*o;let a=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ;a>0&&(a=1/Math.sqrt(a)),this._axisXX*=a,this._axisXY*=a,this._axisXZ*=a;let h=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ;h>0&&(h=1/Math.sqrt(h)),this._axisYX*=h,this._axisYY*=h,this._axisYZ*=h;let b=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ;b>0&&(b=1/Math.sqrt(b)),this._axisZX*=b,this._axisZY*=b,this._axisZZ*=b,this.xSingular=this._axisXX*this._axisXX+this._axisXY*this._axisXY+this._axisXZ*this._axisXZ==0,this.ySingular=this._axisYX*this._axisYX+this._axisYY*this._axisYY+this._axisYZ*this._axisYZ==0,this.zSingular=this._axisZX*this._axisZX+this._axisZY*this._axisZY+this._axisZZ*this._axisZZ==0;let X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B,j,L,V;X=this._basisX1X,c=this._basisY1X,Y=this._basisZ1X,p=this._basisX1Y,x=this._basisY1Y,v=this._basisZ1Y,f=this._basisX1Z,Z=this._basisY1Z,k=this._basisZ1Z,g=this._basisX2X,I=this._basisY2X,z=this._basisZ2X,d=this._basisX2Y,u=this._basisY2Y,B=this._basisZ2Y,j=this._basisX2Z,L=this._basisY2Z,V=this._basisZ2Z;let M,w,P,E,C,S,A,R,H,y,D,F,Q,W;R=X*g+p*d+f*j,H=X*I+p*u+f*L,y=X*z+p*B+f*V,D=c*I+x*u+Z*L,F=c*z+x*B+Z*V,Q=Y*I+v*u+k*L,W=Y*z+v*B+k*V,M=R,w=H,P=y,E=D,C=F,S=Q,A=W;let q,U,G,J=P;if(J<=-1){let N=Math.atan2(S,E);q=N*.5,U=-1.570796326794895,G=-N*.5}else if(J>=1){let N=Math.atan2(S,E);q=N*.5,U=1.570796326794895,G=N*.5}else q=Math.atan2(-C,A),U=Math.asin(J),G=Math.atan2(-w,M);this._angleX=q,this._angleY=U,this._angleZ=G,this.linearErrorX=this._anchor2X-this._anchor1X,this.linearErrorY=this._anchor2Y-this._anchor1Y,this.linearErrorZ=this._anchor2Z-this._anchor1Z}_getVelocitySolverInfo(t,i){super._getVelocitySolverInfo(t,i),this.getInfo(i,t,!1)}_getPositionSolverInfo(t){super._getPositionSolverInfo(t),this.getInfo(t,null,!0)}getAxis1(){let t=new m.common.Vec3;return t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z,t}getAxis2(){let t=new m.common.Vec3;return t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z,t}getAxis1To(t){t.x=this._basisX1X,t.y=this._basisX1Y,t.z=this._basisX1Z}getAxis2To(t){t.x=this._basisZ2X,t.y=this._basisZ2Y,t.z=this._basisZ2Z}getLocalAxis1(){let t=new m.common.Vec3;return t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z,t}getLocalAxis2(){let t=new m.common.Vec3;return t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z,t}getLocalAxis1To(t){t.x=this._localBasisX1X,t.y=this._localBasisX1Y,t.z=this._localBasisX1Z}getLocalAxis2To(t){t.x=this._localBasisZ2X,t.y=this._localBasisZ2Y,t.z=this._localBasisZ2Z}getSpringDamper1(){return this._sd1}getSpringDamper2(){return this._sd2}getLimitMotor1(){return this._lm1}getLimitMotor2(){return this._lm2}getAngle1(){return this._angleX}getAngle2(){return this._angleZ}};m.dynamics.constraint.joint.UniversalJointConfig=class extends m.dynamics.constraint.joint.JointConfig{constructor(){super(),this.localAxis1=new m.common.Vec3(1,0,0),this.localAxis2=new m.common.Vec3(1,0,0),this.springDamper1=new m.dynamics.constraint.joint.SpringDamper,this.springDamper2=new m.dynamics.constraint.joint.SpringDamper,this.limitMotor1=new m.dynamics.constraint.joint.RotationalLimitMotor,this.limitMotor2=new m.dynamics.constraint.joint.RotationalLimitMotor}init(t,i,s,o,n){this._init(t,i,s);let l=this.localAxis1,_,r,e;_=o.x,r=o.y,e=o.z;let a,h,b;a=t._transform._rotation00*_+t._transform._rotation10*r+t._transform._rotation20*e,h=t._transform._rotation01*_+t._transform._rotation11*r+t._transform._rotation21*e,b=t._transform._rotation02*_+t._transform._rotation12*r+t._transform._rotation22*e,_=a,r=h,e=b,l.x=_,l.y=r,l.z=e;let X=this.localAxis2,c,Y,p;c=n.x,Y=n.y,p=n.z;let x,v,f;return x=i._transform._rotation00*c+i._transform._rotation10*Y+i._transform._rotation20*p,v=i._transform._rotation01*c+i._transform._rotation11*Y+i._transform._rotation21*p,f=i._transform._rotation02*c+i._transform._rotation12*Y+i._transform._rotation22*p,c=x,Y=v,p=f,X.x=c,X.y=Y,X.z=p,this}};m.dynamics.constraint.solver||(m.dynamics.constraint.solver={});m.dynamics.constraint.solver.ConstraintSolverType=class{};m.dynamics.constraint.solver.common||(m.dynamics.constraint.solver.common={});m.dynamics.constraint.solver.common.ContactSolverMassDataRow=class{constructor(){this.invMLinN1X=0,this.invMLinN1Y=0,this.invMLinN1Z=0,this.invMLinN2X=0,this.invMLinN2Y=0,this.invMLinN2Z=0,this.invMAngN1X=0,this.invMAngN1Y=0,this.invMAngN1Z=0,this.invMAngN2X=0,this.invMAngN2Y=0,this.invMAngN2Z=0,this.invMLinT1X=0,this.invMLinT1Y=0,this.invMLinT1Z=0,this.invMLinT2X=0,this.invMLinT2Y=0,this.invMLinT2Z=0,this.invMAngT1X=0,this.invMAngT1Y=0,this.invMAngT1Z=0,this.invMAngT2X=0,this.invMAngT2Y=0,this.invMAngT2Z=0,this.invMLinB1X=0,this.invMLinB1Y=0,this.invMLinB1Z=0,this.invMLinB2X=0,this.invMLinB2Y=0,this.invMLinB2Z=0,this.invMAngB1X=0,this.invMAngB1Y=0,this.invMAngB1Z=0,this.invMAngB2X=0,this.invMAngB2Y=0,this.invMAngB2Z=0,this.massN=0,this.massTB00=0,this.massTB01=0,this.massTB10=0,this.massTB11=0}};m.dynamics.constraint.solver.common.JointSolverMassDataRow=class{constructor(){this.invMLin1X=0,this.invMLin1Y=0,this.invMLin1Z=0,this.invMLin2X=0,this.invMLin2Y=0,this.invMLin2Z=0,this.invMAng1X=0,this.invMAng1Y=0,this.invMAng1Z=0,this.invMAng2X=0,this.invMAng2Y=0,this.invMAng2Z=0,this.mass=0,this.massWithoutCfm=0}};m.dynamics.constraint.solver.direct||(m.dynamics.constraint.solver.direct={});m.dynamics.constraint.solver.direct.Boundary=class{constructor(t){this.iBounded=new Array(t),this.iUnbounded=new Array(t),this.signs=new Array(t),this.b=new Array(t),this.numBounded=0,this.numUnbounded=0,this.matrixId=0}init(t){this.numBounded=t.numBounded;let i=0,s=this.numBounded;for(;i<s;){let l=i++;this.iBounded[l]=t.iBounded[l],this.signs[l]=t.signs[l]}this.numUnbounded=t.numUnbounded,this.matrixId=0;let o=0,n=this.numUnbounded;for(;o<n;){let l=o++,_=t.iUnbounded[l];this.iUnbounded[l]=_,this.matrixId|=1<<_}}computeImpulses(t,i,s,o,n,l,_){let r=0,e=this.numUnbounded;for(;r<e;){let I=this.iUnbounded[r++],z=t.rows[I];this.b[I]=z.rhs*l-s[I]-z.cfm*o[I]}let a=i._invMassWithoutCfm,h=0,b=this.numBounded;for(;h<b;){let I=h++,z=this.iBounded[I],d=this.signs[I],u=t.rows[z],B=(d<0?u.minImpulse:d>0?u.maxImpulse:0)-o[z];if(n[z]=B,B!=0){let j=0,L=this.numUnbounded;for(;j<L;){let V=this.iUnbounded[j++];this.b[V]-=a[z][V]*B}}}let X=this.iUnbounded,c=this.numUnbounded,Y=0,p=0;for(;p<c;)Y|=1<<X[p++];let x;i._cacheComputed[Y]||(i.computeSubmatrix(Y,X,c),i._cacheComputed[Y]=!0),x=i._cachedSubmatrices[Y];let v=!0,f=0,Z=this.numUnbounded;for(;f<Z;){let I=f++,z=this.iUnbounded[I],d=t.rows[z],u=o[z],B=u,j=0,L=this.numUnbounded;for(;j<L;){let V=j++;B+=this.b[this.iUnbounded[V]]*x[I][V]}if(B<d.minImpulse-m.common.Setting.directMlcpSolverEps||B>d.maxImpulse+m.common.Setting.directMlcpSolverEps){v=!1;break}n[z]=B-u}if(_)return!0;if(!v)return!1;let k=0,g=this.numBounded;for(;k<g;){let I=k++,z=this.iBounded[I],d=t.rows[z],u=this.signs[I],B=0,j=o[z]+n[z],L=s[z],V=0,M=t.numRows;for(;V<M;){let w=V++;L+=a[z][w]*n[w]}if(B=d.rhs*l-L-d.cfm*j,u<0&&B>m.common.Setting.directMlcpSolverEps||u>0&&B<-m.common.Setting.directMlcpSolverEps){v=!1;break}}return v}};m.dynamics.constraint.solver.direct.BoundaryBuildInfo=class{constructor(t){this.size=t,this.numBounded=0,this.iBounded=new Array(t),this.signs=new Array(t),this.numUnbounded=0,this.iUnbounded=new Array(t)}};m.dynamics.constraint.solver.direct.BoundaryBuilder=class{constructor(t){this.maxRows=t,this.numBoundaries=0,this.boundaries=new Array(1<<t),this.bbInfo=new m.dynamics.constraint.solver.direct.BoundaryBuildInfo(t)}buildBoundariesRecursive(t,i){if(i==t.numRows){this.boundaries[this.numBoundaries]==null&&(this.boundaries[this.numBoundaries]=new m.dynamics.constraint.solver.direct.Boundary(this.maxRows)),this.boundaries[this.numBoundaries++].init(this.bbInfo);return}let s=t.rows[i],o=s.minImpulse>-1/0,n=s.maxImpulse<1/0;if(s.minImpulse==0&&s.maxImpulse==0){let _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=0,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--;return}let l=this.bbInfo;if(l.iUnbounded[l.numUnbounded]=i,l.numUnbounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numUnbounded--,o){let _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=-1,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}if(n){let _=this.bbInfo;_.iBounded[_.numBounded]=i,_.signs[_.numBounded]=1,_.numBounded++,this.buildBoundariesRecursive(t,i+1),this.bbInfo.numBounded--}}buildBoundaries(t){this.numBoundaries=0;let i=this.bbInfo;i.numBounded=0,i.numUnbounded=0,this.buildBoundariesRecursive(t,0)}};m.dynamics.constraint.solver.direct.BoundarySelector=class{constructor(t){this.n=t,this.indices=new Array(t),this.tmpIndices=new Array(t);let i=0;for(;i<t;){let s=i++;this.indices[s]=s}}getIndex(t){return this.indices[t]}select(t){let i=0;for(;this.indices[i]!=t;)++i;for(;i>0;){let s=this.indices[i];this.indices[i]=this.indices[i-1],this.indices[i-1]=s,--i}}setSize(t){let i=0,s=0,o=0,n=this.n;for(;o<n;){let _=this.indices[o++];_<t?(this.tmpIndices[i]=_,++i):(this.tmpIndices[t+s]=_,++s)}let l=this.indices;this.indices=this.tmpIndices,this.tmpIndices=l}};m.dynamics.constraint.solver.direct.DirectJointConstraintSolver=class extends m.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new m.dynamics.constraint.info.joint.JointSolverInfo;let i=m.common.Setting.maxJacobianRows;this.massMatrix=new m.dynamics.constraint.solver.direct.MassMatrix(i),this.boundaryBuilder=new m.dynamics.constraint.solver.direct.BoundaryBuilder(i),this.massData=new Array(i);let s=0,o=this.massData.length;for(;s<o;)this.massData[s++]=new m.dynamics.constraint.solver.common.JointSolverMassDataRow;let n=this.boundaryBuilder.boundaries.length;this.velBoundarySelector=new m.dynamics.constraint.solver.direct.BoundarySelector(n),this.posBoundarySelector=new m.dynamics.constraint.solver.direct.BoundarySelector(n),this.relVels=new Array(i),this.impulses=new Array(i),this.dImpulses=new Array(i),this.dTotalImpulses=new Array(i);let l=0;for(;l<i;){let _=l++;this.relVels[_]=0,this.impulses[_]=0,this.dImpulses[_]=0,this.dTotalImpulses[_]=0}}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let o=this.velBoundarySelector,n=this.boundaryBuilder.numBoundaries,l=0,_=0,r=0,e=o.n;for(;r<e;){let h=o.indices[r++];h<n?(o.tmpIndices[l]=h,++l):(o.tmpIndices[n+_]=h,++_)}let a=o.indices;o.indices=o.tmpIndices,o.tmpIndices=a}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?m.common.Setting.jointWarmStartingFactorForBaungarte:m.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let g=0,I=this.info.numRows;for(;g<I;){let z=this.info.rows[g++].impulse;z.impulse=0,z.impulseM=0,z.impulseP=0}return}let s=0,o=this.info.numRows;for(;s<o;){let g=s++,I=this.info.rows[g],z=I.impulse,d=z.impulse*i;if(d<I.minImpulse?d=I.minImpulse:d>I.maxImpulse&&(d=I.maxImpulse),z.impulse=d,I.motorMaxImpulse>0){let u=z.impulseM*i,B=I.motorMaxImpulse;u<-B?u=-B:u>B&&(u=B),z.impulseM=u}else z.impulseM=0;this.dImpulses[g]=z.impulse+z.impulseM}let n=this.dImpulses,l=!1,_=!1,r,e,a,h,b,X,c,Y,p,x,v,f;r=this._b1._velX,e=this._b1._velY,a=this._b1._velZ,h=this._b2._velX,b=this._b2._velY,X=this._b2._velZ,c=this._b1._angVelX,Y=this._b1._angVelY,p=this._b1._angVelZ,x=this._b2._angVelX,v=this._b2._angVelY,f=this._b2._angVelZ;let Z=0,k=this.info.numRows;for(;Z<k;){let g=Z++,I=this.info.rows[g].jacobian,z=this.massData[g],d=n[g];I.flag&1&&(r+=z.invMLin1X*d,e+=z.invMLin1Y*d,a+=z.invMLin1Z*d,h+=z.invMLin2X*-d,b+=z.invMLin2Y*-d,X+=z.invMLin2Z*-d,l=!0),I.flag&2&&(c+=z.invMAng1X*d,Y+=z.invMAng1Y*d,p+=z.invMAng1Z*d,x+=z.invMAng2X*-d,v+=z.invMAng2Y*-d,f+=z.invMAng2Z*-d,_=!0)}l&&(this._b1._velX=r,this._b1._velY=e,this._b1._velZ=a,this._b2._velX=h,this._b2._velY=b,this._b2._velZ=X),_&&(this._b1._angVelX=c,this._b1._angVelY=Y,this._b1._angVelZ=p,this._b2._angVelX=x,this._b2._angVelY=v,this._b2._angVelZ=f)}solveVelocity(){let t=this.info.numRows,i,s,o,n,l,_,r,e,a,h,b,X;i=this._b1._velX,s=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,l=this._b2._velY,_=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,a=this._b1._angVelZ,h=this._b2._angVelX,b=this._b2._angVelY,X=this._b2._angVelZ;let c=0;for(;c<t;){let Z=c++,k=this.info.rows[Z],g=k.jacobian,I=0;I+=i*g.lin1X+s*g.lin1Y+o*g.lin1Z,I-=n*g.lin2X+l*g.lin2Y+_*g.lin2Z,I+=r*g.ang1X+e*g.ang1Y+a*g.ang1Z,I-=h*g.ang2X+b*g.ang2Y+X*g.ang2Z,this.relVels[Z]=I,this.impulses[Z]=k.impulse.impulse,this.dTotalImpulses[Z]=0}let Y=this.massMatrix._invMassWithoutCfm,p=0;for(;p<t;){let Z=p++,k=this.info.rows[Z],g=k.impulse;if(k.motorMaxImpulse>0){let I=g.impulseM,z=I+this.massData[Z].massWithoutCfm*(-k.motorSpeed-this.relVels[Z]),d=k.motorMaxImpulse;z<-d?z=-d:z>d&&(z=d),g.impulseM=z;let u=z-I;this.dTotalImpulses[Z]=u;let B=0;for(;B<t;){let j=B++;this.relVels[j]+=u*Y[Z][j]}}}let x=!1,v=0,f=this.boundaryBuilder.numBoundaries;for(;v<f;){let Z=this.velBoundarySelector.indices[v++];if(this.boundaryBuilder.boundaries[Z].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,1,!1)){let k=0;for(;k<t;){let D=k++,F=this.dImpulses[D];this.info.rows[D].impulse.impulse+=F,this.dTotalImpulses[D]+=F}let g=this.dTotalImpulses,I=!1,z=!1,d,u,B,j,L,V,M,w,P,E,C,S;d=this._b1._velX,u=this._b1._velY,B=this._b1._velZ,j=this._b2._velX,L=this._b2._velY,V=this._b2._velZ,M=this._b1._angVelX,w=this._b1._angVelY,P=this._b1._angVelZ,E=this._b2._angVelX,C=this._b2._angVelY,S=this._b2._angVelZ;let A=0,R=this.info.numRows;for(;A<R;){let D=A++,F=this.info.rows[D].jacobian,Q=this.massData[D],W=g[D];F.flag&1&&(d+=Q.invMLin1X*W,u+=Q.invMLin1Y*W,B+=Q.invMLin1Z*W,j+=Q.invMLin2X*-W,L+=Q.invMLin2Y*-W,V+=Q.invMLin2Z*-W,I=!0),F.flag&2&&(M+=Q.invMAng1X*W,w+=Q.invMAng1Y*W,P+=Q.invMAng1Z*W,E+=Q.invMAng2X*-W,C+=Q.invMAng2Y*-W,S+=Q.invMAng2Z*-W,z=!0)}I&&(this._b1._velX=d,this._b1._velY=u,this._b1._velZ=B,this._b2._velX=j,this._b2._velY=L,this._b2._velZ=V),z&&(this._b1._angVelX=M,this._b1._angVelY=w,this._b1._angVelZ=P,this._b2._angVelX=E,this._b2._angVelY=C,this._b2._angVelZ=S);let H=this.velBoundarySelector,y=0;for(;H.indices[y]!=Z;)++y;for(;y>0;){let D=H.indices[y];H.indices[y]=H.indices[y-1],H.indices[y-1]=D,--y}x=!0;break}}if(!x){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:335:","could not find solution. (velocity)");return}}postSolveVelocity(t){let i,s,o,n,l,_;i=0,s=0,o=0,n=0,l=0,_=0;let r=0,e=this.info.numRows;for(;r<e;){let a=this.info.rows[r++],h=a.impulse,b=a.jacobian;b.flag&1?(i+=b.lin1X*h.impulse,s+=b.lin1Y*h.impulse,o+=b.lin1Z*h.impulse):b.flag&2&&(n+=b.ang1X*h.impulse,l+=b.ang1Y*h.impulse,_+=b.ang1Z*h.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=o*t.invDt,this.joint._appliedTorqueX=n*t.invDt,this.joint._appliedTorqueY=l*t.invDt,this.joint._appliedTorqueZ=_*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,l=0,_=0,r=0,e=o.n;for(;r<e;){let X=o.indices[r++];X<n?(o.tmpIndices[l]=X,++l):(o.tmpIndices[n+_]=X,++_)}let a=o.indices;o.indices=o.tmpIndices,o.tmpIndices=a;let h=0,b=this.info.numRows;for(;h<b;)this.info.rows[h++].impulse.impulseP=0}solvePositionSplitImpulse(){let t=this.info.numRows,i,s,o,n,l,_,r,e,a,h,b,X;i=this._b1._pseudoVelX,s=this._b1._pseudoVelY,o=this._b1._pseudoVelZ,n=this._b2._pseudoVelX,l=this._b2._pseudoVelY,_=this._b2._pseudoVelZ,r=this._b1._angPseudoVelX,e=this._b1._angPseudoVelY,a=this._b1._angPseudoVelZ,h=this._b2._angPseudoVelX,b=this._b2._angPseudoVelY,X=this._b2._angPseudoVelZ;let c=0;for(;c<t;){let v=c++,f=this.info.rows[v],Z=f.jacobian,k=0;k+=i*Z.lin1X+s*Z.lin1Y+o*Z.lin1Z,k-=n*Z.lin2X+l*Z.lin2Y+_*Z.lin2Z,k+=r*Z.ang1X+e*Z.ang1Y+a*Z.ang1Z,k-=h*Z.ang2X+b*Z.ang2Y+X*Z.ang2Z,this.relVels[v]=k,this.impulses[v]=f.impulse.impulseP}let Y=!1,p=0,x=this.boundaryBuilder.numBoundaries;for(;p<x;){let v=this.posBoundarySelector.indices[p++];if(this.boundaryBuilder.boundaries[v].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,m.common.Setting.positionSplitImpulseBaumgarte,!1)){let f=0;for(;f<t;){let H=f++;this.info.rows[H].impulse.impulseP+=this.dImpulses[H]}let Z=this.dImpulses,k=!1,g=!1,I,z,d,u,B,j,L,V,M,w,P,E;I=this._b1._pseudoVelX,z=this._b1._pseudoVelY,d=this._b1._pseudoVelZ,u=this._b2._pseudoVelX,B=this._b2._pseudoVelY,j=this._b2._pseudoVelZ,L=this._b1._angPseudoVelX,V=this._b1._angPseudoVelY,M=this._b1._angPseudoVelZ,w=this._b2._angPseudoVelX,P=this._b2._angPseudoVelY,E=this._b2._angPseudoVelZ;let C=0,S=this.info.numRows;for(;C<S;){let H=C++,y=this.info.rows[H].jacobian,D=this.massData[H],F=Z[H];y.flag&1&&(I+=D.invMLin1X*F,z+=D.invMLin1Y*F,d+=D.invMLin1Z*F,u+=D.invMLin2X*-F,B+=D.invMLin2Y*-F,j+=D.invMLin2Z*-F,k=!0),y.flag&2&&(L+=D.invMAng1X*F,V+=D.invMAng1Y*F,M+=D.invMAng1Z*F,w+=D.invMAng2X*-F,P+=D.invMAng2Y*-F,E+=D.invMAng2Z*-F,g=!0)}k&&(this._b1._pseudoVelX=I,this._b1._pseudoVelY=z,this._b1._pseudoVelZ=d,this._b2._pseudoVelX=u,this._b2._pseudoVelY=B,this._b2._pseudoVelZ=j),g&&(this._b1._angPseudoVelX=L,this._b1._angPseudoVelY=V,this._b1._angPseudoVelZ=M,this._b2._angPseudoVelX=w,this._b2._angPseudoVelY=P,this._b2._angPseudoVelZ=E);let A=this.posBoundarySelector,R=0;for(;A.indices[R]!=v;)++R;for(;R>0;){let H=A.indices[R];A.indices[R]=A.indices[R-1],A.indices[R-1]=H,--R}Y=!0;break}}if(!Y){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:450:","could not find solution. (split impulse)");return}}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2,this.massMatrix.computeInvMass(this.info,this.massData);let i=this.boundaryBuilder;i.numBoundaries=0;let s=i.bbInfo;s.numBounded=0,s.numUnbounded=0,i.buildBoundariesRecursive(this.info,0);let o=this.posBoundarySelector,n=this.boundaryBuilder.numBoundaries,l=0,_=0,r=0,e=o.n;for(;r<e;){let p=o.indices[r++];p<n?(o.tmpIndices[l]=p,++l):(o.tmpIndices[n+_]=p,++_)}let a=o.indices;o.indices=o.tmpIndices,o.tmpIndices=a;let h=this.info.numRows,b=0;for(;b<h;){let p=b++,x=this.info.rows[p].impulse;this.relVels[p]=0,this.impulses[p]=x.impulseP}let X=!1,c=0,Y=this.boundaryBuilder.numBoundaries;for(;c<Y;){let p=this.posBoundarySelector.indices[c++];if(this.boundaryBuilder.boundaries[p].computeImpulses(this.info,this.massMatrix,this.relVels,this.impulses,this.dImpulses,m.common.Setting.positionNgsBaumgarte,!1)){let x=0;for(;x<h;){let A=x++;this.info.rows[A].impulse.impulseP+=this.dImpulses[A]}let v=this.dImpulses,f=!1,Z=!1,k,g,I,z,d,u,B,j,L,V,M,w;k=0,g=0,I=0,z=0,d=0,u=0,B=0,j=0,L=0,V=0,M=0,w=0;let P=0,E=this.info.numRows;for(;P<E;){let A=P++,R=this.info.rows[A].jacobian,H=this.massData[A],y=v[A];R.flag&1&&(k+=H.invMLin1X*y,g+=H.invMLin1Y*y,I+=H.invMLin1Z*y,z+=H.invMLin2X*-y,d+=H.invMLin2Y*-y,u+=H.invMLin2Z*-y,f=!0),R.flag&2&&(B+=H.invMAng1X*y,j+=H.invMAng1Y*y,L+=H.invMAng1Z*y,V+=H.invMAng2X*-y,M+=H.invMAng2Y*-y,w+=H.invMAng2Z*-y,Z=!0)}if(f){let A=this._b1;A._transform._positionX+=k,A._transform._positionY+=g,A._transform._positionZ+=I;let R=this._b2;R._transform._positionX+=z,R._transform._positionY+=d,R._transform._positionZ+=u}if(Z){let A=this._b1,R=Math.sqrt(B*B+j*j+L*L),H=R*.5,y,D;if(H<.5){let ti=H*H;y=.5*(1-ti*.16666666666666666+ti*ti*.008333333333333333),D=1-ti*.5+ti*ti*.041666666666666664}else y=Math.sin(H)/R,D=Math.cos(H);let F,Q,W;F=B*y,Q=j*y,W=L*y;let q,U,G,J;q=F,U=Q,G=W,J=D;let N,K,O,$,et=A._transform._rotation00,st=A._transform._rotation11,lt=A._transform._rotation22,rt=et+st+lt,at;rt>0?(at=Math.sqrt(rt+1),$=.5*at,at=.5/at,N=(A._transform._rotation21-A._transform._rotation12)*at,K=(A._transform._rotation02-A._transform._rotation20)*at,O=(A._transform._rotation10-A._transform._rotation01)*at):et>st?et>lt?(at=Math.sqrt(et-st-lt+1),N=.5*at,at=.5/at,K=(A._transform._rotation01+A._transform._rotation10)*at,O=(A._transform._rotation02+A._transform._rotation20)*at,$=(A._transform._rotation21-A._transform._rotation12)*at):(at=Math.sqrt(lt-et-st+1),O=.5*at,at=.5/at,N=(A._transform._rotation02+A._transform._rotation20)*at,K=(A._transform._rotation12+A._transform._rotation21)*at,$=(A._transform._rotation10-A._transform._rotation01)*at):st>lt?(at=Math.sqrt(st-lt-et+1),K=.5*at,at=.5/at,N=(A._transform._rotation01+A._transform._rotation10)*at,O=(A._transform._rotation12+A._transform._rotation21)*at,$=(A._transform._rotation02-A._transform._rotation20)*at):(at=Math.sqrt(lt-et-st+1),O=.5*at,at=.5/at,N=(A._transform._rotation02+A._transform._rotation20)*at,K=(A._transform._rotation12+A._transform._rotation21)*at,$=(A._transform._rotation10-A._transform._rotation01)*at),N=J*N+q*$+U*O-G*K,K=J*K-q*O+U*$+G*N,O=J*O+q*K-U*N+G*$,$=J*$-q*N-U*K-G*O;let ot=N*N+K*K+O*O+$*$;ot>1e-32&&(ot=1/Math.sqrt(ot)),N*=ot,K*=ot,O*=ot,$*=ot;let ht=N,_t=K,bt=O,Xt=$,ft=2*ht,Zt=2*_t,xt=2*bt,zt=ht*ft,Yt=_t*Zt,pt=bt*xt,ct=ht*Zt,nt=_t*xt,tt=ht*xt,Lt=Xt*ft,Bt=Xt*Zt,Mt=Xt*xt;A._transform._rotation00=1-Yt-pt,A._transform._rotation01=ct-Mt,A._transform._rotation02=tt+Bt,A._transform._rotation10=ct+Mt,A._transform._rotation11=1-zt-pt,A._transform._rotation12=nt-Lt,A._transform._rotation20=tt-Bt,A._transform._rotation21=nt+Lt,A._transform._rotation22=1-zt-Yt;let jt,ci,Xi,Yi,Li,wi,ei,qt,At;jt=A._transform._rotation00*A._invLocalInertia00+A._transform._rotation01*A._invLocalInertia10+A._transform._rotation02*A._invLocalInertia20,ci=A._transform._rotation00*A._invLocalInertia01+A._transform._rotation01*A._invLocalInertia11+A._transform._rotation02*A._invLocalInertia21,Xi=A._transform._rotation00*A._invLocalInertia02+A._transform._rotation01*A._invLocalInertia12+A._transform._rotation02*A._invLocalInertia22,Yi=A._transform._rotation10*A._invLocalInertia00+A._transform._rotation11*A._invLocalInertia10+A._transform._rotation12*A._invLocalInertia20,Li=A._transform._rotation10*A._invLocalInertia01+A._transform._rotation11*A._invLocalInertia11+A._transform._rotation12*A._invLocalInertia21,wi=A._transform._rotation10*A._invLocalInertia02+A._transform._rotation11*A._invLocalInertia12+A._transform._rotation12*A._invLocalInertia22,ei=A._transform._rotation20*A._invLocalInertia00+A._transform._rotation21*A._invLocalInertia10+A._transform._rotation22*A._invLocalInertia20,qt=A._transform._rotation20*A._invLocalInertia01+A._transform._rotation21*A._invLocalInertia11+A._transform._rotation22*A._invLocalInertia21,At=A._transform._rotation20*A._invLocalInertia02+A._transform._rotation21*A._invLocalInertia12+A._transform._rotation22*A._invLocalInertia22,A._invInertia00=jt,A._invInertia01=ci,A._invInertia02=Xi,A._invInertia10=Yi,A._invInertia11=Li,A._invInertia12=wi,A._invInertia20=ei,A._invInertia21=qt,A._invInertia22=At;let ni,ui,Oi,Bi,kt,wt,$t,fi,gi;ni=A._invInertia00*A._transform._rotation00+A._invInertia01*A._transform._rotation01+A._invInertia02*A._transform._rotation02,ui=A._invInertia00*A._transform._rotation10+A._invInertia01*A._transform._rotation11+A._invInertia02*A._transform._rotation12,Oi=A._invInertia00*A._transform._rotation20+A._invInertia01*A._transform._rotation21+A._invInertia02*A._transform._rotation22,Bi=A._invInertia10*A._transform._rotation00+A._invInertia11*A._transform._rotation01+A._invInertia12*A._transform._rotation02,kt=A._invInertia10*A._transform._rotation10+A._invInertia11*A._transform._rotation11+A._invInertia12*A._transform._rotation12,wt=A._invInertia10*A._transform._rotation20+A._invInertia11*A._transform._rotation21+A._invInertia12*A._transform._rotation22,$t=A._invInertia20*A._transform._rotation00+A._invInertia21*A._transform._rotation01+A._invInertia22*A._transform._rotation02,fi=A._invInertia20*A._transform._rotation10+A._invInertia21*A._transform._rotation11+A._invInertia22*A._transform._rotation12,gi=A._invInertia20*A._transform._rotation20+A._invInertia21*A._transform._rotation21+A._invInertia22*A._transform._rotation22,A._invInertia00=ni,A._invInertia01=ui,A._invInertia02=Oi,A._invInertia10=Bi,A._invInertia11=kt,A._invInertia12=wt,A._invInertia20=$t,A._invInertia21=fi,A._invInertia22=gi,A._invInertia00*=A._rotFactor.x,A._invInertia01*=A._rotFactor.x,A._invInertia02*=A._rotFactor.x,A._invInertia10*=A._rotFactor.y,A._invInertia11*=A._rotFactor.y,A._invInertia12*=A._rotFactor.y,A._invInertia20*=A._rotFactor.z,A._invInertia21*=A._rotFactor.z,A._invInertia22*=A._rotFactor.z;let it=this._b2,Ht=Math.sqrt(V*V+M*M+w*w),ii=Ht*.5,T,Gt;if(ii<.5){let ti=ii*ii;T=.5*(1-ti*.16666666666666666+ti*ti*.008333333333333333),Gt=1-ti*.5+ti*ti*.041666666666666664}else T=Math.sin(ii)/Ht,Gt=Math.cos(ii);let Et,si,oi;Et=V*T,si=M*T,oi=w*T;let Pt,ai,Ri,Zi;Pt=Et,ai=si,Ri=oi,Zi=Gt;let yt,dt,vt,di,Ii=it._transform._rotation00,bi=it._transform._rotation11,se=it._transform._rotation22,me=Ii+bi+se,Di;me>0?(Di=Math.sqrt(me+1),di=.5*Di,Di=.5/Di,yt=(it._transform._rotation21-it._transform._rotation12)*Di,dt=(it._transform._rotation02-it._transform._rotation20)*Di,vt=(it._transform._rotation10-it._transform._rotation01)*Di):Ii>bi?Ii>se?(Di=Math.sqrt(Ii-bi-se+1),yt=.5*Di,Di=.5/Di,dt=(it._transform._rotation01+it._transform._rotation10)*Di,vt=(it._transform._rotation02+it._transform._rotation20)*Di,di=(it._transform._rotation21-it._transform._rotation12)*Di):(Di=Math.sqrt(se-Ii-bi+1),vt=.5*Di,Di=.5/Di,yt=(it._transform._rotation02+it._transform._rotation20)*Di,dt=(it._transform._rotation12+it._transform._rotation21)*Di,di=(it._transform._rotation10-it._transform._rotation01)*Di):bi>se?(Di=Math.sqrt(bi-se-Ii+1),dt=.5*Di,Di=.5/Di,yt=(it._transform._rotation01+it._transform._rotation10)*Di,vt=(it._transform._rotation12+it._transform._rotation21)*Di,di=(it._transform._rotation02-it._transform._rotation20)*Di):(Di=Math.sqrt(se-Ii-bi+1),vt=.5*Di,Di=.5/Di,yt=(it._transform._rotation02+it._transform._rotation20)*Di,dt=(it._transform._rotation12+it._transform._rotation21)*Di,di=(it._transform._rotation10-it._transform._rotation01)*Di),yt=Zi*yt+Pt*di+ai*vt-Ri*dt,dt=Zi*dt-Pt*vt+ai*di+Ri*yt,vt=Zi*vt+Pt*dt-ai*yt+Ri*di,di=Zi*di-Pt*yt-ai*dt-Ri*vt;let he=yt*yt+dt*dt+vt*vt+di*di;he>1e-32&&(he=1/Math.sqrt(he)),yt*=he,dt*=he,vt*=he,di*=he;let ve=yt,_i=dt,ce=vt,be=di,xe=2*ve,ye=2*_i,Ni=2*ce,Ji=ve*xe,Ui=_i*ye,oe=ce*Ni,ne=ve*ye,Ki=_i*Ni,ie=ve*Ni,Hi=be*xe,Wi=be*ye,Pi=be*Ni;it._transform._rotation00=1-Ui-oe,it._transform._rotation01=ne-Pi,it._transform._rotation02=ie+Wi,it._transform._rotation10=ne+Pi,it._transform._rotation11=1-Ji-oe,it._transform._rotation12=Ki-Hi,it._transform._rotation20=ie-Wi,it._transform._rotation21=Ki+Hi,it._transform._rotation22=1-Ji-Ui;let Ut,ri,Ct,Mi,zi,Ei,ki,Ti,Wt;Ut=it._transform._rotation00*it._invLocalInertia00+it._transform._rotation01*it._invLocalInertia10+it._transform._rotation02*it._invLocalInertia20,ri=it._transform._rotation00*it._invLocalInertia01+it._transform._rotation01*it._invLocalInertia11+it._transform._rotation02*it._invLocalInertia21,Ct=it._transform._rotation00*it._invLocalInertia02+it._transform._rotation01*it._invLocalInertia12+it._transform._rotation02*it._invLocalInertia22,Mi=it._transform._rotation10*it._invLocalInertia00+it._transform._rotation11*it._invLocalInertia10+it._transform._rotation12*it._invLocalInertia20,zi=it._transform._rotation10*it._invLocalInertia01+it._transform._rotation11*it._invLocalInertia11+it._transform._rotation12*it._invLocalInertia21,Ei=it._transform._rotation10*it._invLocalInertia02+it._transform._rotation11*it._invLocalInertia12+it._transform._rotation12*it._invLocalInertia22,ki=it._transform._rotation20*it._invLocalInertia00+it._transform._rotation21*it._invLocalInertia10+it._transform._rotation22*it._invLocalInertia20,Ti=it._transform._rotation20*it._invLocalInertia01+it._transform._rotation21*it._invLocalInertia11+it._transform._rotation22*it._invLocalInertia21,Wt=it._transform._rotation20*it._invLocalInertia02+it._transform._rotation21*it._invLocalInertia12+it._transform._rotation22*it._invLocalInertia22,it._invInertia00=Ut,it._invInertia01=ri,it._invInertia02=Ct,it._invInertia10=Mi,it._invInertia11=zi,it._invInertia12=Ei,it._invInertia20=ki,it._invInertia21=Ti,it._invInertia22=Wt;let ut,Vt,Ai,Vi,Fi,$i,ae,re,pe;ut=it._invInertia00*it._transform._rotation00+it._invInertia01*it._transform._rotation01+it._invInertia02*it._transform._rotation02,Vt=it._invInertia00*it._transform._rotation10+it._invInertia01*it._transform._rotation11+it._invInertia02*it._transform._rotation12,Ai=it._invInertia00*it._transform._rotation20+it._invInertia01*it._transform._rotation21+it._invInertia02*it._transform._rotation22,Vi=it._invInertia10*it._transform._rotation00+it._invInertia11*it._transform._rotation01+it._invInertia12*it._transform._rotation02,Fi=it._invInertia10*it._transform._rotation10+it._invInertia11*it._transform._rotation11+it._invInertia12*it._transform._rotation12,$i=it._invInertia10*it._transform._rotation20+it._invInertia11*it._transform._rotation21+it._invInertia12*it._transform._rotation22,ae=it._invInertia20*it._transform._rotation00+it._invInertia21*it._transform._rotation01+it._invInertia22*it._transform._rotation02,re=it._invInertia20*it._transform._rotation10+it._invInertia21*it._transform._rotation11+it._invInertia22*it._transform._rotation12,pe=it._invInertia20*it._transform._rotation20+it._invInertia21*it._transform._rotation21+it._invInertia22*it._transform._rotation22,it._invInertia00=ut,it._invInertia01=Vt,it._invInertia02=Ai,it._invInertia10=Vi,it._invInertia11=Fi,it._invInertia12=$i,it._invInertia20=ae,it._invInertia21=re,it._invInertia22=pe,it._invInertia00*=it._rotFactor.x,it._invInertia01*=it._rotFactor.x,it._invInertia02*=it._rotFactor.x,it._invInertia10*=it._rotFactor.y,it._invInertia11*=it._rotFactor.y,it._invInertia12*=it._rotFactor.y,it._invInertia20*=it._rotFactor.z,it._invInertia21*=it._rotFactor.z,it._invInertia22*=it._rotFactor.z}let C=this.posBoundarySelector,S=0;for(;C.indices[S]!=p;)++S;for(;S>0;){let A=C.indices[S];C.indices[S]=C.indices[S-1],C.indices[S-1]=A,--S}X=!0;break}}if(!X){console.log("src/oimo/dynamics/constraint/solver/direct/DirectJointConstraintSolver.hx:502:","could not find solution. (NGS)");return}}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};m.dynamics.constraint.solver.direct.MassMatrix=class{constructor(t){this._size=t,this.tmpMatrix=new Array(this._size),this._invMass=new Array(this._size),this._invMassWithoutCfm=new Array(this._size);let i=0,s=this._size;for(;i<s;){let l=i++;this.tmpMatrix[l]=new Array(this._size),this._invMass[l]=new Array(this._size),this._invMassWithoutCfm[l]=new Array(this._size);let _=0,r=this._size;for(;_<r;){let e=_++;this.tmpMatrix[l][e]=0,this._invMass[l][e]=0,this._invMassWithoutCfm[l][e]=0}}this._maxSubmatrixId=1<<this._size,this._cacheComputed=new Array(this._maxSubmatrixId),this._cachedSubmatrices=new Array(this._maxSubmatrixId);let o=0,n=this._maxSubmatrixId;for(;o<n;){let l=o++,_;_=(l&85)+(l>>1&85),_=(_&51)+(_>>2&51),_=(_&15)+(_>>4&15);let r=_,e=new Array(r),a=0;for(;a<r;){let h=a++;e[h]=new Array(r);let b=0;for(;b<r;)e[h][b++]=0}this._cacheComputed[l]=!1,this._cachedSubmatrices[l]=e}}computeSubmatrix(t,i,s){let o=0;for(;o<s;){let b=o++,X=i[b],c=0;for(;c<s;){let Y=c++;this.tmpMatrix[b][Y]=this._invMass[X][i[Y]]}}let n=this.tmpMatrix,l=this._cachedSubmatrices[t],_,r,e,a,h;switch(s){case 4:_=n[0],r=l[0],h=1/_[0],r[0]=h,_[1]*=h,_[2]*=h,_[3]*=h,e=n[1],a=l[1],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e=n[2],a=l[2],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e=n[3],a=l[3],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],_=n[1],r=l[1],h=1/_[1],r[1]=h,r[0]*=h,_[2]*=h,_[3]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e=n[2],a=l[2],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e=n[3],a=l[3],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],_=n[2],r=l[2],h=1/_[2],r[2]=h,r[0]*=h,r[1]*=h,_[3]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[2],e[3]-=_[3]*e[2],e=n[1],a=l[1],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],e[3]-=_[3]*e[2],e=n[3],a=l[3],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=_[3]*e[2],_=n[3],r=l[3],h=1/_[3],r[3]=h,r[0]*=h,r[1]*=h,r[2]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[3],e=n[1],a=l[1],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],e=n[2],a=l[2],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],r=l[1],l[0][1]=r[0],r=l[2],l[0][2]=r[0],l[1][2]=r[1],r=l[3],l[0][3]=r[0],l[1][3]=r[1],l[2][3]=r[2];break;case 5:_=n[0],r=l[0],h=1/_[0],r[0]=h,_[1]*=h,_[2]*=h,_[3]*=h,_[4]*=h,e=n[1],a=l[1],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e=n[2],a=l[2],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e=n[3],a=l[3],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e=n[4],a=l[4],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],_=n[1],r=l[1],h=1/_[1],r[1]=h,r[0]*=h,_[2]*=h,_[3]*=h,_[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e=n[2],a=l[2],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e=n[3],a=l[3],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e=n[4],a=l[4],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],_=n[2],r=l[2],h=1/_[2],r[2]=h,r[0]*=h,r[1]*=h,_[3]*=h,_[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e=n[1],a=l[1],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e=n[3],a=l[3],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e=n[4],a=l[4],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],_=n[3],r=l[3],h=1/_[3],r[3]=h,r[0]*=h,r[1]*=h,r[2]*=h,_[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[3],e[4]-=_[4]*e[3],e=n[1],a=l[1],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],e[4]-=_[4]*e[3],e=n[2],a=l[2],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],e[4]-=_[4]*e[3],e=n[4],a=l[4],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],a[3]=-h*e[3],e[4]-=_[4]*e[3],_=n[4],r=l[4],h=1/_[4],r[4]=h,r[0]*=h,r[1]*=h,r[2]*=h,r[3]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[4],e=n[1],a=l[1],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],e=n[2],a=l[2],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],e=n[3],a=l[3],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],a[3]-=r[3]*e[4],r=l[1],l[0][1]=r[0],r=l[2],l[0][2]=r[0],l[1][2]=r[1],r=l[3],l[0][3]=r[0],l[1][3]=r[1],l[2][3]=r[2],r=l[4],l[0][4]=r[0],l[1][4]=r[1],l[2][4]=r[2],l[3][4]=r[3];break;case 6:_=n[0],r=l[0],h=1/_[0],r[0]=h,_[1]*=h,_[2]*=h,_[3]*=h,_[4]*=h,_[5]*=h,e=n[1],a=l[1],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e[5]-=_[5]*e[0],e=n[2],a=l[2],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e[5]-=_[5]*e[0],e=n[3],a=l[3],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e[5]-=_[5]*e[0],e=n[4],a=l[4],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e[5]-=_[5]*e[0],e=n[5],a=l[5],a[0]=-h*e[0],e[1]-=_[1]*e[0],e[2]-=_[2]*e[0],e[3]-=_[3]*e[0],e[4]-=_[4]*e[0],e[5]-=_[5]*e[0],_=n[1],r=l[1],h=1/_[1],r[1]=h,r[0]*=h,_[2]*=h,_[3]*=h,_[4]*=h,_[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e[5]-=_[5]*e[1],e=n[2],a=l[2],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e[5]-=_[5]*e[1],e=n[3],a=l[3],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e[5]-=_[5]*e[1],e=n[4],a=l[4],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e[5]-=_[5]*e[1],e=n[5],a=l[5],a[0]-=r[0]*e[1],a[1]=-h*e[1],e[2]-=_[2]*e[1],e[3]-=_[3]*e[1],e[4]-=_[4]*e[1],e[5]-=_[5]*e[1],_=n[2],r=l[2],h=1/_[2],r[2]=h,r[0]*=h,r[1]*=h,_[3]*=h,_[4]*=h,_[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e[5]-=_[5]*e[2],e=n[1],a=l[1],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e[5]-=_[5]*e[2],e=n[3],a=l[3],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e[5]-=_[5]*e[2],e=n[4],a=l[4],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e[5]-=_[5]*e[2],e=n[5],a=l[5],a[0]-=r[0]*e[2],a[1]-=r[1]*e[2],a[2]=-h*e[2],e[3]-=_[3]*e[2],e[4]-=_[4]*e[2],e[5]-=_[5]*e[2],_=n[3],r=l[3],h=1/_[3],r[3]=h,r[0]*=h,r[1]*=h,r[2]*=h,_[4]*=h,_[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[3],e[4]-=_[4]*e[3],e[5]-=_[5]*e[3],e=n[1],a=l[1],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],e[4]-=_[4]*e[3],e[5]-=_[5]*e[3],e=n[2],a=l[2],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],e[4]-=_[4]*e[3],e[5]-=_[5]*e[3],e=n[4],a=l[4],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],a[3]=-h*e[3],e[4]-=_[4]*e[3],e[5]-=_[5]*e[3],e=n[5],a=l[5],a[0]-=r[0]*e[3],a[1]-=r[1]*e[3],a[2]-=r[2]*e[3],a[3]=-h*e[3],e[4]-=_[4]*e[3],e[5]-=_[5]*e[3],_=n[4],r=l[4],h=1/_[4],r[4]=h,r[0]*=h,r[1]*=h,r[2]*=h,r[3]*=h,_[5]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[4],e[5]-=_[5]*e[4],e=n[1],a=l[1],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],e[5]-=_[5]*e[4],e=n[2],a=l[2],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],e[5]-=_[5]*e[4],e=n[3],a=l[3],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],a[3]-=r[3]*e[4],e[5]-=_[5]*e[4],e=n[5],a=l[5],a[0]-=r[0]*e[4],a[1]-=r[1]*e[4],a[2]-=r[2]*e[4],a[3]-=r[3]*e[4],a[4]=-h*e[4],e[5]-=_[5]*e[4],_=n[5],r=l[5],h=1/_[5],r[5]=h,r[0]*=h,r[1]*=h,r[2]*=h,r[3]*=h,r[4]*=h,e=n[0],a=l[0],a[0]-=r[0]*e[5],e=n[1],a=l[1],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],e=n[2],a=l[2],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],a[2]-=r[2]*e[5],e=n[3],a=l[3],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],a[2]-=r[2]*e[5],a[3]-=r[3]*e[5],e=n[4],a=l[4],a[0]-=r[0]*e[5],a[1]-=r[1]*e[5],a[2]-=r[2]*e[5],a[3]-=r[3]*e[5],a[4]-=r[4]*e[5],r=l[1],l[0][1]=r[0],r=l[2],l[0][2]=r[0],l[1][2]=r[1],r=l[3],l[0][3]=r[0],l[1][3]=r[1],l[2][3]=r[2],r=l[4],l[0][4]=r[0],l[1][4]=r[1],l[2][4]=r[2],l[3][4]=r[3],r=l[5],l[0][5]=r[0],l[1][5]=r[1],l[2][5]=r[2],l[3][5]=r[3],l[4][5]=r[4];break;default:let b=0;for(;b<s;){let c=b++;_=n[c],r=l[c];let Y=1/_[c];r[c]=Y;let p=0;for(;p<c;)r[p++]*=Y;let x=c+1;for(;x<s;)_[x++]*=Y;let v=0;for(;v<c;){let Z=v++;e=n[Z],a=l[Z];let k=0,g=Z+1;for(;k<g;){let z=k++;a[z]-=r[z]*e[c]}let I=c+1;for(;I<s;){let z=I++;e[z]-=_[z]*e[c]}}let f=c+1;for(;f<s;){let Z=f++;e=n[Z],a=l[Z];let k=0;for(;k<c;){let I=k++;a[I]-=r[I]*e[c]}a[c]=-Y*e[c];let g=c+1;for(;g<s;){let I=g++;e[I]-=_[I]*e[c]}}}let X=1;for(;X<s;){let c=X++;r=l[c];let Y=0;for(;Y<c;){let p=Y++;l[p][c]=r[p]}}}}computeInvMass(t,i){let s=this._invMass,o=this._invMassWithoutCfm,n=t.numRows,l=t.b1,_=t.b2,r=l._invMass,e=_._invMass,a,h,b,X,c,Y,p,x,v,f,Z,k,g,I,z,d,u,B;a=l._invInertia00,h=l._invInertia01,b=l._invInertia02,X=l._invInertia10,c=l._invInertia11,Y=l._invInertia12,p=l._invInertia20,x=l._invInertia21,v=l._invInertia22,f=_._invInertia00,Z=_._invInertia01,k=_._invInertia02,g=_._invInertia10,I=_._invInertia11,z=_._invInertia12,d=_._invInertia20,u=_._invInertia21,B=_._invInertia22;let j=0;for(;j<n;){let w=j++,P=t.rows[w].jacobian,E=i[w];if(P.updateSparsity(),P.flag&1?(E.invMLin1X=P.lin1X*r,E.invMLin1Y=P.lin1Y*r,E.invMLin1Z=P.lin1Z*r,E.invMLin2X=P.lin2X*e,E.invMLin2Y=P.lin2Y*e,E.invMLin2Z=P.lin2Z*e):(E.invMLin1X=0,E.invMLin1Y=0,E.invMLin1Z=0,E.invMLin2X=0,E.invMLin2Y=0,E.invMLin2Z=0),P.flag&2){let C,S,A;C=a*P.ang1X+h*P.ang1Y+b*P.ang1Z,S=X*P.ang1X+c*P.ang1Y+Y*P.ang1Z,A=p*P.ang1X+x*P.ang1Y+v*P.ang1Z,E.invMAng1X=C,E.invMAng1Y=S,E.invMAng1Z=A;let R,H,y;R=f*P.ang2X+Z*P.ang2Y+k*P.ang2Z,H=g*P.ang2X+I*P.ang2Y+z*P.ang2Z,y=d*P.ang2X+u*P.ang2Y+B*P.ang2Z,E.invMAng2X=R,E.invMAng2Y=H,E.invMAng2Z=y}else E.invMAng1X=0,E.invMAng1Y=0,E.invMAng1Z=0,E.invMAng2X=0,E.invMAng2Y=0,E.invMAng2Z=0}let L=0;for(;L<n;){let w=L++,P=t.rows[w].jacobian,E=w;for(;E<n;){let C=E++,S=i[C],A=P.lin1X*S.invMLin1X+P.lin1Y*S.invMLin1Y+P.lin1Z*S.invMLin1Z+(P.ang1X*S.invMAng1X+P.ang1Y*S.invMAng1Y+P.ang1Z*S.invMAng1Z)+(P.lin2X*S.invMLin2X+P.lin2Y*S.invMLin2Y+P.lin2Z*S.invMLin2Z)+(P.ang2X*S.invMAng2X+P.ang2Y*S.invMAng2Y+P.ang2Z*S.invMAng2Z);w==C?(s[w][C]=A+t.rows[w].cfm,o[w][C]=A,S.mass=A+t.rows[w].cfm,S.massWithoutCfm=A,S.mass!=0&&(S.mass=1/S.mass),S.massWithoutCfm!=0&&(S.massWithoutCfm=1/S.massWithoutCfm)):(s[w][C]=A,s[C][w]=A,o[w][C]=A,o[C][w]=A)}}let V=0,M=this._maxSubmatrixId;for(;V<M;)this._cacheComputed[V++]=!1}};m.dynamics.constraint.solver.pgs||(m.dynamics.constraint.solver.pgs={});m.dynamics.constraint.solver.pgs.PgsContactConstraintSolver=class extends m.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.constraint=t,this.info=new m.dynamics.constraint.info.contact.ContactSolverInfo,this.massData=new Array(m.common.Setting.maxManifoldPoints);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new m.dynamics.constraint.solver.common.ContactSolverMassDataRow}preSolveVelocity(t){this.constraint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k;o=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,_=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,Y=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,Z=this._b2._invInertia21,k=this._b2._invInertia22;let g=0,I=this.info.numRows;for(;g<I;){let z=g++,d=this.info.rows[z],u=this.massData[z],B=d.jacobianN;u.invMLinN1X=B.lin1X*i,u.invMLinN1Y=B.lin1Y*i,u.invMLinN1Z=B.lin1Z*i,u.invMLinN2X=B.lin2X*s,u.invMLinN2Y=B.lin2Y*s,u.invMLinN2Z=B.lin2Z*s;let j,L,V;j=o*B.ang1X+n*B.ang1Y+l*B.ang1Z,L=_*B.ang1X+r*B.ang1Y+e*B.ang1Z,V=a*B.ang1X+h*B.ang1Y+b*B.ang1Z,u.invMAngN1X=j,u.invMAngN1Y=L,u.invMAngN1Z=V;let M,w,P;M=X*B.ang2X+c*B.ang2Y+Y*B.ang2Z,w=p*B.ang2X+x*B.ang2Y+v*B.ang2Z,P=f*B.ang2X+Z*B.ang2Y+k*B.ang2Z,u.invMAngN2X=M,u.invMAngN2Y=w,u.invMAngN2Z=P,u.massN=i+s+(u.invMAngN1X*B.ang1X+u.invMAngN1Y*B.ang1Y+u.invMAngN1Z*B.ang1Z)+(u.invMAngN2X*B.ang2X+u.invMAngN2Y*B.ang2Y+u.invMAngN2Z*B.ang2Z),u.massN!=0&&(u.massN=1/u.massN);let E=d.jacobianT,C=d.jacobianB;u.invMLinT1X=E.lin1X*i,u.invMLinT1Y=E.lin1Y*i,u.invMLinT1Z=E.lin1Z*i,u.invMLinT2X=E.lin2X*s,u.invMLinT2Y=E.lin2Y*s,u.invMLinT2Z=E.lin2Z*s,u.invMLinB1X=C.lin1X*i,u.invMLinB1Y=C.lin1Y*i,u.invMLinB1Z=C.lin1Z*i,u.invMLinB2X=C.lin2X*s,u.invMLinB2Y=C.lin2Y*s,u.invMLinB2Z=C.lin2Z*s;let S,A,R;S=o*E.ang1X+n*E.ang1Y+l*E.ang1Z,A=_*E.ang1X+r*E.ang1Y+e*E.ang1Z,R=a*E.ang1X+h*E.ang1Y+b*E.ang1Z,u.invMAngT1X=S,u.invMAngT1Y=A,u.invMAngT1Z=R;let H,y,D;H=X*E.ang2X+c*E.ang2Y+Y*E.ang2Z,y=p*E.ang2X+x*E.ang2Y+v*E.ang2Z,D=f*E.ang2X+Z*E.ang2Y+k*E.ang2Z,u.invMAngT2X=H,u.invMAngT2Y=y,u.invMAngT2Z=D;let F,Q,W;F=o*C.ang1X+n*C.ang1Y+l*C.ang1Z,Q=_*C.ang1X+r*C.ang1Y+e*C.ang1Z,W=a*C.ang1X+h*C.ang1Y+b*C.ang1Z,u.invMAngB1X=F,u.invMAngB1Y=Q,u.invMAngB1Z=W;let q,U,G;q=X*C.ang2X+c*C.ang2Y+Y*C.ang2Z,U=p*C.ang2X+x*C.ang2Y+v*C.ang2Z,G=f*C.ang2X+Z*C.ang2Y+k*C.ang2Z,u.invMAngB2X=q,u.invMAngB2Y=U,u.invMAngB2Z=G;let J=i+s+(u.invMAngT1X*E.ang1X+u.invMAngT1Y*E.ang1Y+u.invMAngT1Z*E.ang1Z)+(u.invMAngT2X*E.ang2X+u.invMAngT2Y*E.ang2Y+u.invMAngT2Z*E.ang2Z),N=u.invMAngT1X*C.ang1X+u.invMAngT1Y*C.ang1Y+u.invMAngT1Z*C.ang1Z+(u.invMAngT2X*C.ang2X+u.invMAngT2Y*C.ang2Y+u.invMAngT2Z*C.ang2Z),K=i+s+(u.invMAngB1X*C.ang1X+u.invMAngB1Y*C.ang1Y+u.invMAngB1Z*C.ang1Z)+(u.invMAngB2X*C.ang2X+u.invMAngB2Y*C.ang2Y+u.invMAngB2Z*C.ang2Z),O=J*K-N*N;O!=0&&(O=1/O),u.massTB00=K*O,u.massTB01=-N*O,u.massTB10=-N*O,u.massTB11=J*O}}warmStart(t){let i,s,o,n,l,_,r,e,a,h,b,X;i=this._b1._velX,s=this._b1._velY,o=this._b1._velZ,n=this._b2._velX,l=this._b2._velY,_=this._b2._velZ,r=this._b1._angVelX,e=this._b1._angVelY,a=this._b1._angVelZ,h=this._b2._angVelX,b=this._b2._angVelY,X=this._b2._angVelZ;let c=0,Y=this.info.numRows;for(;c<Y;){let p=c++,x=this.info.rows[p],v=x.impulse,f=this.massData[p],Z=x.jacobianT,k=x.jacobianB,g=v.impulseN,I=v.impulseLX*Z.lin1X+v.impulseLY*Z.lin1Y+v.impulseLZ*Z.lin1Z,z=v.impulseLX*k.lin1X+v.impulseLY*k.lin1Y+v.impulseLZ*k.lin1Z;v.impulseT=I,v.impulseB=z,v.impulseN*=t.dtRatio,v.impulseT*=t.dtRatio,v.impulseB*=t.dtRatio,i+=f.invMLinN1X*g,s+=f.invMLinN1Y*g,o+=f.invMLinN1Z*g,i+=f.invMLinT1X*I,s+=f.invMLinT1Y*I,o+=f.invMLinT1Z*I,i+=f.invMLinB1X*z,s+=f.invMLinB1Y*z,o+=f.invMLinB1Z*z,n+=f.invMLinN2X*-g,l+=f.invMLinN2Y*-g,_+=f.invMLinN2Z*-g,n+=f.invMLinT2X*-I,l+=f.invMLinT2Y*-I,_+=f.invMLinT2Z*-I,n+=f.invMLinB2X*-z,l+=f.invMLinB2Y*-z,_+=f.invMLinB2Z*-z,r+=f.invMAngN1X*g,e+=f.invMAngN1Y*g,a+=f.invMAngN1Z*g,r+=f.invMAngT1X*I,e+=f.invMAngT1Y*I,a+=f.invMAngT1Z*I,r+=f.invMAngB1X*z,e+=f.invMAngB1Y*z,a+=f.invMAngB1Z*z,h+=f.invMAngN2X*-g,b+=f.invMAngN2Y*-g,X+=f.invMAngN2Z*-g,h+=f.invMAngT2X*-I,b+=f.invMAngT2Y*-I,X+=f.invMAngT2Z*-I,h+=f.invMAngB2X*-z,b+=f.invMAngB2Y*-z,X+=f.invMAngB2Z*-z}this._b1._velX=i,this._b1._velY=s,this._b1._velZ=o,this._b2._velX=n,this._b2._velY=l,this._b2._velZ=_,this._b1._angVelX=r,this._b1._angVelY=e,this._b1._angVelZ=a,this._b2._angVelX=h,this._b2._angVelY=b,this._b2._angVelZ=X}solveVelocity(){let t,i,s,o,n,l,_,r,e,a,h,b;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,l=this._b2._velZ,_=this._b1._angVelX,r=this._b1._angVelY,e=this._b1._angVelZ,a=this._b2._angVelX,h=this._b2._angVelY,b=this._b2._angVelZ;let X=0,c=this.info.numRows;for(;X<c;){let x=X++,v=this.info.rows[x],f=this.massData[x],Z=v.impulse,k=0,g=v.jacobianT;k+=t*g.lin1X+i*g.lin1Y+s*g.lin1Z,k-=o*g.lin2X+n*g.lin2Y+l*g.lin2Z,k+=_*g.ang1X+r*g.ang1Y+e*g.ang1Z,k-=a*g.ang2X+h*g.ang2Y+b*g.ang2Z;let I=0;g=v.jacobianB,I+=t*g.lin1X+i*g.lin1Y+s*g.lin1Z,I-=o*g.lin2X+n*g.lin2Y+l*g.lin2Z,I+=_*g.ang1X+r*g.ang1Y+e*g.ang1Z,I-=a*g.ang2X+h*g.ang2Y+b*g.ang2Z;let z=-(k*f.massTB00+I*f.massTB01),d=-(k*f.massTB10+I*f.massTB11),u=Z.impulseT,B=Z.impulseB;Z.impulseT+=z,Z.impulseB+=d;let j=v.friction*Z.impulseN;if(j==0)Z.impulseT=0,Z.impulseB=0;else{let L=Z.impulseT*Z.impulseT+Z.impulseB*Z.impulseB;if(L>j*j){let V=j/Math.sqrt(L);Z.impulseT*=V,Z.impulseB*=V}}z=Z.impulseT-u,d=Z.impulseB-B,t+=f.invMLinT1X*z,i+=f.invMLinT1Y*z,s+=f.invMLinT1Z*z,t+=f.invMLinB1X*d,i+=f.invMLinB1Y*d,s+=f.invMLinB1Z*d,o+=f.invMLinT2X*-z,n+=f.invMLinT2Y*-z,l+=f.invMLinT2Z*-z,o+=f.invMLinB2X*-d,n+=f.invMLinB2Y*-d,l+=f.invMLinB2Z*-d,_+=f.invMAngT1X*z,r+=f.invMAngT1Y*z,e+=f.invMAngT1Z*z,_+=f.invMAngB1X*d,r+=f.invMAngB1Y*d,e+=f.invMAngB1Z*d,a+=f.invMAngT2X*-z,h+=f.invMAngT2Y*-z,b+=f.invMAngT2Z*-z,a+=f.invMAngB2X*-d,h+=f.invMAngB2Y*-d,b+=f.invMAngB2Z*-d}let Y=0,p=this.info.numRows;for(;Y<p;){let x=Y++,v=this.info.rows[x],f=this.massData[x],Z=v.impulse,k=0,g=v.jacobianN;k+=t*g.lin1X+i*g.lin1Y+s*g.lin1Z,k-=o*g.lin2X+n*g.lin2Y+l*g.lin2Z,k+=_*g.ang1X+r*g.ang1Y+e*g.ang1Z,k-=a*g.ang2X+h*g.ang2Y+b*g.ang2Z;let I=(v.rhs-k)*f.massN,z=Z.impulseN;Z.impulseN+=I,Z.impulseN<0&&(Z.impulseN=0),I=Z.impulseN-z,t+=f.invMLinN1X*I,i+=f.invMLinN1Y*I,s+=f.invMLinN1Z*I,o+=f.invMLinN2X*-I,n+=f.invMLinN2Y*-I,l+=f.invMLinN2Z*-I,_+=f.invMAngN1X*I,r+=f.invMAngN1Y*I,e+=f.invMAngN1Z*I,a+=f.invMAngN2X*-I,h+=f.invMAngN2Y*-I,b+=f.invMAngN2Z*-I}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=l,this._b1._angVelX=_,this._b1._angVelY=r,this._b1._angVelZ=e,this._b2._angVelX=a,this._b2._angVelY=h,this._b2._angVelZ=b}preSolvePosition(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i=this._b1._invMass,s=this._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k;o=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,_=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,Y=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,Z=this._b2._invInertia21,k=this._b2._invInertia22;let g=0,I=this.info.numRows;for(;g<I;){let u=g++,B=this.massData[u],j=this.info.rows[u].jacobianN;B.invMLinN1X=j.lin1X*i,B.invMLinN1Y=j.lin1Y*i,B.invMLinN1Z=j.lin1Z*i,B.invMLinN2X=j.lin2X*s,B.invMLinN2Y=j.lin2Y*s,B.invMLinN2Z=j.lin2Z*s;let L,V,M;L=o*j.ang1X+n*j.ang1Y+l*j.ang1Z,V=_*j.ang1X+r*j.ang1Y+e*j.ang1Z,M=a*j.ang1X+h*j.ang1Y+b*j.ang1Z,B.invMAngN1X=L,B.invMAngN1Y=V,B.invMAngN1Z=M;let w,P,E;w=X*j.ang2X+c*j.ang2Y+Y*j.ang2Z,P=p*j.ang2X+x*j.ang2Y+v*j.ang2Z,E=f*j.ang2X+Z*j.ang2Y+k*j.ang2Z,B.invMAngN2X=w,B.invMAngN2Y=P,B.invMAngN2Z=E,B.massN=i+s+(B.invMAngN1X*j.ang1X+B.invMAngN1Y*j.ang1Y+B.invMAngN1Z*j.ang1Z)+(B.invMAngN2X*j.ang2X+B.invMAngN2Y*j.ang2Y+B.invMAngN2Z*j.ang2Z),B.massN!=0&&(B.massN=1/B.massN)}let z=0,d=this.info.numRows;for(;z<d;)this.info.rows[z++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,o,n,l,_,r,e,a,h,b;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,l=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,a=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;let X=0,c=this.info.numRows;for(;X<c;){let Y=X++,p=this.info.rows[Y],x=this.massData[Y],v=p.impulse,f=p.jacobianN,Z=0;Z+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,Z-=o*f.lin2X+n*f.lin2Y+l*f.lin2Z,Z+=_*f.ang1X+r*f.ang1Y+e*f.ang1Z,Z-=a*f.ang2X+h*f.ang2Y+b*f.ang2Z;let k=(p.rhs-Z)*x.massN*m.common.Setting.positionSplitImpulseBaumgarte,g=v.impulseP;v.impulseP+=k,v.impulseP<0&&(v.impulseP=0),k=v.impulseP-g,t+=x.invMLinN1X*k,i+=x.invMLinN1Y*k,s+=x.invMLinN1Z*k,o+=x.invMLinN2X*-k,n+=x.invMLinN2Y*-k,l+=x.invMLinN2Z*-k,_+=x.invMAngN1X*k,r+=x.invMAngN1Y*k,e+=x.invMAngN1Z*k,a+=x.invMAngN2X*-k,h+=x.invMAngN2Y*-k,b+=x.invMAngN2Z*-k}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=l,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=e,this._b2._angPseudoVelX=a,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=b}solvePositionNgs(t){this.constraint._syncManifold(),this.constraint._getPositionSolverInfo(this.info);let i=this._b1._invMass,s=this._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k;o=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,_=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,Y=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,Z=this._b2._invInertia21,k=this._b2._invInertia22;let g=0,I=this.info.numRows;for(;g<I;){let Ci=g++,mi=this.massData[Ci],St=this.info.rows[Ci].jacobianN;mi.invMLinN1X=St.lin1X*i,mi.invMLinN1Y=St.lin1Y*i,mi.invMLinN1Z=St.lin1Z*i,mi.invMLinN2X=St.lin2X*s,mi.invMLinN2Y=St.lin2Y*s,mi.invMLinN2Z=St.lin2Z*s;let Tt,hi,Rt;Tt=o*St.ang1X+n*St.ang1Y+l*St.ang1Z,hi=_*St.ang1X+r*St.ang1Y+e*St.ang1Z,Rt=a*St.ang1X+h*St.ang1Y+b*St.ang1Z,mi.invMAngN1X=Tt,mi.invMAngN1Y=hi,mi.invMAngN1Z=Rt;let mt,gt,Ft;mt=X*St.ang2X+c*St.ang2Y+Y*St.ang2Z,gt=p*St.ang2X+x*St.ang2Y+v*St.ang2Z,Ft=f*St.ang2X+Z*St.ang2Y+k*St.ang2Z,mi.invMAngN2X=mt,mi.invMAngN2Y=gt,mi.invMAngN2Z=Ft,mi.massN=i+s+(mi.invMAngN1X*St.ang1X+mi.invMAngN1Y*St.ang1Y+mi.invMAngN1Z*St.ang1Z)+(mi.invMAngN2X*St.ang2X+mi.invMAngN2Y*St.ang2Y+mi.invMAngN2Z*St.ang2Z),mi.massN!=0&&(mi.massN=1/mi.massN)}let z,d,u,B,j,L,V,M,w,P,E,C;z=0,d=0,u=0,B=0,j=0,L=0,V=0,M=0,w=0,P=0,E=0,C=0;let S=0,A=this.info.numRows;for(;S<A;){let Ci=S++,mi=this.info.rows[Ci],St=this.massData[Ci],Tt=mi.impulse,hi=mi.jacobianN,Rt=0;Rt+=z*hi.lin1X+d*hi.lin1Y+u*hi.lin1Z,Rt-=B*hi.lin2X+j*hi.lin2Y+L*hi.lin2Z,Rt+=V*hi.ang1X+M*hi.ang1Y+w*hi.ang1Z,Rt-=P*hi.ang2X+E*hi.ang2Y+C*hi.ang2Z;let mt=(mi.rhs-Rt)*St.massN*m.common.Setting.positionNgsBaumgarte,gt=Tt.impulseP;Tt.impulseP+=mt,Tt.impulseP<0&&(Tt.impulseP=0),mt=Tt.impulseP-gt,z+=St.invMLinN1X*mt,d+=St.invMLinN1Y*mt,u+=St.invMLinN1Z*mt,B+=St.invMLinN2X*-mt,j+=St.invMLinN2Y*-mt,L+=St.invMLinN2Z*-mt,V+=St.invMAngN1X*mt,M+=St.invMAngN1Y*mt,w+=St.invMAngN1Z*mt,P+=St.invMAngN2X*-mt,E+=St.invMAngN2Y*-mt,C+=St.invMAngN2Z*-mt}let R=this._b1;R._transform._positionX+=z,R._transform._positionY+=d,R._transform._positionZ+=u;let H=this._b2;H._transform._positionX+=B,H._transform._positionY+=j,H._transform._positionZ+=L;let y=this._b1,D=Math.sqrt(V*V+M*M+w*w),F=D*.5,Q,W;if(F<.5){let Ci=F*F;Q=.5*(1-Ci*.16666666666666666+Ci*Ci*.008333333333333333),W=1-Ci*.5+Ci*Ci*.041666666666666664}else Q=Math.sin(F)/D,W=Math.cos(F);let q,U,G;q=V*Q,U=M*Q,G=w*Q;let J,N,K,O;J=q,N=U,K=G,O=W;let $,et,st,lt,rt=y._transform._rotation00,at=y._transform._rotation11,ot=y._transform._rotation22,ht=rt+at+ot,_t;ht>0?(_t=Math.sqrt(ht+1),lt=.5*_t,_t=.5/_t,$=(y._transform._rotation21-y._transform._rotation12)*_t,et=(y._transform._rotation02-y._transform._rotation20)*_t,st=(y._transform._rotation10-y._transform._rotation01)*_t):rt>at?rt>ot?(_t=Math.sqrt(rt-at-ot+1),$=.5*_t,_t=.5/_t,et=(y._transform._rotation01+y._transform._rotation10)*_t,st=(y._transform._rotation02+y._transform._rotation20)*_t,lt=(y._transform._rotation21-y._transform._rotation12)*_t):(_t=Math.sqrt(ot-rt-at+1),st=.5*_t,_t=.5/_t,$=(y._transform._rotation02+y._transform._rotation20)*_t,et=(y._transform._rotation12+y._transform._rotation21)*_t,lt=(y._transform._rotation10-y._transform._rotation01)*_t):at>ot?(_t=Math.sqrt(at-ot-rt+1),et=.5*_t,_t=.5/_t,$=(y._transform._rotation01+y._transform._rotation10)*_t,st=(y._transform._rotation12+y._transform._rotation21)*_t,lt=(y._transform._rotation02-y._transform._rotation20)*_t):(_t=Math.sqrt(ot-rt-at+1),st=.5*_t,_t=.5/_t,$=(y._transform._rotation02+y._transform._rotation20)*_t,et=(y._transform._rotation12+y._transform._rotation21)*_t,lt=(y._transform._rotation10-y._transform._rotation01)*_t),$=O*$+J*lt+N*st-K*et,et=O*et-J*st+N*lt+K*$,st=O*st+J*et-N*$+K*lt,lt=O*lt-J*$-N*et-K*st;let bt=$*$+et*et+st*st+lt*lt;bt>1e-32&&(bt=1/Math.sqrt(bt)),$*=bt,et*=bt,st*=bt,lt*=bt;let Xt=$,ft=et,Zt=st,xt=lt,zt=2*Xt,Yt=2*ft,pt=2*Zt,ct=Xt*zt,nt=ft*Yt,tt=Zt*pt,Lt=Xt*Yt,Bt=ft*pt,Mt=Xt*pt,jt=xt*zt,ci=xt*Yt,Xi=xt*pt;y._transform._rotation00=1-nt-tt,y._transform._rotation01=Lt-Xi,y._transform._rotation02=Mt+ci,y._transform._rotation10=Lt+Xi,y._transform._rotation11=1-ct-tt,y._transform._rotation12=Bt-jt,y._transform._rotation20=Mt-ci,y._transform._rotation21=Bt+jt,y._transform._rotation22=1-ct-nt;let Yi,Li,wi,ei,qt,At,ni,ui,Oi;Yi=y._transform._rotation00*y._invLocalInertia00+y._transform._rotation01*y._invLocalInertia10+y._transform._rotation02*y._invLocalInertia20,Li=y._transform._rotation00*y._invLocalInertia01+y._transform._rotation01*y._invLocalInertia11+y._transform._rotation02*y._invLocalInertia21,wi=y._transform._rotation00*y._invLocalInertia02+y._transform._rotation01*y._invLocalInertia12+y._transform._rotation02*y._invLocalInertia22,ei=y._transform._rotation10*y._invLocalInertia00+y._transform._rotation11*y._invLocalInertia10+y._transform._rotation12*y._invLocalInertia20,qt=y._transform._rotation10*y._invLocalInertia01+y._transform._rotation11*y._invLocalInertia11+y._transform._rotation12*y._invLocalInertia21,At=y._transform._rotation10*y._invLocalInertia02+y._transform._rotation11*y._invLocalInertia12+y._transform._rotation12*y._invLocalInertia22,ni=y._transform._rotation20*y._invLocalInertia00+y._transform._rotation21*y._invLocalInertia10+y._transform._rotation22*y._invLocalInertia20,ui=y._transform._rotation20*y._invLocalInertia01+y._transform._rotation21*y._invLocalInertia11+y._transform._rotation22*y._invLocalInertia21,Oi=y._transform._rotation20*y._invLocalInertia02+y._transform._rotation21*y._invLocalInertia12+y._transform._rotation22*y._invLocalInertia22,y._invInertia00=Yi,y._invInertia01=Li,y._invInertia02=wi,y._invInertia10=ei,y._invInertia11=qt,y._invInertia12=At,y._invInertia20=ni,y._invInertia21=ui,y._invInertia22=Oi;let Bi,kt,wt,$t,fi,gi,it,Ht,ii;Bi=y._invInertia00*y._transform._rotation00+y._invInertia01*y._transform._rotation01+y._invInertia02*y._transform._rotation02,kt=y._invInertia00*y._transform._rotation10+y._invInertia01*y._transform._rotation11+y._invInertia02*y._transform._rotation12,wt=y._invInertia00*y._transform._rotation20+y._invInertia01*y._transform._rotation21+y._invInertia02*y._transform._rotation22,$t=y._invInertia10*y._transform._rotation00+y._invInertia11*y._transform._rotation01+y._invInertia12*y._transform._rotation02,fi=y._invInertia10*y._transform._rotation10+y._invInertia11*y._transform._rotation11+y._invInertia12*y._transform._rotation12,gi=y._invInertia10*y._transform._rotation20+y._invInertia11*y._transform._rotation21+y._invInertia12*y._transform._rotation22,it=y._invInertia20*y._transform._rotation00+y._invInertia21*y._transform._rotation01+y._invInertia22*y._transform._rotation02,Ht=y._invInertia20*y._transform._rotation10+y._invInertia21*y._transform._rotation11+y._invInertia22*y._transform._rotation12,ii=y._invInertia20*y._transform._rotation20+y._invInertia21*y._transform._rotation21+y._invInertia22*y._transform._rotation22,y._invInertia00=Bi,y._invInertia01=kt,y._invInertia02=wt,y._invInertia10=$t,y._invInertia11=fi,y._invInertia12=gi,y._invInertia20=it,y._invInertia21=Ht,y._invInertia22=ii,y._invInertia00*=y._rotFactor.x,y._invInertia01*=y._rotFactor.x,y._invInertia02*=y._rotFactor.x,y._invInertia10*=y._rotFactor.y,y._invInertia11*=y._rotFactor.y,y._invInertia12*=y._rotFactor.y,y._invInertia20*=y._rotFactor.z,y._invInertia21*=y._rotFactor.z,y._invInertia22*=y._rotFactor.z;let T=this._b2,Gt=Math.sqrt(P*P+E*E+C*C),Et=Gt*.5,si,oi;if(Et<.5){let Ci=Et*Et;si=.5*(1-Ci*.16666666666666666+Ci*Ci*.008333333333333333),oi=1-Ci*.5+Ci*Ci*.041666666666666664}else si=Math.sin(Et)/Gt,oi=Math.cos(Et);let Pt,ai,Ri;Pt=P*si,ai=E*si,Ri=C*si;let Zi,yt,dt,vt;Zi=Pt,yt=ai,dt=Ri,vt=oi;let di,Ii,bi,se,me=T._transform._rotation00,Di=T._transform._rotation11,he=T._transform._rotation22,ve=me+Di+he,_i;ve>0?(_i=Math.sqrt(ve+1),se=.5*_i,_i=.5/_i,di=(T._transform._rotation21-T._transform._rotation12)*_i,Ii=(T._transform._rotation02-T._transform._rotation20)*_i,bi=(T._transform._rotation10-T._transform._rotation01)*_i):me>Di?me>he?(_i=Math.sqrt(me-Di-he+1),di=.5*_i,_i=.5/_i,Ii=(T._transform._rotation01+T._transform._rotation10)*_i,bi=(T._transform._rotation02+T._transform._rotation20)*_i,se=(T._transform._rotation21-T._transform._rotation12)*_i):(_i=Math.sqrt(he-me-Di+1),bi=.5*_i,_i=.5/_i,di=(T._transform._rotation02+T._transform._rotation20)*_i,Ii=(T._transform._rotation12+T._transform._rotation21)*_i,se=(T._transform._rotation10-T._transform._rotation01)*_i):Di>he?(_i=Math.sqrt(Di-he-me+1),Ii=.5*_i,_i=.5/_i,di=(T._transform._rotation01+T._transform._rotation10)*_i,bi=(T._transform._rotation12+T._transform._rotation21)*_i,se=(T._transform._rotation02-T._transform._rotation20)*_i):(_i=Math.sqrt(he-me-Di+1),bi=.5*_i,_i=.5/_i,di=(T._transform._rotation02+T._transform._rotation20)*_i,Ii=(T._transform._rotation12+T._transform._rotation21)*_i,se=(T._transform._rotation10-T._transform._rotation01)*_i),di=vt*di+Zi*se+yt*bi-dt*Ii,Ii=vt*Ii-Zi*bi+yt*se+dt*di,bi=vt*bi+Zi*Ii-yt*di+dt*se,se=vt*se-Zi*di-yt*Ii-dt*bi;let ce=di*di+Ii*Ii+bi*bi+se*se;ce>1e-32&&(ce=1/Math.sqrt(ce)),di*=ce,Ii*=ce,bi*=ce,se*=ce;let be=di,xe=Ii,ye=bi,Ni=se,Ji=2*be,Ui=2*xe,oe=2*ye,ne=be*Ji,Ki=xe*Ui,ie=ye*oe,Hi=be*Ui,Wi=xe*oe,Pi=be*oe,Ut=Ni*Ji,ri=Ni*Ui,Ct=Ni*oe;T._transform._rotation00=1-Ki-ie,T._transform._rotation01=Hi-Ct,T._transform._rotation02=Pi+ri,T._transform._rotation10=Hi+Ct,T._transform._rotation11=1-ne-ie,T._transform._rotation12=Wi-Ut,T._transform._rotation20=Pi-ri,T._transform._rotation21=Wi+Ut,T._transform._rotation22=1-ne-Ki;let Mi,zi,Ei,ki,Ti,Wt,ut,Vt,Ai;Mi=T._transform._rotation00*T._invLocalInertia00+T._transform._rotation01*T._invLocalInertia10+T._transform._rotation02*T._invLocalInertia20,zi=T._transform._rotation00*T._invLocalInertia01+T._transform._rotation01*T._invLocalInertia11+T._transform._rotation02*T._invLocalInertia21,Ei=T._transform._rotation00*T._invLocalInertia02+T._transform._rotation01*T._invLocalInertia12+T._transform._rotation02*T._invLocalInertia22,ki=T._transform._rotation10*T._invLocalInertia00+T._transform._rotation11*T._invLocalInertia10+T._transform._rotation12*T._invLocalInertia20,Ti=T._transform._rotation10*T._invLocalInertia01+T._transform._rotation11*T._invLocalInertia11+T._transform._rotation12*T._invLocalInertia21,Wt=T._transform._rotation10*T._invLocalInertia02+T._transform._rotation11*T._invLocalInertia12+T._transform._rotation12*T._invLocalInertia22,ut=T._transform._rotation20*T._invLocalInertia00+T._transform._rotation21*T._invLocalInertia10+T._transform._rotation22*T._invLocalInertia20,Vt=T._transform._rotation20*T._invLocalInertia01+T._transform._rotation21*T._invLocalInertia11+T._transform._rotation22*T._invLocalInertia21,Ai=T._transform._rotation20*T._invLocalInertia02+T._transform._rotation21*T._invLocalInertia12+T._transform._rotation22*T._invLocalInertia22,T._invInertia00=Mi,T._invInertia01=zi,T._invInertia02=Ei,T._invInertia10=ki,T._invInertia11=Ti,T._invInertia12=Wt,T._invInertia20=ut,T._invInertia21=Vt,T._invInertia22=Ai;let Vi,Fi,$i,ae,re,pe,ti,qi,vi;Vi=T._invInertia00*T._transform._rotation00+T._invInertia01*T._transform._rotation01+T._invInertia02*T._transform._rotation02,Fi=T._invInertia00*T._transform._rotation10+T._invInertia01*T._transform._rotation11+T._invInertia02*T._transform._rotation12,$i=T._invInertia00*T._transform._rotation20+T._invInertia01*T._transform._rotation21+T._invInertia02*T._transform._rotation22,ae=T._invInertia10*T._transform._rotation00+T._invInertia11*T._transform._rotation01+T._invInertia12*T._transform._rotation02,re=T._invInertia10*T._transform._rotation10+T._invInertia11*T._transform._rotation11+T._invInertia12*T._transform._rotation12,pe=T._invInertia10*T._transform._rotation20+T._invInertia11*T._transform._rotation21+T._invInertia12*T._transform._rotation22,ti=T._invInertia20*T._transform._rotation00+T._invInertia21*T._transform._rotation01+T._invInertia22*T._transform._rotation02,qi=T._invInertia20*T._transform._rotation10+T._invInertia21*T._transform._rotation11+T._invInertia22*T._transform._rotation12,vi=T._invInertia20*T._transform._rotation20+T._invInertia21*T._transform._rotation21+T._invInertia22*T._transform._rotation22,T._invInertia00=Vi,T._invInertia01=Fi,T._invInertia02=$i,T._invInertia10=ae,T._invInertia11=re,T._invInertia12=pe,T._invInertia20=ti,T._invInertia21=qi,T._invInertia22=vi,T._invInertia00*=T._rotFactor.x,T._invInertia01*=T._rotFactor.x,T._invInertia02*=T._rotFactor.x,T._invInertia10*=T._rotFactor.y,T._invInertia11*=T._rotFactor.y,T._invInertia12*=T._rotFactor.y,T._invInertia20*=T._rotFactor.z,T._invInertia21*=T._rotFactor.z,T._invInertia22*=T._rotFactor.z}postSolve(){let t,i,s,o,n,l,_,r,e;t=0,i=0,s=0,o=0,n=0,l=0,_=0,r=0,e=0;let a=0,h=this.info.numRows;for(;a<h;){let b=this.info.rows[a++],X=b.impulse,c=b.jacobianN,Y=b.jacobianT,p=b.jacobianB,x=X.impulseN,v=X.impulseT,f=X.impulseB,Z,k,g;Z=0,k=0,g=0,Z+=Y.lin1X*v,k+=Y.lin1Y*v,g+=Y.lin1Z*v,Z+=p.lin1X*f,k+=p.lin1Y*f,g+=p.lin1Z*f,X.impulseLX=Z,X.impulseLY=k,X.impulseLZ=g,t+=c.lin1X*x,i+=c.lin1Y*x,s+=c.lin1Z*x,o+=c.ang1X*x,n+=c.ang1Y*x,l+=c.ang1Z*x,_+=c.ang2X*x,r+=c.ang2Y*x,e+=c.ang2Z*x,t+=Y.lin1X*v,i+=Y.lin1Y*v,s+=Y.lin1Z*v,o+=Y.ang1X*v,n+=Y.ang1Y*v,l+=Y.ang1Z*v,_+=Y.ang2X*v,r+=Y.ang2Y*v,e+=Y.ang2Z*v,t+=p.lin1X*f,i+=p.lin1Y*f,s+=p.lin1Z*f,o+=p.ang1X*f,n+=p.ang1Y*f,l+=p.ang1Z*f,_+=p.ang2X*f,r+=p.ang2Y*f,e+=p.ang2Z*f}this._b1._linearContactImpulseX+=t,this._b1._linearContactImpulseY+=i,this._b1._linearContactImpulseZ+=s,this._b1._angularContactImpulseX+=o,this._b1._angularContactImpulseY+=n,this._b1._angularContactImpulseZ+=l,this._b2._linearContactImpulseX-=t,this._b2._linearContactImpulseY-=i,this._b2._linearContactImpulseZ-=s,this._b2._angularContactImpulseX-=_,this._b2._angularContactImpulseY-=r,this._b2._angularContactImpulseZ-=e,this.constraint._syncManifold()}};m.dynamics.constraint.solver.pgs.PgsJointConstraintSolver=class extends m.dynamics.constraint.ConstraintSolver{constructor(t){super(),this.joint=t,this.info=new m.dynamics.constraint.info.joint.JointSolverInfo,this.massData=new Array(m.common.Setting.maxJacobianRows);let i=0,s=this.massData.length;for(;i<s;)this.massData[i++]=new m.dynamics.constraint.solver.common.JointSolverMassDataRow}preSolveVelocity(t){this.joint._syncAnchors(),this.joint._getVelocitySolverInfo(t,this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k;o=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,_=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,Y=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,Z=this._b2._invInertia21,k=this._b2._invInertia22;let g=0,I=this.info.numRows;for(;g<I;){let z=g++,d=this.info.rows[z],u=this.massData[z],B=d.jacobian;if(B.updateSparsity(),B.flag&1?(u.invMLin1X=B.lin1X*i,u.invMLin1Y=B.lin1Y*i,u.invMLin1Z=B.lin1Z*i,u.invMLin2X=B.lin2X*s,u.invMLin2Y=B.lin2Y*s,u.invMLin2Z=B.lin2Z*s):(u.invMLin1X=0,u.invMLin1Y=0,u.invMLin1Z=0,u.invMLin2X=0,u.invMLin2Y=0,u.invMLin2Z=0),B.flag&2){let j,L,V;j=o*B.ang1X+n*B.ang1Y+l*B.ang1Z,L=_*B.ang1X+r*B.ang1Y+e*B.ang1Z,V=a*B.ang1X+h*B.ang1Y+b*B.ang1Z,u.invMAng1X=j,u.invMAng1Y=L,u.invMAng1Z=V;let M,w,P;M=X*B.ang2X+c*B.ang2Y+Y*B.ang2Z,w=p*B.ang2X+x*B.ang2Y+v*B.ang2Z,P=f*B.ang2X+Z*B.ang2Y+k*B.ang2Z,u.invMAng2X=M,u.invMAng2Y=w,u.invMAng2Z=P}else u.invMAng1X=0,u.invMAng1Y=0,u.invMAng1Z=0,u.invMAng2X=0,u.invMAng2Y=0,u.invMAng2Z=0;u.massWithoutCfm=u.invMLin1X*B.lin1X+u.invMLin1Y*B.lin1Y+u.invMLin1Z*B.lin1Z+(u.invMLin2X*B.lin2X+u.invMLin2Y*B.lin2Y+u.invMLin2Z*B.lin2Z)+(u.invMAng1X*B.ang1X+u.invMAng1Y*B.ang1Y+u.invMAng1Z*B.ang1Z)+(u.invMAng2X*B.ang2X+u.invMAng2Y*B.ang2Y+u.invMAng2Z*B.ang2Z),u.mass=u.massWithoutCfm+d.cfm,u.massWithoutCfm!=0&&(u.massWithoutCfm=1/u.massWithoutCfm),u.mass!=0&&(u.mass=1/u.mass)}}warmStart(t){let i=this.joint._positionCorrectionAlgorithm==m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE?m.common.Setting.jointWarmStartingFactorForBaungarte:m.common.Setting.jointWarmStartingFactor;if(i*=t.dtRatio,i<=0){let x=0,v=this.info.numRows;for(;x<v;){let f=this.info.rows[x++].impulse;f.impulse=0,f.impulseM=0,f.impulseP=0}return}let s,o,n,l,_,r,e,a,h,b,X,c;s=this._b1._velX,o=this._b1._velY,n=this._b1._velZ,l=this._b2._velX,_=this._b2._velY,r=this._b2._velZ,e=this._b1._angVelX,a=this._b1._angVelY,h=this._b1._angVelZ,b=this._b2._angVelX,X=this._b2._angVelY,c=this._b2._angVelZ;let Y=0,p=this.info.numRows;for(;Y<p;){let x=Y++,v=this.massData[x],f=this.info.rows[x].impulse;f.impulse*=i,f.impulseM*=i;let Z=f.impulse+f.impulseM;s+=v.invMLin1X*Z,o+=v.invMLin1Y*Z,n+=v.invMLin1Z*Z,l+=v.invMLin2X*-Z,_+=v.invMLin2Y*-Z,r+=v.invMLin2Z*-Z,e+=v.invMAng1X*Z,a+=v.invMAng1Y*Z,h+=v.invMAng1Z*Z,b+=v.invMAng2X*-Z,X+=v.invMAng2Y*-Z,c+=v.invMAng2Z*-Z}this._b1._velX=s,this._b1._velY=o,this._b1._velZ=n,this._b2._velX=l,this._b2._velY=_,this._b2._velZ=r,this._b1._angVelX=e,this._b1._angVelY=a,this._b1._angVelZ=h,this._b2._angVelX=b,this._b2._angVelY=X,this._b2._angVelZ=c}solveVelocity(){let t,i,s,o,n,l,_,r,e,a,h,b;t=this._b1._velX,i=this._b1._velY,s=this._b1._velZ,o=this._b2._velX,n=this._b2._velY,l=this._b2._velZ,_=this._b1._angVelX,r=this._b1._angVelY,e=this._b1._angVelZ,a=this._b2._angVelX,h=this._b2._angVelY,b=this._b2._angVelZ;let X=0,c=this.info.numRows;for(;X<c;){let x=X++,v=this.info.rows[x],f=this.massData[x],Z=v.impulse,k=v.jacobian;if(v.motorMaxImpulse==0)continue;let g=0;g+=t*k.lin1X+i*k.lin1Y+s*k.lin1Z,g-=o*k.lin2X+n*k.lin2Y+l*k.lin2Z,g+=_*k.ang1X+r*k.ang1Y+e*k.ang1Z,g-=a*k.ang2X+h*k.ang2Y+b*k.ang2Z;let I=(-v.motorSpeed-g)*f.massWithoutCfm,z=Z.impulseM;Z.impulseM+=I,Z.impulseM<-v.motorMaxImpulse?Z.impulseM=-v.motorMaxImpulse:Z.impulseM>v.motorMaxImpulse&&(Z.impulseM=v.motorMaxImpulse),I=Z.impulseM-z,k.flag&1&&(t+=f.invMLin1X*I,i+=f.invMLin1Y*I,s+=f.invMLin1Z*I,o+=f.invMLin2X*-I,n+=f.invMLin2Y*-I,l+=f.invMLin2Z*-I),k.flag&2&&(_+=f.invMAng1X*I,r+=f.invMAng1Y*I,e+=f.invMAng1Z*I,a+=f.invMAng2X*-I,h+=f.invMAng2Y*-I,b+=f.invMAng2Z*-I)}let Y=0,p=this.info.numRows;for(;Y<p;){let x=Y++,v=this.info.rows[x],f=this.massData[x],Z=v.impulse,k=v.jacobian,g=0;g+=t*k.lin1X+i*k.lin1Y+s*k.lin1Z,g-=o*k.lin2X+n*k.lin2Y+l*k.lin2Z,g+=_*k.ang1X+r*k.ang1Y+e*k.ang1Z,g-=a*k.ang2X+h*k.ang2Y+b*k.ang2Z;let I=(v.rhs-g-Z.impulse*v.cfm)*f.mass,z=Z.impulse;Z.impulse+=I,Z.impulse<v.minImpulse?Z.impulse=v.minImpulse:Z.impulse>v.maxImpulse&&(Z.impulse=v.maxImpulse),I=Z.impulse-z,k.flag&1&&(t+=f.invMLin1X*I,i+=f.invMLin1Y*I,s+=f.invMLin1Z*I,o+=f.invMLin2X*-I,n+=f.invMLin2Y*-I,l+=f.invMLin2Z*-I),k.flag&2&&(_+=f.invMAng1X*I,r+=f.invMAng1Y*I,e+=f.invMAng1Z*I,a+=f.invMAng2X*-I,h+=f.invMAng2Y*-I,b+=f.invMAng2Z*-I)}this._b1._velX=t,this._b1._velY=i,this._b1._velZ=s,this._b2._velX=o,this._b2._velY=n,this._b2._velZ=l,this._b1._angVelX=_,this._b1._angVelY=r,this._b1._angVelZ=e,this._b2._angVelX=a,this._b2._angVelY=h,this._b2._angVelZ=b}postSolveVelocity(t){let i,s,o,n,l,_;i=0,s=0,o=0,n=0,l=0,_=0;let r=0,e=this.info.numRows;for(;r<e;){let a=this.info.rows[r++],h=a.impulse,b=a.jacobian;b.flag&1?(i+=b.lin1X*h.impulse,s+=b.lin1Y*h.impulse,o+=b.lin1Z*h.impulse):b.flag&2&&(n+=b.ang1X*h.impulse,l+=b.ang1Y*h.impulse,_+=b.ang1Z*h.impulse)}this.joint._appliedForceX=i*t.invDt,this.joint._appliedForceY=s*t.invDt,this.joint._appliedForceZ=o*t.invDt,this.joint._appliedTorqueX=n*t.invDt,this.joint._appliedTorqueY=l*t.invDt,this.joint._appliedTorqueZ=_*t.invDt}preSolvePosition(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k;o=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,_=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,Y=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,Z=this._b2._invInertia21,k=this._b2._invInertia22;let g=0,I=this.info.numRows;for(;g<I;){let u=g++,B=this.massData[u],j=this.info.rows[u].jacobian;B.invMLin1X=j.lin1X*i,B.invMLin1Y=j.lin1Y*i,B.invMLin1Z=j.lin1Z*i,B.invMLin2X=j.lin2X*s,B.invMLin2Y=j.lin2Y*s,B.invMLin2Z=j.lin2Z*s;let L,V,M;L=o*j.ang1X+n*j.ang1Y+l*j.ang1Z,V=_*j.ang1X+r*j.ang1Y+e*j.ang1Z,M=a*j.ang1X+h*j.ang1Y+b*j.ang1Z,B.invMAng1X=L,B.invMAng1Y=V,B.invMAng1Z=M;let w,P,E;w=X*j.ang2X+c*j.ang2Y+Y*j.ang2Z,P=p*j.ang2X+x*j.ang2Y+v*j.ang2Z,E=f*j.ang2X+Z*j.ang2Y+k*j.ang2Z,B.invMAng2X=w,B.invMAng2Y=P,B.invMAng2Z=E,B.mass=B.invMLin1X*j.lin1X+B.invMLin1Y*j.lin1Y+B.invMLin1Z*j.lin1Z+(B.invMLin2X*j.lin2X+B.invMLin2Y*j.lin2Y+B.invMLin2Z*j.lin2Z)+(B.invMAng1X*j.ang1X+B.invMAng1Y*j.ang1Y+B.invMAng1Z*j.ang1Z)+(B.invMAng2X*j.ang2X+B.invMAng2Y*j.ang2Y+B.invMAng2Z*j.ang2Z),B.mass!=0&&(B.mass=1/B.mass)}let z=0,d=this.info.numRows;for(;z<d;)this.info.rows[z++].impulse.impulseP=0}solvePositionSplitImpulse(){let t,i,s,o,n,l,_,r,e,a,h,b;t=this._b1._pseudoVelX,i=this._b1._pseudoVelY,s=this._b1._pseudoVelZ,o=this._b2._pseudoVelX,n=this._b2._pseudoVelY,l=this._b2._pseudoVelZ,_=this._b1._angPseudoVelX,r=this._b1._angPseudoVelY,e=this._b1._angPseudoVelZ,a=this._b2._angPseudoVelX,h=this._b2._angPseudoVelY,b=this._b2._angPseudoVelZ;let X=0,c=this.info.numRows;for(;X<c;){let Y=X++,p=this.info.rows[Y],x=this.massData[Y],v=p.impulse,f=p.jacobian,Z=0;Z+=t*f.lin1X+i*f.lin1Y+s*f.lin1Z,Z-=o*f.lin2X+n*f.lin2Y+l*f.lin2Z,Z+=_*f.ang1X+r*f.ang1Y+e*f.ang1Z,Z-=a*f.ang2X+h*f.ang2Y+b*f.ang2Z;let k=(p.rhs*m.common.Setting.positionSplitImpulseBaumgarte-Z)*x.mass,g=v.impulseP;v.impulseP+=k,v.impulseP<p.minImpulse?v.impulseP=p.minImpulse:v.impulseP>p.maxImpulse&&(v.impulseP=p.maxImpulse),k=v.impulseP-g,t+=x.invMLin1X*k,i+=x.invMLin1Y*k,s+=x.invMLin1Z*k,o+=x.invMLin2X*-k,n+=x.invMLin2Y*-k,l+=x.invMLin2Z*-k,_+=x.invMAng1X*k,r+=x.invMAng1Y*k,e+=x.invMAng1Z*k,a+=x.invMAng2X*-k,h+=x.invMAng2Y*-k,b+=x.invMAng2Z*-k}this._b1._pseudoVelX=t,this._b1._pseudoVelY=i,this._b1._pseudoVelZ=s,this._b2._pseudoVelX=o,this._b2._pseudoVelY=n,this._b2._pseudoVelZ=l,this._b1._angPseudoVelX=_,this._b1._angPseudoVelY=r,this._b1._angPseudoVelZ=e,this._b2._angPseudoVelX=a,this._b2._angPseudoVelY=h,this._b2._angPseudoVelZ=b}solvePositionNgs(t){this.joint._syncAnchors(),this.joint._getPositionSolverInfo(this.info),this._b1=this.info.b1,this._b2=this.info.b2;let i=this._b1._invMass,s=this._b2._invMass,o,n,l,_,r,e,a,h,b,X,c,Y,p,x,v,f,Z,k;o=this._b1._invInertia00,n=this._b1._invInertia01,l=this._b1._invInertia02,_=this._b1._invInertia10,r=this._b1._invInertia11,e=this._b1._invInertia12,a=this._b1._invInertia20,h=this._b1._invInertia21,b=this._b1._invInertia22,X=this._b2._invInertia00,c=this._b2._invInertia01,Y=this._b2._invInertia02,p=this._b2._invInertia10,x=this._b2._invInertia11,v=this._b2._invInertia12,f=this._b2._invInertia20,Z=this._b2._invInertia21,k=this._b2._invInertia22;let g=0,I=this.info.numRows;for(;g<I;){let Ci=g++,mi=this.massData[Ci],St=this.info.rows[Ci].jacobian;mi.invMLin1X=St.lin1X*i,mi.invMLin1Y=St.lin1Y*i,mi.invMLin1Z=St.lin1Z*i,mi.invMLin2X=St.lin2X*s,mi.invMLin2Y=St.lin2Y*s,mi.invMLin2Z=St.lin2Z*s;let Tt,hi,Rt;Tt=o*St.ang1X+n*St.ang1Y+l*St.ang1Z,hi=_*St.ang1X+r*St.ang1Y+e*St.ang1Z,Rt=a*St.ang1X+h*St.ang1Y+b*St.ang1Z,mi.invMAng1X=Tt,mi.invMAng1Y=hi,mi.invMAng1Z=Rt;let mt,gt,Ft;mt=X*St.ang2X+c*St.ang2Y+Y*St.ang2Z,gt=p*St.ang2X+x*St.ang2Y+v*St.ang2Z,Ft=f*St.ang2X+Z*St.ang2Y+k*St.ang2Z,mi.invMAng2X=mt,mi.invMAng2Y=gt,mi.invMAng2Z=Ft,mi.mass=mi.invMLin1X*St.lin1X+mi.invMLin1Y*St.lin1Y+mi.invMLin1Z*St.lin1Z+(mi.invMLin2X*St.lin2X+mi.invMLin2Y*St.lin2Y+mi.invMLin2Z*St.lin2Z)+(mi.invMAng1X*St.ang1X+mi.invMAng1Y*St.ang1Y+mi.invMAng1Z*St.ang1Z)+(mi.invMAng2X*St.ang2X+mi.invMAng2Y*St.ang2Y+mi.invMAng2Z*St.ang2Z),mi.mass!=0&&(mi.mass=1/mi.mass)}let z,d,u,B,j,L,V,M,w,P,E,C;z=0,d=0,u=0,B=0,j=0,L=0,V=0,M=0,w=0,P=0,E=0,C=0;let S=0,A=this.info.numRows;for(;S<A;){let Ci=S++,mi=this.info.rows[Ci],St=this.massData[Ci],Tt=mi.impulse,hi=mi.jacobian,Rt=0;Rt+=z*hi.lin1X+d*hi.lin1Y+u*hi.lin1Z,Rt-=B*hi.lin2X+j*hi.lin2Y+L*hi.lin2Z,Rt+=V*hi.ang1X+M*hi.ang1Y+w*hi.ang1Z,Rt-=P*hi.ang2X+E*hi.ang2Y+C*hi.ang2Z;let mt=(mi.rhs*m.common.Setting.positionNgsBaumgarte-Rt)*St.mass,gt=Tt.impulseP;Tt.impulseP+=mt,Tt.impulseP<mi.minImpulse?Tt.impulseP=mi.minImpulse:Tt.impulseP>mi.maxImpulse&&(Tt.impulseP=mi.maxImpulse),mt=Tt.impulseP-gt,z+=St.invMLin1X*mt,d+=St.invMLin1Y*mt,u+=St.invMLin1Z*mt,B+=St.invMLin2X*-mt,j+=St.invMLin2Y*-mt,L+=St.invMLin2Z*-mt,V+=St.invMAng1X*mt,M+=St.invMAng1Y*mt,w+=St.invMAng1Z*mt,P+=St.invMAng2X*-mt,E+=St.invMAng2Y*-mt,C+=St.invMAng2Z*-mt}let R=this._b1;R._transform._positionX+=z,R._transform._positionY+=d,R._transform._positionZ+=u;let H=this._b2;H._transform._positionX+=B,H._transform._positionY+=j,H._transform._positionZ+=L;let y=this._b1,D=Math.sqrt(V*V+M*M+w*w),F=D*.5,Q,W;if(F<.5){let Ci=F*F;Q=.5*(1-Ci*.16666666666666666+Ci*Ci*.008333333333333333),W=1-Ci*.5+Ci*Ci*.041666666666666664}else Q=Math.sin(F)/D,W=Math.cos(F);let q,U,G;q=V*Q,U=M*Q,G=w*Q;let J,N,K,O;J=q,N=U,K=G,O=W;let $,et,st,lt,rt=y._transform._rotation00,at=y._transform._rotation11,ot=y._transform._rotation22,ht=rt+at+ot,_t;ht>0?(_t=Math.sqrt(ht+1),lt=.5*_t,_t=.5/_t,$=(y._transform._rotation21-y._transform._rotation12)*_t,et=(y._transform._rotation02-y._transform._rotation20)*_t,st=(y._transform._rotation10-y._transform._rotation01)*_t):rt>at?rt>ot?(_t=Math.sqrt(rt-at-ot+1),$=.5*_t,_t=.5/_t,et=(y._transform._rotation01+y._transform._rotation10)*_t,st=(y._transform._rotation02+y._transform._rotation20)*_t,lt=(y._transform._rotation21-y._transform._rotation12)*_t):(_t=Math.sqrt(ot-rt-at+1),st=.5*_t,_t=.5/_t,$=(y._transform._rotation02+y._transform._rotation20)*_t,et=(y._transform._rotation12+y._transform._rotation21)*_t,lt=(y._transform._rotation10-y._transform._rotation01)*_t):at>ot?(_t=Math.sqrt(at-ot-rt+1),et=.5*_t,_t=.5/_t,$=(y._transform._rotation01+y._transform._rotation10)*_t,st=(y._transform._rotation12+y._transform._rotation21)*_t,lt=(y._transform._rotation02-y._transform._rotation20)*_t):(_t=Math.sqrt(ot-rt-at+1),st=.5*_t,_t=.5/_t,$=(y._transform._rotation02+y._transform._rotation20)*_t,et=(y._transform._rotation12+y._transform._rotation21)*_t,lt=(y._transform._rotation10-y._transform._rotation01)*_t),$=O*$+J*lt+N*st-K*et,et=O*et-J*st+N*lt+K*$,st=O*st+J*et-N*$+K*lt,lt=O*lt-J*$-N*et-K*st;let bt=$*$+et*et+st*st+lt*lt;bt>1e-32&&(bt=1/Math.sqrt(bt)),$*=bt,et*=bt,st*=bt,lt*=bt;let Xt=$,ft=et,Zt=st,xt=lt,zt=2*Xt,Yt=2*ft,pt=2*Zt,ct=Xt*zt,nt=ft*Yt,tt=Zt*pt,Lt=Xt*Yt,Bt=ft*pt,Mt=Xt*pt,jt=xt*zt,ci=xt*Yt,Xi=xt*pt;y._transform._rotation00=1-nt-tt,y._transform._rotation01=Lt-Xi,y._transform._rotation02=Mt+ci,y._transform._rotation10=Lt+Xi,y._transform._rotation11=1-ct-tt,y._transform._rotation12=Bt-jt,y._transform._rotation20=Mt-ci,y._transform._rotation21=Bt+jt,y._transform._rotation22=1-ct-nt;let Yi,Li,wi,ei,qt,At,ni,ui,Oi;Yi=y._transform._rotation00*y._invLocalInertia00+y._transform._rotation01*y._invLocalInertia10+y._transform._rotation02*y._invLocalInertia20,Li=y._transform._rotation00*y._invLocalInertia01+y._transform._rotation01*y._invLocalInertia11+y._transform._rotation02*y._invLocalInertia21,wi=y._transform._rotation00*y._invLocalInertia02+y._transform._rotation01*y._invLocalInertia12+y._transform._rotation02*y._invLocalInertia22,ei=y._transform._rotation10*y._invLocalInertia00+y._transform._rotation11*y._invLocalInertia10+y._transform._rotation12*y._invLocalInertia20,qt=y._transform._rotation10*y._invLocalInertia01+y._transform._rotation11*y._invLocalInertia11+y._transform._rotation12*y._invLocalInertia21,At=y._transform._rotation10*y._invLocalInertia02+y._transform._rotation11*y._invLocalInertia12+y._transform._rotation12*y._invLocalInertia22,ni=y._transform._rotation20*y._invLocalInertia00+y._transform._rotation21*y._invLocalInertia10+y._transform._rotation22*y._invLocalInertia20,ui=y._transform._rotation20*y._invLocalInertia01+y._transform._rotation21*y._invLocalInertia11+y._transform._rotation22*y._invLocalInertia21,Oi=y._transform._rotation20*y._invLocalInertia02+y._transform._rotation21*y._invLocalInertia12+y._transform._rotation22*y._invLocalInertia22,y._invInertia00=Yi,y._invInertia01=Li,y._invInertia02=wi,y._invInertia10=ei,y._invInertia11=qt,y._invInertia12=At,y._invInertia20=ni,y._invInertia21=ui,y._invInertia22=Oi;let Bi,kt,wt,$t,fi,gi,it,Ht,ii;Bi=y._invInertia00*y._transform._rotation00+y._invInertia01*y._transform._rotation01+y._invInertia02*y._transform._rotation02,kt=y._invInertia00*y._transform._rotation10+y._invInertia01*y._transform._rotation11+y._invInertia02*y._transform._rotation12,wt=y._invInertia00*y._transform._rotation20+y._invInertia01*y._transform._rotation21+y._invInertia02*y._transform._rotation22,$t=y._invInertia10*y._transform._rotation00+y._invInertia11*y._transform._rotation01+y._invInertia12*y._transform._rotation02,fi=y._invInertia10*y._transform._rotation10+y._invInertia11*y._transform._rotation11+y._invInertia12*y._transform._rotation12,gi=y._invInertia10*y._transform._rotation20+y._invInertia11*y._transform._rotation21+y._invInertia12*y._transform._rotation22,it=y._invInertia20*y._transform._rotation00+y._invInertia21*y._transform._rotation01+y._invInertia22*y._transform._rotation02,Ht=y._invInertia20*y._transform._rotation10+y._invInertia21*y._transform._rotation11+y._invInertia22*y._transform._rotation12,ii=y._invInertia20*y._transform._rotation20+y._invInertia21*y._transform._rotation21+y._invInertia22*y._transform._rotation22,y._invInertia00=Bi,y._invInertia01=kt,y._invInertia02=wt,y._invInertia10=$t,y._invInertia11=fi,y._invInertia12=gi,y._invInertia20=it,y._invInertia21=Ht,y._invInertia22=ii,y._invInertia00*=y._rotFactor.x,y._invInertia01*=y._rotFactor.x,y._invInertia02*=y._rotFactor.x,y._invInertia10*=y._rotFactor.y,y._invInertia11*=y._rotFactor.y,y._invInertia12*=y._rotFactor.y,y._invInertia20*=y._rotFactor.z,y._invInertia21*=y._rotFactor.z,y._invInertia22*=y._rotFactor.z;let T=this._b2,Gt=Math.sqrt(P*P+E*E+C*C),Et=Gt*.5,si,oi;if(Et<.5){let Ci=Et*Et;si=.5*(1-Ci*.16666666666666666+Ci*Ci*.008333333333333333),oi=1-Ci*.5+Ci*Ci*.041666666666666664}else si=Math.sin(Et)/Gt,oi=Math.cos(Et);let Pt,ai,Ri;Pt=P*si,ai=E*si,Ri=C*si;let Zi,yt,dt,vt;Zi=Pt,yt=ai,dt=Ri,vt=oi;let di,Ii,bi,se,me=T._transform._rotation00,Di=T._transform._rotation11,he=T._transform._rotation22,ve=me+Di+he,_i;ve>0?(_i=Math.sqrt(ve+1),se=.5*_i,_i=.5/_i,di=(T._transform._rotation21-T._transform._rotation12)*_i,Ii=(T._transform._rotation02-T._transform._rotation20)*_i,bi=(T._transform._rotation10-T._transform._rotation01)*_i):me>Di?me>he?(_i=Math.sqrt(me-Di-he+1),di=.5*_i,_i=.5/_i,Ii=(T._transform._rotation01+T._transform._rotation10)*_i,bi=(T._transform._rotation02+T._transform._rotation20)*_i,se=(T._transform._rotation21-T._transform._rotation12)*_i):(_i=Math.sqrt(he-me-Di+1),bi=.5*_i,_i=.5/_i,di=(T._transform._rotation02+T._transform._rotation20)*_i,Ii=(T._transform._rotation12+T._transform._rotation21)*_i,se=(T._transform._rotation10-T._transform._rotation01)*_i):Di>he?(_i=Math.sqrt(Di-he-me+1),Ii=.5*_i,_i=.5/_i,di=(T._transform._rotation01+T._transform._rotation10)*_i,bi=(T._transform._rotation12+T._transform._rotation21)*_i,se=(T._transform._rotation02-T._transform._rotation20)*_i):(_i=Math.sqrt(he-me-Di+1),bi=.5*_i,_i=.5/_i,di=(T._transform._rotation02+T._transform._rotation20)*_i,Ii=(T._transform._rotation12+T._transform._rotation21)*_i,se=(T._transform._rotation10-T._transform._rotation01)*_i),di=vt*di+Zi*se+yt*bi-dt*Ii,Ii=vt*Ii-Zi*bi+yt*se+dt*di,bi=vt*bi+Zi*Ii-yt*di+dt*se,se=vt*se-Zi*di-yt*Ii-dt*bi;let ce=di*di+Ii*Ii+bi*bi+se*se;ce>1e-32&&(ce=1/Math.sqrt(ce)),di*=ce,Ii*=ce,bi*=ce,se*=ce;let be=di,xe=Ii,ye=bi,Ni=se,Ji=2*be,Ui=2*xe,oe=2*ye,ne=be*Ji,Ki=xe*Ui,ie=ye*oe,Hi=be*Ui,Wi=xe*oe,Pi=be*oe,Ut=Ni*Ji,ri=Ni*Ui,Ct=Ni*oe;T._transform._rotation00=1-Ki-ie,T._transform._rotation01=Hi-Ct,T._transform._rotation02=Pi+ri,T._transform._rotation10=Hi+Ct,T._transform._rotation11=1-ne-ie,T._transform._rotation12=Wi-Ut,T._transform._rotation20=Pi-ri,T._transform._rotation21=Wi+Ut,T._transform._rotation22=1-ne-Ki;let Mi,zi,Ei,ki,Ti,Wt,ut,Vt,Ai;Mi=T._transform._rotation00*T._invLocalInertia00+T._transform._rotation01*T._invLocalInertia10+T._transform._rotation02*T._invLocalInertia20,zi=T._transform._rotation00*T._invLocalInertia01+T._transform._rotation01*T._invLocalInertia11+T._transform._rotation02*T._invLocalInertia21,Ei=T._transform._rotation00*T._invLocalInertia02+T._transform._rotation01*T._invLocalInertia12+T._transform._rotation02*T._invLocalInertia22,ki=T._transform._rotation10*T._invLocalInertia00+T._transform._rotation11*T._invLocalInertia10+T._transform._rotation12*T._invLocalInertia20,Ti=T._transform._rotation10*T._invLocalInertia01+T._transform._rotation11*T._invLocalInertia11+T._transform._rotation12*T._invLocalInertia21,Wt=T._transform._rotation10*T._invLocalInertia02+T._transform._rotation11*T._invLocalInertia12+T._transform._rotation12*T._invLocalInertia22,ut=T._transform._rotation20*T._invLocalInertia00+T._transform._rotation21*T._invLocalInertia10+T._transform._rotation22*T._invLocalInertia20,Vt=T._transform._rotation20*T._invLocalInertia01+T._transform._rotation21*T._invLocalInertia11+T._transform._rotation22*T._invLocalInertia21,Ai=T._transform._rotation20*T._invLocalInertia02+T._transform._rotation21*T._invLocalInertia12+T._transform._rotation22*T._invLocalInertia22,T._invInertia00=Mi,T._invInertia01=zi,T._invInertia02=Ei,T._invInertia10=ki,T._invInertia11=Ti,T._invInertia12=Wt,T._invInertia20=ut,T._invInertia21=Vt,T._invInertia22=Ai;let Vi,Fi,$i,ae,re,pe,ti,qi,vi;Vi=T._invInertia00*T._transform._rotation00+T._invInertia01*T._transform._rotation01+T._invInertia02*T._transform._rotation02,Fi=T._invInertia00*T._transform._rotation10+T._invInertia01*T._transform._rotation11+T._invInertia02*T._transform._rotation12,$i=T._invInertia00*T._transform._rotation20+T._invInertia01*T._transform._rotation21+T._invInertia02*T._transform._rotation22,ae=T._invInertia10*T._transform._rotation00+T._invInertia11*T._transform._rotation01+T._invInertia12*T._transform._rotation02,re=T._invInertia10*T._transform._rotation10+T._invInertia11*T._transform._rotation11+T._invInertia12*T._transform._rotation12,pe=T._invInertia10*T._transform._rotation20+T._invInertia11*T._transform._rotation21+T._invInertia12*T._transform._rotation22,ti=T._invInertia20*T._transform._rotation00+T._invInertia21*T._transform._rotation01+T._invInertia22*T._transform._rotation02,qi=T._invInertia20*T._transform._rotation10+T._invInertia21*T._transform._rotation11+T._invInertia22*T._transform._rotation12,vi=T._invInertia20*T._transform._rotation20+T._invInertia21*T._transform._rotation21+T._invInertia22*T._transform._rotation22,T._invInertia00=Vi,T._invInertia01=Fi,T._invInertia02=$i,T._invInertia10=ae,T._invInertia11=re,T._invInertia12=pe,T._invInertia20=ti,T._invInertia21=qi,T._invInertia22=vi,T._invInertia00*=T._rotFactor.x,T._invInertia01*=T._rotFactor.x,T._invInertia02*=T._rotFactor.x,T._invInertia10*=T._rotFactor.y,T._invInertia11*=T._rotFactor.y,T._invInertia12*=T._rotFactor.y,T._invInertia20*=T._rotFactor.z,T._invInertia21*=T._rotFactor.z,T._invInertia22*=T._rotFactor.z}postSolve(){this.joint._syncAnchors(),this.joint._checkDestruction()}};m.dynamics.rigidbody||(m.dynamics.rigidbody={});m.dynamics.rigidbody.MassData=class{constructor(){this.mass=0,this.localInertia=new m.common.Mat3}};m.dynamics.rigidbody.RigidBody=class{constructor(t){this._next=null,this._prev=null,this._shapeList=null,this._shapeListLast=null,this._numShapes=0,this._contactLinkList=null,this._contactLinkListLast=null,this._numContactLinks=0,this._jointLinkList=null,this._jointLinkListLast=null,this._numJointLinks=0;let i=t.linearVelocity;this._velX=i.x,this._velY=i.y,this._velZ=i.z;let s=t.angularVelocity;this._angVelX=s.x,this._angVelY=s.y,this._angVelZ=s.z,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._ptransform=new m.common.Transform,this._transform=new m.common.Transform;let o=t.position;this._ptransform._positionX=o.x,this._ptransform._positionY=o.y,this._ptransform._positionZ=o.z;let n=t.rotation;this._ptransform._rotation00=n.e00,this._ptransform._rotation01=n.e01,this._ptransform._rotation02=n.e02,this._ptransform._rotation10=n.e10,this._ptransform._rotation11=n.e11,this._ptransform._rotation12=n.e12,this._ptransform._rotation20=n.e20,this._ptransform._rotation21=n.e21,this._ptransform._rotation22=n.e22;let l=this._transform,_=this._ptransform;l._positionX=_._positionX,l._positionY=_._positionY,l._positionZ=_._positionZ,l._rotation00=_._rotation00,l._rotation01=_._rotation01,l._rotation02=_._rotation02,l._rotation10=_._rotation10,l._rotation11=_._rotation11,l._rotation12=_._rotation12,l._rotation20=_._rotation20,l._rotation21=_._rotation21,l._rotation22=_._rotation22,this._type=t.type,this._sleepTime=0,this._sleeping=!1,this._autoSleep=t.autoSleep,this._mass=0,this._invMass=0,this._localInertia00=0,this._localInertia01=0,this._localInertia02=0,this._localInertia10=0,this._localInertia11=0,this._localInertia12=0,this._localInertia20=0,this._localInertia21=0,this._localInertia22=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._invInertia00=0,this._invInertia01=0,this._invInertia02=0,this._invInertia10=0,this._invInertia11=0,this._invInertia12=0,this._invInertia20=0,this._invInertia21=0,this._invInertia22=0,this._linearDamping=t.linearDamping,this._angularDamping=t.angularDamping,this._forceX=0,this._forceY=0,this._forceZ=0,this._torqueX=0,this._torqueY=0,this._torqueZ=0,this._linearContactImpulseX=0,this._linearContactImpulseY=0,this._linearContactImpulseZ=0,this._angularContactImpulseX=0,this._angularContactImpulseY=0,this._angularContactImpulseZ=0,this._rotFactor=new m.common.Vec3(1,1,1),this._addedToIsland=!1,this._gravityScale=1,this._world=null}_integrate(t){switch(this._type){case 1:this._velX=0,this._velY=0,this._velZ=0,this._angVelX=0,this._angVelY=0,this._angVelZ=0,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let i,s,o,n,l,_;i=this._velX*t,s=this._velY*t,o=this._velZ*t,n=this._angVelX*t,l=this._angVelY*t,_=this._angVelZ*t;let r=i*i+s*s+o*o,e=n*n+l*l+_*_;if(r==0&&e==0)return;if(r>m.common.Setting.maxTranslationPerStep*m.common.Setting.maxTranslationPerStep){let xt=m.common.Setting.maxTranslationPerStep/Math.sqrt(r);this._velX*=xt,this._velY*=xt,this._velZ*=xt,i*=xt,s*=xt,o*=xt}if(e>m.common.Setting.maxRotationPerStep*m.common.Setting.maxRotationPerStep){let xt=m.common.Setting.maxRotationPerStep/Math.sqrt(e);this._angVelX*=xt,this._angVelY*=xt,this._angVelZ*=xt,n*=xt,l*=xt,_*=xt}this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=o;let a=Math.sqrt(n*n+l*l+_*_),h=a*.5,b,X;if(h<.5){let xt=h*h;b=.5*(1-xt*.16666666666666666+xt*xt*.008333333333333333),X=1-xt*.5+xt*xt*.041666666666666664}else b=Math.sin(h)/a,X=Math.cos(h);let c,Y,p;c=n*b,Y=l*b,p=_*b;let x,v,f,Z;x=c,v=Y,f=p,Z=X;let k,g,I,z,d=this._transform._rotation00,u=this._transform._rotation11,B=this._transform._rotation22,j=d+u+B,L;j>0?(L=Math.sqrt(j+1),z=.5*L,L=.5/L,k=(this._transform._rotation21-this._transform._rotation12)*L,g=(this._transform._rotation02-this._transform._rotation20)*L,I=(this._transform._rotation10-this._transform._rotation01)*L):d>u?d>B?(L=Math.sqrt(d-u-B+1),k=.5*L,L=.5/L,g=(this._transform._rotation01+this._transform._rotation10)*L,I=(this._transform._rotation02+this._transform._rotation20)*L,z=(this._transform._rotation21-this._transform._rotation12)*L):(L=Math.sqrt(B-d-u+1),I=.5*L,L=.5/L,k=(this._transform._rotation02+this._transform._rotation20)*L,g=(this._transform._rotation12+this._transform._rotation21)*L,z=(this._transform._rotation10-this._transform._rotation01)*L):u>B?(L=Math.sqrt(u-B-d+1),g=.5*L,L=.5/L,k=(this._transform._rotation01+this._transform._rotation10)*L,I=(this._transform._rotation12+this._transform._rotation21)*L,z=(this._transform._rotation02-this._transform._rotation20)*L):(L=Math.sqrt(B-d-u+1),I=.5*L,L=.5/L,k=(this._transform._rotation02+this._transform._rotation20)*L,g=(this._transform._rotation12+this._transform._rotation21)*L,z=(this._transform._rotation10-this._transform._rotation01)*L),k=Z*k+x*z+v*I-f*g,g=Z*g-x*I+v*z+f*k,I=Z*I+x*g-v*k+f*z,z=Z*z-x*k-v*g-f*I;let V=k*k+g*g+I*I+z*z;V>1e-32&&(V=1/Math.sqrt(V)),k*=V,g*=V,I*=V,z*=V;let M=k,w=g,P=I,E=z,C=2*M,S=2*w,A=2*P,R=M*C,H=w*S,y=P*A,D=M*S,F=w*A,Q=M*A,W=E*C,q=E*S,U=E*A;this._transform._rotation00=1-H-y,this._transform._rotation01=D-U,this._transform._rotation02=Q+q,this._transform._rotation10=D+U,this._transform._rotation11=1-R-y,this._transform._rotation12=F-W,this._transform._rotation20=Q-q,this._transform._rotation21=F+W,this._transform._rotation22=1-R-H;let G,J,N,K,O,$,et,st,lt;G=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,J=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,N=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,K=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,O=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,$=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,et=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,st=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,lt=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=G,this._invInertia01=J,this._invInertia02=N,this._invInertia10=K,this._invInertia11=O,this._invInertia12=$,this._invInertia20=et,this._invInertia21=st,this._invInertia22=lt;let rt,at,ot,ht,_t,bt,Xt,ft,Zt;rt=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,at=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,ot=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,ht=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,_t=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,bt=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,Xt=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,ft=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Zt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=rt,this._invInertia01=at,this._invInertia02=ot,this._invInertia10=ht,this._invInertia11=_t,this._invInertia12=bt,this._invInertia20=Xt,this._invInertia21=ft,this._invInertia22=Zt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}_integratePseudoVelocity(){if(!(this._pseudoVelX*this._pseudoVelX+this._pseudoVelY*this._pseudoVelY+this._pseudoVelZ*this._pseudoVelZ==0&&this._angPseudoVelX*this._angPseudoVelX+this._angPseudoVelY*this._angPseudoVelY+this._angPseudoVelZ*this._angPseudoVelZ==0))switch(this._type){case 1:this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0;break;case 0:case 2:let t,i,s,o,n,l;t=this._pseudoVelX,i=this._pseudoVelY,s=this._pseudoVelZ,o=this._angPseudoVelX,n=this._angPseudoVelY,l=this._angPseudoVelZ,this._pseudoVelX=0,this._pseudoVelY=0,this._pseudoVelZ=0,this._angPseudoVelX=0,this._angPseudoVelY=0,this._angPseudoVelZ=0,this._transform._positionX+=t,this._transform._positionY+=i,this._transform._positionZ+=s;let _=Math.sqrt(o*o+n*n+l*l),r=_*.5,e,a;if(r<.5){let Xt=r*r;e=.5*(1-Xt*.16666666666666666+Xt*Xt*.008333333333333333),a=1-Xt*.5+Xt*Xt*.041666666666666664}else e=Math.sin(r)/_,a=Math.cos(r);let h,b,X;h=o*e,b=n*e,X=l*e;let c,Y,p,x;c=h,Y=b,p=X,x=a;let v,f,Z,k,g=this._transform._rotation00,I=this._transform._rotation11,z=this._transform._rotation22,d=g+I+z,u;d>0?(u=Math.sqrt(d+1),k=.5*u,u=.5/u,v=(this._transform._rotation21-this._transform._rotation12)*u,f=(this._transform._rotation02-this._transform._rotation20)*u,Z=(this._transform._rotation10-this._transform._rotation01)*u):g>I?g>z?(u=Math.sqrt(g-I-z+1),v=.5*u,u=.5/u,f=(this._transform._rotation01+this._transform._rotation10)*u,Z=(this._transform._rotation02+this._transform._rotation20)*u,k=(this._transform._rotation21-this._transform._rotation12)*u):(u=Math.sqrt(z-g-I+1),Z=.5*u,u=.5/u,v=(this._transform._rotation02+this._transform._rotation20)*u,f=(this._transform._rotation12+this._transform._rotation21)*u,k=(this._transform._rotation10-this._transform._rotation01)*u):I>z?(u=Math.sqrt(I-z-g+1),f=.5*u,u=.5/u,v=(this._transform._rotation01+this._transform._rotation10)*u,Z=(this._transform._rotation12+this._transform._rotation21)*u,k=(this._transform._rotation02-this._transform._rotation20)*u):(u=Math.sqrt(z-g-I+1),Z=.5*u,u=.5/u,v=(this._transform._rotation02+this._transform._rotation20)*u,f=(this._transform._rotation12+this._transform._rotation21)*u,k=(this._transform._rotation10-this._transform._rotation01)*u),v=x*v+c*k+Y*Z-p*f,f=x*f-c*Z+Y*k+p*v,Z=x*Z+c*f-Y*v+p*k,k=x*k-c*v-Y*f-p*Z;let B=v*v+f*f+Z*Z+k*k;B>1e-32&&(B=1/Math.sqrt(B)),v*=B,f*=B,Z*=B,k*=B;let j=v,L=f,V=Z,M=k,w=2*j,P=2*L,E=2*V,C=j*w,S=L*P,A=V*E,R=j*P,H=L*E,y=j*E,D=M*w,F=M*P,Q=M*E;this._transform._rotation00=1-S-A,this._transform._rotation01=R-Q,this._transform._rotation02=y+F,this._transform._rotation10=R+Q,this._transform._rotation11=1-C-A,this._transform._rotation12=H-D,this._transform._rotation20=y-F,this._transform._rotation21=H+D,this._transform._rotation22=1-C-S;let W,q,U,G,J,N,K,O,$;W=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,q=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,U=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,G=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,J=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,N=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,K=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,O=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,$=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=W,this._invInertia01=q,this._invInertia02=U,this._invInertia10=G,this._invInertia11=J,this._invInertia12=N,this._invInertia20=K,this._invInertia21=O,this._invInertia22=$;let et,st,lt,rt,at,ot,ht,_t,bt;et=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,st=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,lt=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,rt=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,at=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,ot=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,ht=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,_t=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,bt=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=et,this._invInertia01=st,this._invInertia02=lt,this._invInertia10=rt,this._invInertia11=at,this._invInertia12=ot,this._invInertia20=ht,this._invInertia21=_t,this._invInertia22=bt,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;break}}updateMass(){let t,i,s,o,n,l,_,r,e;t=0,i=0,s=0,o=0,n=0,l=0,_=0,r=0,e=0;let a=0,h=this._shapeList;for(;h!=null;){let V=h._next,M=h._geom;M._updateMass();let w=h._density*M._volume,P,E,C,S,A,R,H,y,D,F,Q,W,q,U,G,J,N,K;F=h._localTransform._rotation00*M._inertiaCoeff00+h._localTransform._rotation01*M._inertiaCoeff10+h._localTransform._rotation02*M._inertiaCoeff20,Q=h._localTransform._rotation00*M._inertiaCoeff01+h._localTransform._rotation01*M._inertiaCoeff11+h._localTransform._rotation02*M._inertiaCoeff21,W=h._localTransform._rotation00*M._inertiaCoeff02+h._localTransform._rotation01*M._inertiaCoeff12+h._localTransform._rotation02*M._inertiaCoeff22,q=h._localTransform._rotation10*M._inertiaCoeff00+h._localTransform._rotation11*M._inertiaCoeff10+h._localTransform._rotation12*M._inertiaCoeff20,U=h._localTransform._rotation10*M._inertiaCoeff01+h._localTransform._rotation11*M._inertiaCoeff11+h._localTransform._rotation12*M._inertiaCoeff21,G=h._localTransform._rotation10*M._inertiaCoeff02+h._localTransform._rotation11*M._inertiaCoeff12+h._localTransform._rotation12*M._inertiaCoeff22,J=h._localTransform._rotation20*M._inertiaCoeff00+h._localTransform._rotation21*M._inertiaCoeff10+h._localTransform._rotation22*M._inertiaCoeff20,N=h._localTransform._rotation20*M._inertiaCoeff01+h._localTransform._rotation21*M._inertiaCoeff11+h._localTransform._rotation22*M._inertiaCoeff21,K=h._localTransform._rotation20*M._inertiaCoeff02+h._localTransform._rotation21*M._inertiaCoeff12+h._localTransform._rotation22*M._inertiaCoeff22,P=F,E=Q,C=W,S=q,A=U,R=G,H=J,y=N,D=K;let O,$,et,st,lt,rt,at,ot,ht;O=P*h._localTransform._rotation00+E*h._localTransform._rotation01+C*h._localTransform._rotation02,$=P*h._localTransform._rotation10+E*h._localTransform._rotation11+C*h._localTransform._rotation12,et=P*h._localTransform._rotation20+E*h._localTransform._rotation21+C*h._localTransform._rotation22,st=S*h._localTransform._rotation00+A*h._localTransform._rotation01+R*h._localTransform._rotation02,lt=S*h._localTransform._rotation10+A*h._localTransform._rotation11+R*h._localTransform._rotation12,rt=S*h._localTransform._rotation20+A*h._localTransform._rotation21+R*h._localTransform._rotation22,at=H*h._localTransform._rotation00+y*h._localTransform._rotation01+D*h._localTransform._rotation02,ot=H*h._localTransform._rotation10+y*h._localTransform._rotation11+D*h._localTransform._rotation12,ht=H*h._localTransform._rotation20+y*h._localTransform._rotation21+D*h._localTransform._rotation22,P=O,E=$,C=et,S=st,A=lt,R=rt,H=at,y=ot,D=ht,P*=w,E*=w,C*=w,S*=w,A*=w,R*=w,H*=w,y*=w,D*=w;let _t,bt,Xt,ft,Zt,xt,zt,Yt,pt,ct=h._localTransform._positionX*h._localTransform._positionX,nt=h._localTransform._positionY*h._localTransform._positionY,tt=h._localTransform._positionZ*h._localTransform._positionZ,Lt=-h._localTransform._positionX*h._localTransform._positionY,Bt=-h._localTransform._positionY*h._localTransform._positionZ,Mt=-h._localTransform._positionZ*h._localTransform._positionX;_t=nt+tt,bt=Lt,Xt=Mt,ft=Lt,Zt=ct+tt,xt=Bt,zt=Mt,Yt=Bt,pt=ct+nt,P+=_t*w,E+=bt*w,C+=Xt*w,S+=ft*w,A+=Zt*w,R+=xt*w,H+=zt*w,y+=Yt*w,D+=pt*w,a+=w,t+=P,i+=E,s+=C,o+=S,n+=A,l+=R,_+=H,r+=y,e+=D,h=V}if(this._mass=a,this._localInertia00=t,this._localInertia01=i,this._localInertia02=s,this._localInertia10=o,this._localInertia11=n,this._localInertia12=l,this._localInertia20=_,this._localInertia21=r,this._localInertia22=e,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let V=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,M=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,w=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,P=this._localInertia00*V-this._localInertia01*M+this._localInertia02*w;(P<-1e-32||P>1e-32)&&(P=1/P),this._invLocalInertia00=V*P,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*P,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*P,this._invLocalInertia10=-M*P,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*P,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*P,this._invLocalInertia20=w*P,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*P,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*P,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let b,X,c,Y,p,x,v,f,Z;b=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,X=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,c=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,Y=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,p=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,x=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,v=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,f=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,Z=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=b,this._invInertia01=X,this._invInertia02=c,this._invInertia10=Y,this._invInertia11=p,this._invInertia12=x,this._invInertia20=v,this._invInertia21=f,this._invInertia22=Z;let k,g,I,z,d,u,B,j,L;k=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,g=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,I=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,z=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,d=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,u=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,B=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,j=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,L=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=k,this._invInertia01=g,this._invInertia02=I,this._invInertia10=z,this._invInertia11=d,this._invInertia12=u,this._invInertia20=B,this._invInertia21=j,this._invInertia22=L,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getPosition(){let t=new m.common.Vec3;return t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ,t}getPositionTo(t){t.x=this._transform._positionX,t.y=this._transform._positionY,t.z=this._transform._positionZ}setPosition(t){this._transform._positionX=t.x,this._transform._positionY=t.y,this._transform._positionZ=t.z;let i=this._ptransform,s=this._transform;i._positionX=s._positionX,i._positionY=s._positionY,i._positionZ=s._positionZ,i._rotation00=s._rotation00,i._rotation01=s._rotation01,i._rotation02=s._rotation02,i._rotation10=s._rotation10,i._rotation11=s._rotation11,i._rotation12=s._rotation12,i._rotation20=s._rotation20,i._rotation21=s._rotation21,i._rotation22=s._rotation22;let o=this._shapeList;for(;o!=null;){let n=o._next,l=this._ptransform,_=this._transform,r=o._ptransform,e=o._localTransform,a,h,b,X,c,Y,p,x,v;a=l._rotation00*e._rotation00+l._rotation01*e._rotation10+l._rotation02*e._rotation20,h=l._rotation00*e._rotation01+l._rotation01*e._rotation11+l._rotation02*e._rotation21,b=l._rotation00*e._rotation02+l._rotation01*e._rotation12+l._rotation02*e._rotation22,X=l._rotation10*e._rotation00+l._rotation11*e._rotation10+l._rotation12*e._rotation20,c=l._rotation10*e._rotation01+l._rotation11*e._rotation11+l._rotation12*e._rotation21,Y=l._rotation10*e._rotation02+l._rotation11*e._rotation12+l._rotation12*e._rotation22,p=l._rotation20*e._rotation00+l._rotation21*e._rotation10+l._rotation22*e._rotation20,x=l._rotation20*e._rotation01+l._rotation21*e._rotation11+l._rotation22*e._rotation21,v=l._rotation20*e._rotation02+l._rotation21*e._rotation12+l._rotation22*e._rotation22,r._rotation00=a,r._rotation01=h,r._rotation02=b,r._rotation10=X,r._rotation11=c,r._rotation12=Y,r._rotation20=p,r._rotation21=x,r._rotation22=v;let f,Z,k;f=l._rotation00*e._positionX+l._rotation01*e._positionY+l._rotation02*e._positionZ,Z=l._rotation10*e._positionX+l._rotation11*e._positionY+l._rotation12*e._positionZ,k=l._rotation20*e._positionX+l._rotation21*e._positionY+l._rotation22*e._positionZ,r._positionX=f,r._positionY=Z,r._positionZ=k,r._positionX+=l._positionX,r._positionY+=l._positionY,r._positionZ+=l._positionZ;let g=o._transform,I=o._localTransform,z,d,u,B,j,L,V,M,w;z=_._rotation00*I._rotation00+_._rotation01*I._rotation10+_._rotation02*I._rotation20,d=_._rotation00*I._rotation01+_._rotation01*I._rotation11+_._rotation02*I._rotation21,u=_._rotation00*I._rotation02+_._rotation01*I._rotation12+_._rotation02*I._rotation22,B=_._rotation10*I._rotation00+_._rotation11*I._rotation10+_._rotation12*I._rotation20,j=_._rotation10*I._rotation01+_._rotation11*I._rotation11+_._rotation12*I._rotation21,L=_._rotation10*I._rotation02+_._rotation11*I._rotation12+_._rotation12*I._rotation22,V=_._rotation20*I._rotation00+_._rotation21*I._rotation10+_._rotation22*I._rotation20,M=_._rotation20*I._rotation01+_._rotation21*I._rotation11+_._rotation22*I._rotation21,w=_._rotation20*I._rotation02+_._rotation21*I._rotation12+_._rotation22*I._rotation22,g._rotation00=z,g._rotation01=d,g._rotation02=u,g._rotation10=B,g._rotation11=j,g._rotation12=L,g._rotation20=V,g._rotation21=M,g._rotation22=w;let P,E,C;P=_._rotation00*I._positionX+_._rotation01*I._positionY+_._rotation02*I._positionZ,E=_._rotation10*I._positionX+_._rotation11*I._positionY+_._rotation12*I._positionZ,C=_._rotation20*I._positionX+_._rotation21*I._positionY+_._rotation22*I._positionZ,g._positionX=P,g._positionY=E,g._positionZ=C,g._positionX+=_._positionX,g._positionY+=_._positionY,g._positionZ+=_._positionZ;let S,A,R,H,y,D;if(o._geom._computeAabb(o._aabb,o._ptransform),S=o._aabb._minX,A=o._aabb._minY,R=o._aabb._minZ,H=o._aabb._maxX,y=o._aabb._maxY,D=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=S<o._aabb._minX?S:o._aabb._minX,o._aabb._minY=A<o._aabb._minY?A:o._aabb._minY,o._aabb._minZ=R<o._aabb._minZ?R:o._aabb._minZ,o._aabb._maxX=H>o._aabb._maxX?H:o._aabb._maxX,o._aabb._maxY=y>o._aabb._maxY?y:o._aabb._maxY,o._aabb._maxZ=D>o._aabb._maxZ?D:o._aabb._maxZ,o._proxy!=null){let F,Q,W;F=o._transform._positionX-o._ptransform._positionX,Q=o._transform._positionY-o._ptransform._positionY,W=o._transform._positionZ-o._ptransform._positionZ;let q=o.displacement;q.x=F,q.y=Q,q.z=W,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=n}this._sleeping=!1,this._sleepTime=0}translate(t){let i,s,o;i=t.x,s=t.y,o=t.z,this._transform._positionX+=i,this._transform._positionY+=s,this._transform._positionZ+=o;let n=this._ptransform,l=this._transform;n._positionX=l._positionX,n._positionY=l._positionY,n._positionZ=l._positionZ,n._rotation00=l._rotation00,n._rotation01=l._rotation01,n._rotation02=l._rotation02,n._rotation10=l._rotation10,n._rotation11=l._rotation11,n._rotation12=l._rotation12,n._rotation20=l._rotation20,n._rotation21=l._rotation21,n._rotation22=l._rotation22;let _=this._shapeList;for(;_!=null;){let r=_._next,e=this._ptransform,a=this._transform,h=_._ptransform,b=_._localTransform,X,c,Y,p,x,v,f,Z,k;X=e._rotation00*b._rotation00+e._rotation01*b._rotation10+e._rotation02*b._rotation20,c=e._rotation00*b._rotation01+e._rotation01*b._rotation11+e._rotation02*b._rotation21,Y=e._rotation00*b._rotation02+e._rotation01*b._rotation12+e._rotation02*b._rotation22,p=e._rotation10*b._rotation00+e._rotation11*b._rotation10+e._rotation12*b._rotation20,x=e._rotation10*b._rotation01+e._rotation11*b._rotation11+e._rotation12*b._rotation21,v=e._rotation10*b._rotation02+e._rotation11*b._rotation12+e._rotation12*b._rotation22,f=e._rotation20*b._rotation00+e._rotation21*b._rotation10+e._rotation22*b._rotation20,Z=e._rotation20*b._rotation01+e._rotation21*b._rotation11+e._rotation22*b._rotation21,k=e._rotation20*b._rotation02+e._rotation21*b._rotation12+e._rotation22*b._rotation22,h._rotation00=X,h._rotation01=c,h._rotation02=Y,h._rotation10=p,h._rotation11=x,h._rotation12=v,h._rotation20=f,h._rotation21=Z,h._rotation22=k;let g,I,z;g=e._rotation00*b._positionX+e._rotation01*b._positionY+e._rotation02*b._positionZ,I=e._rotation10*b._positionX+e._rotation11*b._positionY+e._rotation12*b._positionZ,z=e._rotation20*b._positionX+e._rotation21*b._positionY+e._rotation22*b._positionZ,h._positionX=g,h._positionY=I,h._positionZ=z,h._positionX+=e._positionX,h._positionY+=e._positionY,h._positionZ+=e._positionZ;let d=_._transform,u=_._localTransform,B,j,L,V,M,w,P,E,C;B=a._rotation00*u._rotation00+a._rotation01*u._rotation10+a._rotation02*u._rotation20,j=a._rotation00*u._rotation01+a._rotation01*u._rotation11+a._rotation02*u._rotation21,L=a._rotation00*u._rotation02+a._rotation01*u._rotation12+a._rotation02*u._rotation22,V=a._rotation10*u._rotation00+a._rotation11*u._rotation10+a._rotation12*u._rotation20,M=a._rotation10*u._rotation01+a._rotation11*u._rotation11+a._rotation12*u._rotation21,w=a._rotation10*u._rotation02+a._rotation11*u._rotation12+a._rotation12*u._rotation22,P=a._rotation20*u._rotation00+a._rotation21*u._rotation10+a._rotation22*u._rotation20,E=a._rotation20*u._rotation01+a._rotation21*u._rotation11+a._rotation22*u._rotation21,C=a._rotation20*u._rotation02+a._rotation21*u._rotation12+a._rotation22*u._rotation22,d._rotation00=B,d._rotation01=j,d._rotation02=L,d._rotation10=V,d._rotation11=M,d._rotation12=w,d._rotation20=P,d._rotation21=E,d._rotation22=C;let S,A,R;S=a._rotation00*u._positionX+a._rotation01*u._positionY+a._rotation02*u._positionZ,A=a._rotation10*u._positionX+a._rotation11*u._positionY+a._rotation12*u._positionZ,R=a._rotation20*u._positionX+a._rotation21*u._positionY+a._rotation22*u._positionZ,d._positionX=S,d._positionY=A,d._positionZ=R,d._positionX+=a._positionX,d._positionY+=a._positionY,d._positionZ+=a._positionZ;let H,y,D,F,Q,W;if(_._geom._computeAabb(_._aabb,_._ptransform),H=_._aabb._minX,y=_._aabb._minY,D=_._aabb._minZ,F=_._aabb._maxX,Q=_._aabb._maxY,W=_._aabb._maxZ,_._geom._computeAabb(_._aabb,_._transform),_._aabb._minX=H<_._aabb._minX?H:_._aabb._minX,_._aabb._minY=y<_._aabb._minY?y:_._aabb._minY,_._aabb._minZ=D<_._aabb._minZ?D:_._aabb._minZ,_._aabb._maxX=F>_._aabb._maxX?F:_._aabb._maxX,_._aabb._maxY=Q>_._aabb._maxY?Q:_._aabb._maxY,_._aabb._maxZ=W>_._aabb._maxZ?W:_._aabb._maxZ,_._proxy!=null){let q,U,G;q=_._transform._positionX-_._ptransform._positionX,U=_._transform._positionY-_._ptransform._positionY,G=_._transform._positionZ-_._ptransform._positionZ;let J=_.displacement;J.x=q,J.y=U,J.z=G,_._rigidBody._world._broadPhase.moveProxy(_._proxy,_._aabb,_.displacement)}_=r}this._sleeping=!1,this._sleepTime=0}getRotation(){let t=new m.common.Mat3;return t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22,t}getRotationTo(t){t.e00=this._transform._rotation00,t.e01=this._transform._rotation01,t.e02=this._transform._rotation02,t.e10=this._transform._rotation10,t.e11=this._transform._rotation11,t.e12=this._transform._rotation12,t.e20=this._transform._rotation20,t.e21=this._transform._rotation21,t.e22=this._transform._rotation22}setRotation(t){this._transform._rotation00=t.e00,this._transform._rotation01=t.e01,this._transform._rotation02=t.e02,this._transform._rotation10=t.e10,this._transform._rotation11=t.e11,this._transform._rotation12=t.e12,this._transform._rotation20=t.e20,this._transform._rotation21=t.e21,this._transform._rotation22=t.e22;let i,s,o,n,l,_,r,e,a;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,a=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=o,this._invInertia10=n,this._invInertia11=l,this._invInertia12=_,this._invInertia20=r,this._invInertia21=e,this._invInertia22=a;let h,b,X,c,Y,p,x,v,f;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,X=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,c=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Y=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,f=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=b,this._invInertia02=X,this._invInertia10=c,this._invInertia11=Y,this._invInertia12=p,this._invInertia20=x,this._invInertia21=v,this._invInertia22=f,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let Z=this._ptransform,k=this._transform;Z._positionX=k._positionX,Z._positionY=k._positionY,Z._positionZ=k._positionZ,Z._rotation00=k._rotation00,Z._rotation01=k._rotation01,Z._rotation02=k._rotation02,Z._rotation10=k._rotation10,Z._rotation11=k._rotation11,Z._rotation12=k._rotation12,Z._rotation20=k._rotation20,Z._rotation21=k._rotation21,Z._rotation22=k._rotation22;let g=this._shapeList;for(;g!=null;){let I=g._next,z=this._ptransform,d=this._transform,u=g._ptransform,B=g._localTransform,j,L,V,M,w,P,E,C,S;j=z._rotation00*B._rotation00+z._rotation01*B._rotation10+z._rotation02*B._rotation20,L=z._rotation00*B._rotation01+z._rotation01*B._rotation11+z._rotation02*B._rotation21,V=z._rotation00*B._rotation02+z._rotation01*B._rotation12+z._rotation02*B._rotation22,M=z._rotation10*B._rotation00+z._rotation11*B._rotation10+z._rotation12*B._rotation20,w=z._rotation10*B._rotation01+z._rotation11*B._rotation11+z._rotation12*B._rotation21,P=z._rotation10*B._rotation02+z._rotation11*B._rotation12+z._rotation12*B._rotation22,E=z._rotation20*B._rotation00+z._rotation21*B._rotation10+z._rotation22*B._rotation20,C=z._rotation20*B._rotation01+z._rotation21*B._rotation11+z._rotation22*B._rotation21,S=z._rotation20*B._rotation02+z._rotation21*B._rotation12+z._rotation22*B._rotation22,u._rotation00=j,u._rotation01=L,u._rotation02=V,u._rotation10=M,u._rotation11=w,u._rotation12=P,u._rotation20=E,u._rotation21=C,u._rotation22=S;let A,R,H;A=z._rotation00*B._positionX+z._rotation01*B._positionY+z._rotation02*B._positionZ,R=z._rotation10*B._positionX+z._rotation11*B._positionY+z._rotation12*B._positionZ,H=z._rotation20*B._positionX+z._rotation21*B._positionY+z._rotation22*B._positionZ,u._positionX=A,u._positionY=R,u._positionZ=H,u._positionX+=z._positionX,u._positionY+=z._positionY,u._positionZ+=z._positionZ;let y=g._transform,D=g._localTransform,F,Q,W,q,U,G,J,N,K;F=d._rotation00*D._rotation00+d._rotation01*D._rotation10+d._rotation02*D._rotation20,Q=d._rotation00*D._rotation01+d._rotation01*D._rotation11+d._rotation02*D._rotation21,W=d._rotation00*D._rotation02+d._rotation01*D._rotation12+d._rotation02*D._rotation22,q=d._rotation10*D._rotation00+d._rotation11*D._rotation10+d._rotation12*D._rotation20,U=d._rotation10*D._rotation01+d._rotation11*D._rotation11+d._rotation12*D._rotation21,G=d._rotation10*D._rotation02+d._rotation11*D._rotation12+d._rotation12*D._rotation22,J=d._rotation20*D._rotation00+d._rotation21*D._rotation10+d._rotation22*D._rotation20,N=d._rotation20*D._rotation01+d._rotation21*D._rotation11+d._rotation22*D._rotation21,K=d._rotation20*D._rotation02+d._rotation21*D._rotation12+d._rotation22*D._rotation22,y._rotation00=F,y._rotation01=Q,y._rotation02=W,y._rotation10=q,y._rotation11=U,y._rotation12=G,y._rotation20=J,y._rotation21=N,y._rotation22=K;let O,$,et;O=d._rotation00*D._positionX+d._rotation01*D._positionY+d._rotation02*D._positionZ,$=d._rotation10*D._positionX+d._rotation11*D._positionY+d._rotation12*D._positionZ,et=d._rotation20*D._positionX+d._rotation21*D._positionY+d._rotation22*D._positionZ,y._positionX=O,y._positionY=$,y._positionZ=et,y._positionX+=d._positionX,y._positionY+=d._positionY,y._positionZ+=d._positionZ;let st,lt,rt,at,ot,ht;if(g._geom._computeAabb(g._aabb,g._ptransform),st=g._aabb._minX,lt=g._aabb._minY,rt=g._aabb._minZ,at=g._aabb._maxX,ot=g._aabb._maxY,ht=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=st<g._aabb._minX?st:g._aabb._minX,g._aabb._minY=lt<g._aabb._minY?lt:g._aabb._minY,g._aabb._minZ=rt<g._aabb._minZ?rt:g._aabb._minZ,g._aabb._maxX=at>g._aabb._maxX?at:g._aabb._maxX,g._aabb._maxY=ot>g._aabb._maxY?ot:g._aabb._maxY,g._aabb._maxZ=ht>g._aabb._maxZ?ht:g._aabb._maxZ,g._proxy!=null){let _t,bt,Xt;_t=g._transform._positionX-g._ptransform._positionX,bt=g._transform._positionY-g._ptransform._positionY,Xt=g._transform._positionZ-g._ptransform._positionZ;let ft=g.displacement;ft.x=_t,ft.y=bt,ft.z=Xt,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=I}this._sleeping=!1,this._sleepTime=0}setRotationXyz(t){let i,s,o;i=t.x,s=t.y,o=t.z;let n=Math.sin(i),l=Math.sin(s),_=Math.sin(o),r=Math.cos(i),e=Math.cos(s),a=Math.cos(o);this._transform._rotation00=e*a,this._transform._rotation01=-e*_,this._transform._rotation02=l,this._transform._rotation10=r*_+a*n*l,this._transform._rotation11=r*a-n*l*_,this._transform._rotation12=-e*n,this._transform._rotation20=n*_-r*a*l,this._transform._rotation21=a*n+r*l*_,this._transform._rotation22=r*e;let h,b,X,c,Y,p,x,v,f;h=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,b=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,X=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,c=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,Y=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,p=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,x=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,v=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,f=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=h,this._invInertia01=b,this._invInertia02=X,this._invInertia10=c,this._invInertia11=Y,this._invInertia12=p,this._invInertia20=x,this._invInertia21=v,this._invInertia22=f;let Z,k,g,I,z,d,u,B,j;Z=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,k=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,g=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,I=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,z=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,d=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,u=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,B=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,j=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=Z,this._invInertia01=k,this._invInertia02=g,this._invInertia10=I,this._invInertia11=z,this._invInertia12=d,this._invInertia20=u,this._invInertia21=B,this._invInertia22=j,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let L=this._ptransform,V=this._transform;L._positionX=V._positionX,L._positionY=V._positionY,L._positionZ=V._positionZ,L._rotation00=V._rotation00,L._rotation01=V._rotation01,L._rotation02=V._rotation02,L._rotation10=V._rotation10,L._rotation11=V._rotation11,L._rotation12=V._rotation12,L._rotation20=V._rotation20,L._rotation21=V._rotation21,L._rotation22=V._rotation22;let M=this._shapeList;for(;M!=null;){let w=M._next,P=this._ptransform,E=this._transform,C=M._ptransform,S=M._localTransform,A,R,H,y,D,F,Q,W,q;A=P._rotation00*S._rotation00+P._rotation01*S._rotation10+P._rotation02*S._rotation20,R=P._rotation00*S._rotation01+P._rotation01*S._rotation11+P._rotation02*S._rotation21,H=P._rotation00*S._rotation02+P._rotation01*S._rotation12+P._rotation02*S._rotation22,y=P._rotation10*S._rotation00+P._rotation11*S._rotation10+P._rotation12*S._rotation20,D=P._rotation10*S._rotation01+P._rotation11*S._rotation11+P._rotation12*S._rotation21,F=P._rotation10*S._rotation02+P._rotation11*S._rotation12+P._rotation12*S._rotation22,Q=P._rotation20*S._rotation00+P._rotation21*S._rotation10+P._rotation22*S._rotation20,W=P._rotation20*S._rotation01+P._rotation21*S._rotation11+P._rotation22*S._rotation21,q=P._rotation20*S._rotation02+P._rotation21*S._rotation12+P._rotation22*S._rotation22,C._rotation00=A,C._rotation01=R,C._rotation02=H,C._rotation10=y,C._rotation11=D,C._rotation12=F,C._rotation20=Q,C._rotation21=W,C._rotation22=q;let U,G,J;U=P._rotation00*S._positionX+P._rotation01*S._positionY+P._rotation02*S._positionZ,G=P._rotation10*S._positionX+P._rotation11*S._positionY+P._rotation12*S._positionZ,J=P._rotation20*S._positionX+P._rotation21*S._positionY+P._rotation22*S._positionZ,C._positionX=U,C._positionY=G,C._positionZ=J,C._positionX+=P._positionX,C._positionY+=P._positionY,C._positionZ+=P._positionZ;let N=M._transform,K=M._localTransform,O,$,et,st,lt,rt,at,ot,ht;O=E._rotation00*K._rotation00+E._rotation01*K._rotation10+E._rotation02*K._rotation20,$=E._rotation00*K._rotation01+E._rotation01*K._rotation11+E._rotation02*K._rotation21,et=E._rotation00*K._rotation02+E._rotation01*K._rotation12+E._rotation02*K._rotation22,st=E._rotation10*K._rotation00+E._rotation11*K._rotation10+E._rotation12*K._rotation20,lt=E._rotation10*K._rotation01+E._rotation11*K._rotation11+E._rotation12*K._rotation21,rt=E._rotation10*K._rotation02+E._rotation11*K._rotation12+E._rotation12*K._rotation22,at=E._rotation20*K._rotation00+E._rotation21*K._rotation10+E._rotation22*K._rotation20,ot=E._rotation20*K._rotation01+E._rotation21*K._rotation11+E._rotation22*K._rotation21,ht=E._rotation20*K._rotation02+E._rotation21*K._rotation12+E._rotation22*K._rotation22,N._rotation00=O,N._rotation01=$,N._rotation02=et,N._rotation10=st,N._rotation11=lt,N._rotation12=rt,N._rotation20=at,N._rotation21=ot,N._rotation22=ht;let _t,bt,Xt;_t=E._rotation00*K._positionX+E._rotation01*K._positionY+E._rotation02*K._positionZ,bt=E._rotation10*K._positionX+E._rotation11*K._positionY+E._rotation12*K._positionZ,Xt=E._rotation20*K._positionX+E._rotation21*K._positionY+E._rotation22*K._positionZ,N._positionX=_t,N._positionY=bt,N._positionZ=Xt,N._positionX+=E._positionX,N._positionY+=E._positionY,N._positionZ+=E._positionZ;let ft,Zt,xt,zt,Yt,pt;if(M._geom._computeAabb(M._aabb,M._ptransform),ft=M._aabb._minX,Zt=M._aabb._minY,xt=M._aabb._minZ,zt=M._aabb._maxX,Yt=M._aabb._maxY,pt=M._aabb._maxZ,M._geom._computeAabb(M._aabb,M._transform),M._aabb._minX=ft<M._aabb._minX?ft:M._aabb._minX,M._aabb._minY=Zt<M._aabb._minY?Zt:M._aabb._minY,M._aabb._minZ=xt<M._aabb._minZ?xt:M._aabb._minZ,M._aabb._maxX=zt>M._aabb._maxX?zt:M._aabb._maxX,M._aabb._maxY=Yt>M._aabb._maxY?Yt:M._aabb._maxY,M._aabb._maxZ=pt>M._aabb._maxZ?pt:M._aabb._maxZ,M._proxy!=null){let ct,nt,tt;ct=M._transform._positionX-M._ptransform._positionX,nt=M._transform._positionY-M._ptransform._positionY,tt=M._transform._positionZ-M._ptransform._positionZ;let Lt=M.displacement;Lt.x=ct,Lt.y=nt,Lt.z=tt,M._rigidBody._world._broadPhase.moveProxy(M._proxy,M._aabb,M.displacement)}M=w}this._sleeping=!1,this._sleepTime=0}rotate(t){let i,s,o,n,l,_,r,e,a;i=t.e00,s=t.e01,o=t.e02,n=t.e10,l=t.e11,_=t.e12,r=t.e20,e=t.e21,a=t.e22;let h,b,X,c,Y,p,x,v,f;h=i*this._transform._rotation00+s*this._transform._rotation10+o*this._transform._rotation20,b=i*this._transform._rotation01+s*this._transform._rotation11+o*this._transform._rotation21,X=i*this._transform._rotation02+s*this._transform._rotation12+o*this._transform._rotation22,c=n*this._transform._rotation00+l*this._transform._rotation10+_*this._transform._rotation20,Y=n*this._transform._rotation01+l*this._transform._rotation11+_*this._transform._rotation21,p=n*this._transform._rotation02+l*this._transform._rotation12+_*this._transform._rotation22,x=r*this._transform._rotation00+e*this._transform._rotation10+a*this._transform._rotation20,v=r*this._transform._rotation01+e*this._transform._rotation11+a*this._transform._rotation21,f=r*this._transform._rotation02+e*this._transform._rotation12+a*this._transform._rotation22,this._transform._rotation00=h,this._transform._rotation01=b,this._transform._rotation02=X,this._transform._rotation10=c,this._transform._rotation11=Y,this._transform._rotation12=p,this._transform._rotation20=x,this._transform._rotation21=v,this._transform._rotation22=f;let Z,k,g,I,z,d,u,B,j;Z=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,k=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,g=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,I=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,z=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,d=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,u=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,B=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,j=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=Z,this._invInertia01=k,this._invInertia02=g,this._invInertia10=I,this._invInertia11=z,this._invInertia12=d,this._invInertia20=u,this._invInertia21=B,this._invInertia22=j;let L,V,M,w,P,E,C,S,A;L=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,V=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,M=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,w=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,P=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,E=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,C=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,S=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,A=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=L,this._invInertia01=V,this._invInertia02=M,this._invInertia10=w,this._invInertia11=P,this._invInertia12=E,this._invInertia20=C,this._invInertia21=S,this._invInertia22=A,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let R=this._ptransform,H=this._transform;R._positionX=H._positionX,R._positionY=H._positionY,R._positionZ=H._positionZ,R._rotation00=H._rotation00,R._rotation01=H._rotation01,R._rotation02=H._rotation02,R._rotation10=H._rotation10,R._rotation11=H._rotation11,R._rotation12=H._rotation12,R._rotation20=H._rotation20,R._rotation21=H._rotation21,R._rotation22=H._rotation22;let y=this._shapeList;for(;y!=null;){let D=y._next,F=this._ptransform,Q=this._transform,W=y._ptransform,q=y._localTransform,U,G,J,N,K,O,$,et,st;U=F._rotation00*q._rotation00+F._rotation01*q._rotation10+F._rotation02*q._rotation20,G=F._rotation00*q._rotation01+F._rotation01*q._rotation11+F._rotation02*q._rotation21,J=F._rotation00*q._rotation02+F._rotation01*q._rotation12+F._rotation02*q._rotation22,N=F._rotation10*q._rotation00+F._rotation11*q._rotation10+F._rotation12*q._rotation20,K=F._rotation10*q._rotation01+F._rotation11*q._rotation11+F._rotation12*q._rotation21,O=F._rotation10*q._rotation02+F._rotation11*q._rotation12+F._rotation12*q._rotation22,$=F._rotation20*q._rotation00+F._rotation21*q._rotation10+F._rotation22*q._rotation20,et=F._rotation20*q._rotation01+F._rotation21*q._rotation11+F._rotation22*q._rotation21,st=F._rotation20*q._rotation02+F._rotation21*q._rotation12+F._rotation22*q._rotation22,W._rotation00=U,W._rotation01=G,W._rotation02=J,W._rotation10=N,W._rotation11=K,W._rotation12=O,W._rotation20=$,W._rotation21=et,W._rotation22=st;let lt,rt,at;lt=F._rotation00*q._positionX+F._rotation01*q._positionY+F._rotation02*q._positionZ,rt=F._rotation10*q._positionX+F._rotation11*q._positionY+F._rotation12*q._positionZ,at=F._rotation20*q._positionX+F._rotation21*q._positionY+F._rotation22*q._positionZ,W._positionX=lt,W._positionY=rt,W._positionZ=at,W._positionX+=F._positionX,W._positionY+=F._positionY,W._positionZ+=F._positionZ;let ot=y._transform,ht=y._localTransform,_t,bt,Xt,ft,Zt,xt,zt,Yt,pt;_t=Q._rotation00*ht._rotation00+Q._rotation01*ht._rotation10+Q._rotation02*ht._rotation20,bt=Q._rotation00*ht._rotation01+Q._rotation01*ht._rotation11+Q._rotation02*ht._rotation21,Xt=Q._rotation00*ht._rotation02+Q._rotation01*ht._rotation12+Q._rotation02*ht._rotation22,ft=Q._rotation10*ht._rotation00+Q._rotation11*ht._rotation10+Q._rotation12*ht._rotation20,Zt=Q._rotation10*ht._rotation01+Q._rotation11*ht._rotation11+Q._rotation12*ht._rotation21,xt=Q._rotation10*ht._rotation02+Q._rotation11*ht._rotation12+Q._rotation12*ht._rotation22,zt=Q._rotation20*ht._rotation00+Q._rotation21*ht._rotation10+Q._rotation22*ht._rotation20,Yt=Q._rotation20*ht._rotation01+Q._rotation21*ht._rotation11+Q._rotation22*ht._rotation21,pt=Q._rotation20*ht._rotation02+Q._rotation21*ht._rotation12+Q._rotation22*ht._rotation22,ot._rotation00=_t,ot._rotation01=bt,ot._rotation02=Xt,ot._rotation10=ft,ot._rotation11=Zt,ot._rotation12=xt,ot._rotation20=zt,ot._rotation21=Yt,ot._rotation22=pt;let ct,nt,tt;ct=Q._rotation00*ht._positionX+Q._rotation01*ht._positionY+Q._rotation02*ht._positionZ,nt=Q._rotation10*ht._positionX+Q._rotation11*ht._positionY+Q._rotation12*ht._positionZ,tt=Q._rotation20*ht._positionX+Q._rotation21*ht._positionY+Q._rotation22*ht._positionZ,ot._positionX=ct,ot._positionY=nt,ot._positionZ=tt,ot._positionX+=Q._positionX,ot._positionY+=Q._positionY,ot._positionZ+=Q._positionZ;let Lt,Bt,Mt,jt,ci,Xi;if(y._geom._computeAabb(y._aabb,y._ptransform),Lt=y._aabb._minX,Bt=y._aabb._minY,Mt=y._aabb._minZ,jt=y._aabb._maxX,ci=y._aabb._maxY,Xi=y._aabb._maxZ,y._geom._computeAabb(y._aabb,y._transform),y._aabb._minX=Lt<y._aabb._minX?Lt:y._aabb._minX,y._aabb._minY=Bt<y._aabb._minY?Bt:y._aabb._minY,y._aabb._minZ=Mt<y._aabb._minZ?Mt:y._aabb._minZ,y._aabb._maxX=jt>y._aabb._maxX?jt:y._aabb._maxX,y._aabb._maxY=ci>y._aabb._maxY?ci:y._aabb._maxY,y._aabb._maxZ=Xi>y._aabb._maxZ?Xi:y._aabb._maxZ,y._proxy!=null){let Yi,Li,wi;Yi=y._transform._positionX-y._ptransform._positionX,Li=y._transform._positionY-y._ptransform._positionY,wi=y._transform._positionZ-y._ptransform._positionZ;let ei=y.displacement;ei.x=Yi,ei.y=Li,ei.z=wi,y._rigidBody._world._broadPhase.moveProxy(y._proxy,y._aabb,y.displacement)}y=D}this._sleeping=!1,this._sleepTime=0}rotateXyz(t){let i,s,o,n,l,_,r,e,a,h,b,X;i=t.x,s=t.y,o=t.z;let c=Math.sin(i),Y=Math.sin(s),p=Math.sin(o),x=Math.cos(i),v=Math.cos(s),f=Math.cos(o);n=v*f,l=-v*p,_=Y,r=x*p+f*c*Y,e=x*f-c*Y*p,a=-v*c,h=c*p-x*f*Y,b=f*c+x*Y*p,X=x*v;let Z,k,g,I,z,d,u,B,j;Z=n*this._transform._rotation00+l*this._transform._rotation10+_*this._transform._rotation20,k=n*this._transform._rotation01+l*this._transform._rotation11+_*this._transform._rotation21,g=n*this._transform._rotation02+l*this._transform._rotation12+_*this._transform._rotation22,I=r*this._transform._rotation00+e*this._transform._rotation10+a*this._transform._rotation20,z=r*this._transform._rotation01+e*this._transform._rotation11+a*this._transform._rotation21,d=r*this._transform._rotation02+e*this._transform._rotation12+a*this._transform._rotation22,u=h*this._transform._rotation00+b*this._transform._rotation10+X*this._transform._rotation20,B=h*this._transform._rotation01+b*this._transform._rotation11+X*this._transform._rotation21,j=h*this._transform._rotation02+b*this._transform._rotation12+X*this._transform._rotation22,this._transform._rotation00=Z,this._transform._rotation01=k,this._transform._rotation02=g,this._transform._rotation10=I,this._transform._rotation11=z,this._transform._rotation12=d,this._transform._rotation20=u,this._transform._rotation21=B,this._transform._rotation22=j;let L,V,M,w,P,E,C,S,A;L=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,V=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,M=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,w=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,P=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,E=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,C=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,S=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,A=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=L,this._invInertia01=V,this._invInertia02=M,this._invInertia10=w,this._invInertia11=P,this._invInertia12=E,this._invInertia20=C,this._invInertia21=S,this._invInertia22=A;let R,H,y,D,F,Q,W,q,U;R=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,H=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,y=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,D=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,F=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,Q=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,W=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,q=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,U=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=R,this._invInertia01=H,this._invInertia02=y,this._invInertia10=D,this._invInertia11=F,this._invInertia12=Q,this._invInertia20=W,this._invInertia21=q,this._invInertia22=U,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let G=this._ptransform,J=this._transform;G._positionX=J._positionX,G._positionY=J._positionY,G._positionZ=J._positionZ,G._rotation00=J._rotation00,G._rotation01=J._rotation01,G._rotation02=J._rotation02,G._rotation10=J._rotation10,G._rotation11=J._rotation11,G._rotation12=J._rotation12,G._rotation20=J._rotation20,G._rotation21=J._rotation21,G._rotation22=J._rotation22;let N=this._shapeList;for(;N!=null;){let K=N._next,O=this._ptransform,$=this._transform,et=N._ptransform,st=N._localTransform,lt,rt,at,ot,ht,_t,bt,Xt,ft;lt=O._rotation00*st._rotation00+O._rotation01*st._rotation10+O._rotation02*st._rotation20,rt=O._rotation00*st._rotation01+O._rotation01*st._rotation11+O._rotation02*st._rotation21,at=O._rotation00*st._rotation02+O._rotation01*st._rotation12+O._rotation02*st._rotation22,ot=O._rotation10*st._rotation00+O._rotation11*st._rotation10+O._rotation12*st._rotation20,ht=O._rotation10*st._rotation01+O._rotation11*st._rotation11+O._rotation12*st._rotation21,_t=O._rotation10*st._rotation02+O._rotation11*st._rotation12+O._rotation12*st._rotation22,bt=O._rotation20*st._rotation00+O._rotation21*st._rotation10+O._rotation22*st._rotation20,Xt=O._rotation20*st._rotation01+O._rotation21*st._rotation11+O._rotation22*st._rotation21,ft=O._rotation20*st._rotation02+O._rotation21*st._rotation12+O._rotation22*st._rotation22,et._rotation00=lt,et._rotation01=rt,et._rotation02=at,et._rotation10=ot,et._rotation11=ht,et._rotation12=_t,et._rotation20=bt,et._rotation21=Xt,et._rotation22=ft;let Zt,xt,zt;Zt=O._rotation00*st._positionX+O._rotation01*st._positionY+O._rotation02*st._positionZ,xt=O._rotation10*st._positionX+O._rotation11*st._positionY+O._rotation12*st._positionZ,zt=O._rotation20*st._positionX+O._rotation21*st._positionY+O._rotation22*st._positionZ,et._positionX=Zt,et._positionY=xt,et._positionZ=zt,et._positionX+=O._positionX,et._positionY+=O._positionY,et._positionZ+=O._positionZ;let Yt=N._transform,pt=N._localTransform,ct,nt,tt,Lt,Bt,Mt,jt,ci,Xi;ct=$._rotation00*pt._rotation00+$._rotation01*pt._rotation10+$._rotation02*pt._rotation20,nt=$._rotation00*pt._rotation01+$._rotation01*pt._rotation11+$._rotation02*pt._rotation21,tt=$._rotation00*pt._rotation02+$._rotation01*pt._rotation12+$._rotation02*pt._rotation22,Lt=$._rotation10*pt._rotation00+$._rotation11*pt._rotation10+$._rotation12*pt._rotation20,Bt=$._rotation10*pt._rotation01+$._rotation11*pt._rotation11+$._rotation12*pt._rotation21,Mt=$._rotation10*pt._rotation02+$._rotation11*pt._rotation12+$._rotation12*pt._rotation22,jt=$._rotation20*pt._rotation00+$._rotation21*pt._rotation10+$._rotation22*pt._rotation20,ci=$._rotation20*pt._rotation01+$._rotation21*pt._rotation11+$._rotation22*pt._rotation21,Xi=$._rotation20*pt._rotation02+$._rotation21*pt._rotation12+$._rotation22*pt._rotation22,Yt._rotation00=ct,Yt._rotation01=nt,Yt._rotation02=tt,Yt._rotation10=Lt,Yt._rotation11=Bt,Yt._rotation12=Mt,Yt._rotation20=jt,Yt._rotation21=ci,Yt._rotation22=Xi;let Yi,Li,wi;Yi=$._rotation00*pt._positionX+$._rotation01*pt._positionY+$._rotation02*pt._positionZ,Li=$._rotation10*pt._positionX+$._rotation11*pt._positionY+$._rotation12*pt._positionZ,wi=$._rotation20*pt._positionX+$._rotation21*pt._positionY+$._rotation22*pt._positionZ,Yt._positionX=Yi,Yt._positionY=Li,Yt._positionZ=wi,Yt._positionX+=$._positionX,Yt._positionY+=$._positionY,Yt._positionZ+=$._positionZ;let ei,qt,At,ni,ui,Oi;if(N._geom._computeAabb(N._aabb,N._ptransform),ei=N._aabb._minX,qt=N._aabb._minY,At=N._aabb._minZ,ni=N._aabb._maxX,ui=N._aabb._maxY,Oi=N._aabb._maxZ,N._geom._computeAabb(N._aabb,N._transform),N._aabb._minX=ei<N._aabb._minX?ei:N._aabb._minX,N._aabb._minY=qt<N._aabb._minY?qt:N._aabb._minY,N._aabb._minZ=At<N._aabb._minZ?At:N._aabb._minZ,N._aabb._maxX=ni>N._aabb._maxX?ni:N._aabb._maxX,N._aabb._maxY=ui>N._aabb._maxY?ui:N._aabb._maxY,N._aabb._maxZ=Oi>N._aabb._maxZ?Oi:N._aabb._maxZ,N._proxy!=null){let Bi,kt,wt;Bi=N._transform._positionX-N._ptransform._positionX,kt=N._transform._positionY-N._ptransform._positionY,wt=N._transform._positionZ-N._ptransform._positionZ;let $t=N.displacement;$t.x=Bi,$t.y=kt,$t.z=wt,N._rigidBody._world._broadPhase.moveProxy(N._proxy,N._aabb,N.displacement)}N=K}this._sleeping=!1,this._sleepTime=0}getOrientation(){let t=new m.common.Quat,i,s,o,n,l=this._transform._rotation00,_=this._transform._rotation11,r=this._transform._rotation22,e=l+_+r,a;return e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._transform._rotation21-this._transform._rotation12)*a,s=(this._transform._rotation02-this._transform._rotation20)*a,o=(this._transform._rotation10-this._transform._rotation01)*a):l>_?l>r?(a=Math.sqrt(l-_-r+1),i=.5*a,a=.5/a,s=(this._transform._rotation01+this._transform._rotation10)*a,o=(this._transform._rotation02+this._transform._rotation20)*a,n=(this._transform._rotation21-this._transform._rotation12)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a):_>r?(a=Math.sqrt(_-r-l+1),s=.5*a,a=.5/a,i=(this._transform._rotation01+this._transform._rotation10)*a,o=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation02-this._transform._rotation20)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a),t.x=i,t.y=s,t.z=o,t.w=n,t}getOrientationTo(t){let i,s,o,n,l=this._transform._rotation00,_=this._transform._rotation11,r=this._transform._rotation22,e=l+_+r,a;e>0?(a=Math.sqrt(e+1),n=.5*a,a=.5/a,i=(this._transform._rotation21-this._transform._rotation12)*a,s=(this._transform._rotation02-this._transform._rotation20)*a,o=(this._transform._rotation10-this._transform._rotation01)*a):l>_?l>r?(a=Math.sqrt(l-_-r+1),i=.5*a,a=.5/a,s=(this._transform._rotation01+this._transform._rotation10)*a,o=(this._transform._rotation02+this._transform._rotation20)*a,n=(this._transform._rotation21-this._transform._rotation12)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a):_>r?(a=Math.sqrt(_-r-l+1),s=.5*a,a=.5/a,i=(this._transform._rotation01+this._transform._rotation10)*a,o=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation02-this._transform._rotation20)*a):(a=Math.sqrt(r-l-_+1),o=.5*a,a=.5/a,i=(this._transform._rotation02+this._transform._rotation20)*a,s=(this._transform._rotation12+this._transform._rotation21)*a,n=(this._transform._rotation10-this._transform._rotation01)*a),t.x=i,t.y=s,t.z=o,t.w=n}setOrientation(t){let i,s,o,n;i=t.x,s=t.y,o=t.z,n=t.w;let l=i,_=s,r=o,e=n,a=2*l,h=2*_,b=2*r,X=l*a,c=_*h,Y=r*b,p=l*h,x=_*b,v=l*b,f=e*a,Z=e*h,k=e*b;this._transform._rotation00=1-c-Y,this._transform._rotation01=p-k,this._transform._rotation02=v+Z,this._transform._rotation10=p+k,this._transform._rotation11=1-X-Y,this._transform._rotation12=x-f,this._transform._rotation20=v-Z,this._transform._rotation21=x+f,this._transform._rotation22=1-X-c;let g,I,z,d,u,B,j,L,V;g=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,I=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,z=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,d=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,u=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,B=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,j=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,L=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,V=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=g,this._invInertia01=I,this._invInertia02=z,this._invInertia10=d,this._invInertia11=u,this._invInertia12=B,this._invInertia20=j,this._invInertia21=L,this._invInertia22=V;let M,w,P,E,C,S,A,R,H;M=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,w=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,P=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,E=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,C=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,S=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,A=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,R=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,H=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=M,this._invInertia01=w,this._invInertia02=P,this._invInertia10=E,this._invInertia11=C,this._invInertia12=S,this._invInertia20=A,this._invInertia21=R,this._invInertia22=H,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let y=this._ptransform,D=this._transform;y._positionX=D._positionX,y._positionY=D._positionY,y._positionZ=D._positionZ,y._rotation00=D._rotation00,y._rotation01=D._rotation01,y._rotation02=D._rotation02,y._rotation10=D._rotation10,y._rotation11=D._rotation11,y._rotation12=D._rotation12,y._rotation20=D._rotation20,y._rotation21=D._rotation21,y._rotation22=D._rotation22;let F=this._shapeList;for(;F!=null;){let Q=F._next,W=this._ptransform,q=this._transform,U=F._ptransform,G=F._localTransform,J,N,K,O,$,et,st,lt,rt;J=W._rotation00*G._rotation00+W._rotation01*G._rotation10+W._rotation02*G._rotation20,N=W._rotation00*G._rotation01+W._rotation01*G._rotation11+W._rotation02*G._rotation21,K=W._rotation00*G._rotation02+W._rotation01*G._rotation12+W._rotation02*G._rotation22,O=W._rotation10*G._rotation00+W._rotation11*G._rotation10+W._rotation12*G._rotation20,$=W._rotation10*G._rotation01+W._rotation11*G._rotation11+W._rotation12*G._rotation21,et=W._rotation10*G._rotation02+W._rotation11*G._rotation12+W._rotation12*G._rotation22,st=W._rotation20*G._rotation00+W._rotation21*G._rotation10+W._rotation22*G._rotation20,lt=W._rotation20*G._rotation01+W._rotation21*G._rotation11+W._rotation22*G._rotation21,rt=W._rotation20*G._rotation02+W._rotation21*G._rotation12+W._rotation22*G._rotation22,U._rotation00=J,U._rotation01=N,U._rotation02=K,U._rotation10=O,U._rotation11=$,U._rotation12=et,U._rotation20=st,U._rotation21=lt,U._rotation22=rt;let at,ot,ht;at=W._rotation00*G._positionX+W._rotation01*G._positionY+W._rotation02*G._positionZ,ot=W._rotation10*G._positionX+W._rotation11*G._positionY+W._rotation12*G._positionZ,ht=W._rotation20*G._positionX+W._rotation21*G._positionY+W._rotation22*G._positionZ,U._positionX=at,U._positionY=ot,U._positionZ=ht,U._positionX+=W._positionX,U._positionY+=W._positionY,U._positionZ+=W._positionZ;let _t=F._transform,bt=F._localTransform,Xt,ft,Zt,xt,zt,Yt,pt,ct,nt;Xt=q._rotation00*bt._rotation00+q._rotation01*bt._rotation10+q._rotation02*bt._rotation20,ft=q._rotation00*bt._rotation01+q._rotation01*bt._rotation11+q._rotation02*bt._rotation21,Zt=q._rotation00*bt._rotation02+q._rotation01*bt._rotation12+q._rotation02*bt._rotation22,xt=q._rotation10*bt._rotation00+q._rotation11*bt._rotation10+q._rotation12*bt._rotation20,zt=q._rotation10*bt._rotation01+q._rotation11*bt._rotation11+q._rotation12*bt._rotation21,Yt=q._rotation10*bt._rotation02+q._rotation11*bt._rotation12+q._rotation12*bt._rotation22,pt=q._rotation20*bt._rotation00+q._rotation21*bt._rotation10+q._rotation22*bt._rotation20,ct=q._rotation20*bt._rotation01+q._rotation21*bt._rotation11+q._rotation22*bt._rotation21,nt=q._rotation20*bt._rotation02+q._rotation21*bt._rotation12+q._rotation22*bt._rotation22,_t._rotation00=Xt,_t._rotation01=ft,_t._rotation02=Zt,_t._rotation10=xt,_t._rotation11=zt,_t._rotation12=Yt,_t._rotation20=pt,_t._rotation21=ct,_t._rotation22=nt;let tt,Lt,Bt;tt=q._rotation00*bt._positionX+q._rotation01*bt._positionY+q._rotation02*bt._positionZ,Lt=q._rotation10*bt._positionX+q._rotation11*bt._positionY+q._rotation12*bt._positionZ,Bt=q._rotation20*bt._positionX+q._rotation21*bt._positionY+q._rotation22*bt._positionZ,_t._positionX=tt,_t._positionY=Lt,_t._positionZ=Bt,_t._positionX+=q._positionX,_t._positionY+=q._positionY,_t._positionZ+=q._positionZ;let Mt,jt,ci,Xi,Yi,Li;if(F._geom._computeAabb(F._aabb,F._ptransform),Mt=F._aabb._minX,jt=F._aabb._minY,ci=F._aabb._minZ,Xi=F._aabb._maxX,Yi=F._aabb._maxY,Li=F._aabb._maxZ,F._geom._computeAabb(F._aabb,F._transform),F._aabb._minX=Mt<F._aabb._minX?Mt:F._aabb._minX,F._aabb._minY=jt<F._aabb._minY?jt:F._aabb._minY,F._aabb._minZ=ci<F._aabb._minZ?ci:F._aabb._minZ,F._aabb._maxX=Xi>F._aabb._maxX?Xi:F._aabb._maxX,F._aabb._maxY=Yi>F._aabb._maxY?Yi:F._aabb._maxY,F._aabb._maxZ=Li>F._aabb._maxZ?Li:F._aabb._maxZ,F._proxy!=null){let wi,ei,qt;wi=F._transform._positionX-F._ptransform._positionX,ei=F._transform._positionY-F._ptransform._positionY,qt=F._transform._positionZ-F._ptransform._positionZ;let At=F.displacement;At.x=wi,At.y=ei,At.z=qt,F._rigidBody._world._broadPhase.moveProxy(F._proxy,F._aabb,F.displacement)}F=Q}this._sleeping=!1,this._sleepTime=0}getTransform(){let t=this._transform,i=new m.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setTransform(t){this._transform._positionX=t._positionX,this._transform._positionY=t._positionY,this._transform._positionZ=t._positionZ,this._transform._rotation00=t._rotation00,this._transform._rotation01=t._rotation01,this._transform._rotation02=t._rotation02,this._transform._rotation10=t._rotation10,this._transform._rotation11=t._rotation11,this._transform._rotation12=t._rotation12,this._transform._rotation20=t._rotation20,this._transform._rotation21=t._rotation21,this._transform._rotation22=t._rotation22;let i,s,o,n,l,_,r,e,a;i=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,s=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,o=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,n=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,l=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,_=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,r=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,e=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,a=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=i,this._invInertia01=s,this._invInertia02=o,this._invInertia10=n,this._invInertia11=l,this._invInertia12=_,this._invInertia20=r,this._invInertia21=e,this._invInertia22=a;let h,b,X,c,Y,p,x,v,f;h=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,b=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,X=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,c=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,Y=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,p=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,x=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,v=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,f=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=h,this._invInertia01=b,this._invInertia02=X,this._invInertia10=c,this._invInertia11=Y,this._invInertia12=p,this._invInertia20=x,this._invInertia21=v,this._invInertia22=f,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z;let Z=this._ptransform,k=this._transform;Z._positionX=k._positionX,Z._positionY=k._positionY,Z._positionZ=k._positionZ,Z._rotation00=k._rotation00,Z._rotation01=k._rotation01,Z._rotation02=k._rotation02,Z._rotation10=k._rotation10,Z._rotation11=k._rotation11,Z._rotation12=k._rotation12,Z._rotation20=k._rotation20,Z._rotation21=k._rotation21,Z._rotation22=k._rotation22;let g=this._shapeList;for(;g!=null;){let I=g._next,z=this._ptransform,d=this._transform,u=g._ptransform,B=g._localTransform,j,L,V,M,w,P,E,C,S;j=z._rotation00*B._rotation00+z._rotation01*B._rotation10+z._rotation02*B._rotation20,L=z._rotation00*B._rotation01+z._rotation01*B._rotation11+z._rotation02*B._rotation21,V=z._rotation00*B._rotation02+z._rotation01*B._rotation12+z._rotation02*B._rotation22,M=z._rotation10*B._rotation00+z._rotation11*B._rotation10+z._rotation12*B._rotation20,w=z._rotation10*B._rotation01+z._rotation11*B._rotation11+z._rotation12*B._rotation21,P=z._rotation10*B._rotation02+z._rotation11*B._rotation12+z._rotation12*B._rotation22,E=z._rotation20*B._rotation00+z._rotation21*B._rotation10+z._rotation22*B._rotation20,C=z._rotation20*B._rotation01+z._rotation21*B._rotation11+z._rotation22*B._rotation21,S=z._rotation20*B._rotation02+z._rotation21*B._rotation12+z._rotation22*B._rotation22,u._rotation00=j,u._rotation01=L,u._rotation02=V,u._rotation10=M,u._rotation11=w,u._rotation12=P,u._rotation20=E,u._rotation21=C,u._rotation22=S;let A,R,H;A=z._rotation00*B._positionX+z._rotation01*B._positionY+z._rotation02*B._positionZ,R=z._rotation10*B._positionX+z._rotation11*B._positionY+z._rotation12*B._positionZ,H=z._rotation20*B._positionX+z._rotation21*B._positionY+z._rotation22*B._positionZ,u._positionX=A,u._positionY=R,u._positionZ=H,u._positionX+=z._positionX,u._positionY+=z._positionY,u._positionZ+=z._positionZ;let y=g._transform,D=g._localTransform,F,Q,W,q,U,G,J,N,K;F=d._rotation00*D._rotation00+d._rotation01*D._rotation10+d._rotation02*D._rotation20,Q=d._rotation00*D._rotation01+d._rotation01*D._rotation11+d._rotation02*D._rotation21,W=d._rotation00*D._rotation02+d._rotation01*D._rotation12+d._rotation02*D._rotation22,q=d._rotation10*D._rotation00+d._rotation11*D._rotation10+d._rotation12*D._rotation20,U=d._rotation10*D._rotation01+d._rotation11*D._rotation11+d._rotation12*D._rotation21,G=d._rotation10*D._rotation02+d._rotation11*D._rotation12+d._rotation12*D._rotation22,J=d._rotation20*D._rotation00+d._rotation21*D._rotation10+d._rotation22*D._rotation20,N=d._rotation20*D._rotation01+d._rotation21*D._rotation11+d._rotation22*D._rotation21,K=d._rotation20*D._rotation02+d._rotation21*D._rotation12+d._rotation22*D._rotation22,y._rotation00=F,y._rotation01=Q,y._rotation02=W,y._rotation10=q,y._rotation11=U,y._rotation12=G,y._rotation20=J,y._rotation21=N,y._rotation22=K;let O,$,et;O=d._rotation00*D._positionX+d._rotation01*D._positionY+d._rotation02*D._positionZ,$=d._rotation10*D._positionX+d._rotation11*D._positionY+d._rotation12*D._positionZ,et=d._rotation20*D._positionX+d._rotation21*D._positionY+d._rotation22*D._positionZ,y._positionX=O,y._positionY=$,y._positionZ=et,y._positionX+=d._positionX,y._positionY+=d._positionY,y._positionZ+=d._positionZ;let st,lt,rt,at,ot,ht;if(g._geom._computeAabb(g._aabb,g._ptransform),st=g._aabb._minX,lt=g._aabb._minY,rt=g._aabb._minZ,at=g._aabb._maxX,ot=g._aabb._maxY,ht=g._aabb._maxZ,g._geom._computeAabb(g._aabb,g._transform),g._aabb._minX=st<g._aabb._minX?st:g._aabb._minX,g._aabb._minY=lt<g._aabb._minY?lt:g._aabb._minY,g._aabb._minZ=rt<g._aabb._minZ?rt:g._aabb._minZ,g._aabb._maxX=at>g._aabb._maxX?at:g._aabb._maxX,g._aabb._maxY=ot>g._aabb._maxY?ot:g._aabb._maxY,g._aabb._maxZ=ht>g._aabb._maxZ?ht:g._aabb._maxZ,g._proxy!=null){let _t,bt,Xt;_t=g._transform._positionX-g._ptransform._positionX,bt=g._transform._positionY-g._ptransform._positionY,Xt=g._transform._positionZ-g._ptransform._positionZ;let ft=g.displacement;ft.x=_t,ft.y=bt,ft.z=Xt,g._rigidBody._world._broadPhase.moveProxy(g._proxy,g._aabb,g.displacement)}g=I}this._sleeping=!1,this._sleepTime=0}getMass(){return this._mass}getLocalInertia(){let t=new m.common.Mat3;return t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22,t}getLocalInertiaTo(t){t.e00=this._localInertia00,t.e01=this._localInertia01,t.e02=this._localInertia02,t.e10=this._localInertia10,t.e11=this._localInertia11,t.e12=this._localInertia12,t.e20=this._localInertia20,t.e21=this._localInertia21,t.e22=this._localInertia22}getMassData(){let t=new m.dynamics.rigidbody.MassData;t.mass=this._mass;let i=t.localInertia;return i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22,t}getMassDataTo(t){t.mass=this._mass;let i=t.localInertia;i.e00=this._localInertia00,i.e01=this._localInertia01,i.e02=this._localInertia02,i.e10=this._localInertia10,i.e11=this._localInertia11,i.e12=this._localInertia12,i.e20=this._localInertia20,i.e21=this._localInertia21,i.e22=this._localInertia22}setMassData(t){this._mass=t.mass;let i=t.localInertia;if(this._localInertia00=i.e00,this._localInertia01=i.e01,this._localInertia02=i.e02,this._localInertia10=i.e10,this._localInertia11=i.e11,this._localInertia12=i.e12,this._localInertia20=i.e20,this._localInertia21=i.e21,this._localInertia22=i.e22,this._mass>0&&this._localInertia00*(this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21)-this._localInertia01*(this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20)+this._localInertia02*(this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20)>0&&this._type==0){this._invMass=1/this._mass;let k=this._localInertia11*this._localInertia22-this._localInertia12*this._localInertia21,g=this._localInertia10*this._localInertia22-this._localInertia12*this._localInertia20,I=this._localInertia10*this._localInertia21-this._localInertia11*this._localInertia20,z=this._localInertia00*k-this._localInertia01*g+this._localInertia02*I;(z<-1e-32||z>1e-32)&&(z=1/z),this._invLocalInertia00=k*z,this._invLocalInertia01=-(this._localInertia01*this._localInertia22-this._localInertia02*this._localInertia21)*z,this._invLocalInertia02=(this._localInertia01*this._localInertia12-this._localInertia02*this._localInertia11)*z,this._invLocalInertia10=-g*z,this._invLocalInertia11=(this._localInertia00*this._localInertia22-this._localInertia02*this._localInertia20)*z,this._invLocalInertia12=-(this._localInertia00*this._localInertia12-this._localInertia02*this._localInertia10)*z,this._invLocalInertia20=I*z,this._invLocalInertia21=-(this._localInertia00*this._localInertia21-this._localInertia01*this._localInertia20)*z,this._invLocalInertia22=(this._localInertia00*this._localInertia11-this._localInertia01*this._localInertia10)*z,this._invLocalInertiaWithoutRotFactor00=this._invLocalInertia00,this._invLocalInertiaWithoutRotFactor01=this._invLocalInertia01,this._invLocalInertiaWithoutRotFactor02=this._invLocalInertia02,this._invLocalInertiaWithoutRotFactor10=this._invLocalInertia10,this._invLocalInertiaWithoutRotFactor11=this._invLocalInertia11,this._invLocalInertiaWithoutRotFactor12=this._invLocalInertia12,this._invLocalInertiaWithoutRotFactor20=this._invLocalInertia20,this._invLocalInertiaWithoutRotFactor21=this._invLocalInertia21,this._invLocalInertiaWithoutRotFactor22=this._invLocalInertia22,this._invLocalInertia00=this._invLocalInertiaWithoutRotFactor00*this._rotFactor.x,this._invLocalInertia01=this._invLocalInertiaWithoutRotFactor01*this._rotFactor.x,this._invLocalInertia02=this._invLocalInertiaWithoutRotFactor02*this._rotFactor.x,this._invLocalInertia10=this._invLocalInertiaWithoutRotFactor10*this._rotFactor.y,this._invLocalInertia11=this._invLocalInertiaWithoutRotFactor11*this._rotFactor.y,this._invLocalInertia12=this._invLocalInertiaWithoutRotFactor12*this._rotFactor.y,this._invLocalInertia20=this._invLocalInertiaWithoutRotFactor20*this._rotFactor.z,this._invLocalInertia21=this._invLocalInertiaWithoutRotFactor21*this._rotFactor.z,this._invLocalInertia22=this._invLocalInertiaWithoutRotFactor22*this._rotFactor.z}else this._invMass=0,this._invLocalInertia00=0,this._invLocalInertia01=0,this._invLocalInertia02=0,this._invLocalInertia10=0,this._invLocalInertia11=0,this._invLocalInertia12=0,this._invLocalInertia20=0,this._invLocalInertia21=0,this._invLocalInertia22=0,this._invLocalInertiaWithoutRotFactor00=0,this._invLocalInertiaWithoutRotFactor01=0,this._invLocalInertiaWithoutRotFactor02=0,this._invLocalInertiaWithoutRotFactor10=0,this._invLocalInertiaWithoutRotFactor11=0,this._invLocalInertiaWithoutRotFactor12=0,this._invLocalInertiaWithoutRotFactor20=0,this._invLocalInertiaWithoutRotFactor21=0,this._invLocalInertiaWithoutRotFactor22=0,this._type==0&&(this._type=1);let s,o,n,l,_,r,e,a,h;s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,l=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=o,this._invInertia02=n,this._invInertia10=l,this._invInertia11=_,this._invInertia12=r,this._invInertia20=e,this._invInertia21=a,this._invInertia22=h;let b,X,c,Y,p,x,v,f,Z;b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,X=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Y=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=X,this._invInertia02=c,this._invInertia10=Y,this._invInertia11=p,this._invInertia12=x,this._invInertia20=v,this._invInertia21=f,this._invInertia22=Z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getRotationFactor(){let t=this._rotFactor;return new m.common.Vec3(t.x,t.y,t.z)}setRotationFactor(t){let i=this._rotFactor;i.x=t.x,i.y=t.y,i.z=t.z;let s,o,n,l,_,r,e,a,h;s=this._transform._rotation00*this._invLocalInertia00+this._transform._rotation01*this._invLocalInertia10+this._transform._rotation02*this._invLocalInertia20,o=this._transform._rotation00*this._invLocalInertia01+this._transform._rotation01*this._invLocalInertia11+this._transform._rotation02*this._invLocalInertia21,n=this._transform._rotation00*this._invLocalInertia02+this._transform._rotation01*this._invLocalInertia12+this._transform._rotation02*this._invLocalInertia22,l=this._transform._rotation10*this._invLocalInertia00+this._transform._rotation11*this._invLocalInertia10+this._transform._rotation12*this._invLocalInertia20,_=this._transform._rotation10*this._invLocalInertia01+this._transform._rotation11*this._invLocalInertia11+this._transform._rotation12*this._invLocalInertia21,r=this._transform._rotation10*this._invLocalInertia02+this._transform._rotation11*this._invLocalInertia12+this._transform._rotation12*this._invLocalInertia22,e=this._transform._rotation20*this._invLocalInertia00+this._transform._rotation21*this._invLocalInertia10+this._transform._rotation22*this._invLocalInertia20,a=this._transform._rotation20*this._invLocalInertia01+this._transform._rotation21*this._invLocalInertia11+this._transform._rotation22*this._invLocalInertia21,h=this._transform._rotation20*this._invLocalInertia02+this._transform._rotation21*this._invLocalInertia12+this._transform._rotation22*this._invLocalInertia22,this._invInertia00=s,this._invInertia01=o,this._invInertia02=n,this._invInertia10=l,this._invInertia11=_,this._invInertia12=r,this._invInertia20=e,this._invInertia21=a,this._invInertia22=h;let b,X,c,Y,p,x,v,f,Z;b=this._invInertia00*this._transform._rotation00+this._invInertia01*this._transform._rotation01+this._invInertia02*this._transform._rotation02,X=this._invInertia00*this._transform._rotation10+this._invInertia01*this._transform._rotation11+this._invInertia02*this._transform._rotation12,c=this._invInertia00*this._transform._rotation20+this._invInertia01*this._transform._rotation21+this._invInertia02*this._transform._rotation22,Y=this._invInertia10*this._transform._rotation00+this._invInertia11*this._transform._rotation01+this._invInertia12*this._transform._rotation02,p=this._invInertia10*this._transform._rotation10+this._invInertia11*this._transform._rotation11+this._invInertia12*this._transform._rotation12,x=this._invInertia10*this._transform._rotation20+this._invInertia11*this._transform._rotation21+this._invInertia12*this._transform._rotation22,v=this._invInertia20*this._transform._rotation00+this._invInertia21*this._transform._rotation01+this._invInertia22*this._transform._rotation02,f=this._invInertia20*this._transform._rotation10+this._invInertia21*this._transform._rotation11+this._invInertia22*this._transform._rotation12,Z=this._invInertia20*this._transform._rotation20+this._invInertia21*this._transform._rotation21+this._invInertia22*this._transform._rotation22,this._invInertia00=b,this._invInertia01=X,this._invInertia02=c,this._invInertia10=Y,this._invInertia11=p,this._invInertia12=x,this._invInertia20=v,this._invInertia21=f,this._invInertia22=Z,this._invInertia00*=this._rotFactor.x,this._invInertia01*=this._rotFactor.x,this._invInertia02*=this._rotFactor.x,this._invInertia10*=this._rotFactor.y,this._invInertia11*=this._rotFactor.y,this._invInertia12*=this._rotFactor.y,this._invInertia20*=this._rotFactor.z,this._invInertia21*=this._rotFactor.z,this._invInertia22*=this._rotFactor.z,this._sleeping=!1,this._sleepTime=0}getLinearVelocity(){let t=new m.common.Vec3;return t.x=this._velX,t.y=this._velY,t.z=this._velZ,t}getLinearVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setLinearVelocity(t){this._type==1?(this._velX=0,this._velY=0,this._velZ=0):(this._velX=t.x,this._velY=t.y,this._velZ=t.z),this._sleeping=!1,this._sleepTime=0}getAngularVelocity(){let t=new m.common.Vec3;return t.x=this._angVelX,t.y=this._angVelY,t.z=this._angVelZ,t}getAngularVelocityTo(t){t.x=this._velX,t.y=this._velY,t.z=this._velZ}setAngularVelocity(t){this._type==1?(this._angVelX=0,this._angVelY=0,this._angVelZ=0):(this._angVelX=t.x,this._angVelY=t.y,this._angVelZ=t.z),this._sleeping=!1,this._sleepTime=0}addLinearVelocity(t){if(this._type!=1){let i,s,o;i=t.x,s=t.y,o=t.z,this._velX+=i,this._velY+=s,this._velZ+=o}this._sleeping=!1,this._sleepTime=0}addAngularVelocity(t){if(this._type!=1){let i,s,o;i=t.x,s=t.y,o=t.z,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=o}this._sleeping=!1,this._sleepTime=0}applyImpulse(t,i){let s,o,n;s=t.x,o=t.y,n=t.z,this._velX+=s*this._invMass,this._velY+=o*this._invMass,this._velZ+=n*this._invMass;let l,_,r,e,a,h;e=i.x,a=i.y,h=i.z,e-=this._transform._positionX,a-=this._transform._positionY,h-=this._transform._positionZ,l=a*n-h*o,_=h*s-e*n,r=e*o-a*s;let b,X,c;b=this._invInertia00*l+this._invInertia01*_+this._invInertia02*r,X=this._invInertia10*l+this._invInertia11*_+this._invInertia12*r,c=this._invInertia20*l+this._invInertia21*_+this._invInertia22*r,l=b,_=X,r=c,this._angVelX+=l,this._angVelY+=_,this._angVelZ+=r,this._sleeping=!1,this._sleepTime=0}applyLinearImpulse(t){let i,s,o;i=t.x,s=t.y,o=t.z,this._velX+=i*this._invMass,this._velY+=s*this._invMass,this._velZ+=o*this._invMass,this._sleeping=!1,this._sleepTime=0}applyAngularImpulse(t){let i,s,o;i=t.x,s=t.y,o=t.z;let n,l,_;n=this._invInertia00*i+this._invInertia01*s+this._invInertia02*o,l=this._invInertia10*i+this._invInertia11*s+this._invInertia12*o,_=this._invInertia20*i+this._invInertia21*s+this._invInertia22*o,i=n,s=l,o=_,this._angVelX+=i,this._angVelY+=s,this._angVelZ+=o,this._sleeping=!1,this._sleepTime=0}applyForce(t,i){let s,o,n;s=t.x,o=t.y,n=t.z,this._forceX+=s,this._forceY+=o,this._forceZ+=n;let l,_,r,e,a,h;e=i.x,a=i.y,h=i.z,e-=this._transform._positionX,a-=this._transform._positionY,h-=this._transform._positionZ,l=a*n-h*o,_=h*s-e*n,r=e*o-a*s,this._torqueX+=l,this._torqueY+=_,this._torqueZ+=r,this._sleeping=!1,this._sleepTime=0}applyForceToCenter(t){let i,s,o;i=t.x,s=t.y,o=t.z,this._forceX+=i,this._forceY+=s,this._forceZ+=o,this._sleeping=!1,this._sleepTime=0}applyTorque(t){let i,s,o;i=t.x,s=t.y,o=t.z,this._torqueX+=i,this._torqueY+=s,this._torqueZ+=o,this._sleeping=!1,this._sleepTime=0}getLinearContactImpulse(){let t=new m.common.Vec3;return t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ,t}getLinearContactImpulseTo(t){t.x=this._linearContactImpulseX,t.y=this._linearContactImpulseY,t.z=this._linearContactImpulseZ}getAngularContactImpulse(){let t=new m.common.Vec3;return t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ,t}getAngularContactImpulseTo(t){t.x=this._angularContactImpulseX,t.y=this._angularContactImpulseY,t.z=this._angularContactImpulseZ}getGravityScale(){return this._gravityScale}setGravityScale(t){this._gravityScale=t,this._sleeping=!1,this._sleepTime=0}getLocalPoint(t){let i,s,o;i=t.x,s=t.y,o=t.z,i-=this._transform._positionX,s-=this._transform._positionY,o-=this._transform._positionZ;let n,l,_;n=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*o,l=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*o,_=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*o,i=n,s=l,o=_;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=o,r}getLocalPointTo(t,i){let s,o,n;s=t.x,o=t.y,n=t.z,s-=this._transform._positionX,o-=this._transform._positionY,n-=this._transform._positionZ;let l,_,r;l=this._transform._rotation00*s+this._transform._rotation10*o+this._transform._rotation20*n,_=this._transform._rotation01*s+this._transform._rotation11*o+this._transform._rotation21*n,r=this._transform._rotation02*s+this._transform._rotation12*o+this._transform._rotation22*n,s=l,o=_,n=r,i.x=s,i.y=o,i.z=n}getLocalVector(t){let i,s,o;i=t.x,s=t.y,o=t.z;let n,l,_;n=this._transform._rotation00*i+this._transform._rotation10*s+this._transform._rotation20*o,l=this._transform._rotation01*i+this._transform._rotation11*s+this._transform._rotation21*o,_=this._transform._rotation02*i+this._transform._rotation12*s+this._transform._rotation22*o,i=n,s=l,o=_;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=o,r}getLocalVectorTo(t,i){let s,o,n;s=t.x,o=t.y,n=t.z;let l,_,r;l=this._transform._rotation00*s+this._transform._rotation10*o+this._transform._rotation20*n,_=this._transform._rotation01*s+this._transform._rotation11*o+this._transform._rotation21*n,r=this._transform._rotation02*s+this._transform._rotation12*o+this._transform._rotation22*n,s=l,o=_,n=r,i.x=s,i.y=o,i.z=n}getWorldPoint(t){let i,s,o;i=t.x,s=t.y,o=t.z;let n,l,_;n=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*o,l=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*o,_=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*o,i=n,s=l,o=_,i+=this._transform._positionX,s+=this._transform._positionY,o+=this._transform._positionZ;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=o,r}getWorldPointTo(t,i){let s,o,n;s=t.x,o=t.y,n=t.z;let l,_,r;l=this._transform._rotation00*s+this._transform._rotation01*o+this._transform._rotation02*n,_=this._transform._rotation10*s+this._transform._rotation11*o+this._transform._rotation12*n,r=this._transform._rotation20*s+this._transform._rotation21*o+this._transform._rotation22*n,s=l,o=_,n=r,s+=this._transform._positionX,o+=this._transform._positionY,n+=this._transform._positionZ,i.x=s,i.y=o,i.z=n}getWorldVector(t){let i,s,o;i=t.x,s=t.y,o=t.z;let n,l,_;n=this._transform._rotation00*i+this._transform._rotation01*s+this._transform._rotation02*o,l=this._transform._rotation10*i+this._transform._rotation11*s+this._transform._rotation12*o,_=this._transform._rotation20*i+this._transform._rotation21*s+this._transform._rotation22*o,i=n,s=l,o=_;let r=new m.common.Vec3;return r.x=i,r.y=s,r.z=o,r}getWorldVectorTo(t,i){let s,o,n;s=t.x,o=t.y,n=t.z;let l,_,r;l=this._transform._rotation00*s+this._transform._rotation01*o+this._transform._rotation02*n,_=this._transform._rotation10*s+this._transform._rotation11*o+this._transform._rotation12*n,r=this._transform._rotation20*s+this._transform._rotation21*o+this._transform._rotation22*n,s=l,o=_,n=r,i.x=s,i.y=o,i.z=n}getNumShapes(){return this._numShapes}getShapeList(){return this._shapeList}getNumContectLinks(){return this._numContactLinks}getContactLinkList(){return this._contactLinkList}getNumJointLinks(){return this._numJointLinks}getJointLinkList(){return this._jointLinkList}addShape(t){if(this._shapeList==null?(this._shapeList=t,this._shapeListLast=t):(this._shapeListLast._next=t,t._prev=this._shapeListLast,this._shapeListLast=t),this._numShapes++,t._rigidBody=this,this._world!=null){let s=this._world;t._proxy=s._broadPhase.createProxy(t,t._aabb),t._id=s._shapeIdCount++,s._numShapes++}this.updateMass();let i=this._shapeList;for(;i!=null;){let s=i._next,o=this._ptransform,n=this._transform,l=i._ptransform,_=i._localTransform,r,e,a,h,b,X,c,Y,p;r=o._rotation00*_._rotation00+o._rotation01*_._rotation10+o._rotation02*_._rotation20,e=o._rotation00*_._rotation01+o._rotation01*_._rotation11+o._rotation02*_._rotation21,a=o._rotation00*_._rotation02+o._rotation01*_._rotation12+o._rotation02*_._rotation22,h=o._rotation10*_._rotation00+o._rotation11*_._rotation10+o._rotation12*_._rotation20,b=o._rotation10*_._rotation01+o._rotation11*_._rotation11+o._rotation12*_._rotation21,X=o._rotation10*_._rotation02+o._rotation11*_._rotation12+o._rotation12*_._rotation22,c=o._rotation20*_._rotation00+o._rotation21*_._rotation10+o._rotation22*_._rotation20,Y=o._rotation20*_._rotation01+o._rotation21*_._rotation11+o._rotation22*_._rotation21,p=o._rotation20*_._rotation02+o._rotation21*_._rotation12+o._rotation22*_._rotation22,l._rotation00=r,l._rotation01=e,l._rotation02=a,l._rotation10=h,l._rotation11=b,l._rotation12=X,l._rotation20=c,l._rotation21=Y,l._rotation22=p;let x,v,f;x=o._rotation00*_._positionX+o._rotation01*_._positionY+o._rotation02*_._positionZ,v=o._rotation10*_._positionX+o._rotation11*_._positionY+o._rotation12*_._positionZ,f=o._rotation20*_._positionX+o._rotation21*_._positionY+o._rotation22*_._positionZ,l._positionX=x,l._positionY=v,l._positionZ=f,l._positionX+=o._positionX,l._positionY+=o._positionY,l._positionZ+=o._positionZ;let Z=i._transform,k=i._localTransform,g,I,z,d,u,B,j,L,V;g=n._rotation00*k._rotation00+n._rotation01*k._rotation10+n._rotation02*k._rotation20,I=n._rotation00*k._rotation01+n._rotation01*k._rotation11+n._rotation02*k._rotation21,z=n._rotation00*k._rotation02+n._rotation01*k._rotation12+n._rotation02*k._rotation22,d=n._rotation10*k._rotation00+n._rotation11*k._rotation10+n._rotation12*k._rotation20,u=n._rotation10*k._rotation01+n._rotation11*k._rotation11+n._rotation12*k._rotation21,B=n._rotation10*k._rotation02+n._rotation11*k._rotation12+n._rotation12*k._rotation22,j=n._rotation20*k._rotation00+n._rotation21*k._rotation10+n._rotation22*k._rotation20,L=n._rotation20*k._rotation01+n._rotation21*k._rotation11+n._rotation22*k._rotation21,V=n._rotation20*k._rotation02+n._rotation21*k._rotation12+n._rotation22*k._rotation22,Z._rotation00=g,Z._rotation01=I,Z._rotation02=z,Z._rotation10=d,Z._rotation11=u,Z._rotation12=B,Z._rotation20=j,Z._rotation21=L,Z._rotation22=V;let M,w,P;M=n._rotation00*k._positionX+n._rotation01*k._positionY+n._rotation02*k._positionZ,w=n._rotation10*k._positionX+n._rotation11*k._positionY+n._rotation12*k._positionZ,P=n._rotation20*k._positionX+n._rotation21*k._positionY+n._rotation22*k._positionZ,Z._positionX=M,Z._positionY=w,Z._positionZ=P,Z._positionX+=n._positionX,Z._positionY+=n._positionY,Z._positionZ+=n._positionZ;let E,C,S,A,R,H;if(i._geom._computeAabb(i._aabb,i._ptransform),E=i._aabb._minX,C=i._aabb._minY,S=i._aabb._minZ,A=i._aabb._maxX,R=i._aabb._maxY,H=i._aabb._maxZ,i._geom._computeAabb(i._aabb,i._transform),i._aabb._minX=E<i._aabb._minX?E:i._aabb._minX,i._aabb._minY=C<i._aabb._minY?C:i._aabb._minY,i._aabb._minZ=S<i._aabb._minZ?S:i._aabb._minZ,i._aabb._maxX=A>i._aabb._maxX?A:i._aabb._maxX,i._aabb._maxY=R>i._aabb._maxY?R:i._aabb._maxY,i._aabb._maxZ=H>i._aabb._maxZ?H:i._aabb._maxZ,i._proxy!=null){let y,D,F;y=i._transform._positionX-i._ptransform._positionX,D=i._transform._positionY-i._ptransform._positionY,F=i._transform._positionZ-i._ptransform._positionZ;let Q=i.displacement;Q.x=y,Q.y=D,Q.z=F,i._rigidBody._world._broadPhase.moveProxy(i._proxy,i._aabb,i.displacement)}i=s}}removeShape(t){let i=t._prev,s=t._next;if(i!=null&&(i._next=s),s!=null&&(s._prev=i),t==this._shapeList&&(this._shapeList=this._shapeList._next),t==this._shapeListLast&&(this._shapeListLast=this._shapeListLast._prev),t._next=null,t._prev=null,this._numShapes--,t._rigidBody=null,this._world!=null){let n=this._world;n._broadPhase.destroyProxy(t._proxy),t._proxy=null,t._id=-1;let l=t._rigidBody._contactLinkList;for(;l!=null;){let _=l._next,r=l._contact;if(r._s1==t||r._s2==t){let e=l._other;e._sleeping=!1,e._sleepTime=0;let a=n._contactManager,h=r._prev,b=r._next;if(h!=null&&(h._next=b),b!=null&&(b._prev=h),r==a._contactList&&(a._contactList=a._contactList._next),r==a._contactListLast&&(a._contactListLast=a._contactListLast._prev),r._next=null,r._prev=null,r._touching){let v=r._s1._contactCallback,f=r._s2._contactCallback;v==f&&(f=null),v!=null&&v.endContact(r),f!=null&&f.endContact(r)}let X=r._link1._prev,c=r._link1._next;X!=null&&(X._next=c),c!=null&&(c._prev=X),r._link1==r._b1._contactLinkList&&(r._b1._contactLinkList=r._b1._contactLinkList._next),r._link1==r._b1._contactLinkListLast&&(r._b1._contactLinkListLast=r._b1._contactLinkListLast._prev),r._link1._next=null,r._link1._prev=null;let Y=r._link2._prev,p=r._link2._next;Y!=null&&(Y._next=p),p!=null&&(p._prev=Y),r._link2==r._b2._contactLinkList&&(r._b2._contactLinkList=r._b2._contactLinkList._next),r._link2==r._b2._contactLinkListLast&&(r._b2._contactLinkListLast=r._b2._contactLinkListLast._prev),r._link2._next=null,r._link2._prev=null,r._b1._numContactLinks--,r._b2._numContactLinks--,r._link1._other=null,r._link2._other=null,r._link1._contact=null,r._link2._contact=null,r._s1=null,r._s2=null,r._b1=null,r._b2=null,r._touching=!1,r._cachedDetectorData._clear(),r._manifold._clear(),r._detector=null;let x=r._contactConstraint;x._s1=null,x._s2=null,x._b1=null,x._b2=null,x._tf1=null,x._tf2=null,r._next=a._contactPool,a._contactPool=r,a._numContacts--}l=_}n._numShapes--}this.updateMass();let o=this._shapeList;for(;o!=null;){let n=o._next,l=this._ptransform,_=this._transform,r=o._ptransform,e=o._localTransform,a,h,b,X,c,Y,p,x,v;a=l._rotation00*e._rotation00+l._rotation01*e._rotation10+l._rotation02*e._rotation20,h=l._rotation00*e._rotation01+l._rotation01*e._rotation11+l._rotation02*e._rotation21,b=l._rotation00*e._rotation02+l._rotation01*e._rotation12+l._rotation02*e._rotation22,X=l._rotation10*e._rotation00+l._rotation11*e._rotation10+l._rotation12*e._rotation20,c=l._rotation10*e._rotation01+l._rotation11*e._rotation11+l._rotation12*e._rotation21,Y=l._rotation10*e._rotation02+l._rotation11*e._rotation12+l._rotation12*e._rotation22,p=l._rotation20*e._rotation00+l._rotation21*e._rotation10+l._rotation22*e._rotation20,x=l._rotation20*e._rotation01+l._rotation21*e._rotation11+l._rotation22*e._rotation21,v=l._rotation20*e._rotation02+l._rotation21*e._rotation12+l._rotation22*e._rotation22,r._rotation00=a,r._rotation01=h,r._rotation02=b,r._rotation10=X,r._rotation11=c,r._rotation12=Y,r._rotation20=p,r._rotation21=x,r._rotation22=v;let f,Z,k;f=l._rotation00*e._positionX+l._rotation01*e._positionY+l._rotation02*e._positionZ,Z=l._rotation10*e._positionX+l._rotation11*e._positionY+l._rotation12*e._positionZ,k=l._rotation20*e._positionX+l._rotation21*e._positionY+l._rotation22*e._positionZ,r._positionX=f,r._positionY=Z,r._positionZ=k,r._positionX+=l._positionX,r._positionY+=l._positionY,r._positionZ+=l._positionZ;let g=o._transform,I=o._localTransform,z,d,u,B,j,L,V,M,w;z=_._rotation00*I._rotation00+_._rotation01*I._rotation10+_._rotation02*I._rotation20,d=_._rotation00*I._rotation01+_._rotation01*I._rotation11+_._rotation02*I._rotation21,u=_._rotation00*I._rotation02+_._rotation01*I._rotation12+_._rotation02*I._rotation22,B=_._rotation10*I._rotation00+_._rotation11*I._rotation10+_._rotation12*I._rotation20,j=_._rotation10*I._rotation01+_._rotation11*I._rotation11+_._rotation12*I._rotation21,L=_._rotation10*I._rotation02+_._rotation11*I._rotation12+_._rotation12*I._rotation22,V=_._rotation20*I._rotation00+_._rotation21*I._rotation10+_._rotation22*I._rotation20,M=_._rotation20*I._rotation01+_._rotation21*I._rotation11+_._rotation22*I._rotation21,w=_._rotation20*I._rotation02+_._rotation21*I._rotation12+_._rotation22*I._rotation22,g._rotation00=z,g._rotation01=d,g._rotation02=u,g._rotation10=B,g._rotation11=j,g._rotation12=L,g._rotation20=V,g._rotation21=M,g._rotation22=w;let P,E,C;P=_._rotation00*I._positionX+_._rotation01*I._positionY+_._rotation02*I._positionZ,E=_._rotation10*I._positionX+_._rotation11*I._positionY+_._rotation12*I._positionZ,C=_._rotation20*I._positionX+_._rotation21*I._positionY+_._rotation22*I._positionZ,g._positionX=P,g._positionY=E,g._positionZ=C,g._positionX+=_._positionX,g._positionY+=_._positionY,g._positionZ+=_._positionZ;let S,A,R,H,y,D;if(o._geom._computeAabb(o._aabb,o._ptransform),S=o._aabb._minX,A=o._aabb._minY,R=o._aabb._minZ,H=o._aabb._maxX,y=o._aabb._maxY,D=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=S<o._aabb._minX?S:o._aabb._minX,o._aabb._minY=A<o._aabb._minY?A:o._aabb._minY,o._aabb._minZ=R<o._aabb._minZ?R:o._aabb._minZ,o._aabb._maxX=H>o._aabb._maxX?H:o._aabb._maxX,o._aabb._maxY=y>o._aabb._maxY?y:o._aabb._maxY,o._aabb._maxZ=D>o._aabb._maxZ?D:o._aabb._maxZ,o._proxy!=null){let F,Q,W;F=o._transform._positionX-o._ptransform._positionX,Q=o._transform._positionY-o._ptransform._positionY,W=o._transform._positionZ-o._ptransform._positionZ;let q=o.displacement;q.x=F,q.y=Q,q.z=W,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=n}}getType(){return this._type}setType(t){this._type=t,this.updateMass()}wakeUp(){this._sleeping=!1,this._sleepTime=0}sleep(){this._sleeping=!0,this._sleepTime=0}isSleeping(){return this._sleeping}getSleepTime(){return this._sleepTime}setAutoSleep(t){this._autoSleep=t,this._sleeping=!1,this._sleepTime=0}getLinearDamping(){return this._linearDamping}setLinearDamping(t){this._linearDamping=t}getAngularDamping(){return this._angularDamping}setAngularDamping(t){this._angularDamping=t}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.rigidbody.RigidBodyConfig=class{constructor(){this.position=new m.common.Vec3,this.rotation=new m.common.Mat3,this.linearVelocity=new m.common.Vec3,this.angularVelocity=new m.common.Vec3,this.type=0,this.autoSleep=!0,this.linearDamping=0,this.angularDamping=0}};m.dynamics.rigidbody.RigidBodyType=class{};m.dynamics.rigidbody.Shape=class{constructor(t){this._id=-1,this._localTransform=new m.common.Transform,this._ptransform=new m.common.Transform,this._transform=new m.common.Transform;let i=t.position;this._localTransform._positionX=i.x,this._localTransform._positionY=i.y,this._localTransform._positionZ=i.z;let s=t.rotation;this._localTransform._rotation00=s.e00,this._localTransform._rotation01=s.e01,this._localTransform._rotation02=s.e02,this._localTransform._rotation10=s.e10,this._localTransform._rotation11=s.e11,this._localTransform._rotation12=s.e12,this._localTransform._rotation20=s.e20,this._localTransform._rotation21=s.e21,this._localTransform._rotation22=s.e22;let o=this._ptransform,n=this._localTransform;o._positionX=n._positionX,o._positionY=n._positionY,o._positionZ=n._positionZ,o._rotation00=n._rotation00,o._rotation01=n._rotation01,o._rotation02=n._rotation02,o._rotation10=n._rotation10,o._rotation11=n._rotation11,o._rotation12=n._rotation12,o._rotation20=n._rotation20,o._rotation21=n._rotation21,o._rotation22=n._rotation22;let l=this._transform,_=this._localTransform;l._positionX=_._positionX,l._positionY=_._positionY,l._positionZ=_._positionZ,l._rotation00=_._rotation00,l._rotation01=_._rotation01,l._rotation02=_._rotation02,l._rotation10=_._rotation10,l._rotation11=_._rotation11,l._rotation12=_._rotation12,l._rotation20=_._rotation20,l._rotation21=_._rotation21,l._rotation22=_._rotation22,this._restitution=t.restitution,this._friction=t.friction,this._density=t.density,this._geom=t.geometry,this._collisionGroup=t.collisionGroup,this._collisionMask=t.collisionMask,this._contactCallback=t.contactCallback,this._aabb=new m.collision.geometry.Aabb,this._proxy=null,this.displacement=new m.common.Vec3}getFriction(){return this._friction}setFriction(t){this._friction=t}getRestitution(){return this._restitution}setRestitution(t){this._restitution=t}getLocalTransform(){let t=this._localTransform,i=new m.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getLocalTransformTo(t){let i=this._localTransform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}getTransform(){let t=this._transform,i=new m.common.Transform;return i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,i}getTransformTo(t){let i=this._transform;t._positionX=i._positionX,t._positionY=i._positionY,t._positionZ=i._positionZ,t._rotation00=i._rotation00,t._rotation01=i._rotation01,t._rotation02=i._rotation02,t._rotation10=i._rotation10,t._rotation11=i._rotation11,t._rotation12=i._rotation12,t._rotation20=i._rotation20,t._rotation21=i._rotation21,t._rotation22=i._rotation22}setLocalTransform(t){let i=this._localTransform;if(i._positionX=t._positionX,i._positionY=t._positionY,i._positionZ=t._positionZ,i._rotation00=t._rotation00,i._rotation01=t._rotation01,i._rotation02=t._rotation02,i._rotation10=t._rotation10,i._rotation11=t._rotation11,i._rotation12=t._rotation12,i._rotation20=t._rotation20,i._rotation21=t._rotation21,i._rotation22=t._rotation22,this._rigidBody!=null){let s=this._rigidBody;s.updateMass();let o=s._shapeList;for(;o!=null;){let n=o._next,l=s._ptransform,_=s._transform,r=o._ptransform,e=o._localTransform,a,h,b,X,c,Y,p,x,v;a=l._rotation00*e._rotation00+l._rotation01*e._rotation10+l._rotation02*e._rotation20,h=l._rotation00*e._rotation01+l._rotation01*e._rotation11+l._rotation02*e._rotation21,b=l._rotation00*e._rotation02+l._rotation01*e._rotation12+l._rotation02*e._rotation22,X=l._rotation10*e._rotation00+l._rotation11*e._rotation10+l._rotation12*e._rotation20,c=l._rotation10*e._rotation01+l._rotation11*e._rotation11+l._rotation12*e._rotation21,Y=l._rotation10*e._rotation02+l._rotation11*e._rotation12+l._rotation12*e._rotation22,p=l._rotation20*e._rotation00+l._rotation21*e._rotation10+l._rotation22*e._rotation20,x=l._rotation20*e._rotation01+l._rotation21*e._rotation11+l._rotation22*e._rotation21,v=l._rotation20*e._rotation02+l._rotation21*e._rotation12+l._rotation22*e._rotation22,r._rotation00=a,r._rotation01=h,r._rotation02=b,r._rotation10=X,r._rotation11=c,r._rotation12=Y,r._rotation20=p,r._rotation21=x,r._rotation22=v;let f,Z,k;f=l._rotation00*e._positionX+l._rotation01*e._positionY+l._rotation02*e._positionZ,Z=l._rotation10*e._positionX+l._rotation11*e._positionY+l._rotation12*e._positionZ,k=l._rotation20*e._positionX+l._rotation21*e._positionY+l._rotation22*e._positionZ,r._positionX=f,r._positionY=Z,r._positionZ=k,r._positionX+=l._positionX,r._positionY+=l._positionY,r._positionZ+=l._positionZ;let g=o._transform,I=o._localTransform,z,d,u,B,j,L,V,M,w;z=_._rotation00*I._rotation00+_._rotation01*I._rotation10+_._rotation02*I._rotation20,d=_._rotation00*I._rotation01+_._rotation01*I._rotation11+_._rotation02*I._rotation21,u=_._rotation00*I._rotation02+_._rotation01*I._rotation12+_._rotation02*I._rotation22,B=_._rotation10*I._rotation00+_._rotation11*I._rotation10+_._rotation12*I._rotation20,j=_._rotation10*I._rotation01+_._rotation11*I._rotation11+_._rotation12*I._rotation21,L=_._rotation10*I._rotation02+_._rotation11*I._rotation12+_._rotation12*I._rotation22,V=_._rotation20*I._rotation00+_._rotation21*I._rotation10+_._rotation22*I._rotation20,M=_._rotation20*I._rotation01+_._rotation21*I._rotation11+_._rotation22*I._rotation21,w=_._rotation20*I._rotation02+_._rotation21*I._rotation12+_._rotation22*I._rotation22,g._rotation00=z,g._rotation01=d,g._rotation02=u,g._rotation10=B,g._rotation11=j,g._rotation12=L,g._rotation20=V,g._rotation21=M,g._rotation22=w;let P,E,C;P=_._rotation00*I._positionX+_._rotation01*I._positionY+_._rotation02*I._positionZ,E=_._rotation10*I._positionX+_._rotation11*I._positionY+_._rotation12*I._positionZ,C=_._rotation20*I._positionX+_._rotation21*I._positionY+_._rotation22*I._positionZ,g._positionX=P,g._positionY=E,g._positionZ=C,g._positionX+=_._positionX,g._positionY+=_._positionY,g._positionZ+=_._positionZ;let S,A,R,H,y,D;if(o._geom._computeAabb(o._aabb,o._ptransform),S=o._aabb._minX,A=o._aabb._minY,R=o._aabb._minZ,H=o._aabb._maxX,y=o._aabb._maxY,D=o._aabb._maxZ,o._geom._computeAabb(o._aabb,o._transform),o._aabb._minX=S<o._aabb._minX?S:o._aabb._minX,o._aabb._minY=A<o._aabb._minY?A:o._aabb._minY,o._aabb._minZ=R<o._aabb._minZ?R:o._aabb._minZ,o._aabb._maxX=H>o._aabb._maxX?H:o._aabb._maxX,o._aabb._maxY=y>o._aabb._maxY?y:o._aabb._maxY,o._aabb._maxZ=D>o._aabb._maxZ?D:o._aabb._maxZ,o._proxy!=null){let F,Q,W;F=o._transform._positionX-o._ptransform._positionX,Q=o._transform._positionY-o._ptransform._positionY,W=o._transform._positionZ-o._ptransform._positionZ;let q=o.displacement;q.x=F,q.y=Q,q.z=W,o._rigidBody._world._broadPhase.moveProxy(o._proxy,o._aabb,o.displacement)}o=n}}}getDensity(){return this._density}setDensity(t){if(this._density=t,this._rigidBody!=null){let i=this._rigidBody;i.updateMass();let s=i._shapeList;for(;s!=null;){let o=s._next,n=i._ptransform,l=i._transform,_=s._ptransform,r=s._localTransform,e,a,h,b,X,c,Y,p,x;e=n._rotation00*r._rotation00+n._rotation01*r._rotation10+n._rotation02*r._rotation20,a=n._rotation00*r._rotation01+n._rotation01*r._rotation11+n._rotation02*r._rotation21,h=n._rotation00*r._rotation02+n._rotation01*r._rotation12+n._rotation02*r._rotation22,b=n._rotation10*r._rotation00+n._rotation11*r._rotation10+n._rotation12*r._rotation20,X=n._rotation10*r._rotation01+n._rotation11*r._rotation11+n._rotation12*r._rotation21,c=n._rotation10*r._rotation02+n._rotation11*r._rotation12+n._rotation12*r._rotation22,Y=n._rotation20*r._rotation00+n._rotation21*r._rotation10+n._rotation22*r._rotation20,p=n._rotation20*r._rotation01+n._rotation21*r._rotation11+n._rotation22*r._rotation21,x=n._rotation20*r._rotation02+n._rotation21*r._rotation12+n._rotation22*r._rotation22,_._rotation00=e,_._rotation01=a,_._rotation02=h,_._rotation10=b,_._rotation11=X,_._rotation12=c,_._rotation20=Y,_._rotation21=p,_._rotation22=x;let v,f,Z;v=n._rotation00*r._positionX+n._rotation01*r._positionY+n._rotation02*r._positionZ,f=n._rotation10*r._positionX+n._rotation11*r._positionY+n._rotation12*r._positionZ,Z=n._rotation20*r._positionX+n._rotation21*r._positionY+n._rotation22*r._positionZ,_._positionX=v,_._positionY=f,_._positionZ=Z,_._positionX+=n._positionX,_._positionY+=n._positionY,_._positionZ+=n._positionZ;let k=s._transform,g=s._localTransform,I,z,d,u,B,j,L,V,M;I=l._rotation00*g._rotation00+l._rotation01*g._rotation10+l._rotation02*g._rotation20,z=l._rotation00*g._rotation01+l._rotation01*g._rotation11+l._rotation02*g._rotation21,d=l._rotation00*g._rotation02+l._rotation01*g._rotation12+l._rotation02*g._rotation22,u=l._rotation10*g._rotation00+l._rotation11*g._rotation10+l._rotation12*g._rotation20,B=l._rotation10*g._rotation01+l._rotation11*g._rotation11+l._rotation12*g._rotation21,j=l._rotation10*g._rotation02+l._rotation11*g._rotation12+l._rotation12*g._rotation22,L=l._rotation20*g._rotation00+l._rotation21*g._rotation10+l._rotation22*g._rotation20,V=l._rotation20*g._rotation01+l._rotation21*g._rotation11+l._rotation22*g._rotation21,M=l._rotation20*g._rotation02+l._rotation21*g._rotation12+l._rotation22*g._rotation22,k._rotation00=I,k._rotation01=z,k._rotation02=d,k._rotation10=u,k._rotation11=B,k._rotation12=j,k._rotation20=L,k._rotation21=V,k._rotation22=M;let w,P,E;w=l._rotation00*g._positionX+l._rotation01*g._positionY+l._rotation02*g._positionZ,P=l._rotation10*g._positionX+l._rotation11*g._positionY+l._rotation12*g._positionZ,E=l._rotation20*g._positionX+l._rotation21*g._positionY+l._rotation22*g._positionZ,k._positionX=w,k._positionY=P,k._positionZ=E,k._positionX+=l._positionX,k._positionY+=l._positionY,k._positionZ+=l._positionZ;let C,S,A,R,H,y;if(s._geom._computeAabb(s._aabb,s._ptransform),C=s._aabb._minX,S=s._aabb._minY,A=s._aabb._minZ,R=s._aabb._maxX,H=s._aabb._maxY,y=s._aabb._maxZ,s._geom._computeAabb(s._aabb,s._transform),s._aabb._minX=C<s._aabb._minX?C:s._aabb._minX,s._aabb._minY=S<s._aabb._minY?S:s._aabb._minY,s._aabb._minZ=A<s._aabb._minZ?A:s._aabb._minZ,s._aabb._maxX=R>s._aabb._maxX?R:s._aabb._maxX,s._aabb._maxY=H>s._aabb._maxY?H:s._aabb._maxY,s._aabb._maxZ=y>s._aabb._maxZ?y:s._aabb._maxZ,s._proxy!=null){let D,F,Q;D=s._transform._positionX-s._ptransform._positionX,F=s._transform._positionY-s._ptransform._positionY,Q=s._transform._positionZ-s._ptransform._positionZ;let W=s.displacement;W.x=D,W.y=F,W.z=Q,s._rigidBody._world._broadPhase.moveProxy(s._proxy,s._aabb,s.displacement)}s=o}}}getAabb(){return this._aabb.clone()}getAabbTo(t){t.copyFrom(this._aabb)}getGeometry(){return this._geom}getRigidBody(){return this._rigidBody}getCollisionGroup(){return this._collisionGroup}setCollisionGroup(t){this._collisionGroup=t}getCollisionMask(){return this._collisionMask}setCollisionMask(t){this._collisionMask=t}getContactCallback(){return this._contactCallback}setContactCallback(t){this._contactCallback=t}getPrev(){return this._prev}getNext(){return this._next}};m.dynamics.rigidbody.ShapeConfig=class{constructor(){this.position=new m.common.Vec3,this.rotation=new m.common.Mat3,this.friction=m.common.Setting.defaultFriction,this.restitution=m.common.Setting.defaultRestitution,this.density=m.common.Setting.defaultDensity,this.collisionGroup=m.common.Setting.defaultCollisionGroup,this.collisionMask=m.common.Setting.defaultCollisionMask,this.geometry=null,this.contactCallback=null}};m.m||(m.m={});m.m.M=class{};m.collision.broadphase.BroadPhaseType._BRUTE_FORCE=1;m.collision.broadphase.BroadPhaseType._BVH=2;m.collision.broadphase.BroadPhaseType.BRUTE_FORCE=1;m.collision.broadphase.BroadPhaseType.BVH=2;m.collision.broadphase.bvh.BvhInsertionStrategy.SIMPLE=0;m.collision.broadphase.bvh.BvhInsertionStrategy.MINIMIZE_SURFACE_AREA=1;m.collision.geometry.GeometryType._SPHERE=0;m.collision.geometry.GeometryType._BOX=1;m.collision.geometry.GeometryType._CYLINDER=2;m.collision.geometry.GeometryType._CONE=3;m.collision.geometry.GeometryType._CAPSULE=4;m.collision.geometry.GeometryType._CONVEX_HULL=5;m.collision.geometry.GeometryType._CONVEX_MIN=0;m.collision.geometry.GeometryType._CONVEX_MAX=5;m.collision.geometry.GeometryType.SPHERE=0;m.collision.geometry.GeometryType.BOX=1;m.collision.geometry.GeometryType.CYLINDER=2;m.collision.geometry.GeometryType.CONE=3;m.collision.geometry.GeometryType.CAPSULE=4;m.collision.geometry.GeometryType.CONVEX_HULL=5;m.collision.narrowphase.detector.BoxBoxDetector.EDGE_BIAS_MULT=1;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.OK=0;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.INVALID_TRIANGLE=1;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_PAIR_INDEX=2;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_ADJACENT_TRIANGLE=3;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.EDGE_LOOP_BROKEN=4;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.NO_OUTER_TRIANGLE=5;m.collision.narrowphase.detector.gjkepa.EpaPolyhedronState.TRIANGLE_INVISIBLE=6;m.collision.narrowphase.detector.gjkepa.EpaTriangle.count=0;m.common.Vec3.numCreations=0;m.common.Setting.defaultFriction=.2;m.common.Setting.defaultRestitution=.2;m.common.Setting.defaultDensity=1;m.common.Setting.defaultCollisionGroup=1;m.common.Setting.defaultCollisionMask=1;m.common.Setting.maxTranslationPerStep=20;m.common.Setting.maxRotationPerStep=3.14159265358979;m.common.Setting.bvhProxyPadding=.1;m.common.Setting.bvhIncrementalCollisionThreshold=.45;m.common.Setting.defaultGJKMargin=.05;m.common.Setting.enableGJKCaching=!0;m.common.Setting.maxEPAVertices=128;m.common.Setting.maxEPAPolyhedronFaces=128;m.common.Setting.contactEnableBounceThreshold=.5;m.common.Setting.velocityBaumgarte=.2;m.common.Setting.positionSplitImpulseBaumgarte=.4;m.common.Setting.positionNgsBaumgarte=1;m.common.Setting.contactUseAlternativePositionCorrectionAlgorithmDepthThreshold=.05;m.common.Setting.defaultContactPositionCorrectionAlgorithm=0;m.common.Setting.alternativeContactPositionCorrectionAlgorithm=1;m.common.Setting.contactPersistenceThreshold=.05;m.common.Setting.maxManifoldPoints=4;m.common.Setting.defaultJointConstraintSolverType=0;m.common.Setting.defaultJointPositionCorrectionAlgorithm=0;m.common.Setting.jointWarmStartingFactorForBaungarte=.8;m.common.Setting.jointWarmStartingFactor=.95;m.common.Setting.minSpringDamperDampingRatio=1e-6;m.common.Setting.minRagdollMaxSwingAngle=1e-6;m.common.Setting.maxJacobianRows=6;m.common.Setting.directMlcpSolverEps=1e-9;m.common.Setting.islandInitialRigidBodyArraySize=128;m.common.Setting.islandInitialConstraintArraySize=128;m.common.Setting.sleepingVelocityThreshold=.2;m.common.Setting.sleepingAngularVelocityThreshold=.5;m.common.Setting.sleepingTimeThreshold=1;m.common.Setting.disableSleeping=!1;m.common.Setting.linearSlop=.005;m.common.Setting.angularSlop=.017453292519943278;m.collision.narrowphase.detector.gjkepa.GjkEpa.instance=new m.collision.narrowphase.detector.gjkepa.GjkEpa;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._SUCCEEDED=0;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_FAILED_TO_MAKE_TETRAHEDRON=1;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._GJK_DID_NOT_CONVERGE=2;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_INIT=257;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_FAILED_TO_ADD_VERTEX=258;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState._EPA_DID_NOT_CONVERGE=259;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.SUCCEEDED=0;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_FAILED_TO_MAKE_TETRAHEDRON=1;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.GJK_DID_NOT_CONVERGE=2;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_INIT=257;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_FAILED_TO_ADD_VERTEX=258;m.collision.narrowphase.detector.gjkepa.GjkEpaResultState.EPA_DID_NOT_CONVERGE=259;m.common.Mat3.numCreations=0;m.common.Mat4.numCreations=0;m.common.MathUtil.POSITIVE_INFINITY=1/0;m.common.MathUtil.NEGATIVE_INFINITY=-1/0;m.common.MathUtil.PI=3.14159265358979;m.common.MathUtil.TWO_PI=6.28318530717958;m.common.MathUtil.HALF_PI=1.570796326794895;m.common.MathUtil.TO_RADIANS=.017453292519943278;m.common.MathUtil.TO_DEGREES=57.29577951308238;m.common.Quat.numCreations=0;m.dynamics.common.DebugDraw.SPHERE_PHI_DIVISION=8;m.dynamics.common.DebugDraw.SPHERE_THETA_DIVISION=4;m.dynamics.common.DebugDraw.CIRCLE_THETA_DIVISION=8;m.dynamics.common.Performance.broadPhaseCollisionTime=0;m.dynamics.common.Performance.narrowPhaseCollisionTime=0;m.dynamics.common.Performance.dynamicsTime=0;m.dynamics.common.Performance.totalTime=0;m.dynamics.constraint.PositionCorrectionAlgorithm._BAUMGARTE=0;m.dynamics.constraint.PositionCorrectionAlgorithm._SPLIT_IMPULSE=1;m.dynamics.constraint.PositionCorrectionAlgorithm._NGS=2;m.dynamics.constraint.PositionCorrectionAlgorithm.BAUMGARTE=0;m.dynamics.constraint.PositionCorrectionAlgorithm.SPLIT_IMPULSE=1;m.dynamics.constraint.PositionCorrectionAlgorithm.NGS=2;m.dynamics.constraint.info.JacobianRow.BIT_LINEAR_SET=1;m.dynamics.constraint.info.JacobianRow.BIT_ANGULAR_SET=2;m.dynamics.constraint.joint.JointType._SPHERICAL=0;m.dynamics.constraint.joint.JointType._REVOLUTE=1;m.dynamics.constraint.joint.JointType._CYLINDRICAL=2;m.dynamics.constraint.joint.JointType._PRISMATIC=3;m.dynamics.constraint.joint.JointType._UNIVERSAL=4;m.dynamics.constraint.joint.JointType._RAGDOLL=5;m.dynamics.constraint.joint.JointType._GENERIC=6;m.dynamics.constraint.joint.JointType.SPHERICAL=0;m.dynamics.constraint.joint.JointType.REVOLUTE=1;m.dynamics.constraint.joint.JointType.CYLINDRICAL=2;m.dynamics.constraint.joint.JointType.PRISMATIC=3;m.dynamics.constraint.joint.JointType.UNIVERSAL=4;m.dynamics.constraint.joint.JointType.RAGDOLL=5;m.dynamics.constraint.joint.JointType.GENERIC=6;m.dynamics.constraint.solver.ConstraintSolverType._ITERATIVE=0;m.dynamics.constraint.solver.ConstraintSolverType._DIRECT=1;m.dynamics.constraint.solver.ConstraintSolverType.ITERATIVE=0;m.dynamics.constraint.solver.ConstraintSolverType.DIRECT=1;m.dynamics.rigidbody.RigidBodyType._DYNAMIC=0;m.dynamics.rigidbody.RigidBodyType._STATIC=1;m.dynamics.rigidbody.RigidBodyType._KINEMATIC=2;m.dynamics.rigidbody.RigidBodyType.DYNAMIC=0;m.dynamics.rigidbody.RigidBodyType.STATIC=1;m.dynamics.rigidbody.RigidBodyType.KINEMATIC=2;const ls=m.dynamics.World,Ie=m.dynamics.rigidbody.RigidBodyType,Se=m.dynamics.rigidbody.RigidBodyConfig,Te=m.dynamics.rigidbody.ShapeConfig,je=m.dynamics.rigidbody.RigidBody,Re=m.dynamics.rigidbody.Shape;m.dynamics.constraint.joint.SphericalJoint;m.dynamics.constraint.joint.RevoluteJointConfig;m.dynamics.constraint.joint.UniversalJointConfig;m.dynamics.constraint.joint.CylindricalJoint;m.dynamics.constraint.joint.PrismaticJoint;m.dynamics.constraint.joint.PrismaticJointConfig;m.dynamics.constraint.joint.RevoluteJoint;m.dynamics.constraint.joint.RagdollJoint;m.dynamics.constraint.joint.CylindricalJointConfig;m.dynamics.constraint.joint.SphericalJointConfig;m.dynamics.constraint.joint.RagdollJointConfig;m.dynamics.constraint.joint.SpringDamper;m.dynamics.constraint.joint.TranslationalLimitMotor;m.dynamics.constraint.joint.RotationalLimitMotor;m.dynamics.constraint.joint.UniversalJoint;const Ye=m.common.Vec3;m.common.Quat;m.common.Mat3;m.common.MathUtil;m.common.Transform;m.collision.geometry.CapsuleGeometry;m.collision.geometry.ConvexHullGeometry;const rs=m.collision.geometry.BoxGeometry,hs=m.collision.geometry.SphereGeometry;m.collision.geometry.CylinderGeometry;m.collision.geometry.ConeGeometry;m.collision.geometry.Geometry;m.dynamics.callback.RayCastClosest;async function cs(){const t=new ls(2,new Ye(0,-9.8,0));function i(h){const b=h.parameters;if(h.type==="BoxGeometry"){const X=b.width!==void 0?b.width/2:.5,c=b.height!==void 0?b.height/2:.5,Y=b.depth!==void 0?b.depth/2:.5;return new rs(new Ye(X,c,Y))}else if(h.type==="SphereGeometry"||h.type==="IcosahedronGeometry"){const X=b.radius!==void 0?b.radius:1;return new hs(X)}return null}const s=[],o=new WeakMap;function n(h,b=0){const X=i(h.geometry);X!==null&&(h.isInstancedMesh?_(h,b,X):h.isMesh&&l(h,b,X))}function l(h,b,X){const c=new Te;c.geometry=X;const Y=new Se;Y.type=b===0?Ie.STATIC:Ie.DYNAMIC,Y.position=new Ye(h.position.x,h.position.y,h.position.z);const p=new je(Y);p.addShape(new Re(c)),t.addRigidBody(p),b>0&&(s.push(h),o.set(h,p))}function _(h,b,X){const c=h.instanceMatrix.array,Y=[];for(let p=0;p<h.count;p++){const x=p*16,v=new Te;v.geometry=X;const f=new Se;f.type=b===0?Ie.STATIC:Ie.DYNAMIC,f.position=new Ye(c[x+12],c[x+13],c[x+14]);const Z=new je(f);Z.addShape(new Re(v)),t.addRigidBody(Z),Y.push(Z)}b>0&&(s.push(h),o.set(h,Y))}function r(h,b,X=0){h.isInstancedMesh?o.get(h)[X].setPosition(new Ye(b.x,b.y,b.z)):h.isMesh&&o.get(h).setPosition(new Ye(b.x,b.y,b.z))}let e=0;function a(){const h=performance.now();e>0&&t.step(1/60),e=h;for(let b=0,X=s.length;b<X;b++){const c=s[b];if(c.isInstancedMesh){const Y=c.instanceMatrix.array,p=o.get(c);for(let x=0;x<p.length;x++){const v=p[x];ms(v.getPosition(),v.getOrientation(),Y,x*16)}c.instanceMatrix.needsUpdate=!0}else if(c.isMesh){const Y=o.get(c);c.position.copy(Y.getPosition()),c.quaternion.copy(Y.getOrientation())}}}return setInterval(a,1e3/60),{addMesh:n,setMeshPosition:r}}function ms(Qt,t,i,s){const o=t.x,n=t.y,l=t.z,_=t.w,r=o+o,e=n+n,a=l+l,h=o*r,b=o*e,X=o*a,c=n*e,Y=n*a,p=l*a,x=_*r,v=_*e,f=_*a;i[s+0]=1-(c+p),i[s+1]=b+f,i[s+2]=X-v,i[s+3]=0,i[s+4]=b-f,i[s+5]=1-(h+p),i[s+6]=Y+x,i[s+7]=0,i[s+8]=X+v,i[s+9]=Y-x,i[s+10]=1-(h+c),i[s+11]=0,i[s+12]=Qt.x,i[s+13]=Qt.y,i[s+14]=Qt.z,i[s+15]=1}const ps={name:"Physics"},bs=ss({...ps,setup(Qt){let t,i,s,o,n;const{el:l,width:_,height:r}=Ne();function e(){t=new Ge,t.background=new Ae(14540253)}function a(){i=new Je(75,_.value/r.value,.1,1e3),i.position.set(0,3,3),i.lookAt(0,0,0)}function h(){s=new Qe,s.setPixelRatio(window.devicePixelRatio),s.outputEncoding=Oe,s.setSize(_.value,r.value),l.value.appendChild(s.domElement)}function b(){o=new He(i,s.domElement),o.update()}let X;function c(){const z=new Ue(14540253,.5);t.add(z),X=new Ke(16777215,.3),X.position.set(3,3,3),t.add(X)}let Y,p,x;function v(){const z=new Be(.1,.1,.1),d=new Ee;Y=new Pe(z,d,100);const u=new $e,B=new Ae;for(let V=0;V<Y.count;V++)u.setPosition(Math.random()-.5,Math.random()*2,Math.random()-.5),B.setHex(16777215*Math.random()),Y.setMatrixAt(V,u),Y.setColorAt(V,B);Y.instanceMatrix.setUsage(Ce),t.add(Y);const j=new ts(.1,3),L=new Ee;p=new Pe(j,L,100);for(let V=0;V<p.count;V++)u.setPosition(Math.random()-.5,Math.random()*2,Math.random()-.5),B.setHex(16777215*Math.random()),p.setMatrixAt(V,u),p.setColorAt(V,B);p.instanceMatrix.setUsage(Ce),t.add(p),x=new is(new Be(10,.4,10),new es({color:3355443})),x.position.set(0,-1,0),t.add(x)}function f(){Y.castShadow=!0,x.receiveShadow=!0,s.shadowMap.enabled=!0,X.shadow.camera.zoom=2,X.castShadow=!0}async function Z(){n=await cs(),n.addMesh(x),n.addMesh(p,1),n.addMesh(Y,1)}let k;var g=new We;function I(){k=requestAnimationFrame(I),s.render(t,i),o.update();const z=Math.floor(Math.random()*Y.count);g.set(0,Math.random()*2,0),n.setMeshPosition(Y,g,z);const d=Math.floor(Math.random()*Y.count);g.set(0,Math.random()*2,0),n.setMeshPosition(p,g,d)}return as(async()=>{e(),a(),h(),b(),c(),v(),f(),await Z(),I()}),ns(()=>{cancelAnimationFrame(k),s.dispose(),o.dispose(),s.domElement.remove()}),(z,d)=>(Fe(),De("div",{ref_key:"el",ref:l,"h-500px":"",class:"border-2 border-gray-300"},null,512))}}),vs=Me("h1",{id:"phisycs",tabindex:"-1"},[qe("Phisycs "),Me("a",{class:"header-anchor",href:"#phisycs","aria-label":'Permalink to "Phisycs"'},"​")],-1),xs=Me("h2",{id:"preview",tabindex:"-1"},[qe("preview "),Me("a",{class:"header-anchor",href:"#preview","aria-label":'Permalink to "preview"'},"​")],-1),fs=Me("p",null,"This example demonstrates how to use a physics engine to simulate the effects of collisions between several objects.",-1),Xs=_s("",9),Fn=JSON.parse('{"title":"Phisycs","description":"","frontmatter":{},"headers":[],"relativePath":"part-01/05-physics/README.md","filePath":"part-01/05-physics/README.md"}'),ys={name:"part-01/05-physics/README.md"},Dn=Object.assign(ys,{setup(Qt){return(t,i)=>(Fe(),De("div",null,[vs,xs,fs,os(bs),Xs]))}});export{Fn as __pageData,Dn as default};
